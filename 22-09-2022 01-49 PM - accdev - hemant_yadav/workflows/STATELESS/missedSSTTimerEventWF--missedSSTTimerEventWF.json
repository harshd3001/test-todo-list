{"appendTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"{ if (Array.isArray(contextVar.moreWorkOrderTaskData)) { contextVar.workOrderTaskDataToAutoSchedule = contextVar.workOrderTaskDataToAutoSchedule.concat(contextVar.moreWorkOrderTaskData); } contextVar.tasksBatchNumber++; }","nodeType":"PROCESS"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{ contextVar.noOfTasksBatches = Math.ceil(contextVar.tasksCount/contextVar.customBatchSize); contextVar.tasksBatchNumber++; }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFilterData"}],"name":"start","description":"start","nodeType":"START"},"fetchTaskData":{"models":["workOrderTask","site","workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"areTasksPresent"}],"columns":{"workOrderTaskDueDate":"workOrderTask.dueDate","workOrderTaskTypeId":"workOrderTask.taskTypeId","slaDeadline":"workOrder.deadline","workOrderTaskId":"workOrderTask.id","workOrderTaskRegionId":"site.regionId","workOrderTaskCustomerId":"workOrder.customerId","workOrderTaskWorkOrderTypeId":"workOrder.workOrderTypeId"},"description":"fetchTaskData","outerJoinOnModel":"workOrderTask","inputVarMap":{"customBatchSize":"batchSize","filter":"filter","currentDate":"currentDate","statusIds":"statusIds"},"nodeType":"QUERY","filter":"{@filter}","name":"fetchTaskData","links":{"workOrder":"workOrderTask","workOrderTask":"site"},"outputVarMap":{"data":"workOrderTaskDataToAutoSchedule","count":"tasksCount","batchNumber":"tasksBatchNumber"},"batchSize":"batchSize","getCount":true},"callSchedulerUpsertWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"schedulerLogModelWF","name":"callSchedulerUpsertWF","description":"callSchedulerUpsertWF","inputVarMap":{"subAction":"subAction","schedulerLog":"schedulerLog"},"nodeType":"WORKFLOW"},"areTasksPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"findNumberOfBatches"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areTasksPresent","description":"areTasksPresent","processRule":"(typeof contextVar.workOrderTaskDataToAutoSchedule !== 'undefined' &&  contextVar.workOrderTaskDataToAutoSchedule !=='')","nodeType":"DECISION"},"workflowNodes":["start","processFilterData","fetchTaskData","areTasksPresent","findNumberOfBatches","areMoreBatchesPresent","getMoreTasksData","appendTasks","processWorkOrderTaskData","callSchedulerUpsertWF","end"],"processFilterData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskData"}],"contextChangePermitted":true,"name":"processFilterData","description":"processFilterData","processRule":"{contextVar.currentDate = new Date(); contextVar.currentDate.setMinutes(contextVar.currentDate.getMinutes() - 60); contextVar.currentDate.setSeconds(0, 0); contextVar.currentDate = contextVar.currentDate.toISOString().replace('T', ' ').replace('Z', ''); contextVar.filter = '{$workOrderTask.statusId} IN {@statusIds} AND {$workOrderTask.scheduledDate} <= {@currentDate}';}","nodeType":"PROCESS"},"areMoreBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreTasksData"},{"exitPortType":"FalseStep","nodeId":"processWorkOrderTaskData"}],"name":"areMoreBatchesPresent","description":"areMoreBatchesPresent","processRule":"(contextVar.noOfTasksBatches >= 2 && contextVar.noOfTasksBatches >= contextVar.tasksBatchNumber)","nodeType":"DECISION"},"getMoreTasksData":{"models":["workOrderTask","site","workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTasks"}],"columns":{"workOrderTaskDueDate":"workOrderTask.dueDate","workOrderTaskTypeId":"workOrderTask.taskTypeId","slaDeadline":"workOrder.deadline","workOrderTaskStatus":"workOrderTask.statusId","workOrderTaskId":"workOrderTask.id","workOrderTaskRegionId":"site.regionId"},"outerJoinOnModel":"workOrderTask","description":"getMoreTasksData","inputVarMap":{"customBatchSize":"batchSize","filter":"filter","tasksBatchNumber":"batchNumber","currentDate":"currentDate","statusIds":"statusIds"},"nodeType":"QUERY","filter":"{@filter}","name":"getMoreTasksData","links":{"workOrder":"workOrderTask","workOrderTask":"site"},"outputVarMap":{"data":"moreWorkOrderTaskData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"workflowContext":{"customBatchSize":1000,"modelName":"BatchScheduler","statusTargetModel":"schedulerLog","noOfDaysSchedulerWillSearch":10,"subAction":"upsertSchedulerLog","noOfTasksBatches":0,"schedulerId":"XBX010O9UN","schedulerLog":[],"schedulerType":"missedSST","statusIds":["workOrderTaskOpen","workOrderTaskReopened","workOrderTaskScheduled","workOrderTaskDispatched"],"status":"schedulerLogQueued"},"processWorkOrderTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callSchedulerUpsertWF"}],"contextChangePermitted":true,"name":"processWorkOrderTaskData","description":"processWorkOrderTaskData","processRule":"@S8LLK1O3B5","nodeType":"PROCESS","jsEngine":"es6"},"end":{"name":"end","description":"end","inputVarMap":{"data":"data"},"outputVarMap":{"data":"data"},"nodeType":"END"}}