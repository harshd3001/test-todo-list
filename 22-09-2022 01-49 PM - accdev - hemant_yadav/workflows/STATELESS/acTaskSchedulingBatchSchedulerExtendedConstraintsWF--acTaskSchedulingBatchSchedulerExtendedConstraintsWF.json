{"processCapacityData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTaskCapacity"}],"contextChangePermitted":true,"name":"processCapacityData","description":"processCapacityData","processRule":"{ if (contextVar.taskAppointmentWindowData !== '' && typeof contextVar.taskAppointmentWindowData !== 'undefined') { contextVar.endDate = contextVar.taskAppointmentWindowData[0].endDate.slice(0, 11); contextVar.startDate = contextVar.taskAppointmentWindowData[0].startDate.slice(0, 11); var start = '00:00:00'; var end = '23:59:59'; contextVar.startDate = contextVar.startDate.concat(start); contextVar.endDate = contextVar.endDate.concat(end); } if (contextVar.techData !== '' && typeof contextVar.techData !== 'undefined') { contextVar.techCapacity = contextVar.techData[0].acCapacity; } if (contextVar.appriaserCapacityData !== '' && typeof contextVar.appriaserCapacityData !== 'undefined') { contextVar.appriaserCapacity = contextVar.appriaserCapacityData[0].acCapacity; } }","nodeType":"PROCESS"},"checkCapacity":{"connectors":[{"exitPortType":"NextStep","nodeId":"isSkillPresent"}],"contextChangePermitted":true,"name":"checkCapacity","description":"checkCapacity","processRule":"{ if (contextVar.taskCapacity < contextVar.techCapacity) { { if (contextVar.taskAppraiserCapacity < contextVar.appriaserCapacity) { contextVar.isValid = true; } else { contextVar.isValid = false; } } } else { contextVar.isValid = false; } }","nodeType":"PROCESS"},"processTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionCheckForStateSkill"}],"contextChangePermitted":true,"name":"processTaskData","description":"processTaskData","processRule":"{ if (contextVar.taskData !== '' && typeof contextVar.taskData !== 'undefined' && contextVar.taskData.length > 0) { contextVar.workOrderId = contextVar.taskData[0].workOrderId;contextVar.acPrimaryAppraiserId = contextVar.taskData[0].acPrimaryAppraiserId; contextVar.customerId = contextVar.taskData[0].customerId; if (contextVar.taskData[0].acTagComplex !== '' && typeof contextVar.taskData[0].acTagComplex !== 'undefined' && contextVar.taskData[0].acTagComplex !== '-') { contextVar.acTagComplex = contextVar.taskData[0].acTagComplex; } if (contextVar.taskData[0].acTagHistorical !== '' && typeof contextVar.taskData[0].acTagHistorical !== 'undefined' && contextVar.taskData[0].acTagHistorical !== '-') { contextVar.acTagHistorical = contextVar.taskData[0].acTagHistorical; } if (contextVar.taskData[0].acTagRural !== '' && typeof contextVar.taskData[0].acTagRural !== 'undefined' && contextVar.taskData[0].acTagRural !== '-') { contextVar.acTagRural = contextVar.taskData[0].acTagRural; } if (contextVar.taskData[0].state !== '' && typeof contextVar.taskData[0].state !== 'undefined' && contextVar.taskData[0].state !== '-' ) { contextVar.state = contextVar.taskData[0].state; contextVar.preState = 'Trainee License-'; contextVar.stateSkill = contextVar.preState.concat(contextVar.state); } } contextVar.skill = Object.keys(contextVar.techniciansSkill); contextVar.technicianSkill = []; contextVar.technicianSkill.push(contextVar.techniciansSkill); }","nodeType":"PROCESS"},"decisionCheckForRuralSkill":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchRuralSkill"},{"exitPortType":"FalseStep","nodeId":"decisionCheckForHistoricalSkill"}],"name":"decisionCheckForRuralSkill","description":"decisionCheckForRuralSkill","processRule":"{typeof contextVar.acTagRural !== 'undefined' && contextVar.acTagRural !== '' && contextVar.isValid === true}","nodeType":"DECISION"},"getTechCapacity":{"filter":"{$userId} = {@techId} ","models":["workforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"getAppraiserCapacity"}],"columns":{"acCapacity":"workforce.acCapacity","userId":"workforce.userId"},"name":"getTechCapacity","description":"getTechCapacity","distinct":true,"inputVarMap":{"acPrimaryAppraiserId":"acPrimaryAppraiserId","techId":"techId"},"outputVarMap":{"data":"techData"},"nodeType":"QUERY","getCount":true},"checkTechnicianWorkGroupEligibility":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"checkTechnicianWorkGroupEligibility","description":"checkTechnicianWorkGroupEligibility","processRule":"{ contextVar.isValid = false; let objectMap = {}; let workGroupFilter = ['region', 'customer', 'workOrderType', 'taskType']; if (Array.isArray(contextVar.userWorkGroupFilterData) && contextVar.userWorkGroupFilterData.length > 0) { for (let value of contextVar.userWorkGroupFilterData) { if (value.filterMethod === 'all') { contextVar.isValid = true; break; } if (typeof objectMap[value.filterMethod] === 'undefined') { objectMap[value.filterMethod] = []; } objectMap[value.filterMethod].push(value.filterId); } if (!contextVar.isValid) { contextVar.isValid = true; for (let val of workGroupFilter) { if (val in objectMap) { if (!(objectMap[val].indexOf(contextVar[`${val}Id`]) > -1)) { contextVar.isValid = false; break; } } } } } }","nodeType":"PROCESS","jsEngine":"es6"},"fetchHistoricalSkill":{"filter":"{$name} = {@acTagHistorical} && {$id} IN {@skill}","models":["skill","skillLevel"],"connectors":[{"exitPortType":"NextStep","nodeId":"processHistoricalSkillData"}],"columns":{"name":"skill.name","description":"skill.description","rank":"skillLevel.rank","id":"skill.id"},"name":"fetchHistoricalSkill","description":"fetchHistoricalSkill","distinct":true,"links":{"skillLevel":"skill"},"inputVarMap":{"skill":"skill","acTagHistorical":"acTagHistorical"},"outputVarMap":{"data":"historicalSkillData"},"nodeType":"QUERY","getCount":true},"workflowContext":{"customBatchSize":1000,"featureName":"batchScheduler","isValid":false,"extraMsg":"EXTENDED CONSTRAINTS: acTaskSchedulingBatchSchedulerExtendedConstraintsWF call"},"getTaskCapacity":{"filter":"{$workOrderId} != {@workOrderId} && {$workOrderTask.assignedToUserId} = {@techId} &&{$workOrderTask.scheduledDate} > {@startDate} && {$workOrderTask.scheduledDate} < {@endDate} && {$workOrderTask.statusId} != 'worOrderTaskPendingReview' && {$workOrderTask.statusId} != 'worOrderTaskCompleted' && {$workOrderTask.statusId} != 'workOrderTaskCancelled'","models":["workOrderTask","workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"getAppriaserTaskCapacity"}],"columns":{"date":"workOrderTask.scheduledDate","eventType":"workOrderTask.eventType","id":"workOrderTask.id","workOrderId":"workOrderTask.workOrderId"},"name":"getTaskCapacity","description":"getTaskCapacity","distinct":true,"inputVarMap":{"endDate":"endDate","workOrderId":"workOrderId","techId":"techId","startDate":"startDate"},"links":{"workOrderTask":"workOrder"},"outputVarMap":{"data":"taskCapacityData","count":"taskCapacity"},"nodeType":"QUERY","getCount":true},"fetchRuralSkill":{"filter":"{$name} = {@acTagRural} && {$id} IN {@skill}","models":["skill","skillLevel"],"connectors":[{"exitPortType":"NextStep","nodeId":"processRuralSkillData"}],"columns":{"name":"skill.name","description":"skill.description","rank":"skillLevel.rank","id":"skill.id"},"name":"fetchRuralSkill","description":"fetchRuralSkill","distinct":true,"links":{"skillLevel":"skill"},"inputVarMap":{"acTagRural":"acTagRural","skill":"skill"},"outputVarMap":{"data":"ruralData"},"nodeType":"QUERY","getCount":true},"processHistoricalSkillData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionCheckForComplexSkill"}],"contextChangePermitted":true,"name":"processHistoricalSkillData","description":"processHistoricalSkillData","processRule":"{ contextVar.finalHistoricalSkill = ''; if (contextVar.historicalSkillData !== '' && typeof contextVar.historicalSkillData !== 'undefined') { contextVar.skillId = contextVar.historicalSkillData[0].id; contextVar.rank = contextVar.historicalSkillData[0].rank; for (var x in contextVar.techniciansSkill) { if (contextVar.skillId == x && contextVar.rank == contextVar.techniciansSkill[x]) { contextVar.finalHistoricalSkill = x; } } } if (contextVar.finalHistoricalSkill !== '' && typeof contextVar.finalHistoricalSkill !== 'undefined') { contextVar.isValid = true; } else { contextVar.isValid = false; } }","nodeType":"PROCESS"},"end":{"name":"end","description":"End","inputVarMap":{"taskCapacity":"taskCapacity","endDate":"endDate","isValid":"isValid"},"outputVarMap":{"isValid":"isValid"},"nodeType":"END"},"decisionCheckForStateSkill":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchStateSkill"},{"exitPortType":"FalseStep","nodeId":"decisionCheckForRuralSkill"}],"name":"decisionCheckForStateSkill","description":"decisionCheckForStateSkill","processRule":"{typeof contextVar.state !== 'undefined' && contextVar.state !== ''}","nodeType":"DECISION"},"getTaskAppointmentWindow":{"filter":"{$workOrderTaskId} = {@workOrderTaskId}","models":["workOrderTaskAppointmentWindow"],"connectors":[{"exitPortType":"NextStep","nodeId":"processCapacityData"}],"columns":{"appointmentWindowId":"workOrderTaskAppointmentWindow.appointmentWindowId","recver":"recver","endDate":"workOrderTaskAppointmentWindow.endDate","workOrderTaskId":"workOrderTaskAppointmentWindow.workOrderTaskId","id":"workOrderTaskAppointmentWindow.id","startDate":"workOrderTaskAppointmentWindow.startDate"},"name":"getTaskAppointmentWindow","description":"getTaskAppointmentWindow","distinct":true,"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"taskAppointmentWindowData"},"nodeType":"QUERY","getCount":true},"fetchStateSkill":{"filter":"({$name} = {@state} || {$skill.name} = {@stateSkill}) && {$id} IN {@skill}","models":["skill","skillLevel"],"connectors":[{"exitPortType":"NextStep","nodeId":"processStateSkillData"}],"columns":{"name":"skillLevel.name","description":"skill.description","rank":"skillLevel.rank","id":"skill.id"},"name":"fetchStateSkill","description":"fetchStateSkill","distinct":true,"links":{"skillLevel":"skill"},"inputVarMap":{"stateSkill":"stateSkill","skill":"skill","state":"state"},"outputVarMap":{"data":"stateSkillData"},"nodeType":"QUERY","getCount":true},"getAppriaserTaskCapacity":{"filter":"{$workOrderId} != {@workOrderId} && {$workOrderTask.assignedToUserId} = {@acPrimaryAppraiserId} &&{$workOrderTask.scheduledDate} > {@startDate} && {$workOrderTask.scheduledDate} < {@endDate} && {$workOrderTask.statusId} != 'worOrderTaskPendingReview' && {$workOrderTask.statusId} != 'worOrderTaskCompleted'  && {$workOrderTask.statusId} != 'workOrderTaskCancelled'","models":["workOrderTask","workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"checkCapacity"}],"columns":{"date":"workOrderTask.scheduledDate","eventType":"workOrderTask.eventType","id":"workOrderTask.id","workOrderId":"workOrderTask.workOrderId"},"name":"getAppriaserTaskCapacity","description":"getAppriaserTaskCapacity","distinct":true,"inputVarMap":{"acPrimaryAppraiserId":"acPrimaryAppraiserId","endDate":"endDate","workOrderId":"workOrderId","startDate":"startDate"},"links":{"workOrderTask":"workOrder"},"outputVarMap":{"data":"taskAppraiserCapacityData","count":"taskAppraiserCapacity"},"nodeType":"QUERY","getCount":true},"getTaskData":{"filter":"{$id} = {@workOrderTaskId}","models":["workOrderTask","workOrder","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"processTaskData"}],"columns":{"acPrimaryAppraiserId":"workOrder.acPrimaryAppraiserId","acTagRural":"workOrder.acTagRural","customerId":"workOrder.customerId","acTagComplex":"workOrder.acTagComplex","state":"site.state","workOrderId":"workOrder.id","id":"workOrderTask.id","acTagHistorical":"workOrder.acTagHistorical"},"name":"getTaskData","description":"getTaskData","distinct":true,"outerJoinOnModel":"workOrderTask","inputVarMap":{"workOrderTaskId":"workOrderTaskId","techId":"techId"},"outputVarMap":{"data":"taskData"},"nodeType":"QUERY","getCount":true},"processComplexSkillData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isSkillPresent"}],"contextChangePermitted":true,"name":"processComplexSkillData","description":"processComplexSkillData","processRule":"{ contextVar.finalComplexSkill = ''; if (contextVar.complexSkillData !== '' && typeof contextVar.complexSkillData !== 'undefined') { contextVar.skillId = contextVar.complexSkillData[0].id; contextVar.rank = contextVar.complexSkillData[0].rank; for (var x in contextVar.techniciansSkill) { if (contextVar.skillId == x && contextVar.rank == contextVar.techniciansSkill[x]) { contextVar.finalComplexSkill = x; } } } if (contextVar.finalComplexSkill !== '' && typeof contextVar.finalComplexSkill !== 'undefined') { contextVar.isValid = true; } else { contextVar.isValid = false; } }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"logContextVar"}],"name":"start","description":"Start","nodeType":"START"},"logContextVar":{"connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"processId":"featureLoggerWF","name":"logContextVar","description":"logContextVar","inputVarMap":{"featureName":"featureName","extraMsg":"extraMsg"},"id":"logContextVar","outputVarMap":{},"nodeType":"WORKFLOW"},"decisionCheckForHistoricalSkill":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchHistoricalSkill"},{"exitPortType":"FalseStep","nodeId":"decisionCheckForComplexSkill"}],"name":"decisionCheckForHistoricalSkill","description":"decisionCheckForHistoricalSkill","processRule":"{typeof contextVar.acTagHistorical !== 'undefined' && contextVar.acTagHistorical !== '' && contextVar.isValid === true}","nodeType":"DECISION"},"getAppraiserCapacity":{"filter":"{$userId} = {@acPrimaryAppraiserId} ","models":["workforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"getTaskAppointmentWindow"}],"columns":{"acCapacity":"workforce.acCapacity","userId":"workforce.userId"},"name":"getAppraiserCapacity","description":"getAppraiserCapacity","distinct":true,"inputVarMap":{"acPrimaryAppraiserId":"acPrimaryAppraiserId"},"outputVarMap":{"data":"appriaserCapacityData"},"nodeType":"QUERY","getCount":true},"workflowNodes":["start","logContextVar","processData","getTaskData","processTaskData","decisionCheckForStateSkill","fetchStateSkill","processStateSkillData","decisionCheckForRuralSkill","fetchRuralSkill","processRuralSkillData","decisionCheckForHistoricalSkill","fetchHistoricalSkill","processHistoricalSkillData","decisionCheckForComplexSkill","fetchComplexSkill","processComplexSkillData","getTechCapacity","getAppraiserCapacity","getTaskAppointmentWindow","processCapacityData","getTaskCapacity","getAppriaserTaskCapacity","checkCapacity","isSkillPresent","getEligibleTechnicianIds","checkTechnicianWorkGroupEligibility","end"],"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTaskData"}],"contextChangePermitted":true,"name":"processData","description":"processData","processRule":"{ contextVar.userList = []; contextVar.userList.push(contextVar.tech.id); contextVar.techId = contextVar.tech.id; contextVar.workOrderTaskId = contextVar.taskDetail.id; contextVar.techniciansSkill = contextVar.tech.techniciansSkill; for (var key in contextVar.taskDetail) { contextVar[key] = contextVar.taskDetail[key]; } }","nodeType":"PROCESS"},"isSkillPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getEligibleTechnicianIds"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isSkillPresent","description":"isSkillPresent","processRule":"( contextVar.isValid === true )","nodeType":"DECISION"},"processStateSkillData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionCheckForRuralSkill"}],"contextChangePermitted":true,"name":"processStateSkillData","description":"processStateSkillData","processRule":"{ contextVar.finalSkill = ''; if (contextVar.stateSkillData !== '' && typeof contextVar.stateSkillData !== 'undefined') { contextVar.skillId = contextVar.stateSkillData[0].id; contextVar.rank = contextVar.stateSkillData[0].rank; for (var x in contextVar.techniciansSkill) { if (contextVar.skillId == x && contextVar.rank == contextVar.techniciansSkill[x]) { contextVar.finalSkill = x; } } } if(contextVar.finalSkill !== '' && typeof contextVar.finalSkill !== 'undefined' ){ contextVar.isValid = true; } else{ contextVar.isValid = false; } }","nodeType":"PROCESS"},"getEligibleTechnicianIds":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkTechnicianWorkGroupEligibility"}],"processId":"userWorkGroupFilterWF","name":"getEligibleTechnicianIds","description":"getEligibleTechnicianIds","inputVarMap":{"userList":"userList"},"outputVarMap":{},"nodeType":"WORKFLOW"},"processRuralSkillData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionCheckForHistoricalSkill"}],"contextChangePermitted":true,"name":"processRuralSkillData","description":"processRuralSkillData","processRule":"{ contextVar.finalRuralSkill = ''; if (contextVar.ruralData !== '' && typeof contextVar.ruralData !== 'undefined') { contextVar.skillId = contextVar.ruralData[0].id; contextVar.rank = contextVar.ruralData[0].rank; for (var x in contextVar.techniciansSkill) { if (contextVar.skillId == x && contextVar.rank == contextVar.techniciansSkill[x]) { contextVar.finalRuralSkill = x; } } } if (contextVar.finalRuralSkill !== '' && typeof contextVar.finalRuralSkill !== 'undefined') { contextVar.isValid = true; } else { contextVar.isValid = false; } }","nodeType":"PROCESS"},"decisionCheckForComplexSkill":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchComplexSkill"},{"exitPortType":"FalseStep","nodeId":"isSkillPresent"}],"name":"decisionCheckForComplexSkill","description":"decisionCheckForComplexSkill","processRule":"{typeof contextVar.acTagComplex !== 'undefined' && contextVar.acTagComplex !== '' && contextVar.isValid === true}","nodeType":"DECISION"},"fetchComplexSkill":{"filter":"{$name} = {@acTagComplex} && {$id} IN {@skill}","models":["skill","skillLevel"],"connectors":[{"exitPortType":"NextStep","nodeId":"processComplexSkillData"}],"columns":{"name":"skillLevel.name","description":"skill.description","rank":"skillLevel.rank","id":"skill.id"},"name":"fetchComplexSkill","description":"fetchComplexSkill","distinct":true,"links":{"skillLevel":"skill"},"inputVarMap":{"skill":"skill","acTagComplex":"acTagComplex"},"outputVarMap":{"data":"complexSkillData"},"nodeType":"QUERY","getCount":true}}