{"pageContext":{},"actionOnLoad":["@actions.decisionActionOnLoad","@actions.setInitialData"],"localPageContext":true,"jslib":{"isCompAddress":"function(pageContext){if((pageContext.compAddress=='' || typeof pageContext.compAddress=='undefined') && (pageContext.compAddress == pageContext.address)){return true;}else{return false;}}"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.clearFieldValues","@actions.openPreviousPanel"],"type":"buttonIcon"}]},"children":[],"title":"@lang.['eca2','Edit Comparable Address']"},"body":{"children":[{"children":[{"isRequired":true,"actionOnChange":"@actions.clearLocation","disabled":false,"id":"siteAddress","label":"@lang.['ca3','Comp Address']","placeholder":"@lang.['ea','Enter address']","type":"address","value":"@pageContext.compAddress"},{"buttonType":"primary","hidden":false,"actionOnClick":["@actions.modelUpdate","@actions.clearCompsData","@actions.openPreviousPanel","@actions.callReferenceData"],"disabled":"@jslib.isCompAddress","id":"button_3358","title":"@lang.['a15','Add']","type":"button","helperText":"","required":false}],"label":"@lang.['cp7','Comparable Property']","id":"customerSiteDetails","type":"section"}]},"actions":[{"endPoint":"process/start","alertMessage":true,"name":"callReferenceData","outputVarMap":{"data":"@pageContext.callReferenceData"},"type":"api","actionDef":{"data":[{"processId":"acRefDataUpdateInstance","contextVar":{"workOrderId":"@pageContext.workOrderId"}}]}},{"endPoint":"model/update","name":"modelUpdate","outputVarMap":{"data":"@pageContext.responseDataComp"},"type":"api","actionDef":{"data":[{"modelName":"acCompAddress","address":"@pageContext.compAddress","recver":"@pageContext.compAddressRecver","latitude":"@pageContext.latitude","id":"@pageContext.id","longitude":"@pageContext.longitude"}],"columns":["address","longitude","latitude"]}},{"name":"clearCompsData","type":"script","actionDef":"function (pageContext) { pageContext.compAddress = '';}"},{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { pageContext.compAddress = pageContext.address}"},{"name":"clearFieldValues","type":"script","actionDef":"function (pageContext) { if (pageContext.workOrderInventoryAction === 'edit' || pageContext.workOrderInventoryAction === 'addInitial') {  pageContext.workOrderTaskObj = []; pageContext.catalog = ''; pageContext.workOrderTaskId = ''; pageContext.taskId = ''; pageContext.workOrderInventoryUnitPrice = ''; pageContext.workOrderInventoryCustomerPrice = ''; pageContext.workOrderInventoryCatalogId = ''; pageContext.catalogModelNumber = '-'; pageContext.manufacturerName = '-'; pageContext.catalogName='';pageContext.catalogTypeName = '-'; pageContext.stockUnitName = '-'; pageContext.workOrderInventoryEstimatedQuantity = 0; } if (pageContext.workOrderInventoryAction === 'addInitial') { pageContext.workOrderInventoryAction = 'add'; } }"},{"name":"clearFieldOnAddParts","type":"script","actionDef":"function (pageContext) { pageContext.workOrderTaskObj =[]; pageContext.taskId = ''; pageContext.catalog = ''; pageContext.workOrderTaskId = '';pageContext.workOrderInventoryUnitPrice = ''; pageContext.workOrderInventoryCustomerPrice = ''; pageContext.workOrderInventoryCatalogId = '';pageContext.catalogName=''; pageContext.catalogModelNumber = '-'; pageContext.manufacturerName = '-'; pageContext.catalogTypeName = '-'; pageContext.stockUnitName = '-'; pageContext.workOrderInventoryEstimatedQuantity = 0; }"},{"falseStep":["@actions.fetchTaskID","@actions.setWorkOrderTaskId"],"trueStep":["@actions.clearFieldValues"],"name":"decisionActionOnLoad","type":"decision","actionDef":"function(pageContext){if(pageContext.workOrderInventoryAction === 'addInitial'||pageContext.workOrderInventoryAction === 'add'){return true;}}"},{"name":"refreshPartsAndMaterialsGrid","gridId":["partsAndMaterialsGrid"],"type":"RefreshGridOnSidePanel"},{"name":"setWorkOrderTaskId","type":"script","actionDef":"function (pageContext) { if (pageContext.workOrderTaskObj[0] === null || typeof pageContext.workOrderTaskObj === 'undefined' || pageContext.workOrderTaskObj === '' || typeof pageContext.workOrderTaskObj[0].value === 'undefined' || pageContext.workOrderTaskObj[0].value === '') { pageContext.taskId = ''; } else { pageContext.taskId = pageContext.workOrderTaskObj[0].value; } }"},{"name":"refreshWorkOrderInventoryDataGrid","gridId":["workOrderInventoryDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"openPreviousPanel","type":"backPanel"},{"name":"fetchTaskID","outputVarMap":{"data":"@pageContext.workOrderTaskObj"},"type":"query","actionDef":{"filter":"{$value}={@value}","models":["workOrderTask","taskType"],"columns":{"label":"CONCAT({$workOrderTask.id},' - ',{$taskType.name})","value":"workOrderTask.id"},"inputs":{"value":"@pageContext.workOrderTaskId"},"links":{"workOrderTask":"taskType"}}},{"falseStep":["@actions.clearCatalogData"],"trueStep":["@actions.setCatalogId","@actions.getSelectedCatalogData","@actions.setSelectedCatalogData"],"name":"decisionActionForCatalogData","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.catalog !=='undefined' && pageContext.catalog !=='' && pageContext.catalog[0] !== null) {return true;} return false;}"},{"name":"clearCatalogData","type":"script","actionDef":"function (pageContext) { pageContext.catalog='';pageContext.workOrderInventoryUnitPrice='-';pageContext.workOrderInventoryCustomerPrice='-';pageContext.workOrderInventoryCatalogId=''; pageContext.catalogModelNumber='-';pageContext.manufacturerName='-';pageContext.catalogTypeName='-';pageContext.stockUnitName='-';pageContext.workOrderInventoryEstimatedQuantity=0;}"},{"name":"setCatalogId","type":"script","actionDef":"function (pageContext) {pageContext.workOrderInventoryCatalogId=pageContext.catalog[0].value;}"},{"name":"updateWorkOrderInventoryGrid","type":"script","actionDef":"function (pageContext) { var partsMaterial = {}; partsMaterial = { 'workOrderId': pageContext.workOrderId, 'workOrderTaskId': pageContext.taskId ? pageContext.taskId : '-', 'customerPrice': Number(pageContext.workOrderInventoryCustomerPrice).toFixed(2), 'id': '', 'modelNumber': pageContext.catalogModelNumber, 'modelName': pageContext.catalogName, 'manufacturerName': pageContext.manufacturerName, 'unitPrice': Number(pageContext.workOrderInventoryUnitPrice).toFixed(2), 'catalogType': pageContext.catalogTypeName, 'catalogId': pageContext.workOrderInventoryCatalogId, 'estimatedQty': pageContext.workOrderInventoryEstimatedQuantity }; if (typeof pageContext.workOrderInventoryDataGrid !== 'undefined' && pageContext.workOrderInventoryDataGrid.length > 0) { var index = _.findLastIndex(pageContext.workOrderInventoryDataGrid, function (element) { return (((typeof partsMaterial.workOrderTaskId !== 'undefined' && partsMaterial.workOrderTaskId !== '' && element.workOrderTaskId == partsMaterial.workOrderTaskId) || (typeof partsMaterial.workOrderTaskId === 'undefined' || partsMaterial.workOrderTaskId === '') && (typeof element.workOrderTaskId === 'undefined' || element.workOrderTaskId === '')) && element.catalogId == partsMaterial.catalogId && element.unitPrice == partsMaterial.unitPrice && element.customerPrice == partsMaterial.customerPrice); }); if (index >= 0) { pageContext.workOrderInventoryDataGrid[index].estimatedQty = Number(partsMaterial.estimatedQty) + Number(pageContext.workOrderInventoryDataGrid[index].estimatedQty) } else { pageContext.workOrderInventoryDataGrid.push(partsMaterial); } } else { pageContext.workOrderInventoryDataGrid.push(partsMaterial); } }"},{"name":"getSelectedCatalogData","outputVarMap":{"data":"@pageContext.catalogData"},"type":"query","actionDef":{"filter":"{$catalogId} = {@catalogId}","models":["catalog","manufacturer","stockUnit","catalogType"],"inputs":{"catalogId":"@pageContext.workOrderInventoryCatalogId"},"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","cost":"catalog.unitPrice","catalogType":"catalogType.name","manufacturerName":"IF({$manufacturer.name}!='',{$manufacturer.name},'-')","modelNumber":"catalog.modelNumber","listPrice":"catalog.customerPrice","stockUnitName":"stockUnit.name"},"outerJoinOnModel":"catalog","links":{"catalogType":"catalog","catalog":"manufacturer","stockUnit":"catalog"},"translate":true}},{"name":"setSelectedCatalogData","type":"script","actionDef":"function (pageContext) { pageContext.installedBaseCatalogId = pageContext.catalog[0].value; if (pageContext.catalogData) { pageContext.manufacturerName = pageContext.catalogData[0].manufacturerName; pageContext.catalogModelNumber = pageContext.catalogData[0].modelNumber,pageContext.catalogName=pageContext.catalogData[0].catalogName; pageContext.catalogTypeName = pageContext.catalogData[0].catalogType; pageContext.stockUnitName = pageContext.catalogData[0].stockUnitName; pageContext.workOrderInventoryCatalogId = pageContext.catalogData[0].catalogId; pageContext.workOrderInventoryUnitPrice=pageContext.catalogData[0].cost; pageContext.workOrderInventoryCustomerPrice=pageContext.catalogData[0].listPrice; }; if (!pageContext.catalog || !pageContext.catalog[0]) { pageContext.manufacturerName = ''; pageContext.catalogModelNumber = ''; pageContext.catalogTypeName = ''; pageContext.stockUnitName = ''; pageContext.workOrderInventoryCatalogId = ''; } }"},{"name":"setPriceAndCost","type":"script","continueOnError":true,"actionDef":"function(pageContext) {var roundoff=pageContext.workOrderInventoryUnitPrice;roundoff=roundoff.toFixed(2);pageContext.workOrderInventoryUnitPrice=roundoff;var ToFixed=pageContext.workOrderInventoryCustomerPrice;ToFixed=ToFixed.toFixed(2);pageContext.workOrderInventoryCustomerPrice=ToFixed;}"}]}