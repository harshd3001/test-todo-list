{"appendTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendTaskData","description":"appendTaskData","processRule":"{ if (Array.isArray(contextVar.appendTaskData)) { contextVar.taskData.push(...contextVar.appendTaskData); } contextVar.taskBatchNumber = contextVar.taskBatchNumber+1; }","nodeType":"PROCESS","jsEngine":"es6"},"upsertWorkOrderTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"workOrderTaskModelWF","ignoreSubContext":true,"name":"upsertWorkOrderTaskData","description":"upsertWorkOrderTaskData","inputVarMap":{"taskData":"workOrderTask"},"outputVarMap":{},"nodeType":"WORKFLOW"},"areMoreBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreTaskData"},{"exitPortType":"FalseStep","nodeId":"isTaskDataPresent"}],"name":"areMoreBatchesPresent","description":"areMoreBatchesPresent","processRule":"(contextVar.noOfBatches >= 2 && contextVar.noOfBatches >= contextVar.taskBatchNumber)","nodeType":"DECISION"},"getMultiBreakdownTaskData":{"models":["workOrderTask","taskScheduleBreakdown"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"havingClause":"taskScheduleBreakdownCount > 1","columns":{"taskScheduleBreakdownCount":"COUNT({$taskScheduleBreakdown.id})","id":"workOrderTask.id"},"description":"getMultiBreakdownTaskData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize"},"groupBy":"id","nodeType":"QUERY","filter":"{$workOrderTask.isLongDurationTask} IS NULL || {$workOrderTask.isLongDurationTask} = false","name":"getMultiBreakdownTaskData","links":{"taskScheduleBreakdown":"workOrderTask"},"outputVarMap":{"data":"taskData","count":"taskCount","batchNumber":"taskBatchNumber"},"batchSize":"batchSize","getCount":true},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertWorkOrderTaskData"}],"contextChangePermitted":true,"name":"processData","description":"processData","processRule":"{ contextVar.taskData.forEach(ele=>{ ele.isLongDurationTask = true; }); }","nodeType":"PROCESS","jsEngine":"es6"},"workflowContext":{"customBatchSize":1000,"taskData":[]},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{ contextVar.noOfBatches = 0; contextVar.noOfBatches = Math.ceil(contextVar.taskCount/contextVar.customBatchSize); contextVar.taskBatchNumber++; }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getMultiBreakdownTaskData"}],"name":"start","description":"start","nodeType":"START"},"end":{"name":"end","description":"End","inputVarMap":{},"outputVarMap":{},"nodeType":"END"},"isTaskDataPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isTaskDataPresent","description":"isTaskDataPresent","processRule":"(Array.isArray(contextVar.taskData) && contextVar.taskData.length > 0)","nodeType":"DECISION"},"workflowNodes":["start","getMultiBreakdownTaskData","findNumberOfBatches","areMoreBatchesPresent","getMoreTaskData","appendTaskData","isTaskDataPresent","processData","upsertWorkOrderTaskData","end"],"getMoreTaskData":{"models":["workOrderTask","taskScheduleBreakdown"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTaskData"}],"havingClause":"taskScheduleBreakdownCount > 1","columns":{"taskScheduleBreakdownCount":"COUNT({$taskScheduleBreakdown.id})","id":"workOrderTask.id"},"description":"getMoreTaskData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","taskBatchNumber":"batchNumber"},"groupBy":"id","nodeType":"QUERY","filter":"{$workOrderTask.isLongDurationTask} IS NULL || {$workOrderTask.isLongDurationTask} = false","name":"getMoreTaskData","links":{"taskScheduleBreakdown":"workOrderTask"},"outputVarMap":{"data":"appendTaskData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"}}