{"processFinalFilteredData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isAllFilterApplied"}],"contextChangePermitted":true,"name":"processFinalFilteredData","description":"processFinalFilteredData","processRule":"{if (typeof contextVar.userList !== 'undefined' && contextVar.userList.length > 0) { userId = contextVar.userList[0]; if (typeof contextVar.finalFilteredData !== 'undefined' && typeof contextVar.finalFilteredData !== '' && typeof contextVar.finalFilteredData[userId] !== 'undefined' && contextVar.finalFilteredData[userId] !== '') { contextVar.isAllFilterApplied = contextVar.finalFilteredData[userId].isAllFilterApplied; if (typeof contextVar.finalFilteredData[userId].workOrderType !== 'undefined' && contextVar.finalFilteredData[userId].workOrderType !== '' && typeof contextVar.finalFilteredData[userId].workOrderType.filterIdList !== 'undefined') { contextVar.workOrderTypeIdList = contextVar.finalFilteredData[userId].workOrderType.filterIdList; } if (typeof contextVar.finalFilteredData[userId].taskType !== 'undefined' && contextVar.finalFilteredData[userId].taskType !== '' && typeof contextVar.finalFilteredData[userId].taskType.filterIdList!=='undefined') { contextVar.taskTypeIdList = contextVar.finalFilteredData[userId].taskType.filterIdList; } if (typeof contextVar.finalFilteredData[userId].region !== 'undefined' && contextVar.finalFilteredData[userId].region !== '' && typeof contextVar.finalFilteredData[userId].region.filterIdList!=='undefined') { contextVar.regionIdList = contextVar.finalFilteredData[userId].region.filterIdList; } if (typeof contextVar.finalFilteredData[userId].customer !== 'undefined' && contextVar.finalFilteredData[userId].customer !== '' && typeof contextVar.finalFilteredData[userId].customer.filterIdList!=='undefined') { contextVar.customerIdList = contextVar.finalFilteredData[userId].customer.filterIdList; } } }}","nodeType":"PROCESS"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTimeSlotsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{contextVar.noOfTimeSlotBatches = Math.ceil(contextVar.timeSlotcount / contextVar.customBatchSize);contextVar.timeSlotBatchNumber = contextVar.timeSlotBatchNumber + 1;}","id":"findNumberOfBatches","nodeType":"PROCESS"},"appendTimeSlot":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTimeSlotsPresent"}],"contextChangePermitted":true,"name":"appendTimeSlot","description":"appendTimeSlot","processRule":"if (Array.isArray(contextVar.appendTimeSlotData)) { contextVar.taskData = contextVar.taskData.concat(contextVar.appendTimeSlotData) } contextVar.timeSlotBatchNumber = contextVar.timeSlotBatchNumber + 1;","nodeType":"PROCESS"},"getMoreFilteredTimeSlot":{"models":["workOrderTask","workOrder","site","region","taskType","ZStatus","customer"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTimeSlot"}],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","workOrderTypeId":"workOrder.workOrderTypeId","workOrderDeadline":"workOrder.deadline","customerCompanyName":"customer.companyName","regionName":"region.name","siteName":"site.name","taskTypeName":"taskType.name","statusNameColor":"ZStatus.colorCode","taskTypeId":"taskType.id","workOrderTaskTypeId":"workOrderTask.taskTypeId","regionId":"region.id","workOrderTaskId":"workOrderTask.id","statusName":"ZStatus.name","customerId":"customer.id","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id"},"distinct":true,"inputVarMap":{"siteIdList":"siteIdList","taskIdsToBeNeglected":"taskIdsToBeNeglected","endDate":"endDate","orderBy":"orderBy","deadlineDateFilter":"deadlineDateFilter","timeSlotBatchNumber":"batchNumber","workOrderIdList":"workOrderIdList","filter":"filter","customBatchSize":"batchSize","statusList":"statusList","taskTypeFilter":"taskTypeFilter","regionFilter":"regionFilter","startDate":"startDate"},"nodeType":"QUERY","filter":"filter","name":"getMoreFilteredTimeSlot","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrderTask","region":"site","ZStatus":"workOrderTask","customer":"workOrder"},"outputVarMap":{"data":"appendTimeSlotData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getLoggedInUser"}],"name":"Start","description":"Start","id":"start","nodeType":"START"},"processFilterForSiteQuery":{"connectors":[{"exitPortType":"NextStep","nodeId":"getSiteData"}],"contextChangePermitted":true,"name":"processFilterForSiteQuery","description":"processFilterForSiteQuery","processRule":"{contextVar.siteQueryFilter = ''; if (typeof contextVar.regionIdList != 'undefined' && contextVar.regionIdList.length > 0) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + '({$site.regionId} IN {@regionIdList})'; if (contextVar.customerIdList != 'undefined' && contextVar.customerIdList.length > 0) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + ' AND ({$site.customerId} IN {@customerIdList})'; } } else if (contextVar.customer != 'undefined' && contextVar.customer.length > 0) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + '({$site.customerId} IN {@customerIdList})'; } }","nodeType":"PROCESS"},"fetchTaskData":{"models":["workOrderTask","workOrder","site","region","taskType","ZStatus","customer"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","workOrderTypeId":"workOrder.workOrderTypeId","workOrderDeadline":"workOrder.deadline","customerCompanyName":"customer.companyName","regionName":"region.name","siteName":"site.name","taskTypeName":"taskType.name","statusNameColor":"ZStatus.colorCode","taskTypeId":"taskType.id","workOrderTaskTypeId":"workOrderTask.taskTypeId","regionId":"region.id","workOrderTaskId":"workOrderTask.id","statusName":"ZStatus.name","customerId":"customer.id","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id"},"distinct":true,"description":"fetchTaskData","inputVarMap":{"filter":"filter","customBatchSize":"batchSize","statusList":"statusList","siteIdList":"siteIdList","taskIdsToBeNeglected":"taskIdsToBeNeglected","endDate":"endDate","taskTypeFilter":"taskTypeFilter","orderBy":"orderBy","deadlineDateFilter":"deadlineDateFilter","regionFilter":"regionFilter","startDate":"startDate","workOrderIdList":"workOrderIdList"},"nodeType":"QUERY","filter":"filter","name":"fetchTaskData","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrderTask","region":"site","ZStatus":"workOrderTask","customer":"workOrder"},"id":"fetchTaskData","outputVarMap":{"data":"taskData","count":"timeSlotcount","batchNumber":"timeSlotBatchNumber"},"batchSize":"batchSize","getCount":true},"addFilteredTimeSlotToArray":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"addFilteredTimeSlotToArray","description":"addFilteredTimeSlotToArray","processRule":"if (typeof contextVar.taskData !== 'undefined' && contextVar.taskData.length > 0) { contextVar.taskAutoScheduleData = contextVar.taskData; contextVar.count = contextVar.taskAutoScheduleData.length; }","nodeType":"PROCESS"},"workflowNodes":["start","getLoggedInUser","processUserId","getLoggedInUserWorkGroupFilters","processFinalFilteredData","isAllFilterApplied","isRegionIdListOrCustomerIdListPresent","processFilterForSiteQuery","getSiteData","isWorkOrderTypeIdListPresent","getWorkOrderData","processSiteIdListAndWorkOrderIdList","getTaskScheduleBreakdownData","initializeParams","fetchTaskData","findNumberOfBatches","areMoreTimeSlotsPresent","getMoreFilteredTimeSlot","appendTimeSlot","addFilteredTimeSlotToArray","end"],"initializeParams":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskData"}],"contextChangePermitted":true,"name":"initializeParams","description":"Initialize params for workflow ","processRule":"@N7CYFI9JJF","id":"initializeParams","nodeType":"PROCESS","jsEngine":"es6"},"processSiteIdListAndWorkOrderIdList":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTaskScheduleBreakdownData"}],"contextChangePermitted":true,"name":"processSiteIdListAndWorkOrderIdList","description":"processSiteIdListAndWorkOrderIdList","processRule":"{ contextVar.siteIdList = []; contextVar.workOrderIdList = []; if (typeof contextVar.siteData != 'undefined' && contextVar.siteData.length > 0) { contextVar.siteIdData.forEach(function (element) { contextVar.siteIdList.push(element.siteId); }); } if (typeof contextVar.workOrderData != 'undefined' && contextVar.workOrderData.length > 0) { contextVar.workOrderData.forEach(function (element) { contextVar.workOrderIdList.push(element.workOrderId); }); } }","nodeType":"PROCESS"},"getLoggedInUserWorkGroupFilters":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFinalFilteredData"}],"processId":"userWorkGroupFilterWF","ignoreSubContext":true,"name":"getLoggedInUserWorkGroupFilters","description":"getLoggedInUserWorkGroupFilters","inputVarMap":{"userList":"userList"},"outputVarMap":{"finalFilteredData":"finalFilteredData"},"nodeType":"WORKFLOW"},"getTaskScheduleBreakdownData":{"models":["taskScheduleBreakdown"],"connectors":[{"exitPortType":"NextStep","nodeId":"initializeParams"}],"havingClause":"taskScheduleBreakdown > 1","columns":{"taskScheduleBreakdown":"COUNT({$taskScheduleBreakdown.id})","id":"taskScheduleBreakdown.workOrderTaskId"},"name":"getTaskScheduleBreakdownData","description":"getTaskScheduleBreakdownData","orderBy":"id","inputVarMap":{"customBatchSize":"batchSize"},"groupBy":"id","outputVarMap":{"data":"taskScheduleBreakDownData"},"batchSize":"batchSize","nodeType":"QUERY"},"workflowContext":{"taskAutoScheduleData":[],"customBatchSize":1000,"statusList":[],"taskIdsToBeNeglected":[],"noOfTimeSlotBatches":0,"count":0,"taskData":[]},"getSiteData":{"filter":"filter","models":["customer","site","region"],"connectors":[{"exitPortType":"NextStep","nodeId":"isWorkOrderTypeIdListPresent"}],"columns":{"siteId":"site.id"},"name":"getSiteData","description":"getSiteData","inputVarMap":{"customerIdList":"customerIdList","regionIdList":"regionIdList","siteQueryFilter":"filter"},"links":{"site":"customer","region":"site"},"outputVarMap":{"data":"siteData"},"nodeType":"QUERY"},"processUserId":{"connectors":[{"exitPortType":"NextStep","nodeId":"getLoggedInUserWorkGroupFilters"}],"contextChangePermitted":true,"name":"processUserId","description":"processUserId","processRule":"if (typeof contextVar.currentUserDetail !=='undefined') { contextVar.userList=[];contextVar.userList.push(contextVar.currentUserDetail[0].userId)};","nodeType":"PROCESS"},"isAllFilterApplied":{"connectors":[{"exitPortType":"FalseStep","nodeId":"isRegionIdListOrCustomerIdListPresent"},{"exitPortType":"TrueStep","nodeId":"getTaskScheduleBreakdownData"}],"name":"isAllFilterApplied","description":"isAllFilterApplied","processRule":"(contextVar.isAllFilterApplied===true)","nodeType":"DECISION"},"isWorkOrderTypeIdListPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getWorkOrderData"},{"exitPortType":"FalseStep","nodeId":"processSiteIdListAndWorkOrderIdList"}],"name":"isWorkOrderTypeIdListPresent","description":"isWorkOrderTypeIdListPresent","processRule":"(typeof contextVar.workOrderTypeIdList !== 'undefined' && contextVar.workOrderTypeIdList !== '' && contextVar.workOrderTypeIdList.length > 0 )","nodeType":"DECISION"},"areMoreTimeSlotsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreFilteredTimeSlot"},{"exitPortType":"FalseStep","nodeId":"addFilteredTimeSlotToArray"}],"name":"areMoreTimeSlotsPresent","description":"areMoreTimeSlotsPresent","processRule":"contextVar.noOfTimeSlotBatches >= 2 && contextVar.noOfTimeSlotBatches >= contextVar.timeSlotBatchNumber","nodeType":"DECISION"},"getLoggedInUser":{"filter":"{$userId}={@userId}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processUserId"}],"columns":{"userName":"User.name","userId":"User.id"},"name":"getLoggedInUser","description":"getLoggedInUser","inputVarMap":{"{@userId}":"userId"},"outputVarMap":{"data":"currentUserDetail"},"nodeType":"QUERY"},"end":{"name":"End","description":"end","inputVarMap":{"taskAutoScheduleData":"taskAutoScheduleData","count":"count"},"outputVarMap":{"taskAutoScheduleData":"taskAutoScheduleData","count":"count"},"id":"end","nodeType":"END"},"isRegionIdListOrCustomerIdListPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processFilterForSiteQuery"},{"exitPortType":"FalseStep","nodeId":"isWorkOrderTypeIdListPresent"}],"name":"isRegionIdListOrCustomerIdListPresent","description":"isRegionIdListOrCustomerIdListPresent","processRule":"((typeof contextVar.regionIdList !== 'undefined' && contextVar.regionIdList !== '' && contextVar.regionIdList.length > 0 )|| (typeof contextVar.customerIdList !== 'undefined' && contextVar.customerIdList !== '' && contextVar.customerIdList.length > 0))","nodeType":"DECISION"},"getWorkOrderData":{"filter":"{$workOrder.workOrderTypeId} IN {@workOrderTypeIdList}","models":["workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"processSiteIdListAndWorkOrderIdList"}],"columns":{"workOrderId":"workOrder.id"},"name":"getWorkOrderData","description":"getWorkOrderData","inputVarMap":{"workOrderTypeIdList":"workOrderTypeIdList"},"outputVarMap":{"data":"workOrderData"},"nodeType":"QUERY"}}