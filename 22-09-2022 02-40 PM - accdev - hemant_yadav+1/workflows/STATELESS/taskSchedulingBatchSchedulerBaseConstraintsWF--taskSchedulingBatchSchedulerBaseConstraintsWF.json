{"isMobileTechnicianPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getSchedulerSettingData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isMobileTechnicianPresent","description":"isMobileTechnicianPresent","processRule":"(contextVar.isValid === true )","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"logContextVar"}],"name":"start","description":"Start","nodeType":"START"},"logContextVar":{"connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"processId":"featureLoggerWF","name":"logContextVar","description":"logContextVar","inputVarMap":{"featureName":"featureName","extraMsg":"extraMsg"},"id":"logContextVar","outputVarMap":{},"nodeType":"WORKFLOW"},"processSchedulerSettingData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isSkillFilterApplicable"}],"contextChangePermitted":true,"name":"processSchedulerSettingData","description":"processSchedulerSettingData ","processRule":"{if (typeof contextVar.schedulerSettingData != 'undefined' && contextVar.schedulerSettingData.length > 0) { contextVar.schedulerSettingUseSkills = contextVar.schedulerSettingData[0].schedulerSettingUseSkills; } else { contextVar.schedulerSettingUseSkills = false; } }","nodeType":"PROCESS"},"workflowNodes":["start","logContextVar","processData","getTechnician","processTechData","isMobileTechnicianPresent","getSchedulerSettingData","processSchedulerSettingData","isSkillFilterApplicable","processSkillLevelData","isSkillPresent","getEligibleTechnicianIds","checkTechnicianWorkGroupEligibility","end"],"getSchedulerSettingData":{"models":["schedulerSetting"],"connectors":[{"exitPortType":"NextStep","nodeId":"processSchedulerSettingData"}],"columns":{"schedulerSettingUseSkills":"schedulerSetting.useSkills"},"name":"getSchedulerSettingData","description":"getSchedulerSettingData","distinct":true,"inputVarMap":{},"outputVarMap":{"data":"schedulerSettingData"},"nodeType":"QUERY","getCount":true},"processTechData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isMobileTechnicianPresent"}],"contextChangePermitted":true,"name":"processTechData","description":"processTechData","processRule":"{ if (Array.isArray(contextVar.technicianData) && contextVar.technicianData.length > 0) { contextVar.isValid = true; } }","nodeType":"PROCESS"},"checkTechnicianWorkGroupEligibility":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"checkTechnicianWorkGroupEligibility","description":"checkTechnicianWorkGroupEligibility","processRule":"{ contextVar.isValid = false; let objectMap = {}; let workGroupFilter = ['region', 'customer', 'workOrderType', 'taskType']; if (Array.isArray(contextVar.userWorkGroupFilterData) && contextVar.userWorkGroupFilterData.length > 0) { for (let value of contextVar.userWorkGroupFilterData) { if (value.filterMethod === 'all') { contextVar.isValid = true; break; } if (typeof objectMap[value.filterMethod] === 'undefined') { objectMap[value.filterMethod] = []; } objectMap[value.filterMethod].push(value.filterId); } if (!contextVar.isValid) { contextVar.isValid = true; for (let val of workGroupFilter) { if (val in objectMap) { if (!(objectMap[val].indexOf(contextVar[`${val}Id`]) > -1)) { contextVar.isValid = false; break; } } } } } }","nodeType":"PROCESS","jsEngine":"es6"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTechnician"}],"contextChangePermitted":true,"name":"processData","description":"processData","processRule":"{ contextVar.userList = []; contextVar.userList.push(contextVar.tech.id); contextVar.techId = contextVar.tech.id; contextVar.workOrderTaskId = contextVar.taskDetail.id; contextVar.techniciansSkill = contextVar.tech.techniciansSkill; for (var key in contextVar.taskDetail) { contextVar[key] = contextVar.taskDetail[key]; } }","nodeType":"PROCESS"},"workflowContext":{"customBatchSize":1000,"featureName":"batchScheduler","isValid":false,"extraMsg":"BASE CONSTRAINTS: taskSchedulingBatchSchedulerBaseConstraintsWF call"},"isSkillPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getEligibleTechnicianIds"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isSkillPresent","description":"isSkillPresent","processRule":"( contextVar.isValid === true )","nodeType":"DECISION"},"getTechnician":{"filter":"{$id} = {@techId} AND {@taskTypeMobileProcessId}={$ZProcess.id} and {$ZProcess.projectId}={$ZProjectUser.projectId} and {$ZProjectUser.groupId} = {$UserGroup.groupId}","models":["UserGroup","User","ZProjectUser","ZProcess"],"connectors":[{"exitPortType":"NextStep","nodeId":"processTechData"}],"columns":{"id":"User.id"},"name":"getTechnician","description":"getTechnician","distinct":true,"links":{"UserGroup":"User"},"inputVarMap":{"taskTypeMobileProcessId":"taskTypeMobileProcessId","techId":"techId"},"outputVarMap":{"data":"technicianData"},"nodeType":"QUERY","getCount":true},"getEligibleTechnicianIds":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkTechnicianWorkGroupEligibility"}],"processId":"userWorkGroupFilterWF","name":"getEligibleTechnicianIds","description":"getEligibleTechnicianIds","inputVarMap":{"userList":"userList"},"outputVarMap":{},"nodeType":"WORKFLOW"},"processSkillLevelData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isSkillPresent"}],"contextChangePermitted":true,"name":"processSkillLevelData","description":"processSkillLevelData","processRule":"{ if (Array.isArray(contextVar.taskTypeSkill) && contextVar.taskTypeSkill.length > 0) { if (typeof contextVar.techniciansSkill !== 'undefined') { for (var element of contextVar.taskTypeSkill) { if (typeof contextVar.techniciansSkill[element.skillId] === 'undefined' || contextVar.techniciansSkill[element.skillId] < element.skillLevelRank) { contextVar.isValid = false; break; } } } else { contextVar.isValid = false; } } }","nodeType":"PROCESS","jsEngine":"es6"},"end":{"name":"end","description":"End","inputVarMap":{"isValid":"isValid"},"outputVarMap":{"isValid":"isValid"},"nodeType":"END"},"isSkillFilterApplicable":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processSkillLevelData"},{"exitPortType":"FalseStep","nodeId":"getEligibleTechnicianIds"}],"name":"isSkillFilterApplicable","description":"isSkillFilterApplicable","processRule":"(contextVar.schedulerSettingUseSkills === true )","nodeType":"DECISION"}}