{"pageContext":{},"actionOnLoad":["@actions.checkForActionOnLoad"],"jslib":{"isCrewLeadHidden":"function(pageContext) { return ( typeof pageContext.crewMembersData == 'undefined' || pageContext.crewMembersData == '' ) ; }","disableCrewMemberGrid":"function(pageContext) { if (typeof pageContext.crewWorkOrderTaskData !== 'undefined' && pageContext.crewWorkOrderTaskData.length > 0) { for (var i in pageContext.crewWorkOrderTaskData) { if (pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskInProgress' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskPendingReview' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskInTransit' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskDispatched' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskDelayed' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskIncident') { return true; } } } if (pageContext.crewStatusId === 'crewDeactivated') { return true; } return false; }","isSaveContinueDisabled":"function(pageContext) { return (!(typeof pageContext.crewName !== 'undefined' && pageContext.crewName !== '' && typeof pageContext.crewRegion !== 'undefined' && pageContext.crewRegion !== '' && typeof pageContext.crewBaseLocation !== 'undefined' && pageContext.crewBaseLocation !== '' && pageContext.crewStartDate !== '' && pageContext.crewEndDate !== '' && typeof pageContext.crewBaseLocation !== 'undefined' && typeof pageContext.crewCalendarId !== 'undefined' && pageContext.crewCalendarId !== '' && typeof pageContext.selectWorkGroup !== 'undefined' && pageContext.selectWorkGroup.length > 0)) }","isCrewDatesDisabled":"function(pageContext) { if (typeof pageContext.crewStatusId === 'undefined'|| pageContext.crewStatusId === 'crewDraft'  ) { return false; } return true; }","showBanner":"function(pageContext) { if(pageContext.banner === 'show'){ if (typeof pageContext.crewWorkOrderTaskData !== 'undefined' && pageContext.crewWorkOrderTaskData.length > 0) { for (var i in pageContext.crewWorkOrderTaskData) { if (pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskInProgress' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskPendingReview' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskInTransit' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskDispatched' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskDelayed' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskIncident') { return false; } } } } return true; }","crewStatusDeactivate":"function(pageContext) { if(typeof pageContext.crewStatusId !='undefined' && pageContext.crewStatusId !=='' && pageContext.crewStatusId ==='crewDeactivated'){ return true;} return false; }","dynamicModalText":"function (pageContext) { if (pageContext.crewMemberAction === 'delete') { return `@lang.['tcbdstatclf','Technician cannot be deleted since they are the crew lead for: ']` + pageContext.crewName + `@lang.['aanlbdtt','. Assign a new lead before deleting this technician.']` } else if (pageContext.crewMemberAction === 'suspend') { return `@lang.['tcbsstatclf','Technician cannot be suspended since they are the crew lead for: ']` + pageContext.crewName + `@lang.['aanlbstt','. Assign a new lead before suspending this technician.']` } }","dynamicHeaderText":"function(pageContext){ if(pageContext.crewAction === 'add'|| pageContext.crewAction==='addInitial' ){return '@lang.[\"anc3\",\"Add New Crew\"]';}else if(pageContext.crewAction === 'edit' ){return '@lang.[\"edit\",\"Edit\"] '+ pageContext.crewName }}","isSaveDisabled":"function(pageContext) { var workGroupCheck = true; if ((pageContext.selectWorkGroup !== '' && typeof pageContext.selectWorkGroup !== 'undefined' && pageContext.selectWorkGroup.length > 0) && (typeof pageContext.initialSelectWorkGroup !== 'undefined' && pageContext.initialSelectWorkGroup !== '' && pageContext.initialSelectWorkGroup.length > 0)) { if (pageContext.selectWorkGroup.length !== pageContext.initialSelectWorkGroup.length){ workGroupCheck = false;} else { for (var i in pageContext.selectWorkGroup) { if (pageContext.initialSelectWorkGroup.indexOf(pageContext.selectWorkGroup[i].value) == -1) { workGroupCheck = false; } } } } return ((pageContext.crewAction === 'edit') && (((workGroupCheck) && (pageContext.initialName === pageContext.crewName) && (pageContext.initialCrewBaseLocation === pageContext.crewBaseLocation) && (pageContext.initialCrewStartDate === pageContext.crewStartDate) && (pageContext.initialCrewEndDate === pageContext.crewEndDate) && (pageContext.initialCrewDescription === pageContext.crewDescription) && (pageContext.initialCrewLeadUserId === pageContext.crewLeadUserId)) || (pageContext.crewName === '') || (pageContext.crewBaseLocation === '') || (pageContext.crewStartDate == '') || (pageContext.selectWorkGroup == '') || (pageContext.crewEndDate == ''))); }","dynamicModalTitle":"function(pageContext) { if (pageContext.crewMemberAction === 'delete') { return '@lang.[\"utd\",\"Unable to Delete\"]' } else if (pageContext.crewMemberAction === 'suspend') { return '@lang.[\"uts\",\"Unable to Suspend\"]' } }","isActionEdit":"function(pageContext) {return(pageContext.crewAction==='edit')}","isActionAdd":"function(pageContext){return(pageContext.crewAction==='add' )|| (pageContext.crewAction==='addInitial')}"},"header":{"children":[{"hidden":"@jslib.isActionAdd","statusColor":"@pageContext.statusColor","id":"status","type":"status","value":"@pageContext.crewStatusName"},{"buttonType":"primary","hidden":"@jslib.isActionEdit","actionOnClick":["@actions.setSubActionUpsertCrew","@actions.fireProcessEvent","@actions.processApiOutput","@actions.setActionEdit","@actions.fireProcessEventToFetchCrewData","@actions.refreshCrewGridOnMainPage","@actions.normalizeWorkflowData","@actions.enableRecordGrid","@actions.setInitialDataSaveAndContinue"],"disabled":"@jslib.isSaveContinueDisabled","id":"saveAndContinue","type":"button","title":"@lang.['sc1','Save & Continue']"},{"buttonType":"primary","hidden":"@jslib.isActionAdd","actionOnClick":["@actions.setSubActionUpsertCrew","@actions.setCrewStatus","@actions.fireProcessEvent","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.checkForCrewLead"],"id":"Close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"children":[{"isRequired":true,"disabled":"@jslib.crewStatusDeactivate","inputType":"text","id":"name","label":"@lang.['cn4','Crew Name']","placeholder":"@lang.['en5','Enter Name']","type":"input","value":"@pageContext.crewName"},{"disabled":"@jslib.crewStatusDeactivate","id":"description","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.crewDescription","placeHolder":"@lang.['ed5','Enter Description']"},{"actionOnChange":["@actions.setContractor"],"optLabelMap":"contractorName","optValueMap":"contractorId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$contractorName} like {@filter}","models":["contractorRegion","contractor","region"],"columns":{"regionId":"contractorRegion.regionId","contractorId":"contractorRegion.contractorId","regionName":"region.name","contractorName":"contractor.name"},"outerJoinOnModel":"contractorRegion","orderBy":"contractorName ASC","distinct":true,"links":{"contractor":"contractorRegion","region":"contractorRegion"}}},"hidden":"@jslib.isActionEdit","isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$contractorId} = {@selectedContractorId}","models":["contractorRegion","contractor","region"],"columns":{"regionId":"contractorRegion.regionId","contractorId":"contractor.id","regionName":"region.name","contractorName":"contractor.name","contractorRegionId":"contractorRegion.id"},"inputs":{"selectedContractorId":"@pageContext.selectedContractorId"},"links":{"contractor":"contractorRegion","region":"contractorRegion"}},"columnsToBeHidden":["regionId","contractorId"],"selectedRowAdvanceGrid":"AdvancedGrid","rowsToBeSelect":"selectedContractorId","sidePanelTitle":"@lang.['sc6','Select Contractor']","gridHeaderText":"@lang.['c7','Contractor']","customColumns":{"regionName":"@lang.['r1','Region']","contractorName":"@lang.['c7','Contractor']"},"searchKeys":["regionName","contractorName"]},"label":"@lang.['c14','Contractor (Optional)']","id":"contractor","type":"selectDropdown","value":"@pageContext.selectContractor"},{"hidden":"@jslib.isActionAdd","disabled":"@jslib.isActionEdit","label":"@lang.['c14','Contractor (Optional)']","id":"contractorId","type":"input","value":"@pageContext.contractorName"},{"actionOnChange":[],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$regionName} like {@filter}","models":["region"],"columns":{"regionId":"region.id","regionName":"region.name","regionDescription":"region.description"},"orderBy":"regionName ASC","distinct":true}},"optLabelMap":"regionName","optValueMap":"regionId","hidden":"@jslib.isActionEdit","id":"region","label":"@lang.['r1','Region']","type":"selectDropdown","value":"@pageContext.crewRegion"},{"hidden":"@jslib.isActionAdd","disabled":"@jslib.isActionEdit","id":"regionId","label":"@lang.['r1','Region']","type":"input","value":"@pageContext.regionName"},{"isRequired":true,"disabled":"@jslib.crewStatusDeactivate","id":"address","label":"@lang.['bl','Base Location']","placeholder":"@lang.['tia','Type in address']","type":"address","value":"@pageContext.crewBaseLocation"},{"minDate":"1970-01-01 00:00","disabled":"@jslib.isCrewDatesDisabled","id":"startDate","title":"@lang.['sd','Start Date']","type":"date","value":"@pageContext.crewStartDate","placeHolder":"@lang.['sd8','Select date']"},{"minDate":"@pageContext.crewStartDate","disabled":"@jslib.isCrewDatesDisabled","id":"endDate","title":"@lang.['ed','End Date']","type":"date","value":"@pageContext.crewEndDate","placeHolder":"@lang.['sd8','Select date']"}],"id":"crewInformation","label":"@lang.['ci8','Crew Information']","type":"section"},{"children":[{"isRequired":true,"hidden":"@jslib.isActionEdit","options":"@pageContext.shiftData","id":"shiftId","optTitleKey":"calendarName","optValueKey":"calendarId","title":"@lang.['s4','Shift']","type":"select","value":"@pageContext.crewCalendarId","placeHolder":"@lang.['ss5','Select Shift']"},{"hidden":"@jslib.isActionAdd","disabled":"@jslib.isActionEdit","id":"shift","label":"@lang.['s4','Shift']","type":"input","value":"@pageContext.calendarName"},{"actionOnChange":[],"isMultiSelect":true,"optLabelMap":"workGroupName","optValueMap":"workGroupId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$workGroupName} like {@filter}","models":["workGroup"],"columns":{"workGroupDescription":"workGroup.description","workGroupName":"workGroup.name","workGroupId":"workGroup.id","workGroupFilterMethod":"workGroup.filterMethod"},"inputs":{},"orderBy":"workGroupName ASC","distinct":true}},"isMainPage":false,"disabled":"@jslib.crewStatusDeactivate","label":"@lang.['wg1','Work Group']","id":"selectWorkGroup","type":"selectDropdown","value":"@pageContext.selectWorkGroup","hoverText":{"title":"@lang.['atctoomwgtrtabortteatttgatbefatat','Add this crew to one or more work groups to restrict task assignment based on region, task type, etc. Add them to the All group and they\u2019ll be eligible for assignment to any task.']"}}],"id":"shiftSection","label":"@lang.['swg','Shift & Work Group']","type":"section"}],"label":"@lang.['ci8','Crew Information']","type":"tab"},{"hidden":"@jslib.isActionAdd","children":[{"alertMessage":"@lang.['ccbmsthabdradtowfttbctmtncc','Crew cannot be modified since tasks have already been dispatched. Recall all dispatched tasks or wait for them to be completed to make the necessary crew changes.']","actionOnChange":"@actions.hideBannerMsg","onClose":"@actions.hideBannerMsg","alertType":"warning","hidden":"@jslib.showBanner","id":"errTxt","type":"alert"},{"hidden":"@jslib.isCrewLeadHidden","children":[{"isRequired":true,"options":"@pageContext.crewLeadData","disabled":"@jslib.disableCrewMemberGrid","id":"leadId","optTitleKey":"userName","optValueKey":"workforceCrewUserId","title":"@lang.['cl2','Crew Lead']","type":"select","value":"@pageContext.crewLeadUserId","placeHolder":"@lang.['sl5','Select lead']"}],"id":"crewLead","type":"section"},{"children":[{"id":"crewMembersDataGrid","type":"dataGrid","jsonDef":{"isScrollAble":true,"searchAllowed":true,"tableWidth":"60rem","searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsBinPurple","name":"@lang.['d1','Delete']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.checkForDeleteCondition"],"disabled":"@jslib.disableCrewMemberGrid","type":"buttonIcon"},{"activeIcon":"https://d122pusslfmuhu.cloudfront.net/field-service-elements/icons/icon-crew-purple.svg","hidden":{"workforceCrewStatusId":["workforceCrewOffCrew","workforceCrewDeactivated"]},"name":"@lang.['s31','Suspend']","icon":"https://d122pusslfmuhu.cloudfront.net/field-service-elements/icons/icon-crew-grey.svg","tooltip":"@lang.['s31','Suspend']","actionOnClick":["@actions.checkForSuspendCondition"],"disabled":"@jslib.disableCrewMemberGrid","type":"buttonIcon"},{"activeIcon":"https://d122pusslfmuhu.cloudfront.net/field-service-elements/icons/icon-tech-reactivate-purple.svg","hidden":{"workforceCrewStatusId":["workforceCrewOnCrew","workforceCrewDeactivated"]},"name":"@lang.['r6','Reactivate']","icon":"https://d122pusslfmuhu.cloudfront.net/field-service-elements/icons/icon-tech-reactivate-grey.svg","tooltip":"@lang.['r6','Reactivate']","actionOnClick":["@actions.checkCrewMemberStatus","@actions.checkCrewMemberStatusData","@actions.checkForReactivateCondition"],"disabled":"@jslib.disableCrewMemberGrid","type":"buttonIcon"}]},"gridRefreshId":"crewMemberDataGrid","emptyScreen":{"image":"@iconlib.ActionsSearchGrey","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":1,"sortOrder":"ASC","colorCode":"statusNameColor","sortable":true,"showLabel":true},"key":"statusName"},{"name":"@lang.['n','Name']","options":{"flex":1.3,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"userName"},{"name":"@lang.['c7','Contractor']","options":{"flex":1,"showLabel":true},"key":"contractor"},{"name":"@lang.['navS1','Skills']","options":{"flex":1,"showLabel":true},"key":"skill"},{"name":"@lang.['p6','Phone']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"userPhoneNumber"}],"dataToBeSent":{"apiResponseParams":["count"],"processId":"workforceFieldForceCrewFetchDataWF","apiResponseFormat":true,"contextVar":{"crewId":"@pageContext.crewId"},"orderBy":"userName ASC","apiResponseObject":"crewMembersData"},"dataSourceId":"process/start","sourceType":"api","jslib":{"disableCrewMemberGrid":"function(pageContext) { if (typeof pageContext.crewWorkOrderTaskData !== 'undefined' && pageContext.crewWorkOrderTaskData.length > 0) { for (var i in pageContext.crewWorkOrderTaskData) { if (pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskInProgress' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskPendingReview' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskInTransit' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskDispatched' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskDelayed' || pageContext.crewWorkOrderTaskData[i].workOrderTaskStatusId == 'workOrderTaskIncident') { return true; } } } if (pageContext.crewStatusId === 'crewDeactivated') { return true; } return false; }"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['cm','Crew Members']","children":[{"buttonType":"primary","hidden":"@jslib.disableCrewMemberGrid","actionOnClick":["@actions.openCrewMemberNSP"],"id":"addNew","type":"button","title":"@lang.['am1','Add Members']"}]},"isSelectable":false,"updateAllowed":true,"actions":[{"name":"openCrewMemberNSP","type":"openPanel","pageId":"Z3CEIIDNOD"},{"name":"setDataBeforeReactivatingCrewMember","type":"script","actionDef":"function(pageContext){ pageContext.crewMemberStatusId = 'workforceCrewOnCrew'; if (Array.isArray(pageContext.removedMembersList) && pageContext.removedMembersList.length>0 && pageContext.removedMembersList.indexOf(pageContext.workforceUserId)!==-1){ pageContext.removedMembersList.splice(pageContext.removedMembersList.indexOf(pageContext.workforceUserId),1); }}"},{"name":"setDataBeforeDeletingCrewMember","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteWorkforceCrew';if (!Array.isArray(pageContext.removedMembersList)) pageContext.removedMembersList = []; pageContext.removedMembersList.push(pageContext.workforceUserId);}"},{"name":"setSubActionUpsertWorkforceCrew","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertWorkforceCrew';}"},{"name":"setSuspendAction","type":"script","actionDef":"function(pageContext){pageContext.crewMemberAction='suspend';}"},{"name":"setDeleteAction","type":"script","actionDef":"function(pageContext){pageContext.crewMemberAction='delete';}"},{"endPoint":"event/start","name":"fireProcessEventToFetchCrewData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","continueOnError":true,"actionDef":{"data":[{"eventId":"workforceFieldForceCrewFetchDataProcessEvent","contextVar":{"timezoneOffset":"@pageContext.timezoneOffset","crewAction":"@pageContext.crewAction","crewId":"@pageContext.crewId"}}]}},{"name":"refreshSidePanelDataGrid","gridId":["crewMemberDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"normalizeWorkflowData","type":"script","actionDef":"function(pageContext) { if (pageContext.crewAction === 'edit') { for (var key in pageContext.responseData[0].data[0]) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.responseData[0].data[0][key]; } } }"},{"endPoint":"event/start","name":"fireProcessEventForCrew","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceFieldForceCrewProcessEvent","contextVar":{"subAction":"@pageContext.subAction","workforceCrew":[{"statusId":"@pageContext.crewMemberStatusId","recver":"@pageContext.workforceCrewRecver","crewId":"@pageContext.crewId","workforceUserId":"@pageContext.workforceUserId"}]}}]}},{"name":"checkCrewMemberStatus","outputVarMap":{"data":"@pageContext.memberData"},"type":"query","actionDef":{"filter":"{$workforceCrewUserId} = {@workforceUserId} AND {$status}='crewActive'","models":["workforceCrew","crew"],"columns":{"workforceCrewStatusId":"workforceCrew.statusId","crewId":"workforceCrew.crewId","workforceCrewUserId":"workforceCrew.workforceUserId","status":"crew.statusId"},"inputs":{"workforceUserId":"@pageContext.workforceUserId"},"link":{"workforceCrew":"crew"}}},{"name":"checkCrewMemberStatusData","type":"script","actionDef":"function(pageContext) { if(typeof pageContext.memberData!=='undefined' && pageContext.memberData!==''){ pageContext.memberStatusData = []; for (var i in pageContext.memberData) { pageContext.memberStatusData.push(pageContext.memberData[i].workforceCrewStatusId); } } }"},{"subTitle":"@lang.['sacmptfbatacttswbfutjacoatfst','Suspending a crew member prevents them from being assigned to a crew task. Their schedule will be freed up to join another crew or accept tasks for single technician']","name":"suspendCrewMember","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionUpsertWorkforceCrew","@actions.setDataBeforeDeactivatingCrewMember","@actions.fireProcessEventForCrew","@actions.getCrewLead","@actions.refreshSidePanelDataGrid","@actions.closeModal"],"type":"button","title":"@lang.['c15','Confirm']"}],"type":"openModal","title":"@lang.['scm','Suspend Crew Member']"},{"subTitle":"@lang.['tiaoacywntsortftociotattto','Technician is active on another crew. You will need to suspend or remove them from the other crew in order to add them to this one.']","name":"canNotReactivateCrewMember","options":[{"buttonType":"primary","name":"close","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c23','Close']"}],"type":"openModal","title":"@lang.['taoc','Technician Already on Crew']"},{"subTitle":"@jslib.dynamicModalText","name":"canNotApplyOnCrewLead","options":[{"buttonType":"primary","name":"close","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c23','Close']"}],"type":"openModal","title":"@jslib.dynamicModalTitle"},{"subTitle":"@lang.['tcbsstacd','Technician cannot be suspended since they are currently deactivated.']","name":"canNotSuspendDeactivatedTechnician","options":[{"buttonType":"primary","name":"close","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c23','Close']"}],"type":"openModal","title":"@lang.['uts','Unable to Suspend']"},{"subTitle":"@lang.['tidgtsuowtrtabattac','Technician is deactivated. Go to Settings > Users or Workforce > Technician to reactivate their account before adding them to a crew.']","name":"canNotReactivateDeactivatedTechnician","options":[{"buttonType":"primary","name":"close","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c23','Close']"}],"type":"openModal","title":"@lang.['ud','User Deactivated']"},{"falseStep":["@actions.checkForDeactivatedConditionForReactivate"],"trueStep":["@actions.canNotReactivateCrewMember"],"name":"checkForReactivateCondition","type":"decision","actionDef":"function(pageContext) { if (typeof pageContext.memberData !== 'undefined' && pageContext.memberData !== '') { for (var i in pageContext.memberData) { if (pageContext.memberData[i].workforceCrewStatusId === 'workforceCrewOnCrew') { return true; } } } return false; }"},{"falseStep":["@actions.setSubActionUpsertWorkforceCrew","@actions.setDataBeforeReactivatingCrewMember","@actions.fireProcessEventForCrew","@actions.fireProcessEventToFetchCrewData","@actions.normalizeWorkflowData","@actions.getCrewLead","@actions.refreshSidePanelDataGrid"],"trueStep":["@actions.canNotReactivateDeactivatedTechnician"],"name":"checkForDeactivatedConditionForReactivate","type":"decision","actionDef":"function(pageContext) { if (pageContext.workforceStatusId === 'workforceDeactivated') { return true; } return false;  }"},{"falseStep":["@actions.checkForDeactivatedCondition"],"trueStep":["@actions.setSuspendAction","@actions.canNotApplyOnCrewLead"],"name":"checkForSuspendCondition","type":"decision","actionDef":"function(pageContext) { if (pageContext.workforceUserId === pageContext.crewLeadUserId) { return true; } return false; }"},{"falseStep":["@actions.suspendCrewMember"],"trueStep":["@actions.canNotSuspendDeactivatedTechnician"],"name":"checkForDeactivatedCondition","type":"decision","actionDef":"function(pageContext) { if (pageContext.workforceStatusId === 'workforceDeactivated') { return true; } return false; }"},{"name":"refreshMainPageDataGrid","gridId":["crewMembers"],"type":"RefreshGridOnSidePanel"},{"falseStep":["@actions.setDataBeforeDeletingCrewMember","@actions.fireProcessEventForCrew","@actions.getCrewLead","@actions.refreshSidePanelDataGrid","@actions.refreshMainPageDataGrid"],"trueStep":["@actions.setDeleteAction","@actions.canNotApplyOnCrewLead"],"name":"checkForDeleteCondition","type":"decision","actionDef":"function(pageContext) { if (pageContext.workforceUserId === pageContext.crewLeadUserId) { return true; } return false; }"},{"name":"getCrewLead","outputVarMap":{"data":"@pageContext.crewLeadData"},"type":"query","actionDef":{"filter":"{$workforceCrewId} = {@crewId} AND {$workforceCrewStatusId}= 'workforceCrewOnCrew' ","models":["workforceCrew","User","workforce"],"columns":{"workforceCrewId":"workforceCrew.crewId","workforceCrewStatusId":"workforceCrew.statusId","userName":"User.name","workforceCrewUserId":"workforceCrew.workforceUserId"},"inputs":{"crewId":"@pageContext.crewId"},"link":{"workforce":"User","workforceCrew":"workforce"}}}],"searchKeys":["userName","workforceCity","userPhoneNumber","statusName"]}}],"id":"crewMember","type":"section","transparent":true}],"label":"@lang.['cm','Crew Members']","type":"tab"},{"hidden":"@jslib.isActionAdd","children":[{"children":[{"readOnly":true,"id":"shift","title":"@lang.['s4','Shift']","type":"input","value":"@pageContext.calendarName"}],"id":"shiftSection","label":"@lang.['s4','Shift']","type":"section"},{"children":[{"id":"workforceWeeklySchedule","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"tableData":{"source":"@pageContext.calendarData"}},"isScrollAble":false,"rowActions":{"children":[]},"tableWidth":"50rem","jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['ws','Weekly Schedule']","children":[]},"gridRefreshId":"workforceWeeklySchedule","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSelectable":false,"actions":[],"tableHeader":[{"name":"@lang.['d12','Day']","options":{"flex":1.2,"showLabel":true},"key":"weeklyScheduleDay"},{"name":"@lang.['s','Status']","options":{"flex":1,"showLabel":true},"key":"shiftWeeklyScheduleIsOpen"},{"name":"@lang.['set','Start - End Time']","options":{"flex":3,"dateRangeType":"absoluteTime","type":"dateRange","showLabel":true},"key":"weeklyScheduleTimings"},{"name":"@lang.['tt2','Total Time']","options":{"flex":1.3,"showLabel":true},"key":"weeklyScheduleTotalHours"},{"name":"@lang.['b2','Break']","options":{"flex":3,"dateRangeType":"absoluteTime","sortable":true,"type":"dateRange","showLabel":true},"key":"weeklyScheduleLunchBreakSchedule"},{"name":"@lang.['mbd','Min Break Duration (Minutes)']","options":{"sortable":true,"showLabel":true},"key":"minimumBreakDuration"}]}}],"id":"weeklyScheduleSection","label":"@lang.['ws','Weekly Schedule']","type":"section","transparent":true},{"children":[{"id":"publicHoliday","type":"dataGrid","jsonDef":{"dataSourceId":"query/read","isScrollAble":true,"searchAllowed":false,"rowActions":{"children":[]},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navPH','Public Holidays']","children":[]},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"gridRefreshId":"crewPublicHoliday","isSelectable":false,"actions":[],"tableHeader":[{"name":"@lang.['n','Name']","options":{"sortable":false,"showLabel":true},"key":"holidayName"},{"name":"@lang.['d3','Date']","options":{"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"holidayDate"}],"dataToBeSent":{"filter":"{$calendarHolidayId} = {@calendarId}","models":["calendarHoliday","holiday"],"columns":{"calendarHolidayId":"calendarHoliday.calendarId","holidayRecver":"holiday.recver","holidayName":"holiday.name","holidayDate":"holiday.date","holidayId":"holiday.id"},"inputs":{"calendarId":"@pageContext.crewCalendarId"},"outerJoinOnModel":"calendarHoliday","distinct":true,"links":{"calendarHoliday":"holiday"},"translate":true},"searchKeys":["holidayName"]}}],"id":"publicHolidaysSection","label":"@lang.['navPH',' Public Holidays']","type":"section","transparent":true},{"children":[{"id":"leaveGrid","type":"dataGrid","jsonDef":{"isScrollAble":false,"rowActions":{"children":[]},"searchAllowed":false,"gridRefreshId":"crewLeave","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['n','Name']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"userName"},{"name":"@lang.['r5','Reason']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"listOptionAnswerAnswerOptionText"},{"name":"@lang.['sdt','Start Date & Time']","options":{"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceLeaveStartDate"},{"name":"@lang.['edt','End Date & Time']","options":{"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceLeaveEndDate"}],"dataToBeSent":{"filter":"({$workforceUserId} IN {@crewMemberId}) AND ({$workforceLeaveStartDate} BETWEEN {@startDate} AND {@endDate}) AND ({$workforceLeaveEndDate} BETWEEN {@startDate} AND {@endDate})","models":["workforceLeave","listOptionAnswer","workforce","User"],"columns":{"workforceLeaveId":"workforceLeave.id","workforceLeaveEndDate":"workforceLeave.endDate","workforceLeaveUserId":"workforceLeave.workforceUserId","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText","workforceLeaveReasonListOptionAnswerId":"workforceLeave.reasonListOptionAnswerId","workforceUserId":"workforce.userId","userName":"User.name","workforceLeaveStartDate":"workforceLeave.startDate"},"inputs":{"endDate":"@pageContext.crewEndDate","crewMemberId":"@pageContext.crewMemberId","startDate":"@pageContext.crewStartDate"},"distinct":true,"links":{"listOptionAnswer":"workforceLeave","workforce":"User","workforceLeave":"workforce"},"translate":true},"dataSourceId":"query/read","jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['l4','Leave']","children":[]},"isSelectable":false,"actions":[],"searchKeys":["listOptionAnswerAnswerOptionText"]}}],"label":"@lang.['l4','Leave']","id":"leaveSection","type":"section","transparent":true},{"children":[{"id":"crewOvertime","type":"dataGrid","jsonDef":{"isScrollAble":false,"searchAllowed":false,"rowActions":{"children":[]},"tableWidth":"40rem","gridRefreshId":"crewOvertime","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['n','Name']","options":{"flex":0.7,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"userName"},{"name":"@lang.['sdt','Start Date & Time']","options":{"flex":0.9,"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceOvertimeStartDate"},{"name":"@lang.['edt','End Date & Time']","options":{"flex":0.9,"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceOvertimeEndDate"},{"name":"@lang.['tt2','Total Time']","options":{"showLabel":true},"key":"workforceOvertimeTotalTime"}],"dataToBeSent":{"filter":"({$workforceUserId} IN {@crewMemberId}) AND ({$workforceOvertimeStartDate} BETWEEN {@startDate} AND {@endDate}) AND ({$workforceOvertimeEndDate} BETWEEN {@startDate} AND {@endDate})","models":["workforceOvertime","workforce","User"],"columns":{"workforceOvertimeUserId":"workforceOvertime.workforceUserId","workforceOvertimeStartDate":"workforceOvertime.startDate","workforceOvertimeId":"workforceOvertime.id","workforceOvertimeTotalTime":"CONCAT(ABS(TIMESTAMPDIFF(day,{$workforceOvertime.endDate},{$workforceOvertime.startDate})),\" @lang.['d11','Days'] \",ABS(MOD(TIMESTAMPDIFF(hour,{$workforceOvertime.endDate},{$workforceOvertime.startDate}),24)),\" @lang.['h','Hours'] \",ABS(MOD(TIMESTAMPDIFF(minute,{$workforceOvertime.endDate},{$workforceOvertime.startDate}),60)),\" @lang.['m2','Minutes'] \")","workforceUserId":"workforce.userId","userName":"User.name","workforceOvertimeEndDate":"workforceOvertime.endDate"},"inputs":{"endDate":"@pageContext.crewEndDate","crewMemberId":"@pageContext.crewMemberId","startDate":"@pageContext.crewStartDate"},"distinct":true,"links":{"workforceOvertime":"workforce","workforce":"User"},"translate":true},"actionOnLoad":[],"dataSourceId":"query/read","jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['o','Overtime']","children":[]},"isSelectable":false,"actions":[{}],"searchKeys":["userName"]}}],"id":"overtimeSection","label":"@lang.['o','Overtime']","type":"section","transparent":true}],"label":"@lang.['ws1','Work Schedule']","type":"tab"},{"hidden":"@jslib.isActionAdd","children":[{"alertMessage":"@lang.['ccbmsthabdradtowfttbctmtncc','Crew cannot be modified since tasks have already been dispatched. Recall all dispatched tasks or wait for them to be completed to make the necessary crew changes.']","actionOnChange":"@actions.hideBannerMsg","onClose":"@actions.hideBannerMsg","alertType":"warning","hidden":"@jslib.showBanner","id":"errTxt","type":"alert"},{"children":[{"id":"tasks","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":true,"tableData":{"source":"@pageContext.crewWorkOrderTaskData"}},"isScrollAble":true,"tableWidth":"60rem","searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{},"modifyRowActions":[],"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":0.6,"colorCode":"zStatusNameColor","showLabel":true},"key":"zStatusName"},{"name":"@lang.['taskId','Task ID']","options":{"flex":0.5,"showLabel":true},"key":"workOrderTaskId"},{"name":"@lang.['taskType','Task Type']","options":{"flex":0.8,"showLabel":true},"key":"taskTypeName"},{"name":"@lang.['cs','Customer Site']","options":{"flex":0.7,"showLabel":true},"key":"siteName"},{"name":"@lang.['s7','Scheduled']","options":{"flex":0.8,"type":"dateTime","showLabel":true},"key":"workOrderTaskScheduledDate"},{"name":"@lang.['d24','Duration']","options":{"flex":0.3,"showLabel":true},"key":"workOrderTaskEstimatedDuration"}],"actionOnLoad":[],"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['t7','Tasks']","children":[]},"isSelectable":false,"actions":[],"searchKeys":["siteName","taskTypeName","zStatusName","workOrderTaskEstimatedDuration"]}}],"id":"tasksSectionId","type":"section","transparent":true}],"label":"@lang.['t7','Tasks']","type":"tab"}],"label":"","type":"tab"}]},"actions":[{"name":"getTimeZone","type":"script","actionDef":"function(pageContext){pageContext.timezoneOffset=new Date().getTimezoneOffset();}"},{"name":"enableRecordGrid","type":"script","actionDef":"function(pageContext){pageContext.enable=true;}"},{"name":"setCrewStatus","type":"script","actionDef":"function (pageContext) { if (pageContext.crewAction === 'edit') { if (typeof pageContext.crewMembersData !== 'undefined' && pageContext.crewMembersData !== '' && pageContext.crewMembersData.length > 0 && typeof pageContext.crewLeadUserId !== 'undefined' && pageContext.crewLeadUserId !== '') { if (pageContext.crewStatusId === 'crewDraft') { pageContext.crewStatusId = 'crewNotStarted'; } }else{ pageContext.crewStatusId = 'crewDraft'; } } }"},{"name":"refreshSidePanelDataGrid","gridId":["crewMemberDataGrid","crewPublicHoliday","crewLeave","crewOvertime"],"type":"RefreshGridOnSidePanel"},{"name":"closePanel","type":"closePanel"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"closeModal","type":"closeModal"},{"falseStep":["@actions.getTimeZone","@actions.fireProcessEventToFetchCrewData","@actions.normalizeWorkflowData","@actions.setInitialPageContext","@actions.enableRecordGrid","@actions.setCrewMemberId","@actions.getCrewLead","@actions.refreshSidePanelDataGrid"],"trueStep":["@actions.fetchAllShifts","@actions.setInitialPageContext"],"name":"checkForActionOnLoad","type":"decision","actionDef":"function(pageContext){if(pageContext.crewAction==='addInitial' || pageContext.crewAction==='add'){return true;} return false;}"},{"name":"setContractor","type":"script","actionDef":"function(pageContext) { if (typeof pageContext.selectContractor !== 'undefined' && pageContext.selectContractor !== '') { pageContext.contractorId = pageContext.selectContractor[0].value; } else { pageContext.contractorId = '' } }"},{"name":"setCrewMemberId","type":"script","actionDef":"function(pageContext) {  pageContext.banner ='show'; pageContext.crewMemberId=[]; if (typeof pageContext.crewMembersData !== 'undefined' && pageContext.crewMembersData.length > 0) { for (var i in pageContext.crewMembersData ){ pageContext.crewMemberId.push(pageContext.crewMembersData[i].workforceUserId); } } }"},{"name":"processApiOutput","type":"script","actionDef":"function(pageContext){pageContext.crewId=pageContext.saveData[0].data[0].crewId;}"},{"name":"hideBannerMsg","type":"script","actionDef":"function(pageContext) {pageContext.banner='hide';}"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"getCrewLead","outputVarMap":{"data":"@pageContext.crewLeadData"},"type":"query","actionDef":{"filter":"{$workforceCrewId} = {@crewId} AND {$workforceCrewStatusId}= 'workforceCrewOnCrew' ","models":["workforceCrew","User","workforce"],"columns":{"workforceCrewId":"workforceCrew.crewId","workforceCrewStatusId":"workforceCrew.statusId","userName":"User.name","workforceCrewUserId":"workforceCrew.workforceUserId"},"inputs":{"crewId":"@pageContext.crewId"},"link":{"workforce":"User","workforceCrew":"workforce"}}},{"name":"setSubActionUpsertWorkforceCrew","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertWorkforceCrew';}"},{"name":"setDataBeforeDeactivatingCrewMember","type":"script","actionDef":"function(pageContext){ pageContext.crewMemberStatusId = 'workforceCrewOffCrew'; if (!Array.isArray(pageContext.removedMembersList)) pageContext.removedMembersList = []; pageContext.removedMembersList.push(pageContext.workforceUserId); }"},{"endPoint":"event/start","name":"fireProcessEventForCrew","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceFieldForceCrewProcessEvent","contextVar":{"subAction":"@pageContext.subAction","workforceCrew":[{"statusId":"@pageContext.crewMemberStatusId","recver":"@pageContext.workforceCrewRecver","crewId":"@pageContext.crewId","workforceUserId":"@pageContext.workforceUserId"}]}}]}},{"falseStep":["@actions.closePanel","@actions.clearPageContext"],"trueStep":["@actions.warningToSelectLead"],"name":"checkForCrewLead","type":"decision","actionDef":"function(pageContext) { if (pageContext.crewAction === 'edit') { if (pageContext.crewMembersData !== '' && pageContext.crewMembersData.length > 0) { if ( (typeof pageContext.initialCrewLeadUserId === 'undefined' || pageContext.initialCrewLeadUserId === '') || (Array.isArray(pageContext.removedMembersList)  && pageContext.removedMembersList.length>0 && pageContext.removedMembersList.indexOf(pageContext.initialCrewLeadUserId)!==-1)) { return true; } } } return false; }"},{"name":"setInitialPageContext","type":"script","actionDef":"function(pageContext) { if (pageContext.crewAction === 'edit') { pageContext.statusTargetModel = 'crew'; pageContext.initialSelectWorkGroup = []; if (typeof pageContext.selectWorkGroup !== 'undefined') { for (var i = 0; i < pageContext.selectWorkGroup.length; i++) { pageContext.initialSelectWorkGroup.push( pageContext.selectWorkGroup[i].value); } } pageContext.initialName = pageContext.crewName; pageContext.initialCrewContractorId = pageContext.selectContractor[0].value; pageContext.initialCrewRegionId = pageContext.crewRegion[0].value; pageContext.initialCrewBaseLocation = pageContext.crewBaseLocation; pageContext.initialCrewCalendarId = pageContext.crewCalendarId; pageContext.initialCrewStartDate = pageContext.crewStartDate; pageContext.initialCrewEndDate = pageContext.crewEndDate; pageContext.initialCrewDescription = pageContext.crewDescription; pageContext.initialCrewLeadUserId = pageContext.crewLeadUserId; } else if (pageContext.crewAction === 'addInitial') { pageContext.statusTargetModel = 'crew'; pageContext.crewName = ''; pageContext.crewDescription = ''; pageContext.crewRegion = ''; pageContext.selectContractor = ''; pageContext.crewBaseLocation = ''; pageContext.selectWorkGroup = ''; pageContext.crewEndDate = ''; pageContext.crewStartDate = ''; pageContext.crewCalendarId = ''; pageContext.crewStatusId = 'crewDraft'; pageContext.crewAction='add'; } }"},{"name":"normalizeWorkflowData","type":"script","actionDef":"function(pageContext) { if (pageContext.crewAction === 'edit') { for (var key in pageContext.responseData[0].data[0].crewInformationData[0]) { pageContext[key] = pageContext.responseData[0].data[0].crewInformationData[0][key]; } for (var key in pageContext.responseData[0].data[0]) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.responseData[0].data[0][key]; } pageContext.crewBaseLocation = pageContext.responseData[0].data[0].crewInformationData[0].crewAddress; pageContext.addressObj = {}; pageContext.addressObj.longitude = pageContext.responseData[0].data[0].crewInformationData[0].crewLongitude; pageContext.addressObj.latitude = pageContext.responseData[0].data[0].crewInformationData[0].crewLatitude; pageContext.selectContractor = []; pageContext.selectContractor.push({ 'label': pageContext.contractorName, 'value': pageContext.crewContractorId }); pageContext.crewRegion = []; pageContext.crewRegion.push({ 'label': pageContext.regionName, 'value': pageContext.crewRegionId }); pageContext.selectWorkGroup = []; for (var i = 0; i < pageContext.workGroup.length; i++) { pageContext.selectWorkGroup.push({ 'label': pageContext.workGroup[i].workGroupName, 'value': pageContext.workGroup[i].workGroupId }); } } }"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.saveData"},"type":"api","actionDef":{"data":[{"eventId":"workforceFieldForceCrewProcessEvent","contextVar":{"subAction":"@pageContext.subAction","crewId":"@pageContext.crewId","crewWorkGroup":[{"workGroupId":"@pageContext.selectWorkGroup"}],"crew":[{"country":"@pageContext.addressObj.country","address":"@pageContext.crewBaseLocation","statusTargetModel":"@pageContext.statusTargetModel","city":"@pageContext.addressObj.city","endDate":"@pageContext.crewEndDate","contractorId":"@pageContext.contractorId","postalCode":"@pageContext.addressObj.zipCode","latitude":"@pageContext.addressObj.latitude","description":"@pageContext.crewDescription","leadUserId":"@pageContext.crewLeadUserId","calendarId":"@pageContext.crewCalendarId","statusId":"@pageContext.crewStatusId","regionId":"@pageContext.crewRegion[0].value","recver":"@pageContext.recver","name":"@pageContext.crewName","id":"@pageContext.crewId","state":"@pageContext.addressObj.state","startDate":"@pageContext.crewStartDate","longitude":"@pageContext.addressObj.longitude"}]}}]}},{"endPoint":"event/start","name":"fireProcessEventToFetchCrewData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","continueOnError":true,"actionDef":{"data":[{"eventId":"workforceFieldForceCrewFetchDataProcessEvent","contextVar":{"timezoneOffset":"@pageContext.timezoneOffset","crewAction":"@pageContext.crewAction","crewId":"@pageContext.crewId"}}]}},{"name":"fetchAllShifts","outputVarMap":{"data":"@pageContext.shiftData"},"type":"query","actionDef":{"filter":"{$calendarCalendarType} ='shift'","models":["calendar"],"columns":{"calendarName":"calendar.name","calendarId":"calendar.id","calendarCalendarType":"calendar.calendarType"},"orderBy":"calendarName ASC"}},{"name":"setSubActionUpsertCrew","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertCrew';}"},{"name":"setActionEdit","type":"script","actionDef":"function(pageContext){pageContext.crewAction='edit';}"},{"name":"setInitialDataSaveAndContinue","type":"script","actionDef":"function(pageContext) { pageContext.initialName = pageContext.crewName; pageContext.initialCrewContractorId =  pageContext.contractorId; pageContext.initialCrewRegionId = pageContext.crewRegion; pageContext.initialCrewBaseLocation = pageContext.crewBaseLocation; pageContext.initialCrewCity = pageContext.addressObj.city; pageContext.initialCrewState = pageContext.addressObj.state; pageContext.initialCrewCountry = pageContext.addressObj.country; pageContext.initialCrewPostalCode = pageContext.addressObj.zipCode; pageContext.initialCrewCalendarId = pageContext.crewCalendarId; pageContext.initialCrewStartDate = pageContext.crewStartDate; pageContext.initialCrewEndDate = pageContext.crewEndDate; pageContext.initialCrewDescription = pageContext.crewDescription; pageContext.initialSelectWorkGroup = []; if (pageContext.selectWorkGroup !== 'undefined') { for (var i = 0; i < pageContext.selectWorkGroup.length; i++) { pageContext.initialSelectWorkGroup.push(pageContext.selectWorkGroup[i].value); } } }"},{"subTitle":"@lang.['tccbauacliscctsaclnoctctw','This crew cannot be activated until a crew lead is selected. Click cancel to select a crew lead now or continue to close this window.']","name":"warningToSelectLead","options":[{"buttonType":"primary","name":"cancel","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"continue","actionOnClick":["@actions.isLeadRemoved"],"type":"button","title":"@lang.['c13','Continue']"}],"type":"openModal","title":"@lang.['scl','Select Crew Lead']"},{"falseStep":["@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"trueStep":["@actions.fireProcessEventRemoveLeadUserId","@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"name":"isLeadRemoved","type":"decision","actionDef":"function (pageContext) { return (Array.isArray(pageContext.removedMembersList)  && pageContext.removedMembersList.length>0 && pageContext.removedMembersList.indexOf(pageContext.initialCrewLeadUserId)!==-1); }"},{"name":"refreshCrewGridOnMainPage","gridId":["crewDataGrid"],"type":"RefreshGridOnSidePanel"},{"endPoint":"event/start","name":"fireProcessEventRemoveLeadUserId","outputVarMap":{"data":"@pageContext.saveData"},"type":"api","actionDef":{"data":[{"eventId":"workforceFieldForceCrewProcessEvent","contextVar":{"subAction":"upsertCrew","crewId":"@pageContext.crewId","crew":[{"statusId":"crewDraft","id":"@pageContext.crewId","leadUserId":""}]}}]}}]}