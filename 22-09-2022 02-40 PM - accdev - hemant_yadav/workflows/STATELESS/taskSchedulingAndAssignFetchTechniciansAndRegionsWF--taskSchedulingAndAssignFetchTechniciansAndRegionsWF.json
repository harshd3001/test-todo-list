{"appendTechs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTechs","description":"appendTechs","processRule":"if (Array.isArray(contextVar.appendAvailableTechniciansData)) { contextVar.technicianListData = contextVar.technicianListData.concat(contextVar.appendAvailableTechniciansData) } contextVar.availableTechsBatchNumber = contextVar.availableTechsBatchNumber + 1;","nodeType":"PROCESS"},"getEligibleTechnicianData":{"connectors":[{"exitPortType":"NextStep","nodeId":"processTechnicianIdList"}],"processId":"taskSchedulingAndAssignFetchEligibleTechniciansWF","name":"getEligibleTechnicianData","description":"getEligibleTechnicianData","inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"technicianList":"technicianList","count":"count"},"nodeType":"WORKFLOW"},"fetchContractorAndRegionDetails":{"models":["workforce","region","contractor","contractorRegion","contractorWorkforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"regionId":"contractorRegion.regionId","regionName":"region.name","contractorName":"contractor.name","workforceUserId":"workforce.userId"},"orderBy":"regionName ASC","distinct":true,"description":"fetchContractorAndRegionDetails","inputVarMap":{"customBatchSizeForTech":"batchSize","techIds":"techIds"},"nodeType":"QUERY","filter":"{$workforceUserId} IN {@techIds}","name":"fetchContractorAndRegionDetails","links":{"contractorRegion":"contractorWorkforce","contractor":"contractorRegion","contractorWorkforce":"contractorRegion","workforce":"contractorWorkforce","region":"contractorRegion"},"outputVarMap":{"data":"technicianListData","count":"availableTechsCount","batchNumber":"availableTechsBatchNumber"},"batchSize":"batchSize","getCount":true},"processTechnicianData":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processTechnicianData","description":"processTechnicianData","processRule":"{var contractorName = ''; var regionName = ''; if (contextVar.technicianList.length > 0 && contextVar.technicianListData.length > 0) { contextVar.technicianList.forEach(function (val, i) { contractorName = ''; regionName = ''; contextVar.technicianListData.forEach(function (ele) { if (val.workforceUserId === ele.workforceUserId) { if (regionName.indexOf(ele.regionName) === -1) { regionName += ele.regionName + ' ' + ', '; contextVar.technicianList[i].regionName = regionName.slice(0, regionName.length - 2); } if (contractorName.indexOf(ele.contractorName) === -1) { contractorName += ele.contractorName + ' ' + ', '; contextVar.technicianList[i].contractorName = contractorName.slice(0, contractorName.length - 2); } } }) }) }contextVar.count = contextVar.technicianList.length;}","nodeType":"PROCESS"},"workflowContext":{"customBatchSizeForTech":1000,"noOfAvailableTechsBatches":0},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{contextVar.noOfAvailableTechsBatches = Math.ceil(contextVar.availableTechsCount / contextVar.customBatchSizeForTech);contextVar.availableTechsBatchNumber = contextVar.availableTechsBatchNumber + 1;}","id":"findNumberOfBatches","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreContractorAndRegionDetails"},{"exitPortType":"FalseStep","nodeId":"processTechnicianData"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"contextVar.noOfAvailableTechsBatches >= 2 && contextVar.noOfAvailableTechsBatches >= contextVar.availableTechsBatchNumber","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getEligibleTechnicianData"}],"name":"Start","description":"Start","id":"start","nodeType":"START"},"fetchMoreContractorAndRegionDetails":{"models":["workforce","region","contractor","contractorRegion","contractorWorkforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTechs"}],"columns":{"regionId":"contractorRegion.regionId","regionName":"region.name","contractorName":"contractor.name","workforceUserId":"workforce.userId"},"orderBy":"regionName ASC","distinct":true,"description":"fetchMoreContractorAndRegionDetails","inputVarMap":{"customBatchSizeForTech":"batchSize","availableTechsBatchNumber":"batchNumber","techIds":"techIds"},"nodeType":"QUERY","filter":"{$workforceUserId} IN {@techIds}","name":"fetchMoreContractorAndRegionDetails","links":{"contractorRegion":"contractorWorkforce","contractor":"contractorRegion","contractorWorkforce":"contractorRegion","workforce":"contractorWorkforce","region":"contractorRegion"},"outputVarMap":{"data":"appendAvailableTechniciansData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"processTechnicianIdList":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchContractorAndRegionDetails"}],"contextChangePermitted":true,"name":"processTechnicianList","description":"processTechnicianList","processRule":"{contextVar.techIds=[]; if( contextVar.technicianList.length>0){ for (var i = 0; i < contextVar.technicianList.length; i++) { contextVar.techIds.push(contextVar.technicianList[i].workforceUserId); } } }","nodeType":"PROCESS"},"end":{"name":"end","description":"end","inputVarMap":{"technicianList":"technicianList","count":"count"},"outputVarMap":{"technicianList":"technicianList","count":"count"},"id":"end","nodeType":"END"},"workflowNodes":["start","getEligibleTechnicianData","processTechnicianIdList","fetchContractorAndRegionDetails","findNumberOfBatches","areMoreTechsPresent","fetchMoreContractorAndRegionDetails","appendTechs","processTechnicianData","end"]}