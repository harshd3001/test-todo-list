{"appendWorkforceData":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendWorkforceData","description":"appendWorkforceData","processRule":"{ if (Array.isArray(contextVar.appendWorkforceData)) { contextVar.workforceData.push(...contextVar.appendWorkforceData); } contextVar.workforceBatchNumber = contextVar.workforceBatchNumber+1; }","nodeType":"PROCESS","jsEngine":"es6"},"isSiteDataPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"upsertSiteData"},{"exitPortType":"FalseStep","nodeId":"isCrewDataPresent"}],"name":"isSiteDataPresent","description":"isSiteDataPresent","processRule":"(Array.isArray(contextVar.siteData) && contextVar.siteData.length > 0)","nodeType":"DECISION"},"areMoreSiteBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreSiteData"},{"exitPortType":"FalseStep","nodeId":"getCrewData"}],"name":"areMoreSiteBatchesPresent","description":"areMoreSiteBatchesPresent","processRule":"(contextVar.noOfSiteBatches >= 2 && contextVar.noOfSiteBatches >= contextVar.siteBatchNumber)","nodeType":"DECISION"},"upsertCrewData":{"modelName":"crew","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"multirecord":true,"name":"upsertCrewData","description":"upsertCrewData","inputVarMap":{"crewData":"data"},"outputVarMap":{},"nodeType":"MODEL","operation":4},"areMoreBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreWorkforceData"},{"exitPortType":"FalseStep","nodeId":"getSiteData"}],"name":"areMoreBatchesPresent","description":"areMoreBatchesPresent","processRule":"(contextVar.noOfBatches >= 2 && contextVar.noOfBatches >= contextVar.workforceBatchNumber)","nodeType":"DECISION"},"workflowContext":{"customBatchSize":1000,"workforceData":[],"siteData":[]},"getSiteData":{"models":["site"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatchesOfSite"}],"columns":{"id":"site.id"},"description":"getSiteData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize"},"nodeType":"QUERY","filter":"{$site.timezoneOffset} IS NULL OR {$site.timezoneOffset} = '' OR {$site.timezoneOffset} = 0","name":"getSiteData","links":{},"outputVarMap":{"data":"siteData","count":"siteCount","batchNumber":"siteBatchNumber"},"batchSize":"batchSize","getCount":true},"isCrewDataPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"upsertCrewData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isCrewDataPresent","description":"isCrewDataPresent","processRule":"(Array.isArray(contextVar.crewData) && contextVar.crewData.length > 0)","nodeType":"DECISION"},"getMoreWorkforceData":{"models":["workforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendWorkforceData"}],"columns":{"userId":"workforce.userId"},"description":"getMoreWorkforceData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","workforceBatchNumber":"batchNumber"},"nodeType":"QUERY","filter":"{$workforce.timezoneOffset} IS NULL OR {$workforce.timezoneOffset} = '' OR {$workforce.timezoneOffset} = 0","name":"getMoreWorkforceData","links":{},"outputVarMap":{"data":"appendWorkforceData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"findNumberOfBatchesOfSite":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreSiteBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatchesOfSite","description":"findNumberOfBatchesOfSite","processRule":"{ contextVar.noOfSiteBatches = 0; contextVar.noOfSiteBatches = Math.ceil(contextVar.siteCount/contextVar.customBatchSize); contextVar.siteBatchNumber++; }","nodeType":"PROCESS"},"findNumberOfBatchesForCrew":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreCrewBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatchesForCrew","description":"findNumberOfBatchesForCrew","processRule":"{ contextVar.noOfCrewBatches = 0; contextVar.noOfCrewBatches = Math.ceil(contextVar.crewCount/contextVar.customBatchSize); contextVar.crewBatchNumber++; }","nodeType":"PROCESS"},"areMoreCrewBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreCrewData"},{"exitPortType":"FalseStep","nodeId":"isWorkforceDataPresent"}],"name":"areMoreCrewBatchesPresent","description":"areMoreCrewBatchesPresent","processRule":"(contextVar.noOfCrewBatches >= 2 && contextVar.noOfCrewBatches >= contextVar.crewBatchNumber)","nodeType":"DECISION"},"getCrewData":{"models":["crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatchesForCrew"}],"columns":{"id":"crew.id"},"description":"getCrewData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize"},"nodeType":"QUERY","filter":"{$crew.timezoneOffset} IS NULL OR {$crew.timezoneOffset} = '' OR {$crew.timezoneOffset} = 0","name":"getCrewData","links":{},"outputVarMap":{"data":"crewData","count":"crewCount","batchNumber":"crewBatchNumber"},"batchSize":"batchSize","getCount":true},"end":{"name":"end","description":"End","inputVarMap":{"workforceData":"workforceData","siteData":"siteData","crewData":"crewData"},"outputVarMap":{"workforceData":"workforceData","siteData":"siteData","crewData":"crewData"},"nodeType":"END"},"upsertSiteData":{"modelName":"site","connectors":[{"exitPortType":"NextStep","nodeId":"isCrewDataPresent"}],"multirecord":true,"name":"upsertSiteData","description":"upsertSiteData","inputVarMap":{"siteData":"data"},"outputVarMap":{},"nodeType":"MODEL","operation":4},"appendSiteData":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreSiteBatchesPresent"}],"contextChangePermitted":true,"name":"appendSiteData","description":"appendSiteData","processRule":"{ if (Array.isArray(contextVar.appendSiteData)) { contextVar.siteData.push(...contextVar.appendSiteData); } contextVar.siteBatchNumber++; }","nodeType":"PROCESS","jsEngine":"es6"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{ contextVar.noOfBatches = 0; contextVar.noOfBatches = Math.ceil(contextVar.workforceCount/contextVar.customBatchSize); contextVar.workforceBatchNumber++; }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getWorkforceData"}],"name":"start","description":"start","nodeType":"START"},"getWorkforceData":{"models":["workforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"userId":"workforce.userId"},"description":"getWorkforceData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize"},"nodeType":"QUERY","filter":"{$workforce.timezoneOffset} IS NULL OR {$workforce.timezoneOffset} = '' OR {$workforce.timezoneOffset} = 0","name":"getWorkforceData","links":{},"outputVarMap":{"data":"workforceData","count":"workforceCount","batchNumber":"workforceBatchNumber"},"batchSize":"batchSize","getCount":true},"workflowNodes":["start","getWorkforceData","findNumberOfBatches","areMoreBatchesPresent","getMoreWorkforceData","appendWorkforceData","getSiteData","findNumberOfBatchesOfSite","areMoreSiteBatchesPresent","getMoreSiteData","appendSiteData","getCrewData","findNumberOfBatchesForCrew","areMoreCrewBatchesPresent","getMoreCrewData","appendCrewData","isWorkforceDataPresent","upsertWorkforceData","isSiteDataPresent","upsertSiteData","isCrewDataPresent","upsertCrewData","end"],"upsertWorkforceData":{"modelName":"workforce","connectors":[{"exitPortType":"NextStep","nodeId":"isSiteDataPresent"}],"multirecord":true,"name":"upsertWorkforceData","description":"upsertWorkforceData","inputVarMap":{"workforceData":"data"},"outputVarMap":{},"nodeType":"MODEL","operation":4},"appendCrewData":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendCrewData","description":"appendCrewData","processRule":"{ if (Array.isArray(contextVar.appendCrewData)) { contextVar.crewData.push(...contextVar.appendCrewData); } contextVar.crewBatchNumber = contextVar.crewBatchNumber+1; }","nodeType":"PROCESS","jsEngine":"es6"},"isWorkforceDataPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"upsertWorkforceData"},{"exitPortType":"FalseStep","nodeId":"isSiteDataPresent"}],"name":"isWorkforceDataPresent","description":"isWorkforceDataPresent","processRule":"(Array.isArray(contextVar.workforceData) && contextVar.workforceData.length > 0)","nodeType":"DECISION"},"getMoreSiteData":{"models":["site"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendSiteData"}],"columns":{"id":"site.id"},"description":"getMoreSiteData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","siteBatchNumber":"batchNumber"},"nodeType":"QUERY","filter":"{$site.timezoneOffset} IS NULL OR {$site.timezoneOffset} = '' OR {$site.timezoneOffset} = 0","name":"getMoreSiteData","links":{},"outputVarMap":{"data":"appendSiteData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"getMoreCrewData":{"models":["crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendCrewData"}],"columns":{"id":"crew.id"},"description":"getMoreCrewData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","crewBatchNumber":"batchNumber"},"nodeType":"QUERY","filter":"{$crew.timezoneOffset} IS NULL OR {$crew.timezoneOffset} = '' OR {$crew.timezoneOffset} = 0","name":"getMoreCrewData","links":{},"outputVarMap":{"data":"appendCrewData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"}}