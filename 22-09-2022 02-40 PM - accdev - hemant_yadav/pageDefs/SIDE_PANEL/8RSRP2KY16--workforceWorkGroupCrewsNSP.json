{"pageContext":{},"actionOnLoad":["@actions.fetchSelectedCrews","@actions.setInitialData"],"localPageContext":true,"jslib":{"isSaveDisabled":"function (pageContext) { if (typeof pageContext.initialSelectedRowIdsArray !== 'undefined' && pageContext.initialSelectedRowIdsArray.length > 0 && pageContext.selectedRowIds.length !== pageContext.initialSelectedRowIdsArray.length) { return false; } else { for (var i in pageContext.selectedRowIds) { if (pageContext.initialSelectedRowIdsArray.indexOf(pageContext.selectedRowIds[i].crewId) === -1) { return false; }; }; return true; } }"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel"],"type":"buttonIcon"}]},"children":[{"buttonType":"primary","actionOnClick":["@actions.setSubActionInsertCrewWorkGroup","@actions.comparePreviousCrewId","@actions.fireProcessEvent","@actions.openPreviousPanel","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"}],"title":"Edit Crews"},"body":{"children":[{"label":"@lang.['s16','Search']","id":"crewsDataGrid","type":"datagrid","jsonDef":{"isScrollAble":false,"tableWidth":"60rem","searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY']","type":"noData"},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['i','id']","options":{"hidden":true,"showLabel":false},"key":"crewId","primaryKey":true},{"name":"@lang.['s','Status']","options":{"flex":1,"sortOrder":"ASC","colorCode":"statusNameColor","sortable":true,"showLabel":true},"key":"statusName"},{"name":"@lang.['n','Name']","options":{"flex":0.9,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"crewName"},{"name":"Region","options":{"flex":0.6,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"regionName"},{"name":"Crew Lead","options":{"flex":0.6,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"crewLeadName"},{"name":"Crew Lead Phone","options":{"flex":1.2,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"crewLeadPhone"}],"dataToBeSent":{"filter":"{$crew.statusId} != 'crewDeactivated' AND {$User.status}!='Deactivated' AND {$workforce.statusId}!= 'workforceDeactivated'","models":["crew","region","User","workforce","ZStatus"],"columns":{"crewLeadId":"crew.leadUserId","crewLeadName":"User.name","regionName":"region.name","crewLeadPhone":"User.phoneNumber","statusName":"ZStatus.name","crewId":"crew.id","crewName":"crew.name","statusNameColor":"ZStatus.colorCode"},"name":"crewList","distinct":true,"orderBy":"crewName ASC","links":{"User":"workforce","workforce":"crew","crew":"region","ZStatus":"crew"},"getCount":true,"translate":true},"rowsToSelect":{"filter":"{$crewWorkGroup.workGroupId} = {@idFilter} AND {$crew.statusId} != 'crewDeactivated' AND {$User.status}!='Deactivated' AND {$workforce.statusId}!= 'workforceDeactivated'","models":["crew","region","User","workforce","crewWorkGroup","ZStatus"],"columns":{"crewLeadId":"crew.leadUserId","crewLeadName":"User.name","regionName":"region.name","crewLeadPhone":"User.phoneNumber","statusName":"ZStatus.name","crewId":"crew.id","crewName":"crew.name","statusNameColor":"ZStatus.colorCode"},"inputs":{"idFilter":"@pageContext.workGroupId"},"name":"crewList","distinct":true,"orderBy":"crewName ASC","links":{"User":"workforce","crewWorkGroup":"crew","workforce":"crew","crew":"region","ZStatus":"crew"},"getCount":true,"translate":true},"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"Crews"},"isSelectable":true,"actions":[],"searchKeys":["crewName","crewLeadName","regionName","crewLeadPhone"]}}],"label":"Crews","id":"datagridWorkGroupCrews","type":"section","transparent":true},"updateAllowed":true,"isSelectable":true,"actions":[{"name":"openPreviousPanel","type":"backPanel"},{"name":"setSubActionInsertCrewWorkGroup","type":"script","actionDef":"function(pageContext){pageContext.subAction='insertCrewWorkGroup';}"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.crewWorkGroupUserList"},"type":"api","actionDef":{"data":[{"eventId":"workforceWorkGroupProcessEvent","contextVar":{"subAction":"@pageContext.subAction","crewWorkGroup":[{"removeWorkGroupCrewList":"@pageContext.unSelectedCrewList","workGroupCrewList":"@pageContext.selectedRowIds","workGroupId":"@pageContext.workGroupId"}]}}]}},{"name":"fetchSelectedCrews","outputVarMap":{"data":"@pageContext.selectedCrewList"},"type":"query","actionDef":{"filter":"{$crewWorkGroup.workGroupId} = {@idFilter} AND {$crew.statusId} != 'crewDeactivated' AND {$User.status}!='Deactivated' AND {$workforce.statusId}!= 'workforceDeactivated'","models":["crew","region","User","workforce","crewWorkGroup"],"columns":{"recver":"crewWorkGroup.recver","crewId":"crewWorkGroup.crewId","workGroupId":"crewWorkGroup.workGroupId","crewWorkGroupRecver":"crewWorkGroup.recver"},"inputs":{"idFilter":"@pageContext.workGroupId"},"name":"crewList","distinct":true,"links":{"User":"workforce","crewWorkGroup":"crew","workforce":"crew","crew":"region"},"getCount":true,"translate":true}},{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { pageContext.initialSelectedRowIdsArray = []; if (typeof pageContext.selectedCrewList !== 'undefined' && pageContext.selectedCrewList.length > 0) { for (var i = 0; i < pageContext.selectedCrewList.length; i++) { pageContext.initialSelectedRowIdsArray.push( pageContext.selectedCrewList[i].crewId ); } } }"},{"name":"comparePreviousCrewId","type":"script","actionDef":"function (pageContext) { pageContext.unSelectedCrewList = []; var props = ['crewId', 'workGroupId', 'crewWorkGroupRecver']; var result = pageContext.selectedCrewList.filter(function (o1) { return !pageContext.selectedRowIds.some(function (o2) { return o1.crewId === o2.crewId }) }) .map(function (o) { return props.reduce(function (newo, name) { newo[name] = o[name]; return newo }, {}) }); pageContext.unSelectedCrewList = result; }"},{"name":"refreshDataGrid","type":"refreshDataGrid"}]}