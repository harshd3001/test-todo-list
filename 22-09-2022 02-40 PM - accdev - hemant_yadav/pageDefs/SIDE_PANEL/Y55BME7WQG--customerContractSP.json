{"pageContext":{},"actionOnLoad":["@actions.customerContractPerformanceEnhancerWF","@actions.normalizeWorkFlowData","@actions.initialData"],"localPageContext":true,"jslib":{"isDoNotDeleteHidden":"function(pagecontext){if(pageContext.contractAction != 'add' && pageContext.modalAction=='doNotDeleteContract'){return false}else{return true}}","isNotStartActive":"function(pageContext){return !(pageContext.status==='contractNotStarted' || pageContext.status==='contractDraft' || pageContext.status==='contractActive');}","isMaintenancePlansTabHidden":"function(pagecontext){return(pageContext.contractAction === 'addInitial' || pageContext.contractAction === 'add' );}","isDeleteHidden":"function(pagecontext){if(pageContext.contractAction != 'add' && pageContext.modalAction=='deleteContract' ){return false}else{return true}}","isEdit":"function(pageContext){if(pageContext.contractAction=='edit'){return true}}","isDisabled":"function(pageContext){return (pageContext.status!=='contractDraft');}","dynamicHeaderText":"function(pageContext){ if(pageContext.contractAction === 'add' || pageContext.contractAction === 'addInitial'){return '@lang.[\"anc1\",\"Add New Contract\"]'}else if(pageContext.contractAction === 'edit' || pageContext.contractAction === 'editInitial'){return '@lang.[\"edit\",\"Edit\"] '+pageContext.contractNumber}}","isSaveDisabled":"function(pageContext){if(pageContext.contractAction==='add'){return(pageContext.contractNumber===''||pageContext.calendarId===''||typeof pageContext.selectedCustomer==='undefined'||pageContext.selectedCustomer==='')}else if(pageContext.contractAction==='edit'){return((pageContext.endDate===pageContext.initialEndDate&&pageContext.startDate===pageContext.initialStartDate&&pageContext.name===pageContext.initialName&&pageContext.contractNumber===pageContext.initialContractNumber&&pageContext.name===pageContext.initialName&&pageContext.initialDescription===pageContext.description&&pageContext.initialSlaId===pageContext.slaId&&pageContext.initialCalendarId===pageContext.calendarId&&pageContext.initialCustomerId===pageContext.customerId&&pageContext.initialStatus===pageContext.status)||pageContext.customerId===''||pageContext.contractNumber===''||pageContext.calendarId==='');}}","isAddNewMaintenancePlanHidden":"function(pagecontext){return(pageContext.status === 'contractExpired' );}"},"header":{"children":[{"statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"hidden":"@jslib.isDoNotDeleteHidden","icon":"@iconlib.ActionsBinGrey","actionOnClick":["@actions.cantDeleteContract"],"id":"doNotDeleteContract","type":"buttonIcon"},{"hidden":"@jslib.isDeleteHidden","icon":"@iconlib.ActionsBinGrey","actionOnClick":["@actions.deleteContract"],"id":"deleteContract","type":"buttonIcon"},{"buttonType":"primary","actionOnClick":["@actions.setSubActionUpsert","@actions.fireProcessEvent","@actions.clearContext","@actions.closePanel","@actions.refreshGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.clearContext","@actions.closePanel"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"children":[{"isRequired":true,"disabled":"@jslib.isNotStartActive","id":"contractNumber","label":"@lang.['cn','Contract Number']","placeholder":"@lang.['ecn','Enter contract number']","type":"input","value":"@pageContext.contractNumber"},{"disabled":"@jslib.isNotStartActive","id":"description","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.description","placeHolder":"@lang.['ecd','Enter contract description']"}],"label":"@lang.['gi','General Information']","id":"generalInformationSection","type":"section"},{"children":[{"actionOnChange":["@actions.decisionActionForCustomerData"],"optLabelMap":"companyName","optValueMap":"id","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$companyName} like {@filter} AND {$statusId}!='customerDeactivated'","models":["customer","ZStatus"],"columns":{"statusId":"customer.statusId","companyName":"customer.companyName","statusName":"ZStatus.name","id":"customer.id","billingAddress":"customer.billingAddress"},"inputs":{},"outerJoinOnModel":"customer","orderBy":"companyName ASC"}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$id} IN {@selectedCustomerId} AND {$statusId}!='customerDeactivated'","models":["customer","ZStatus"],"columns":{"statusId":"customer.statusId","companyName":"customer.companyName","statusName":"ZStatus.name","id":"customer.id","billingAddress":"customer.billingAddress"},"inputs":{"selectedCustomerId":"@pageContext.selectedId"},"outerJoinOnModel":"customer"},"columnsToBeHidden":["statusId","id"],"dataSourceId":"query/read","selectedRowAdvanceGrid":"AdvancedGrid","rowsToBeSelect":"selectedId","sourceType":"query","sidePanelTitle":"@lang.['sc','Select Customer']","gridHeaderText":"@lang.['navC','Customers']","customColumns":{"companyName":"@lang.['c16','Customer']","statusName":"@lang.['s','Status']","billingAddress":"@lang.['address','Address']"},"searchKeys":["id","companyName"]},"disabled":"@jslib.isDisabled","id":"selectedCustomer","label":"@lang.['customer','Customer']","type":"selectDropdown","value":"@pageContext.selectedCustomer"},{"options":"@pageContext.slaList","disabled":"@jslib.isDisabled","optTitleKey":"slaName","optValueKey":"slaId","id":"slaList","title":"@lang.['s13','SLA (Optional)']","type":"dropdown","value":"@pageContext.slaId","placeHolder":"@pageContext.slaPlaceHolderText"},{"options":"@pageContext.calendarList","disabled":"@jslib.isDisabled","optTitleKey":"calendarName","optValueKey":"calendarId","id":"calendarList","title":"@lang.['navSW','Service Window']","type":"dropdown","value":"@pageContext.calendarId","placeHolder":"@lang.['ssw','Select service window']"}],"label":"@lang.['ci2','Contract Information']","id":"contractInformationSection","type":"section"},{"children":[{"actionOnChange":["@actions.checkEndDate"],"minDate":"1970-01-01 00:00","disabled":"@jslib.isDisabled","id":"startDate","title":"@lang.['sd1','Start Date (Optional)']","type":"date","value":"@pageContext.startDate","placeHolder":"@pageContext.startDatePlaceHolderText"},{"minDate":"@pageContext.startDate","disabled":"@jslib.isDisabled","id":"endDate","title":"@lang.['ed3','End Date (Optional)']","type":"date","value":"@pageContext.endDate","placeHolder":"@lang.['sed','Select end date']"}],"label":"@lang.['d8','Dates']","id":"datesSection","type":"section"}],"label":"@lang.['ci2','Contract Information']","id":"contractInformation","type":"tab"},{"hidden":"@jslib.isMaintenancePlansTabHidden","children":[{"children":[{"label":"","id":"maintenancePlans","type":"dataGrid","jsonDef":{"isScrollAble":true,"tableWidth":"70rem","searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsOpenInNewWindowPurple","hidden":{"statusId":["assetMaintenancePlanExpired"]},"name":"@lang.['o10','OPEN']","tooltip":"@lang.['o10','OPEN']","icon":"@iconlib.ActionsOpenInNewWindowGrey","actionOnClick":["@actions.setActionEdit","@actions.openSidePanel"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsVisiblePurple","hidden":{"statusId":["assetMaintenancePlanActive"]},"name":"@lang.['v4','VIEW']","tooltip":"@lang.['v4','VIEW']","icon":"@iconlib.ActionsVisibleGrey","actionOnClick":["@actions.setActionView","@actions.openSidePanel"],"type":"buttonIcon"}]},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['ampi','Asset Maintenance Plan Id']","options":{"hidden":true,"showLabel":false},"key":"assetMaintenancePlanId","primaryKey":true},{"name":"@lang.['s','Status']","options":{"sortOrder":"ASC","colorCode":"statusNameColor","sortable":true,"showLabel":true},"key":"statusName"},{"name":"@lang.['mp','Maintenance Plan']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"assetMaintenancePlanName"},{"name":"@lang.['navCS','Customer Sites']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"assetMaintenancePlanSiteName"},{"name":"@lang.['re','Repeats Every']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"frequencyValueUnit"},{"name":"@lang.['fm1','First Maintenance']","options":{"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"firstMaintenanceDate"},{"name":"@lang.['lm','Last Maintenance']","options":{"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"lastMaintenanceDate"}],"dataToBeSent":{"apiResponseParams":["count"],"processId":"fetchAssetMaintenancePlanAndScheduleWF","apiResponseFormat":true,"contextVar":{"contractId":"@pageContext.id"},"apiResponseObject":"assetMaintenancePlanData"},"dataSourceId":"process/start","sourceType":"api","jslib":{"isAddNewMaintenancePlanHidden":"function(pageContext){return (pageContext.status ==='contractExpired');}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navMP','Maintenance Plans']","children":[{"buttonType":"primary","hidden":"@jslib.isAddNewMaintenancePlanHidden","actionOnClick":["@actions.setActionAdd","@actions.openSidePanel"],"id":"add","type":"button","title":"@lang.['addNew','Add New']"}]},"isSelectable":false,"updateAllowed":true,"actions":[{"name":"openSidePanel","type":"openPanel","pageId":"assetMaintenanceScheduleSP"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"setActionEdit","type":"script","actionDef":"function(pageContext){pageContext.maintenancePlanAction = 'edit';pageContext.module = 'contracts';}"},{"name":"setActionView","type":"script","actionDef":"function(pageContext){pageContext.maintenancePlanAction = 'view';pageContext.module = 'contracts';}"},{"name":"setActionAdd","type":"script","actionDef":"function(pageContext){pageContext.maintenancePlanAction ='add';pageContext.module = 'contracts';}"}],"searchKeys":["statusName","assetMaintenancePlanName","assetMaintenancePlanFrequencyValueUnit","siteName"]}}],"label":"","id":"assetLogGrid","type":"section","transparent":true}],"label":"@lang.['navMP','Maintenance Plans']","type":"tab"}],"label":"","type":"tab"}]},"actions":[{"name":"clearContext","type":"script","actionDef":"function(pageContext){pageContext.contractNumber='';pageContext.description='';pageContext.slaId='';pageContext.calendarId='';pageContext.startDate='';pageContext.endDate='';pageContext.statusName='';pageContext.statusNameColor='';pageContext.status='';pageContext.customerId='';}"},{"name":"closePanel","type":"closePanel"},{"name":"initialData","type":"script","actionDef":"function(pageContext){ if (pageContext.contractAction == 'editInitial') { pageContext.initialContractNumber = pageContext.contractNumber; pageContext.initialCustomerId = pageContext.customerId; pageContext.initialDescription = pageContext.description; pageContext.initialSlaId = pageContext.slaId; pageContext.initialCalendarId = pageContext.calendarId; pageContext.initialStatus = pageContext.status; pageContext.initialEndDate = pageContext.endDate; pageContext.initialStartDate = pageContext.startDate; pageContext.contractAction = 'edit'; pageContext.selectedCustomer = [];if (pageContext.customerList.length > 0) {for(var j = 0; j < pageContext.customerList.length; j++) {var obj = {label: pageContext.customerList[j].companyName,value: pageContext.customerList[j].id};pageContext.selectedCustomer.push(obj);}}pageContext.customerId = pageContext.selectedCustomer[0].value; pageContext.slaPlaceHolderText = `@lang.['nssftc','No SLA selected for this contract']`; pageContext.startDatePlaceHolderText = `@lang.['nsdgftc','No start date given for this contract']`; } else if (pageContext.contractAction == 'addInitial') { pageContext.contractNumber = ''; pageContext.description = ''; pageContext.slaId = ''; pageContext.calendarId = ''; pageContext.endDate = ''; pageContext.startDate = ''; pageContext.statusTargetModel = 'contract'; pageContext.contractAction = 'add'; pageContext.slaPlaceHolderText = `@lang.['ss','Select SLA']`; pageContext.startDatePlaceHolderText = `@lang.['ssd','Select start date']`;pageContext.customerId=''; } }"},{"name":"setSubActionDelete","type":"script","actionDef":"function(pageContext){pageContext.subAction = 'deleteContract';}"},{"subTitle":"@lang.['aysywtdtctcbu1','Are you sure you want to delete the contract? This cannot be undone.']","name":"deleteContract","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDelete","@actions.fireProcessEvent","@actions.closeModal","@actions.clearContext","@actions.closePanel","@actions.refreshGrid"],"type":"button","title":"@lang.['d1','Delete']"}],"type":"openModal","title":"@lang.['dc1','Delete Contract']"},{"subTitle":"@lang.['ycdtcbihbufapwoatedtctcartfh','You cannot delete this contract because it has been used for a past work order. Adjust the End Date to cancel the contract and retain the full history.']","name":"cantDeleteContract","options":[{"buttonType":"primary","name":"ok","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['o1','Ok']"}],"type":"openModal","title":"@lang.['dc1','Delete Contract']"},{"name":"closeModal","type":"closeModal"},{"falseStep":["@actions.clearCustomerData"],"trueStep":["@actions.setSelectedCustomerId"],"name":"decisionActionForCustomerData","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.selectedCustomer !=='undefined' && pageContext.selectedCustomer !=='' && pageContext.selectedCustomer[0] !== null) {return true;} return false;}"},{"name":"clearCustomerData","type":"script","actionDef":"function(pageContext){pageContext.selectedCustomer='';pageContext.customerId='';}"},{"name":"setSelectedCustomerId","type":"script","actionDef":"function(pageContext){if(typeof pageContext.selectedCustomer != 'undefined' && pageContext.selectedCustomer.length >0){pageContext.customerId=pageContext.selectedCustomer[0].value;}}"},{"name":"normalizeWorkFlowData","type":"script","actionDef":"function (pageContext) { pageContext.slaList = pageContext.queryData[0].outputVar.slaList; pageContext.calendarList = pageContext.queryData[0].outputVar.calendarList; pageContext.statusData = pageContext.queryData[0].outputVar.statusData; pageContext.customerList = pageContext.queryData[0].outputVar.customerList; pageContext.workOrderContractList = pageContext.queryData[0].outputVar.workOrderContractList; if (typeof pageContext.statusData !== undefined && pageContext.statusData > 0) { pageContext.statusName = pageContext.statusData[0].statusName; pageContext.statusNameColor = pageContext.statusData[0].statusNameColor; } if (typeof pageContext.workOrderContractList !== undefined && pageContext.workOrderContractList.length > 0) { pageContext.modalAction = 'doNotDeleteContract' } else { pageContext.modalAction = 'deleteContract' } }"},{"name":"setSubActionUpsert","type":"script","actionDef":"function(pageContext) {if (pageContext.contractAction == 'add' || pageContext.contractAction == 'edit') {pageContext.subAction = 'upsertContract';}}"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.workFlowData"},"type":"api","actionDef":{"data":[{"eventId":"customerContractProcessEvent","contextVar":{"contract":[{"calendarId":"@pageContext.calendarId","slaId":"@pageContext.slaId","statusTargetModel":"contract","statusId":"@pageContext.status","endDate":"@pageContext.endDate","recver":"@pageContext.recver","customerId":"@pageContext.customerId","contractNumber":"@pageContext.contractNumber","description":"@pageContext.description","id":"@pageContext.id","startDate":"@pageContext.startDate"}],"subAction":"@pageContext.subAction"}}]}},{"endPoint":"process/start","name":"customerContractPerformanceEnhancerWF","outputVarMap":{"data":"@pageContext.queryData"},"type":"api","actionDef":{"data":[{"processId":"B15F5I9EPS","contextVar":{"customerId":"@pageContext.customerId","id":"@pageContext.id","status":"@pageContext.status"}}]}},{"name":"refreshGrid","type":"refreshDataGrid"},{"name":"checkEndDate","type":"script","actionDef":"function(pageContext) {if (typeof pageContext.startDate !== 'undefined' && pageContext.startDate !== '' && typeof pageContext.endDate !== 'undefined' && pageContext.endDate !== '' ) { pageContext.contractStartDate = new Date(pageContext.startDate);  pageContext.contractEndDate = new Date(pageContext.endDate); if (pageContext.contractStartDate > pageContext.contractEndDate){pageContext.endDate='';} } }"}]}