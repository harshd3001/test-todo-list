{"pageContext":{},"actionOnLoad":["@actions.initialData"],"localPageContext":true,"jslib":{"isContractorHidden":"function (pageContext) { return !(typeof pageContext.contractorName != 'undefined' && pageContext.contractorName != '')}","isViewTechniciansDisabled":"function (pageContext) { if (typeof pageContext.availabilityFilter !== 'undefined' && pageContext.availabilityFilter !== '' && typeof pageContext.shiftFilter !== 'undefined' && pageContext.shiftFilter !== '') { if ((typeof pageContext.initialAvailabilityFilter !== 'undefined' && pageContext.initialAvailabilityFilter !== pageContext.availabilityFilter) || (typeof pageContext.initialShiftFilter !== 'undefined' && pageContext.initialShiftFilter !== pageContext.shiftFilter)) { return false; } var filteredArray = []; if (typeof pageContext.regionList !== 'undefined' && typeof pageContext.initialRegionList !== 'undefined') { if (pageContext.regionList.length !== pageContext.initialRegionList.length) { return false; } filteredArray = pageContext.regionList.filter(ele => pageContext.initialRegionList.indexOf(ele.value) == -1); if (filteredArray.length) { return false; } } if (typeof pageContext.contractorList !== 'undefined' && typeof pageContext.initialContractorList !== 'undefined') { if (pageContext.contractorList.length !== pageContext.initialContractorList.length) { return false; } filteredArray = pageContext.contractorList.filter(ele => pageContext.initialContractorList.indexOf(ele.value) == -1); if (filteredArray.length) { return false; } } if (typeof pageContext.skillLevelList !== 'undefined' && typeof pageContext.initialSkillLevelList !== 'undefined') { if (pageContext.skillLevelList.length !== pageContext.initialSkillLevelList.length) { return false; } filteredArray = pageContext.skillLevelList.filter(ele => pageContext.initialSkillLevelList.indexOf(ele.value) == -1); if (filteredArray.length) { return false; } } } return true; }","isShowScheduleClicked":"function (pageContext) { return !(pageContext.showScheduleClicked && pageContext.technicianSchedule);}","isTechnicianDataGridHidden":"function (pageContext) { return !(pageContext.showTechnicianDataGrid);}","isContractorSearchHidden":"function (pageContext) { return (typeof pageContext.contractorName != 'undefined' && pageContext.contractorName != '')}","isSaveDisabled":"function (pageContext) { if (typeof pageContext.selectedRowIds != 'undefined' && pageContext.selectedRowIds.length > 0) { return false; } else { return true; } }"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.goBackToPreviousPanel"],"type":"buttonIcon"}]},"children":[{"buttonType":"primary","actionOnClick":["@actions.fireProcessEvent","@actions.refreshMainPageDataGrid","@actions.goBackToPreviousPanel"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"}],"title":"@lang.['acm','Add Crew Members']"},"body":{"children":[{"children":[{"isRequired":true,"isMultiSelect":true,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$name} like {@filter}","models":["region"],"columns":{"name":"region.name","id":"region.id"},"distinct":true,"getCount":true}},"optLabelMap":"name","optValueMap":"id","id":"regionList","label":"@lang.['r10','Region (optional)']","type":"selectDropdown","value":"@pageContext.regionList","placeHolder":"@lang.['sr','Select region']"},{"hidden":"@jslib.isContractorHidden","disabled":true,"inputType":"text","id":"contractorName","label":"@lang.['c7','Contractor']","placeholder":"@lang.['sc4','Select contractor']","type":"input","value":"@pageContext.contractorName"},{"isRequired":true,"isMultiSelect":true,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$name} like {@filter}","models":["contractor"],"columns":{"name":"contractor.name","id":"contractor.id"},"distinct":true,"getCount":true}},"optLabelMap":"name","optValueMap":"id","hidden":"@jslib.isContractorSearchHidden","id":"contractorList","label":"@lang.['c25','Contractor (optional)']","type":"selectDropdown","value":"@pageContext.contractorList","placeHolder":"@lang.['sc4','Select contractor']"},{"actionOnChange":["@actions.setIsChangedFlagToTrue","@actions.setskillLevelList"],"optLabelMap":"displaySkillName","optValueMap":"skillLevelId","isMultiSelect":true,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$skillName} like {@filter} AND {$skillLevelSkillId} != ''","models":["skill","skillLevel"],"columns":{"skillName":"skill.name","skillId":"skill.id","displaySkillName":"CONCAT({$skill.name},' - ',{$skillLevel.name})","skillLevelSkillId":"skillLevel.skillId","skillLevelId":"skillLevel.id","skillLevel":"skillLevel.rank","skillLevelName":"skillLevel.name"},"inputs":{},"orderBy":"skillName ASC","links":{"skill":"skillLevel"}}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$skillLevelId} IN {@skillLevelList} AND {$skillLevelSkillId} != ''","models":["skill","skillLevel"],"columns":{"skillName":"skill.name","skillId":"skill.id","displaySkillName":"CONCAT({$skill.name},' - ',{$skillLevel.name})","skillLevelSkillId":"skillLevel.skillId","skillLevelId":"skillLevel.id","skillLevel":"skillLevel.rank","skillLevelName":"skillLevel.name"},"inputs":{"skillLevelList":"@pageContext.selectedId"},"outerJoinOnModel":"skill"},"columnsToBeHidden":["skillId","skillLevel","skillLevelId","displaySkillName","skillLevelSkillId"],"dataSourceId":"query/read","selectedRowAdvanceGrid":"AdvancedGrid","rowsToBeSelect":"selectedId","sourceType":"query","sidePanelTitle":"@lang.['ss11','Select Skill']","gridHeaderText":"@lang.['navS1','Skills']","customColumns":{"skillName":"@lang.['sl2','Skill Level']","skillLevelName":"@lang.['s17','Skill']"},"searchKeys":["skillName","skillLevelName"]},"id":"selectedSkill","label":"@lang.['s32','Skills (optional)']","type":"selectDropdown","value":"@pageContext.skillLevelList"},{"options":[{"label":"@lang.['soat','Show only available technicians']","value":"availableTechs"},{"label":"@lang.['sat1','Show all technicians']","value":"allTechs"}],"id":"availabilityDropdown","optTitleKey":"label","optValueKey":"value","title":"@lang.['a2','Availability']","type":"dropdown","value":"@pageContext.availabilityFilter","placeHolder":"@lang.['saf','Select availability filter']"},{"options":[{"label":"@lang.['stwms','Show technicians with matching shifts']","value":"matchingShift"},{"label":"@lang.['sat1','Show all technicians']","value":"allShifts"}],"id":"shiftDropdown","optTitleKey":"label","optValueKey":"value","title":"@lang.['s4','Shift']","type":"dropdown","value":"@pageContext.shiftFilter","placeHolder":"@lang.['ssf','Select shift filter']"},{"children":[{"children":[{"buttonType":"primary","actionOnClick":["@actions.fetchFilteredTechniciansData","@actions.setDataGridAndInitialFilterData","@actions.refreshDataGrid"],"disabled":"@jslib.isViewTechniciansDisabled","id":"viewTechnicians","type":"button","title":"@lang.['vt1','View Technicians']"}],"flex":"2","type":"column"},{"flex":"4","id":"","type":"column"}],"id":"viewTechniciansButtonRow","type":"row"}],"label":"@lang.['sf2','Search Filters']","id":"searchFilters","type":"section"},{"children":[{"children":[{"id":"infoText","type":"infoText","value":"@lang.['tcobtocaagttaoacbtsaedafoadnaitlb','Technicians can only belong to one crew at any given time. Technicians already on a crew between the start and end date are filtered out and do not appear in the list below.']"}],"label":"","id":"techniciansInCrews","type":"section","transparent":true}],"label":"@lang.['tic','Technicians in Crews']","id":"recDescription","type":"collapseSection","transparent":false},{"hidden":"@jslib.isTechnicianDataGridHidden","children":[{"id":"autoSchedulingDataGrid","label":"","type":"datagrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.techniciansData"}},"isScrollAble":true,"deleteAllowed":false,"searchAllowed":true,"tableWidth":"80rem","searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"modifyRowActions":[],"gridRefreshId":"autoSchedulingDataGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ntfftgsc','No technicians found for the given search criteria']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['n','Name']","options":{"flex":2,"showLabel":true},"key":"userName"},{"name":"@lang.['r1','Region']","options":{"flex":1.2,"showLabel":true},"key":"region"},{"name":"@lang.['c','City']","options":{"flex":1.2,"showLabel":true},"key":"workforceCity"},{"name":"@lang.['c7','Contractor']","options":{"flex":1.6,"showLabel":true},"key":"contractor"},{"name":"@lang.['p1','Proximity']","options":{"flex":1.2,"showLabel":true},"key":"travelTime"},{"name":"@lang.['navS1','Skills']","options":{"flex":2,"showLabel":true},"key":"skill"},{"name":"@lang.['a2','Availability']","options":{"flex":1.2,"showLabel":true},"key":"availability"},{"name":"@lang.['s4','Shift']","options":{"flex":1.4,"showLabel":true},"key":"shiftName"},{"name":"@lang.['p6','Phone']","options":{"flex":1.4,"showLabel":true},"key":"userPhoneNumber"},{"name":"@lang.['ui1','User Id']","options":{"hidden":true,"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":false},"key":"workforceUserId","primaryKey":true}],"isMultiSelect":true,"jslib":{"isShowScheduledDisabled":"function (pageContext) { return !(typeof pageContext.selectedRowIds != 'undefined' && pageContext.selectedRowIds.length > 0) }"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navT','Technicians']","children":[{"buttonType":"primary","actionOnClick":["@actions.setData","@actions.calendarFromAPI","@actions.initialEventsData"],"disabled":"@jslib.isShowScheduledDisabled","id":"getTechSchedule","type":"button","title":"@lang.['ss3','Show Schedule']"}]},"isSelectable":true,"actions":[{"name":"setData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.selectedRowIds != 'undefined' && pageContext.selectedRowIds.length > 0) { pageContext.techIds =[]; pageContext.showScheduleClicked = true;pageContext.selectedRowIds.forEach(function (element) { pageContext.techIds.push(element.workforceUserId); }); } }"},{"name":"calendarFromAPI","outputVarMap":{"data":"@pageContext.calendarFromAPIQuery"},"type":"query","actionDef":{"filter":"{$workOrderId} = {$workOrderTaskWorkOrderId} and {$workOrderTaskAssignedToUserId} IN {@techIds} and {$statusTargetModel}='workOrderTask' and {$statusId} IN {@statusFilter} and {$taskType.webTask} = false","models":["taskType","workOrder","workOrderTask","ZStatus","User","workforce"],"inputs":{"statusFilter":["workOrderTaskScheduled","workOrderTaskDispatched","workOrderTaskInProgress","workOrderTaskPendingReview","workOrderTaskDiscontinued","workOrderTaskIncident","workOrderTaskInTransit","workOrderTaskDelayed","workOrderTaskCompleted"],"techIds":"@pageContext.techIds"},"columns":{"backgroundColor":"ZStatus.colorCode","workOrderTaskAssignedToUserId":"workOrderTask.assignedToUserId","statusTargetModel":"ZStatus.targetModel","userName":"User.name","workOrderTaskDueDate":"workOrderTask.dueDate","workOrderTaskActualStartTime":"workOrderTask.actualStartTime","statusId":"ZStatus.id","workOrderTaskWorkOrderId":"workOrderTask.workOrderId","statusName":"ZStatus.name","workOrderTaskId":"workOrderTask.id","workOrderTaskEstimatedDuration":"workOrderTask.estimatedDuration","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id","workOrderTaskCompletedDate":"workOrderTask.completedDate"},"links":{"workOrder":"workOrderTask","workOrderTask":"workforce","taskType":"workOrderTask","workforce":"User","ZStatus":"workOrderTask"}}},{"name":"initialEventsData","type":"script","actionDef":"function(pageContext) { var calendarEvents = []; pageContext.calendarFromAPIQuery.forEach((event) => { var events = {}; events['id'] = event.workOrderTaskId; events['userName'] = event.userName;events['title'] = event.workOrderTaskId; if (typeof event.workOrderTaskActualStartTime !== 'undefined' && typeof event.workOrderTaskCompletedDate !== 'undefined') { events['start'] = event.workOrderTaskActualStartTime; events['end'] = event.workOrderTaskCompletedDate; } else if (typeof event.workOrderTaskActualStartTime !== 'undefined' && typeof event.workOrderTaskCompletedDate === 'undefined') { events['start'] = event.workOrderTaskActualStartTime; events['end'] = event.workOrderTaskDueDate; } else if (typeof event.workOrderTaskActualStartTime === 'undefined' && typeof event.workOrderTaskCompletedDate === 'undefined') { events['start'] = event.workOrderTaskScheduledDate; events['end'] = event.workOrderTaskDueDate; } events['backgroundColor'] = event.backgroundColor; events['color'] = '#000000'; calendarEvents.push(events); }); pageContext.calenderEventsData = calendarEvents; }"}],"searchKeys":["userName"]}}],"label":"@lang.['s16','Search']","id":"technicians","type":"section","transparent":true},{"hidden":"@jslib.isShowScheduleClicked","children":[{"children":[{"hidden":"@jslib.isShowScheduleClicked","disabled":false,"id":"technicianSchedule","label":"@lang.['ts','Technician Schedule']","fieldsToShow":[{"labelName":"Assignee","key":"userName"},{"labelName":"Task Name","key":"title"},{"labelName":"Task Id","key":"id"},{"labelName":"Planned Date","key":"plannedDate"},{"labelName":"End Date","key":"dueDateTime"},{"labelName":"Task Duration","key":"duration"}],"type":"calendarComponent","config":{"setPageContext":true,"actionOnClick":[]},"events":"@pageContext.calenderEventsData"}],"label":"","id":"schedule","type":"section","transparent":true}],"label":"","id":"scheduleInfo","type":"section","transparent":false}]},"actions":[{"name":"refreshMainPageDataGrid","gridId":["crewMembers"],"type":"RefreshGridOnSidePanel"},{"endPoint":"event/start","name":"fetchFilteredTechniciansData","outputVarMap":{"data":"@pageContext.filteredTechniciansData"},"type":"api","actionDef":{"data":[{"eventId":"workforceFieldForceCrewFetchFilteredTechniciansProcessEvent","contextVar":{"availabilityFilter":"@pageContext.availabilityFilter","calendarId":"@pageContext.crewCalendarId","regionList":"@pageContext.regionList","endDate":"@pageContext.crewEndDate","shiftFilter":"@pageContext.shiftFilter","destinations":"@pageContext.destinations","crewId":"@pageContext.crewId","contractorList":"@pageContext.contractorList","skillLevelList":"@pageContext.skillLevelList","startDate":"@pageContext.crewStartDate"}}]}},{"name":"initialData","type":"script","actionDef":"function(pageContext){pageContext.showScheduleClicked=false;pageContext.technicianSchedule=false; pageContext.destinations=pageContext.addressObj.latitude+','+pageContext.addressObj.longitude;pageContext.initialAvailabilityFilter='';pageContext.initialShiftFilter='';pageContext.initialRegionList=[];pageContext.initialContractorList=[];pageContext.initialSkillLevelList=[];if(typeof pageContext.crewContractorId!='undefined'&&pageContext.crewContractorId!=''&&typeof pageContext.contractorName!='undefined'&&pageContext.contractorName!=''){pageContext.contractorList=[];var obj={};obj['label']=pageContext.contractorName;obj['value']=pageContext.crewContractorId;pageContext.contractorList.push(obj);}}"},{"name":"setskillLevelList","type":"script","actionDef":"function (pageContext) { pageContext.selectedId = []; if (typeof pageContext.skillLevelList != 'undefined' && pageContext.skillLevelList.length > 0) { pageContext.skillLevelList.forEach(function(element){ pageContext.selectedId.push(element.value); }); } }"},{"name":"setDataGridAndInitialFilterData","type":"script","actionDef":"function (pageContext) { pageContext.selectedRowIds = []; pageContext.showTechnicianDataGrid = true;pageContext.showScheduleClicked=false; pageContext.techniciansData = pageContext.filteredTechniciansData[0].data[0].techniciansData; pageContext.enable = true; if (typeof pageContext.regionList !== 'undefined' && pageContext.regionList.length > 0) pageContext.initialRegionList = pageContext.regionList.map(ele => ele.value); if (typeof pageContext.contractorList !== 'undefined' && pageContext.contractorList.length > 0) pageContext.initialContractorList = pageContext.contractorList.map(ele => ele.value); if (typeof pageContext.skillLevelList !== 'undefined' && pageContext.skillLevelList.length > 0) pageContext.initialSkillLevelList = pageContext.skillLevelList.map(ele => ele.value); pageContext.initialAvailabilityFilter = pageContext.availabilityFilter; pageContext.initialShiftFilter = pageContext.shiftFilter; pageContext.technicianSchedule=true;}"},{"name":"refreshDataGrid","gridId":["autoSchedulingDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"goBackToPreviousPanel","type":"backPanel"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"workforceFieldForceCrewProcessEvent","contextVar":{"subAction":"insertWorkforceCrew","crewId":"@pageContext.crewId","workforceCrew":"@pageContext.selectedRowIds"}}]}},{"name":"clearPageContext","type":"clearPageContext"}]}