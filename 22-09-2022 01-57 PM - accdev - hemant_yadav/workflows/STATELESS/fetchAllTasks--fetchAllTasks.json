{"workflowContext":{"filter":"{$taskLog.eventType} = 'workOrderTaskSlaBreached'","statusFilter":["workOrderOpen","workOrderScheduled","workOrderInProgress"],"techBatchSize":1000,"taskBatchNumber":0,"statusFilter1":["workOrderTaskScheduled","workOrderTaskDispatched","workOrderTaskInTransit","workOrderTaskInProgress"]},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTasksPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"contextVar.noOfBatches = Math.ceil(contextVar.count / contextVar.techBatchSize);contextVar.newBatchNumber = contextVar.taskBatchNumber + 1;contextVar.techBatchSize = contextVar.techBatchSize;","id":"findNumberOfBatches","nodeType":"PROCESS"},"areMoreTasksPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreTask"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areMoreTasksPresent","description":"areMoreTasksPresent","processRule":"contextVar.noOfBatches >= 1","id":"areMoreTasksPresent","nodeType":"DECISION"},"appendTaskLogData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchMoreTask"}],"contextChangePermitted":true,"name":"appendTaskLogData","description":"appendTaskLogData","processRule":"if (Array.isArray(contextVar.techDataToAppend)) { contextVar.techDataToAppend.forEach(function(obj){contextVar.tasksData.push(obj);}); } contextVar.newBatchNumber = contextVar.newBatchNumber + 1;","id":"appendTaskLogData","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTasksData"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"fetchMoreTask":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchTaskData"},{"exitPortType":"FalseStep","nodeId":"end"}],"data":"tasksData","name":"fetchMoreTask","description":"fetchMoreTask","inputVarMap":{},"processRule":"contextVar.noOfBatches >= contextVar.newBatchNumber","id":"fetchMoreTask","outputVarMap":{},"nodeType":"WHILELOOP"},"fetchTaskData":{"models":["workOrderTask","workOrder","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTaskLogData"}],"columns":{"workOrderTaskDueDate":"IFNULL({$workOrderTask.dueDate},'')","statusId":"workOrderTask.statusId","workOrderDeadline":"workOrder.deadline","timezoneOffset":"site.timezoneOffset","dueDate":"workOrderTask.dueDate","workOrderTaskId":"workOrderTask.id","scheduledDate":"workOrderTask.scheduledDate","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id","estimatedDuration":"workOrderTask.estimatedDuration"},"inputs":{"taskArray":{"filter":"{$taskLog.eventType} = 'workOrderTaskSlaBreached'","models":["taskLog"],"columns":{"id":"taskLog.taskId"},"distinct":true,"selectColumns":["id"]}},"description":"Fetch Task Details","inputVarMap":{"statusFilter":"statusFilter"},"nodeType":"QUERY","filter":"{$workOrderTaskId} NOT IN ({@taskArray}) AND {$workOrder.statusId} IN {@statusFilter} AND TIMESTAMPDIFF(minute,{$workOrder.deadline},now())> 0","name":"fetchTaskData","links":{"workOrder":"workOrderTask","workOrderTask":"site"},"id":"fetchTaskData","outputVarMap":{"data":"techDataToAppend"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"end":{"name":"End","description":"end","inputVarMap":{"tasksData":"tasksData"},"outputVarMap":{"tasksData":"tasksData"},"id":"end","nodeType":"END"},"getTasksData":{"filter":"{$workOrderTaskId} NOT IN ({@taskArray}) AND {$workOrder.statusId} IN {@statusFilter} AND TIMESTAMPDIFF(minute,{$workOrder.deadline},now())> 0 ","models":["workOrderTask","site","taskType","workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"assignedToUserId":"workOrderTask.assignedToUserId","workOrderDeadline":"workOrder.deadline","dueDate":"workOrderTask.dueDate","scheduledDate":"workOrderTask.scheduledDate","siteName":"site.name","taskTypeName":"taskType.name","estimatedDuration":"workOrderTask.estimatedDuration","workOrderTaskDueDate":"IFNULL({$workOrderTask.dueDate},'')","statusId":"workOrderTask.statusId","timezoneOffset":"site.timezoneOffset","workOrderTaskId":"workOrderTask.id","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id"},"inputs":{"taskArray":{"filter":"{$taskLog.eventType} = 'workOrderTaskSlaBreached'","models":["taskLog"],"columns":{"id":"taskLog.taskId","countId":"count({$taskLog.eventType})"},"distinct":true,"selectColumns":["id"]}},"name":"getTasksData","description":"getTasksData","inputVarMap":{"statusFilter":"statusFilter"},"links":{"workOrder":"workOrderTask","workOrderTask":"site","taskType":"workOrderTask"},"outputVarMap":{"data":"tasksData","count":"count","batchNumber":"taskBatchNumber"},"nodeType":"QUERY","getCount":true},"workflowNodes":["start","getTasksData","findNumberOfBatches","areMoreTasksPresent","fetchMoreTask","fetchTaskData","appendTaskLogData","end"]}