{"pageContext":{},"actionOnLoad":["@actions.initialData","@actions.fetchSelectedServicesForTask","@actions.setSelectedServices","@actions.refreshDataGrid"],"localPageContext":true,"jslib":{"isServiceHidden":"function (pageContext) {if(typeof pageContext.workOrderTemplateTaskEnableServices!=='undefined' && pageContext.workOrderTemplateTaskEnableServices!==''){ return pageContext.workOrderTemplateTaskEnableServices==='true'?false:true;}}","isSaveDisabled":"function (pageContext) { if ((pageContext.initialWorkOrderTemplateTaskTypeId !== pageContext.workOrderTemplateTaskTaskTypeId || pageContext.initialWorkOrderTemplateTaskEstimatedDuration !== Number(pageContext.workOrderTemplateTaskEstimatedDuration) || (pageContext.initialWorkOrderTemplateTaskEnableServices !== pageContext.workOrderTemplateTaskEnableServices ) )&& (typeof pageContext.workOrderTemplateTaskTaskTypeId !== 'undefined' && pageContext.workOrderTemplateTaskTaskTypeId !== '') && (typeof pageContext.workOrderTemplateTaskEstimatedDuration !== 'undefined' && pageContext.workOrderTemplateTaskEstimatedDuration !== '')) { if(pageContext.selectedRowIds.length>0){ return false; }else if(pageContext.workOrderTemplateTaskEnableServices==='false' && pageContext.selectedRowIds.length===0){ return false; }else{ return true; } } else { if ((typeof pageContext.workOrderTemplateTaskTaskTypeId !== 'undefined' && pageContext.workOrderTemplateTaskTaskTypeId !== '') && (typeof pageContext.workOrderTemplateTaskEstimatedDuration !== 'undefined' && pageContext.workOrderTemplateTaskEstimatedDuration !== '')) { if ((typeof pageContext.selectedRowIds === 'undefined' && typeof pageContext.selectedServices === 'undefined') || (pageContext.selectedRowIds == '')) { return true; } else { if (pageContext.selectedRowIds.length != pageContext.selectedServices.length) { return false; } else { for (var i in pageContext.selectedRowIds) { if (pageContext.selectedServices.indexOf(pageContext.selectedRowIds[i].catalogId) == -1) { return false; }; }; return true; } } } else { return true; } } }"},"header":{"leftData":{"children":[{"icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel"],"id":"back","type":"buttonIcon"}]},"children":[{"buttonType":"primary","actionOnClick":["@actions.setTemplateTaskSubAction","@actions.fireProcessEvent","@actions.openPreviousPanel"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext"],"id":"close","type":"buttonIcon"}],"title":"@lang.['et1','Edit Task']"},"body":{"children":[{"children":[{"actionOnChange":["@actions.setSelectedTaskTypeId","@actions.getTaskTypeEstimatedDuration","@actions.setTaskTypeEstimatedDuration","@actions.fetchSelectedServices","@actions.setSelectedServices","@actions.refreshDataGrid"],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$taskTypeName} like {@filter} AND {$taskTypeWebTask} = false AND {$taskTypeStatusId} = 'taskTypeActive'","models":["taskType"],"columns":{"taskTypeId":"taskType.id","taskTypeWebTask":"taskType.webTask","taskTypeStatusId":"taskType.statusId","taskTypeName":"taskType.name"}}},"optLabelMap":"taskTypeName","optValueMap":"taskTypeId","id":"taskTypeList","label":"@lang.['taskType','Task Type']","type":"selectDropdown","value":"@pageContext.selectedTaskType"},{"isRequired":true,"inputType":"number","id":"taskTypeEstimatedDuration","label":"@lang.['etdh','Estimated Task Duration (In hours)']","placeholder":"@lang.['etd2','Enter task duration']","type":"input","value":"@pageContext.workOrderTemplateTaskEstimatedDuration"}],"label":"@lang.['gi','General Information']","id":"templateInfo","type":"section"},{"children":[{"options":[{"name":"@lang.['e9','Enabled']","id":true},{"name":"@lang.['d25','Disabled']","id":false}],"id":"service","optTitleKey":"name","optValueKey":"id","title":"@lang.['navS3','Services']","type":"select","value":"@pageContext.workOrderTemplateTaskEnableServices"}],"label":"@lang.['navS3','Services']","id":"services","type":"section"},{"hidden":"@jslib.isServiceHidden","children":[{"name":"@lang.['s18','servicesGrid']","label":"","id":"servicesGrid","type":"dataGrid","jsonDef":{"isScrollAble":true,"searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['c3','catalogId']","options":{"hidden":true,"showLabel":false},"key":"catalogId","primaryKey":true},{"name":"@lang.['n','Name']","options":{"sortable":true,"showLabel":true},"key":"catalogName"},{"name":"@lang.['d','Description']","options":{"sortable":true,"showLabel":true},"key":"catalogDescription"}],"dataToBeSent":{"filter":"{$catalog.catalogTypeId}='service'","models":["catalog"],"columns":{"catalogName":"catalog.name","catalogRecver":"catalog.recver","catalogId":"catalog.id","catalogDescription":"catalog.description"},"orderBy":"catalogName ASC","outerJoinOnModel":"catalog","distinct":true},"rowsToSelect":{"filter":"{$catalogId} in {@selectedServices}","models":["catalog"],"inputs":{"selectedServices":"@pageContext.selectedServices"},"columns":{"catalogName":"catalog.name","catalogRecver":"catalog.recver","catalogId":"catalog.id"}},"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navS3','Services']"},"disabled":true,"isSelectable":true,"actions":[],"searchKeys":["catalogName"]}}],"label":"@lang.['los','List of Services']","id":"taskTypeSection","type":"section","transparent":true}]},"actions":[{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"GB6MAV7BA1","contextVar":{"workOrderTemplateId":"@pageContext.workOrderTemplateId","taskTypeId":"@pageContext.workOrderTemplateTaskTaskTypeId","enableServices":"@pageContext.workOrderTemplateTaskEnableServices","templateSubAction":"@pageContext.templateSubAction","id":"@pageContext.workOrderTemplateTaskId","services":"@pageContext.selectedRowIds","estimatedDuration":"@pageContext.estimatedDuration"}}]}},{"name":"setTemplateTaskSubAction","type":"script","actionDef":"function(pageContext){pageContext.templateSubAction='upsertTemplateTask';pageContext.estimatedDuration=pageContext.workOrderTemplateTaskEstimatedDuration*60;}"},{"name":"initialData","type":"script","actionDef":"function (pageContext) { pageContext.workOrderTemplateTaskEnableServices = pageContext.workOrderTemplateTaskEnableServices.toString(); pageContext.selectedTaskType = []; var obj = { label: pageContext.taskTypeName, value: pageContext.workOrderTemplateTaskTaskTypeId }; pageContext.selectedTaskType.push(obj); pageContext.initialWorkOrderTemplateTaskTypeId = pageContext.selectedTaskType[0].value; pageContext.initialWorkOrderTemplateTaskEstimatedDuration = pageContext.workOrderTemplateTaskEstimatedDuration; pageContext.initialWorkOrderTemplateTaskEnableServices = pageContext.workOrderTemplateTaskEnableServices;}"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"closePanel","type":"closePanel"},{"name":"openPreviousPanel","type":"backPanel"},{"name":"setSelectedTaskTypeId","type":"script","actionDef":"function(pageContext){if(pageContext.selectedTaskType[0] !== null){pageContext.workOrderTemplateTaskTaskTypeId=pageContext.selectedTaskType[0].value;pageContext.taskTypeName=pageContext.selectedTaskType[0].label;} }"},{"name":"getTaskTypeEstimatedDuration","outputVarMap":{"data":"@pageContext.taskTypeData"},"type":"query","continueOnError":true,"actionDef":{"filter":"{$taskTypeId}={@filter} ","models":["taskType"],"columns":{"taskTypeId":"taskType.id","taskTypeEstimatedDuration":"taskType.estimatedDuration","taskTypeName":"taskType.name"},"inputs":{"filter":"@pageContext.workOrderTemplateTaskTaskTypeId"}}},{"name":"setTaskTypeEstimatedDuration","type":"script","actionDef":"function(pageContext) {if (pageContext.taskTypeData.length > 0) {pageContext.workOrderTemplateTaskEstimatedDuration = pageContext.taskTypeData[0].taskTypeEstimatedDuration;}}"},{"name":"fetchSelectedServicesForTask","outputVarMap":{"data":"@pageContext.selectedServicesList"},"type":"query","actionDef":{"filter":"{$workOrderTemplateTask.id} = {@workOrderTemplateTaskId}","models":["workOrderTemplateTask"],"inputs":{"workOrderTemplateTaskId":"@pageContext.workOrderTemplateTaskId"},"columns":{"catalogId":"workOrderTemplateTask.services"}}},{"name":"fetchSelectedServices","outputVarMap":{"data":"@pageContext.selectedServicesList"},"type":"query","actionDef":{"filter":"{$taskType.id} = {@taskTypeId}","models":["taskType"],"inputs":{"taskTypeId":"@pageContext.workOrderTemplateTaskTaskTypeId"},"columns":{"catalogId":"taskType.services"}}},{"name":"setSelectedServices","type":"script","actionDef":"function(pageContext){pageContext.selectedServices=[];pageContext.initialSelectedRowIdsArray=pageContext.selectedServicesList[0].catalogId;for(var i in pageContext.initialSelectedRowIdsArray){pageContext.selectedServices.push(pageContext.initialSelectedRowIdsArray[i].catalogId)}}"},{"name":"refreshDataGrid","type":"refreshDataGrid"}]}