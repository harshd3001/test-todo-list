{"pageContext":{},"actionOnLoad":["@actions.checkForActionOnLoad"],"jslib":{"isSaveContinueDisabled":"function (pageContext) { return (!(typeof pageContext.selectUser !== 'undefined' && pageContext.selectUser.length > 0 && pageContext.workforceCalendarId !== '' && typeof pageContext.userPhoneNumber !== 'undefined' && pageContext.userPhoneNumber !== '' && typeof pageContext.phoneNumberIsValid !== 'undefined' && pageContext.phoneNumberIsValid !== '' &&  pageContext.phoneNumberIsValid === true && typeof pageContext.workforceAddress !== 'undefined' && pageContext.workforceAddress !== '' && typeof pageContext.selectWorkGroup !== 'undefined' && pageContext.selectWorkGroup.length > 0)) }","dynamicDeactivateHeader":"function(pageContext) {if (pageContext.modalAction === 'cantDeactivateCrewLead') { return '@lang.[\"ttcbdbtaaclf\",\"This technician cannot be deactivated because they are a Crew Lead for: \"]' + pageContext.crewLeadDataCrewName + '@lang.[\"paaclf\",\". Please assign another Crew Lead first.\"]' } else if (pageContext.modalAction === 'cantDeactivateCrewMember') { return '@lang.[\"ttcbdbtaoacthatip\",\"This technician cannot be deactivated because they are on a Crew that has a task in progress.\"]' } else if (pageContext.modalAction === 'cantDeactivateTechnician') { return '@lang.[\"ttcbdbthatipprttf1\",\"This technician cannot be deactivated because they have a task in progress. Please reassign this task first.\"]' } }","isAddressPopulated":"function(pageContext){return (typeof pageContext.workforceAddress==='undefined' || pageContext.workforceAddress==='') || (pageContext.workforceAction==='view') ||(pageContext.statusId=='workforceDeactivated')}","isDeactivateHidden":"function (pagecontext) { if (pageContext.statusId != 'workforceDeactivated' &&(pageContext.workforceAction === 'edit' || pageContext.workforceAction=== 'view')) { return false } else { return true } }","showUser":"function (pageContext) {if (typeof pageContext.workforceAction !== 'undefined' && (pageContext.workforceAction === 'edit' || pageContext.technicianAdded === true || pageContext.workforceAction === 'view')) {return false}return true}","showUserDetails":"function (pageContext) {if (pageContext.workforceAction != 'add' && pageContext.workforceAction != 'view' && pageContext.technicianAdded === true && typeof pageContext.AddNext !== 'undefined') {return false}else if (pageContext.workforceAction === 'edit'){return false}return true}","isAdvanceSearchDisabled":"function (pageContext) {if (pageContext.workforceAction === 'add' ) {pageContext.isStatusHidden = true;return false} else if(pageContext.workforceAction === 'view' || pageContext.workforceAction === 'edit'  || pageContext.statusId == 'workforceDeactivated'){return true}}","hideEmail":"function(pageContext){if(typeof pageContext.selectUser == 'undefined' && pageContext.selectUser.length == 0) {return true;} else { return false;}}","isSaveDisabled":"function (pageContext) { if ((typeof pageContext.selectWorkGroup !== 'undefined' && pageContext.selectWorkGroup !== '' || typeof pageContext.selectWorkGroup === 'undefined' && pageContext.selectWorkGroup == '') && (pageContext.selectWorkGroup.length > 0 || pageContext.selectWorkGroup.length == 0) && (typeof pageContext.initialSelectWorkGroup !== 'undefined' && pageContext.initialSelectWorkGroup !== '' || typeof pageContext.initialSelectWorkGroup === 'undefined' && pageContext.initialSelectWorkGroup === '') && (pageContext.initialSelectWorkGroup.length > 0 || pageContext.initialSelectWorkGroup.length == 0) && (pageContext.selectWorkGroup.length !== pageContext.initialSelectWorkGroup.length)) { pageContext.workGroupCheck = false; } else { for (var i in pageContext.selectWorkGroup) { if ((typeof pageContext.selectWorkGroup !== 'undefined' && pageContext.selectWorkGroup !== '' || typeof pageContext.selectWorkGroup === 'undefined' && pageContext.selectWorkGroup == '') && (pageContext.selectWorkGroup.length > 0 || pageContext.selectWorkGroup.length == 0) && (typeof pageContext.initialSelectWorkGroup !== 'undefined' && pageContext.initialSelectWorkGroup !== '' || typeof pageContext.initialSelectWorkGroup === 'undefined' && pageContext.initialSelectWorkGroup === '') && (pageContext.initialSelectWorkGroup.length > 0 || pageContext.initialSelectWorkGroup.length == 0) && (pageContext.initialSelectWorkGroup.indexOf(pageContext.selectWorkGroup[i].value) == -1)) { pageContext.workGroupCheck = false; break; } pageContext.workGroupCheck = true; } } return ((pageContext.workforceAction === 'edit') && (((pageContext.workGroupCheck) && (pageContext.initialWorkforceUserId === pageContext.selectUser[0].value) && (pageContext.initialWorkforceCalendarId === pageContext.workforceCalendarId) && (pageContext.phoneNumberIsValid===false||(pageContext.initialUserPhoneNumber === pageContext.userPhoneNumber)) && (pageContext.initialWorkforceAddress === pageContext.workforceAddress) && (pageContext.initialWorkforceCity === pageContext.addressObj.city) && (pageContext.initialWorkforceState === pageContext.addressObj.state) && (pageContext.initialWorkforceCountry === pageContext.addressObj.country) && (pageContext.initialWorkforcePostalCode === pageContext.addressObj.zipCode)) || (pageContext.workforceCalendarId === '') || (pageContext.userPhoneNumber === '') || (pageContext.workforceAddress === '') || (pageContext.selectWorkGroup == ''))) }","isActionEdit":"function(pageContext){return(pageContext.workforceAction==='edit')}","isActionAdd":"function(pageContext){return(pageContext.workforceAction==='add')|| (pageContext.workforceAction=== 'addInitial')}","isViewDisabled":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}","isReactivateHidden":"function(pageContext){return (typeof pageContext.statusId === 'undefined' || pageContext.statusId === 'workforceActive' || pageContext.userStatus === 'Deactivated')}","showUserList":"function(pageContext){return(typeof pageContext.workforceAction==='undefined'||pageContext.workforceAction==='edit' || (pageContext.workforceAction==='add' &&  pageContext.technicianAdded===true) || pageContext.workforceAction==='view')}","dynamicHeaderText":"function(pageContext){ if(pageContext.workforceAction === 'addInitial' || pageContext.workforceAction === 'add'){return '@lang.[\"ant\",\"Add New Technician\"]'}else if(pageContext.workforceAction === 'edit'){return '@lang.[\"edit\",\"Edit\"] ' + pageContext.userName}}"},"header":{"children":[{"hidden":"@jslib.isActionAdd","statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"buttonType":"secondary","hidden":"@jslib.isDeactivateHidden","actionOnClick":["@actions.setCrewId","@actions.fetchWorkOrderTaskData","@actions.fetchCrewLeadData","@actions.fetchTaskForCrewMember","@actions.setModalAction","@actions.decisionActionDeactivate"],"id":"cantDeactivate","type":"button","title":"@lang.['d10','Deactivate']"},{"buttonType":"secondary","hidden":"@jslib.isReactivateHidden","actionOnClick":"@actions.reactivateTechnician","id":"reactivate","type":"button","title":"@lang.['r6','Reactivate']"},{"buttonType":"primary","hidden":"@jslib.showUserList","actionOnClick":["@actions.setSubActionUpsertWorkforce","@actions.fireProcessEvent","@actions.setActionEdit","@actions.setInitialDataSaveAndContinue","@actions.processApiOutput","@actions.fireProcessEventForTechnicianFetchData","@actions.normalizeWorkflowDataAndSetInitialPageContext","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveContinueDisabled","id":"saveAndContinue","type":"button","title":"@lang.['sc1','Save & Continue']"},{"buttonType":"primary","hidden":"@jslib.showUserDetails","actionOnClick":["@actions.setSubActionUpsertWorkforce","@actions.fireProcessEvent","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"id":"Close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"children":[{"actionOnChange":["@actions.decisionActionForPhoneAndEmail"],"hidden":"@jslib.isActionEdit","optLabelMap":"userName","optValueMap":"userId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"(({$workforceUserId} IS NULL) OR ({$workforceUserId} IS NOT NULL AND {$workforce.statusId} = 'workforceDeactivated' AND ({$workforce.workforceType} = 'webUser'))) AND {$roleId}!='web_admin' AND {$userStatus}!='Deactivated' AND {$userName} like {@filter}","models":["User","workforce","Role"],"columns":{"userStatus":"User.status","roleId":"Role.id","userPhoneNumber":"User.phoneNumber","userEmail":"User.emailId","userName":"User.name","workforceUserId":"workforce.userId","userId":"User.id"},"inputs":{},"outerJoinOnModel":"User","orderBy":"userName ASC","distinct":true,"links":{"Role":"User","User":"workforce"}}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$userId} = {@selectedUserId}","models":["User","workforce","Role"],"columns":{"userStatus":"User.status","roleId":"Role.id","userPhoneNumber":"User.phoneNumber","userEmail":"User.emailId","userName":"User.name","workforceUserId":"workforce.userId","userId":"User.id"},"inputs":{"selectedUserId":"@pageContext.selectedUserId"},"outerJoinOnModel":"User"},"columnsToBeHidden":["userStatus","roleId","userPhoneNumber","workforceUserId","userId"],"selectedRowAdvanceGrid":"AdvancedGridUser","rowsToBeSelect":"selectedUserId","tableHeaderDisplayOrder":["userName","userEmail"],"sidePanelTitle":"@lang.['selectUser','Select User']","gridHeaderText":"@lang.['users','Users']","customColumns":{"userEmail":"@lang.['e4','Email']","userName":"@lang.['n','Name']"},"searchKeys":["userName"]},"label":"@lang.['n','Name']","id":"selectUser","type":"selectDropdown","value":"@pageContext.selectUser"},{"hidden":"@jslib.isActionAdd","disabled":true,"inputType":"text","id":"name","label":"@lang.['n','Name']","type":"input","value":"@pageContext.userName"},{"hidden":"@jslib.hideEmail","disabled":"true","id":"email","label":"@lang.['e4','Email']","type":"input","value":"@pageContext.userEmail","placeHolder":"@lang.['eiabosn','Email is autofilled based on selected name']"}],"id":"generalInformation","label":"@lang.['gi','General Information']","type":"section"},{"children":[{"isRequired":true,"options":"@pageContext.calendarList","disabled":"@jslib.isViewDisabled","id":"shiftId","optTitleKey":"calendarName","optValueKey":"calendarId","title":"@lang.['s4','Shift']","type":"dropdown","value":"@pageContext.workforceCalendarId","placeHolder":"@lang.['ss5','Select Shift']"},{"actionOnChange":["@actions.setWorkGroup"],"optLabelMap":"workGroupName","optValueMap":"workGroupId","isMainPage":false,"label":"@lang.['wg1','Work Group']","type":"selectDropdown","isMultiSelect":true,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$workGroupName} like {@filter}","models":["workGroup"],"columns":{"filterMethod":"workGroup.filterMethod","description":"workGroup.description","workGroupName":"workGroup.name","workGroupId":"workGroup.id"},"inputs":{},"orderBy":"workGroupName ASC","distinct":true}},"isAdvanceSearch":{"rowsToSelect":{"filter":"{$workGroupId} IN {@selectedGroupId}","models":["workGroup"],"columns":{"filterMethod":"workGroup.filterMethod","description":"workGroup.description","workGroupName":"workGroup.name","workGroupId":"workGroup.id"},"inputs":{"selectedGroupId":"@pageContext.selectedId"}},"columnsToBeHidden":["workGroupId"],"selectedRowAdvanceGrid":"AdvancedGridWorkGroup","dataSourceId":"query/read","rowsToBeSelect":"selectedId","sourceType":"query","sidePanelTitle":"@lang.['as4','Advance Search']","gridHeaderText":"@lang.['wg1','Work Group']","customColumns":{"filterMethod":"@lang.['fm','Filter Method']","description":"@lang.['d','Description']","workGroupName":"@lang.['n','Name']"},"searchKeys":["workGroupName","filterMethod"]},"disabled":"@jslib.isViewDisabled","id":"selectWorkGroup","value":"@pageContext.selectWorkGroup","hoverText":{"title":"@lang.['atttoomwgtrtabortteatttgatbefatat','Add this technician to one or more work groups to restrict task assignment based on region, task type, etc. Add them to the All group and they will be eligible for assignment to any task.']"}}],"id":"shiftSection","label":"@lang.['swg','Shift & Work Group']","type":"section"},{"children":[{"isRequired":true,"actionOnChange":"@actions.clearAddress","disabled":"@jslib.isViewDisabled","id":"address","label":"@lang.['address','Address']","placeholder":"@lang.['eca1','Enter contact address']","type":"address","value":"@pageContext.workforceAddress"},{"isRequired":true,"disabled":"@jslib.isAddressPopulated","id":"city","label":"@lang.['c','City']","placeholder":"@lang.['cibosa','City is based on selected address']","type":"input","value":"@pageContext.addressObj.city"},{"disabled":"@jslib.isAddressPopulated","id":"state","label":"@lang.['s30','State (Optional)']","placeholder":"@lang.['sibosa','State is based on selected address']","type":"input","value":"@pageContext.addressObj.state"},{"isRequired":true,"disabled":"@jslib.isAddressPopulated","id":"postalCode","label":"@lang.['pc','Postal Code']","placeholder":"@lang.['pcibosa','Postal code is based on selected address']","type":"input","value":"@pageContext.addressObj.zipCode"},{"isRequired":true,"disabled":"@jslib.isAddressPopulated","id":"country","label":"@lang.['c1','Country']","placeholder":"@lang.['cibosa1','Country is based on selected address']","type":"input","value":"@pageContext.addressObj.country"},{"isRequired":true,"disabled":"@jslib.isViewDisabled","id":"phoneNumber","label":"@lang.['cp','Contact Phone']","type":"phoneNumber","value":"@pageContext.userPhoneNumber"}],"id":"contactInformation","label":"@lang.['ci4','Contact Information']","type":"section"}],"label":"@lang.['ti1','Technician Information']","type":"tab"},{"hidden":"@jslib.showUser","children":[{"children":[{"id":"workforceSkillDataGrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.skillDataGrid"}},"isScrollAble":false,"searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsEditPurple","hidden":"@jslib.isViewSkillGridHidden","name":"@lang.['e1','Edit']","tooltip":"@lang.['e1','Edit']","icon":"@iconlib.ActionsEditGrey","actionOnClick":["@actions.setWorkforceSkillLevelActionEdit","@actions.workforceSkillQuery","@actions.skillLevelQuery","@actions.openNestedSidePanelSkill"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isViewDisabled","name":"@lang.['d2','delete']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.setSubActionDeleteSkill","@actions.fireProcessEventForSkill","@actions.fireProcessEventForTechnicianFetchData","@actions.normalizeWorkflowData","@actions.refreshSkillDataGrid"],"type":"buttonIcon"}]},"gridRefreshId":"workforceSkillDataGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['s29','skillUserId']","options":{"hidden":true,"showLabel":false},"key":"skillUserId","primaryKey":true},{"name":"@lang.['s17','Skill']","options":{"flex":1.5,"sortable":false,"showLabel":true},"key":"skillName"},{"name":"@lang.['sl3','Skill level']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"skillLevelName"}],"actionOnLoad":[],"jslib":{"isSkillSaveDisable":"function(pageContext){if (typeof pageContext.skillSet === 'undefined' || pageContext.skillSet.length === 0){return true} else {return false}}","isViewDisabled":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}","isViewSkillGridHidden":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navS1','Skills']","children":[{"buttonType":"primary","hidden":"@jslib.isViewSkillGridHidden","actionOnClick":["@actions.clearSkill","@actions.setWorkforceSkillLevelActionAdd","@actions.skillQuery","@actions.openNestedSidePanelSkill"],"disabled":"@jslib.isSkillSaveDisable","id":"addNewSkills","type":"button","title":"@lang.['addNew','Add New']"}]},"isSelectable":false,"actions":[{"name":"workforceSkillQuery","outputVarMap":{"data":"@pageContext.skillList"},"type":"query","actionDef":{"filter":"{$skillId} = {@skillId}","models":["skill"],"inputs":{"skillId":"@pageContext.skillId"},"columns":{"skillName":"skill.name","skillId":"skill.id"}}},{"name":"skillQuery","outputVarMap":{"data":"@pageContext.skillList"},"type":"query","actionDef":{"filter":"{$skillId} not in ({@workforceSkillSkillId})","models":["skill"],"inputs":{"skillLevelSkillId":{"models":["skillLevel"],"columns":{"skillLevelSkillId":"skillLevel.skillId"},"inputs":{},"distinct":true,"selectColumns":["skillLevelSkillId"]},"workforceSkillSkillId":{"filter":"{$workforceSkillUserId} = {@selectedUserId}","models":["workforceSkill"],"columns":{"workforceSkillSkillId":"workforceSkill.skillId","workforceSkillUserId":"workforceSkill.userId"},"inputs":{"selectedUserId":"@pageContext.workforceUserId"},"selectColumns":["workforceSkillSkillId"]}},"columns":{"skillName":"skill.name","skillId":"skill.id"},"orderBy":"skillName ASC"}},{"name":"skillLevelQuery","outputVarMap":{"data":"@pageContext.skillLevelList"},"type":"query","actionDef":{"filter":" {$skillLevelSkillId}={$skillId} AND {$skillId}={@selectedSkill}","models":["skill","skillLevel"],"columns":{"skillName":"skill.name","skillId":"skill.id","skillLevelSkillId":"skillLevel.skillId","skillLevelId":"skillLevel.id","skillLevelName":"skillLevel.name"},"inputs":{"selectedSkill":"@pageContext.skillId"}}},{"name":"openNestedSidePanelSkill","type":"openPanel","pageId":"6OV7O47313"},{"name":"setWorkforceSkillLevelActionAdd","type":"script","actionDef":"function(pageContext){pageContext.workforceSkillLevelAction='add';}"},{"name":"setWorkforceSkillLevelActionEdit","type":"script","actionDef":"function(pageContext){pageContext.workforceSkillLevelAction='edit';}"},{"name":"clearSkill","type":"script","actionDef":"function(pageContext){pageContext.skillId = ' '; pageContext.skillLevelId = ' ';}"},{"name":"closeModal","type":"closeModal"},{"name":"refreshSkillDataGrid","gridId":["workforceSkillDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"setSubActionDeleteSkill","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteWorkforceSkill';}"},{"endPoint":"event/start","name":"fireProcessEventForSkill","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceTechnicianProcessEvent","contextVar":{"skillId":"@pageContext.skillId","workforceSkillRecver":"@pageContext.workforceSkillRecver","subAction":"@pageContext.subAction","workforceUserId":"@pageContext.workforceUserId","userId":"@pageContext.workforceUserId"}}]}},{"endPoint":"event/start","name":"fireProcessEventForTechnicianFetchData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"Y7LUYP8GK","contextVar":{"workforceAction":"@pageContext.workforceAction","timezoneOffset":"@pageContext.timezoneOffset","workforceUserId":"@pageContext.workforceUserId"}}]}},{"name":"normalizeWorkflowData","type":"script","actionDef":"function(pageContext) { if (pageContext.workforceAction === 'edit' || pageContext.workforceAction === 'view') { if(typeof pageContext.responseData!=='undefined' && pageContext.responseData.length>0 ){ for (var key in pageContext.responseData[0].data[0]) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.responseData[0].data[0][key]; } } } }"}],"searchKeys":["skillName","skillLevelName"]}}],"id":"SkillsSection","label":"@lang.['navS1','Skills']","type":"section","transparent":true}],"label":"@lang.['navS1','Skills']","type":"tab"},{"hidden":"@jslib.showUser","children":[{"children":[{"readOnly":true,"id":"shift","title":"@lang.['s4','Shift']","type":"input","value":"@pageContext.calendarName"}],"id":"shiftSection","label":"@lang.['s4','Shift']","type":"section"},{"children":[{"id":"workforceWeeklySchedule","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.calendarData"}},"isScrollAble":false,"rowActions":{"children":[]},"tableWidth":"50rem","jslib":{"isViewSkillGridHidden":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['ws','Weekly Schedule']","children":[]},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSelectable":false,"actions":[],"tableHeader":[{"name":"@lang.['d12','Day']","options":{"flex":1.2,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"weeklyScheduleDay"},{"name":"@lang.['s','Status']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"shiftWeeklyScheduleIsOpen"},{"name":"@lang.['set','Start - End Time']","options":{"flex":3,"dateRangeType":"absoluteTime","sortable":false,"type":"dateRange","showLabel":true},"key":"weeklyScheduleTimings"},{"name":"@lang.['tt2','Total Time']","options":{"flex":1.3,"sortable":false,"showLabel":true},"key":"weeklyScheduleTotalHours"},{"name":"@lang.['b2','Break']","options":{"flex":3,"dateRangeType":"absoluteTime","sortable":true,"type":"dateRange","showLabel":true},"key":"weeklyScheduleLunchBreakSchedule"},{"name":"@lang.['mbd','Min Break Duration (Minutes)']","options":{"sortable":true,"showLabel":true},"key":"minimumBreakDuration"}]}}],"id":"weeklyScheduleSection","label":"@lang.['ws','Weekly Schedule']","type":"section","transparent":true},{"children":[{"id":"workforcePublicHoliday","type":"dataGrid","jsonDef":{"dataSourceId":"query/read","isScrollAble":true,"rowActions":{"children":[]},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navPH','Public Holidays']","children":[]},"gridRefreshId":"workforcePublicHoliday","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSelectable":false,"actions":[],"tableHeader":[{"name":"@lang.['n','Name']","options":{"sortable":false,"showLabel":true},"key":"holidayName"},{"name":"@lang.['d3','Date']","options":{"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"holidayDate"}],"dataToBeSent":{"filter":"{$calendarHolidayId} = {@calendarId}","models":["calendarHoliday","holiday"],"columns":{"calendarHolidayId":"calendarHoliday.calendarId","holidayRecver":"holiday.recver","holidayName":"holiday.name","holidayDate":"holiday.date","holidayId":"holiday.id"},"inputs":{"calendarId":"@pageContext.workforceCalendarId"},"outerJoinOnModel":"calendarHoliday","distinct":true,"links":{"calendarHoliday":"holiday"},"translate":true},"searchKeys":["holidayName"]}}],"id":"publicHolidaysSection","label":"@lang.['navPH',' Public Holidays']","type":"section","transparent":true},{"children":[{"id":"workforceLeave","type":"dataGrid","jsonDef":{"isScrollAble":false,"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsEditPurple","hidden":"@jslib.isAddOrEditLeaveHidden","name":"@lang.['e1','Edit']","tooltip":"@lang.['e1','Edit']","icon":"@iconlib.ActionsEditGrey","actionOnClick":["@actions.setWorkforceLeaveActionEdit","@actions.openLeaveNestedSidePanel"],"type":"buttonIcon"}]},"searchAllowed":false,"gridRefreshId":"workforceLeave","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['r5','Reason']","options":{"sortable":false,"showLabel":true},"key":"listOptionAnswerAnswerOptionText"},{"name":"@lang.['sdt','Start Date & Time']","options":{"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceLeaveStartDate"},{"name":"@lang.['edt','End Date & Time']","options":{"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceLeaveEndDate"}],"dataToBeSent":{"filter":" {$workforceUserId} = {@workforceUserId}","models":["workforceLeave","listOptionAnswer"],"columns":{"workforceLeaveRecver":"workforceLeave.recver","workforceLeaveNotes":"workforceLeave.notes","workforeLeaveUnassignTasks":"workforceLeave.unassignTasks","workforceLeaveId":"workforceLeave.id","workforceLeaveEndDate":"workforceLeave.endDate","workforceLeaveHoursType":"workforceLeave.hoursType","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText","workforceLeaveReasonListOptionAnswerId":"workforceLeave.reasonListOptionAnswerId","workforceUserId":"workforceLeave.workforceUserId","workforceLeaveStartDate":"workforceLeave.startDate"},"inputs":{"workforceUserId":"@pageContext.workforceUserId"},"distinct":true,"links":{"listOptionAnswer":"workforceLeave"},"translate":true},"dataSourceId":"query/read","jslib":{"isAddOrEditLeaveHidden":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['l4','Leave']","children":[{"buttonType":"primary","hidden":"@jslib.isAddOrEditLeaveHidden","actionOnClick":["@actions.setWorkforceLeaveActionAdd","@actions.openLeaveNestedSidePanel"],"id":"addNewLeave","type":"button","title":"@lang.['addNew','Add New']"}]},"isSelectable":false,"actions":[{"name":"openLeaveNestedSidePanel","type":"openPanel","pageId":"RVNVKT9MMX"},{"name":"setWorkforceLeaveActionAdd","type":"script","actionDef":"function(pageContext){pageContext.leaveAction='add';}"},{"name":"setWorkforceLeaveActionEdit","type":"script","actionDef":"function(pageContext){pageContext.leaveAction='edit';}"}],"searchKeys":["listOptionAnswerAnswerOptionText"]}}],"id":"leaveSection","label":"@lang.['l4','Leave']","type":"section","transparent":true},{"children":[{"id":"workforceOvertime","type":"dataGrid","jsonDef":{"isScrollAble":false,"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsEditPurple","hidden":"@jslib.isAddOrEditOverTimeHidden","name":"@lang.['e1','Edit']","tooltip":"@lang.['e1','Edit']","icon":"@iconlib.ActionsEditGrey","actionOnClick":["@actions.setWorkforceOvertimeActionEdit","@actions.clearBannerType","@actions.openOvertimeNestedSidePanel"],"type":"buttonIcon"}]},"searchAllowed":false,"gridRefreshId":"workforceOvertime","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['sdt','Start Date & Time']","options":{"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceOvertimeStartDate"},{"name":"@lang.['edt','End Date & Time']","options":{"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workforceOvertimeEndDate"},{"name":"@lang.['tt2','Total Time']","options":{"sortable":false,"showLabel":true},"key":"workforceOvertimeTotalTime"}],"dataToBeSent":{"filter":" {$workforceUserId} = {@workforceUserId}","models":["workforceOvertime"],"columns":{"workforceOvertimeStartDate":"workforceOvertime.startDate","workforceOvertimeRecver":"workforceOvertime.recver","workforceOvertimeId":"workforceOvertime.id","workforceOvertimeTotalTime":"CONCAT(ABS(TIMESTAMPDIFF(day,{$workforceOvertime.endDate},{$workforceOvertime.startDate})),\" @lang.['d11','Days'] \",ABS(MOD(TIMESTAMPDIFF(hour,{$workforceOvertime.endDate},{$workforceOvertime.startDate}),24)),\" @lang.['h','Hours'] \",ABS(MOD(TIMESTAMPDIFF(minute,{$workforceOvertime.endDate},{$workforceOvertime.startDate}),60)),\" @lang.['m2','Minutes'] \")","workforceUserId":"workforceOvertime.workforceUserId","workforceOvertimeEndDate":"workforceOvertime.endDate","workforceOvertimeNotes":"workforceOvertime.notes"},"inputs":{"workforceUserId":"@pageContext.workforceUserId"},"distinct":true,"translate":true},"dataSourceId":"query/read","jslib":{"isAddOrEditOverTimeHidden":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['o','Overtime']","children":[{"buttonType":"primary","hidden":"@jslib.isAddOrEditOverTimeHidden","actionOnClick":["@actions.setWorkforceOvertimeActionAdd","@actions.openOvertimeNestedSidePanel"],"id":"addNewOvertime","type":"button","title":"@lang.['addNew','Add New']"}]},"isSelectable":false,"actions":[{"name":"openOvertimeNestedSidePanel","type":"openPanel","pageId":"ZZJ7CV9CU"},{"name":"clearBannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType ='hide';}"},{"name":"setWorkforceOvertimeActionAdd","type":"script","actionDef":"function(pageContext){pageContext.overtimeAction='add';}"},{"name":"setWorkforceOvertimeActionEdit","type":"script","actionDef":"function(pageContext){pageContext.overtimeAction='edit';}"},{"name":"clearBannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType ='hide';}"}],"searchKeys":["workforceOvertimeStartDate"]}}],"id":"overtimeSection","label":"@lang.['o','Overtime']","type":"section","transparent":true}],"label":"@lang.['ws1','Work Schedule']","type":"tab"},{"hidden":"@jslib.showUser","children":[{"children":[{"id":"workforceContractors","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.contractorDataGrid"}},"isScrollAble":false,"searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isViewDisabled","name":"@lang.['d1','Delete']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.setSubActionDeleteContractor","@actions.fireProcessEventForContractor","@actions.fireProcessEventForTechnicianFetchData","@actions.normalizeWorkflowData","@actions.refreshContractorDataGrid"],"type":"buttonIcon"}]},"gridRefreshId":"workforceContractors","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['c17','contractorContractorRegionId']","options":{"hidden":true,"showLabel":false},"key":"contractorContractorRegionId","primaryKey":true},{"name":"@lang.['c6','Company']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"contractorName"},{"name":"@lang.['r1','Region']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"regionName"},{"name":"@lang.['s15','Subregion']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"subRegionName"}],"actionOnLoad":[],"dataSourceId":"query/read","jslib":{"isViewDisabled":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}","isViewContractorGridHidden":"function(pageContext){if(pageContext.workforceAction=='view' || pageContext.statusId=='workforceDeactivated'){return true;}else {return false;}}","isContractorSaveDisable":"function(pageContext){if (typeof pageContext.contractorData === 'undefined' || pageContext.contractorData.length === 0){return true;} else {return false;}}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navC3','Contractors']","children":[{"buttonType":"primary","hidden":"@jslib.isViewContractorGridHidden","actionOnClick":["@actions.openSidePanel"],"disabled":"@jslib.isContractorSaveDisable","id":"addNewContractors","type":"button","title":"@lang.['addNew','Add New']"}]},"isSelectable":false,"actions":[{"name":"openSidePanel","type":"openPanel","pageId":"HPBNZV66YV"},{"name":"setSubActionDeleteContractor","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteContractor';}"},{"name":"refreshContractorDataGrid","gridId":["workforceContractors"],"type":"RefreshGridOnSidePanel"},{"endPoint":"event/start","name":"fireProcessEventForContractor","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceTechnicianProcessEvent","contextVar":{"subAction":"@pageContext.subAction","contractorRegionId":"@pageContext.contractorContractorRegionId","workforceUserId":"@pageContext.workforceUserId","userId":"@pageContext.workforceUserId","contractorWorkforceRecver":"@pageContext.contractorWorkforceRecver"}}]}},{"endPoint":"event/start","name":"fireProcessEventForTechnicianFetchData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"Y7LUYP8GK","contextVar":{"workforceAction":"@pageContext.workforceAction","timezoneOffset":"@pageContext.timezoneOffset","workforceUserId":"@pageContext.workforceUserId"}}]}},{"name":"normalizeWorkflowData","type":"script","actionDef":"function(pageContext) { if (pageContext.workforceAction === 'edit' || pageContext.workforceAction === 'view') { if(typeof pageContext.responseData!=='undefined' && pageContext.responseData.length>0 ){ for (var key in pageContext.responseData[0].data[0]) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.responseData[0].data[0][key]; } } } }"}],"searchKeys":["contractorName","regionName","subRegionName"],"multiSelect":true}}],"id":"contractorSection","label":"@lang.['c14','Contractor (Optional)']","type":"section","transparent":true}],"label":"@lang.['navC3','Contractors']","id":"contractorsTab ","type":"tab"},{"hidden":"@jslib.showUserDetails","children":[{"children":[{"id":"tasks","type":"dataGrid","jsonDef":{"isScrollAble":false,"searchAllowed":false,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[]},"tableWidth":"50rem","modifyRowActions":[],"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":0.9,"sortOrder":"ASC","colorCode":"zStatusNameColor","sortable":true,"showLabel":true},"key":"zStatusName"},{"name":"@lang.['sd4','Scheduled Date']","options":{"flex":1.1,"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workOrderTaskScheduledDate"},{"name":"@lang.['taskType','Task Type']","options":{"flex":1.1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"taskTypeName"},{"name":"@lang.['taskId','Task ID']","options":{"flex":0.8,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderTaskId"},{"name":"@lang.['WorkOrderId','Work Order ID']","options":{"flex":0.8,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"orkOrderTaskWorkOrderId"}],"dataToBeSent":{"filter":" {$workforceUserId} = {@workforceUserId} AND {$statusId} IN {@statusFilter}","models":["workOrderTask","ZStatus","taskType"],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","zStatusName":"ZStatus.name","zStatusNameColor":"ZStatus.colorCode","statusId":"workOrderTask.statusId","workOrderTaskCreatedDate":"workOrderTask.createdDate","workOrderTaskId":"workOrderTask.id","orkOrderTaskWorkOrderId":"workOrderTask.workOrderId","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workforceUserId":"workOrderTask.assignedToUserId","workOrderTaskTaskTypeId":"workOrderTask.taskTypeId","taskTypeName":"taskType.name"},"inputs":{"statusFilter":["workOrderTaskDispatched","workOrderTaskInProgress","workOrderTaskIncident","workOrderTaskInTransit","workOrderTaskDelayed","workOrderTaskPendingReview"],"workforceUserId":"@pageContext.workforceUserId"},"outerJoinOnModel":"workOrderTask","distinct":true,"links":{"taskType":"workOrderTask","ZStatus":"workOrderTask"}},"actionOnLoad":[],"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['t7','Tasks']","children":[]},"isSelectable":false,"actions":[],"searchKeys":["zStatusName","taskTypeName","workOrderTaskScheduledDate","workOrderTaskId","orkOrderTaskWorkOrderId"]}}],"id":"tasksSectionId","type":"section","transparent":true}],"label":"@lang.['t7','Tasks']","type":"tab"},{"hidden":"@jslib.showUserDetails","children":[{"children":[{"id":"crew","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.crewData"}},"isScrollAble":true,"searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[]},"tableWidth":"60rem","modifyRowActions":[],"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['cs1','Crew Status']","options":{"flex":1,"colorCode":"crewStatusNameColor","showLabel":true},"key":"crewStatusName"},{"name":"@lang.['ts3','Technician Status']","options":{"flex":1,"sortOrder":"ASC","colorCode":"workforceCrewStatusNameColor","sortable":true,"showLabel":true},"key":"workforceCrewStatusName"},{"name":"@lang.['cn4','Crew Name']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"crewName"},{"name":"@lang.['cl2','Crew Lead']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"crewLeadName"},{"name":"@lang.['sd','Start Date']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"crewStartDate"},{"name":"@lang.['ed','End Date']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"crewEndDate"}],"actionOnLoad":[],"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['c22','Crews']","children":[]},"isSelectable":false,"actions":[],"searchKeys":["crewLeadName","crewName","workforceCrewStatusName"]}}],"id":"crewSectionId","label":"","type":"section","transparent":true}],"label":"@lang.['c22','Crews']","type":"tab"}],"label":"","type":"tab"}]},"actions":[{"falseStep":["@actions.setWorkforceUserId","@actions.getTimeZone","@actions.fireProcessEventForTechnicianFetchData","@actions.normalizeWorkflowDataAndSetInitialPageContext","@actions.enableRecordGrid","@actions.refreshWorkScheduleDataGrid"],"trueStep":["@actions.fireProcessEventForTechnicianFetchData","@actions.normalizeWorkflowDataAndSetInitialPageContext"],"name":"checkForActionOnLoad","type":"decision","actionDef":"function(pageContext){if(pageContext.workforceAction==='addInitial' || pageContext.workforceAction==='add'){return true;} return false;}"},{"name":"getTimeZone","type":"script","actionDef":"function(pageContext) {pageContext.timezoneOffset=new Date().getTimezoneOffset();}"},{"name":"enableRecordGrid","type":"script","actionDef":"function(pageContext){pageContext.enable=true;}"},{"name":"setWorkGroup","type":"script","actionDef":"function(pageContext){ if(typeof pageContext.selectedRowIds!=='undefined' &&pageContext.selectedRowIds!=='' && pageContext.selectedRowIds.length>0){ pageContext.selectWorkGroup = []; for (var i = 0; i < pageContext.selectedRowIds.length; i++) { pageContext.selectWorkGroup.push({ 'label': pageContext.selectedRowIds[i].workGroupName, 'value': pageContext.selectedRowIds[i].workGroupId });} } }"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"closePanel","type":"closePanel"},{"name":"closeModal","type":"closeModal"},{"name":"openSidePanelSkill","type":"openPanel","pageId":"6OV7O47313"},{"name":"refreshWorkScheduleDataGrid","gridId":["workforceLeave","workforceOvertime","workforceSkillDataGrid","workforceContractors"],"type":"RefreshGridOnSidePanel"},{"name":"processApiOutput","type":"script","actionDef":"function(pageContext){pageContext.technicianAdded=true;pageContext.workforceUserId=pageContext.data[0].data[0].workforceUserId;}"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"normalizeWorkflowDataAndSetInitialPageContext","type":"script","actionDef":"function(pageContext) { /* normalized WF data */ if (pageContext.workforceAction === 'edit' || pageContext.workforceAction === 'view') { pageContext.addressObj = {}; pageContext.addressObj.city = pageContext.responseData[0].data[0].workforceData[0].workforceCity; pageContext.addressObj.state = pageContext.responseData[0].data[0].workforceData[0].workforceState; pageContext.addressObj.zipCode = pageContext.responseData[0].data[0].workforceData[0].workforcePostalCode; pageContext.addressObj.country = pageContext.responseData[0].data[0].workforceData[0].workforceCountry; for (var key in pageContext.responseData[0].data[0].workforceData[0]) { pageContext[key] = pageContext.responseData[0].data[0].workforceData[0][key]; } for (var key in pageContext.responseData[0].data[0]) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.responseData[0].data[0][key]; } pageContext.selectUser = []; pageContext.selectUser.push({ 'label': pageContext.userName, 'value': pageContext.workforceUserId }); if (typeof pageContext.selectedId === 'undefined') { pageContext.selectWorkGroup = []; for (var i = 0; i < pageContext.workGroup.length; i++) { pageContext.selectWorkGroup.push({ 'label': pageContext.workGroup[i].workGroupName, 'value': pageContext.workGroup[i].workGroupId }); } } pageContext.enable=true; } else if (pageContext.workforceAction === 'add' || pageContext.workforceAction === 'addInitial') { for (var key in pageContext.responseData[0].data[0]) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.responseData[0].data[0][key]; } } /* setInitialPageContext */ if (typeof pageContext.technicianAdded === 'undefined') { pageContext.technicianAdded = false; } if (pageContext.workforceAction == 'edit') { pageContext.statusTargetModel = 'workforce'; pageContext.selectUser = []; pageContext.selectUser.push({ 'value': pageContext.workforceUserId, 'label': pageContext.userName }); if (typeof pageContext.selectedId === 'undefined') { pageContext.initialSelectWorkGroup = []; if (typeof pageContext.selectWorkGroup !== 'undefined') { for (var i = 0; i < pageContext.selectWorkGroup.length; i++) { pageContext.initialSelectWorkGroup.push(pageContext.selectWorkGroup[i].value); } } } pageContext.initialWorkforceUserId = pageContext.workforceUserId; pageContext.initialWorkforceCalendarId = pageContext.workforceCalendarId; pageContext.initialWorkforceAddress = pageContext.workforceAddress; pageContext.initialWorkforceCity = pageContext.workforceCity; pageContext.initialWorkforceState = pageContext.workforceState; pageContext.initialWorkforceCountry = pageContext.workforceCountry; pageContext.initialWorkforcePostalCode = pageContext.workforcePostalCode; pageContext.initialUserPhoneNumber = pageContext.userPhoneNumber; pageContext.initialUserEmail = pageContext.userEmail; } else if (pageContext.workforceAction === 'addInitial') { pageContext.statusTargetModel = 'workforce'; pageContext.workforceCalendarId = ''; pageContext.userPhoneNumber = ''; pageContext.userEmail = ''; pageContext.workforceAddress = ''; pageContext.workforceUserId = ''; pageContext.selectWorkGroup = ''; pageContext.workforceAction = 'add'; pageContext.statusId = 'workforceActive' } }"},{"name":"setSubActionDeactivateTechnician","type":"script","actionDef":"function(pageContext){pageContext.subAction='deactivateTechnician'; pageContext.statusId='workforceDeactivated';pageContext.workforceCrewUserStatusId='workforceCrewDeactivated'}"},{"name":"setSubActionReactivateTechnician","type":"script","actionDef":"function(pageContext){pageContext.subAction='reactivateTechnician'; pageContext.statusId='workforceActive';pageContext.workforceCrewUserStatusId='workforceCrewOffCrew'}"},{"name":"clearAddress","type":"script","actionDef":"function(pageContext) { if (typeof pageContext.workforceAddress === 'undefined' || pageContext.workforceAddress==='') { pageContext.addressObj.city = ''; pageContext.addressObj.state = ''; pageContext.addressObj.zipCode = ''; pageContext.addressObj.country = '';} }"},{"name":"clearSkill","type":"script","actionDef":"function(pageContext){pageContext.skillId = ' '; pageContext.skillLevelId = ' ';}"},{"name":"setSubActionDeleteRegion","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteContractorWorkforce';}"},{"name":"initializeCrewLeadDataCrewName","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.crewLeadData !== 'undefined' && pageContext.crewLeadData !== '') { pageContext.crewLeadDataCrewName=Array.prototype.map.call(pageContext.crewLeadData, function(item) { return item.crewName; }).join(', '); } }"},{"name":"Delete","type":"deleteRow"},{"subTitle":"@lang.['aysywtdttaotwntbr','Are you sure you want to deactivate this technician? All open tasks will need to be reassigned.']","name":"deactivateTechnician","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeactivateTechnician","@actions.fireProcessEvent","@actions.fireProcessEventForWorkOrderTask","@actions.closeModal","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['d10','Deactivate']"}],"type":"openModal","title":"@lang.['dt2','Deactivate Technician']"},{"subTitle":"@lang.['aysywtrtt','Are you sure you want to reactivate this technician?']","name":"reactivateTechnician","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionReactivateTechnician","@actions.fireProcessEvent","@actions.closeModal","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['r6','Reactivate']"}],"type":"openModal","title":"@lang.['rt5','Reactivate Technician']"},{"subTitle":"@jslib.dynamicDeactivateHeader","name":"cantDeactivateTechnician","options":[{"buttonType":"primary","name":"yes","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['o2','OK']"}],"type":"openModal","title":"@lang.['dt2','Deactivate Technician']"},{"subTitle":"@lang.['aysywdtttcbu','Are you sure you want delete the technician? This cannot be undone.']","name":"deleteWorkforce","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeleteWorkforce","@actions.delete","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['yc','Yes, Continue']"},{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closePanel","type":"button","title":"@lang.['c2','Cancel']"}],"type":"openModal","title":"@lang.['cd','Confirm Delete']"},{"subTitle":"@lang.['aysywdtstcbu','Are you sure you want delete the skill? This cannot be undone.']","name":"deleteWorkforceSkill","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeleteWorkforceSkill","@actions.delete","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['yc','Yes, Continue']"},{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closePanel","type":"button","title":"@lang.['c2','Cancel']"}],"type":"openModal","title":"@lang.['cd','Confirm Delete']"},{"subTitle":"@lang.['aysywtdtctcbu2','Are you sure you want to delete the contractor? This cannot be undone.']","name":"deleteContractorWorkforce","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeleteContractorWorkforce","@actions.delete","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['yc','Yes, Continue']"},{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closePanel","type":"button","title":"@lang.['c2','Cancel']"}],"type":"openModal","title":"@lang.['cd','Confirm Delete']"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceTechnicianProcessEvent","contextVar":{"skillId":"@pageContext.skillId","workforceWorkGroup":[{"workforceUserId":"@pageContext.selectUser[0].value","workGroupId":"@pageContext.selectWorkGroup"}],"User":[{"phoneNumber":"@pageContext.userPhoneNumber","emailId":"@pageContext.userEmail","id":"@pageContext.selectUser[0].value"}],"workforceSkillRecver":"@pageContext.workforceSkillRecver","subAction":"@pageContext.subAction","contractorRegionId":"@pageContext.contractorContractorRegionId","workforce":[{"country":"@pageContext.addressObj.country","role":"technician","address":"@pageContext.workforceAddress","statusTargetModel":"@pageContext.statusTargetModel","city":"@pageContext.addressObj.city","postalCode":"@pageContext.addressObj.zipCode","latitude":"@pageContext.addressObj.latitude","workforceUserId":"@pageContext.workforceUserId","userId":"@pageContext.selectUser[0].value","calendarId":"@pageContext.workforceCalendarId","statusId":"@pageContext.statusId","recver":"@pageContext.workforceRecver","workforceType":"technician","state":"@pageContext.addressObj.state","longitude":"@pageContext.addressObj.longitude"}],"workforceUserId":"@pageContext.workforceUserId","userId":"@pageContext.workforceUserId","workforceCrew":[{"workforceCrewUserStatusId":"@pageContext.workforceCrewUserStatusId","crewData":"@pageContext.crewData"}],"contractorWorkforceRecver":"@pageContext.contractorWorkforceRecver"}}]}},{"endPoint":"event/start","name":"fireProcessEventForTechnicianFetchData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"Y7LUYP8GK","contextVar":{"workforceAction":"@pageContext.workforceAction","timezoneOffset":"@pageContext.timezoneOffset","workforceUserId":"@pageContext.workforceUserId"}}]}},{"endPoint":"event/start","name":"fireProcessEventForWorkOrderTask","outputVarMap":{"data":"@pageContext.response"},"type":"api","actionDef":{"data":[{"eventId":"BM58GU7UNT","contextVar":{"subAction":"openWorkOrderTask","workforceUserId":"@pageContext.workforceUserId"}}]}},{"name":"setSubActionUpsertWorkforce","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertWorkforce';}"},{"name":"setActionEdit","type":"script","actionDef":"function(pageContext){pageContext.workforceAction='edit';pageContext.isStatusHidden = false;}"},{"name":"setAddressObj","type":"script","actionDef":"function(pageContext){if(typeof pageContext!==undefined&&(pageContext.workforceAction==='addInitial'||pageContext.workforceAction==='edit')){pageContext.addressObj={};pageContext.addressObj.city=pageContext.workforceCity;pageContext.addressObj.state=pageContext.workforceState;pageContext.addressObj.country=pageContext.workforceCountry;pageContext.addressObj.zipCode=pageContext.workforcePostalCode}}"},{"name":"setInitialDataSaveAndContinue","type":"script","actionDef":"function(pageContext) { pageContext.userName = pageContext.selectUser[0].label; pageContext.initialWorkforceCity = pageContext.addressObj.city; pageContext.initialWorkforceState = pageContext.addressObj.state; pageContext.initialWorkforceCountry = pageContext.addressObj.country; pageContext.initialWorkforcePostalCode = pageContext.addressObj.zipCode; pageContext.initialWorkforceAddress = pageContext.workforceAddress; pageContext.initialWorkforceCalendarId = pageContext.workforceCalendarId; pageContext.initialWorkforceUserId = pageContext.selectUser[0].value; pageContext.initialUserPhoneNumber = pageContext.userPhoneNumber; pageContext.workforceCity = pageContext.addressObj.city; pageContext.workforceState = pageContext.addressObj.state; pageContext.workforceCountry = pageContext.addressObj.country; pageContext.workforcePostalCode = pageContext.addressObj.zipCode; pageContext.workforceUserId = pageContext.selectUser[0].value; pageContext.initialSelectWorkGroup = []; if (pageContext.selectWorkGroup !== 'undefined') { for (var i = 0; i < pageContext.selectWorkGroup.length; i++) { pageContext.initialSelectWorkGroup.push(pageContext.selectWorkGroup[i].value); } } }"},{"name":"setWorkforceUserId","type":"script","actionDef":"function(pageContext){if(pageContext.workforceAction==='view'){ pageContext.workforceUserId=pageContext.userId}}"},{"name":"setModalAction","type":"script","actionDef":"function(pageContext) { if (typeof pageContext.crewLeadData !== 'undefined' && pageContext.crewLeadData.length > 0) { pageContext.modalAction = 'cantDeactivateCrewLead' } else if (typeof pageContext.workOrderTaskData !== 'undefined' && pageContext.workOrderTaskData.length > 0) { pageContext.modalAction = 'cantDeactivateTechnician' } else if (typeof pageContext.crewTask !== 'undefined' && pageContext.crewTask.length > 0) { pageContext.modalAction = 'cantDeactivateCrewMember' } else { pageContext.modalAction = 'deactivateTechnician' } }"},{"falseStep":["@actions.clearPhoneNumberAndEmail"],"trueStep":["@actions.setUserId","@actions.fetchPhoneNumberAndEmail","@actions.setPhoneNumberAndEmail"],"name":"decisionActionForPhoneAndEmail","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.selectUser !== 'undefined' && pageContext.selectUser !== '' && pageContext.selectUser[0] !== null )  {return true;} return false;}"},{"name":"setUserId","type":"script","actionDef":"function(pageContext){if(typeof pageContext.selectUser !== 'undefined' && pageContext.selectUser.length >0) {pageContext.selectedUserId=pageContext.selectUser[0].value;}}"},{"name":"setPhoneNumberAndEmail","type":"script","actionDef":"function(pageContext){if(typeof pageContext.userPhoneNumberData !== 'undefined' && pageContext.userPhoneNumberData.length > 0) {pageContext.userPhoneNumber=pageContext.userPhoneNumberData[0].userPhoneNumber;pageContext.userEmail=pageContext.userPhoneNumberData[0].userEmail;}}"},{"name":"clearPhoneNumberAndEmail","type":"script","actionDef":"function(pageContext){pageContext.userEmail='';pageContext.userPhoneNumber='';}"},{"name":"setCrewId","type":"script","actionDef":"function(pageContext) {pageContext.crewId = []; if (typeof pageContext.crewData !== 'undefined' && pageContext.crewData.length > 0) {for (var i in pageContext.crewData) { if(pageContext.crewData[i].crewStatusId==='crewActive') pageContext.crewId.push(pageContext.crewData[i].crewId); }}}"},{"falseStep":["@actions.decisionActionDeactivateTechnician"],"trueStep":["@actions.deactivateTechnician"],"name":"decisionActionDeactivate","type":"decision","actionDef":"function(pageContext){return(pageContext.modalAction === 'deactivateTechnician')}"},{"falseStep":["@actions.decisionActionForCrewMember"],"trueStep":["@actions.initializeCrewLeadDataCrewName","@actions.cantDeactivateTechnician"],"name":"decisionActionDeactivateTechnician","type":"decision","actionDef":"function(pageContext){if(pageContext.modalAction === 'cantDeactivateCrewLead'){return true;}else{return false;}}"},{"falseStep":["@actions.cantDeactivateTechnician"],"trueStep":["@actions.cantDeactivateTechnician"],"name":"decisionActionForCrewMember","type":"decision","actionDef":"function(pageContext){if(pageContext.modalAction === 'cantDeactivateCrewMember'){return true;}else{return false;}}"},{"name":"fetchPhoneNumberAndEmail","outputVarMap":{"data":"@pageContext.userPhoneNumberData"},"type":"query","actionDef":{"filter":"{$userId} = {@selectedUserId}","models":["User"],"columns":{"userPhoneNumber":"User.phoneNumber","userEmail":"User.emailId","userName":"User.name","userId":"User.id"},"inputs":{"selectedUserId":"@pageContext.selectedUserId"}}},{"name":"fetchCrewLeadData","outputVarMap":{"data":"@pageContext.crewLeadData"},"type":"query","actionDef":{"filter":"{$crew.leadUserId}={@workforceUserId} && {$crew.statusId}!='crewDeactivated'","models":["crew"],"columns":{"crewId":"crew.id","crewName":"crew.name"},"inputs":{"workforceUserId":"@pageContext.workforceUserId"},"distinct":true}},{"name":"fetchCrewWorkOrdertask","outputVarMap":{"data":"@pageContext.crewTask"},"type":"query","actionDef":{"filter":"{$assignedToCrewId} IN {@crewId} AND {$workOrderTaskStatusId} IN {@statusFilter}","models":["workOrderTask"],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","workOrderTaskId":"workOrderTask.id","assignedToCrewId":"workOrderTask.assignedToCrewId","workforceUserId":"workOrderTask.assignedToUserId"},"inputs":{"statusFilter":["workOrderTaskDispatched","workOrderTaskInProgress","workOrderTaskIncident","workOrderTaskInTransit","workOrderTaskDelayed"],"crewId":"@pageContext.crewId"},"distinct":true}},{"falseStep":[],"trueStep":["@actions.fetchCrewWorkOrdertask"],"name":"fetchTaskForCrewMember","type":"decision","actionDef":"function(pageContext){ if (pageContext.crewId!=='undefined' && pageContext.crewId.length > 0){return true;} return false;}"},{"name":"fetchWorkOrderTaskData","outputVarMap":{"data":"@pageContext.workOrderTaskData"},"type":"query","actionDef":{"filter":" {$workforceUserId} = {@workforceUserId} AND ({$statusId} IN {@statusFilter})","models":["workOrderTask"],"columns":{"statusId":"workOrderTask.statusId","workOrderTaskId":"workOrderTask.id","workforceUserId":"workOrderTask.assignedToUserId"},"inputs":{"statusFilter":["workOrderTaskInProgress","workOrderTaskPendingReview","workOrderTaskIncident","workOrderTaskInTransit","workOrderTaskDelayed"],"workforceUserId":"@pageContext.workforceUserId"},"distinct":true}}]}