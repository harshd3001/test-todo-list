{"appendTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTasksPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"if (Array.isArray(contextVar.taskDataToAppend)) { contextVar.taskDataToAppend.forEach(function(obj){contextVar.taskData.push(obj);}); } contextVar.newTaskBatchNumber = contextVar.newTaskBatchNumber + 1;","id":"appendTasks","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"technicianProcessData"},{"exitPortType":"FalseStep","nodeId":"TechsId"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"typeof contextVar.technicianIdsArray !== 'undefined' && contextVar.technicianIdsArray.length > 0 && contextVar.noOfBatchesOfTechTask >= contextVar.newTechTaskBatchNumber","id":"areMoreTechsPresent","nodeType":"DECISION"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTasksPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"contextVar.noOfBatchesTask = Math.ceil(contextVar.count / contextVar.customBatchSize);contextVar.newTaskBatchNumber = contextVar.taskBatchNumber + 1;if (Array.isArray(contextVar.taskDataToAppend)) { contextVar.taskDataToAppend.forEach(function(obj){contextVar.taskData.push(obj);}); }","id":"findNumberOfBatches","nodeType":"PROCESS"},"areMoreTasksPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchTechsTaskData"},{"exitPortType":"FalseStep","nodeId":"appendTechs"}],"name":"areMoreTasksPresent","description":"areMoreTasksPresent","processRule":"contextVar.noOfBatchesTask >= 2 && contextVar.noOfBatchesTask >= contextVar.newTaskBatchNumber","id":"areMoreTasksPresent","nodeType":"DECISION"},"getDispatcherTechsTaskData":{"models":["site","region","customer","workforce","User","ZStatus","workOrder","workOrderTask","taskType","taskScheduleBreakdown","crewAttendance","ZPriority"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"statusColor":"ZStatus.colorCode","customerCompanyName":"customer.companyName","regionName":"region.name","siteName":"site.name","taskTypeName":"taskType.name","type":"IF({$workOrderTask.id} IS NULL,'','task')","taskScheduleBreakdownStartDate":"taskScheduleBreakdown.startDate","taskBreakdownId":"taskScheduleBreakdown.id","scheduledStartTime":"workOrderTask.scheduledDate","customerId":"customer.id","workOrderTaskId":"workOrderTask.id","workOrderTaskEstimatedDuration":"Round(({$workOrderTask.estimatedDuration})/60,2)","id":"workOrderTask.id","workOrderTaskEstimatedDurationMinutes":"workOrderTask.estimatedDuration","workOrderTaskAppointmentBasedFlag":"workOrderTask.isAppointmentBasedTask","ZPriorityName":"ZPriority.name","workOrderDeadline":"workOrder.deadline","scheduledEndTime":"workOrderTask.dueDate","taskScheduleBreakdownDuration":"taskScheduleBreakdown.duration","resultWebPageId":"taskType.resultWebPageId","userName":"User.name","priority":"workOrder.priorityPriority","taskTypeCrewTask":"taskType.crewTask","userId":"workOrderTask.assignedToUserId","tId":"workOrderTask.id","workOrderTaskTypeId":"taskType.id","statusId":"workOrderTask.statusId","regionId":"region.id","name":"workOrderTask.id","taskScheduleBreakdownDurationInHours":"Round(({$taskScheduleBreakdown.duration})/60,2)","workOrderId":"workOrder.id","attendance":"crewAttendance.attendance","viewTravelStatus":"taskType.viewTravelStatus","taskScheduleBreakdownEndDate":"taskScheduleBreakdown.endDate","status":"ZStatus.name"},"orderBy":"id ASC","description":"Fetch Task Details","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","pendingAndCompletedStatus":"pendingAndCompletedStatus","loopArray":"loopArray","taskFilter":"filter"},"nodeType":"QUERY","filter":"filter","name":"getDispatcherTechsTaskData","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrderTask","User":"workOrderTask","taskScheduleBreakdown":"workOrderTask","crewAttendance":"workOrderTask","workforce":"workOrderTask","region":"site","ZStatus":"workOrderTask","customer":"site","ZPriority":"workOrder"},"id":"getDispatcherTechsTaskData","outputVarMap":{"data":"taskDataToAppend","count":"count","batchNumber":"taskBatchNumber"},"batchSize":"batchSize","getCount":true},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatchesOfTechnician"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"workflowNodes":["start","findNumberOfBatchesOfTechnician","areMoreTechsPresent","technicianProcessData","getDispatcherTechsTaskData","findNumberOfBatches","areMoreTasksPresent","fetchTechsTaskData","appendTasks","appendTechs","TechsId","end"],"TechsId":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"TechsId","description":"TechsId","processRule":"{ if (contextVar.taskData === '') { contextVar.publishEventTaskData = []; } else { contextVar.publishEventTaskData = []; contextVar.taskData.forEach(function(task) { if (typeof task.attendance !== 'undefined' && task.attendance.length > 0) { let taskCopy = JSON.parse(JSON.stringify(task)); delete taskCopy.attendance; task.attendance.forEach(function(record) { let startTime = record.checkInTime; let endTime = record.checkOutTime; let actualStartTime = record.checkInTime; let actualEndTime = record.checkOutTime; taskCopy = { ...taskCopy, 'startTime': startTime, 'endTime': endTime, 'actualStartTime': actualStartTime, 'actualEndTime': actualEndTime }; contextVar.publishEventTaskData.push(taskCopy); }); } }); } }","id":"appendTasks","nodeType":"PROCESS","jsEngine":"es6"},"appendTechs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTechs","description":"appendTechs","processRule":"contextVar.newTechTaskBatchNumber = contextVar.newTechTaskBatchNumber + 1;","id":"appendTasks","nodeType":"PROCESS"},"workflowContext":{"customBatchSize":1000,"noOfBatchesTask":0,"newTechTaskBatchNumber":0,"taskData":[],"taskFilter":"({$userId} IN {@loopArray}) AND ({$statusId} IN {@pendingAndCompletedStatus} AND {$taskType.webTask} = false) AND ({$taskType.crewTask} IS NULL OR {$taskType.crewTask}= false)","noOfBatchesOfTechTask":0},"technicianProcessData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getDispatcherTechsTaskData"}],"contextChangePermitted":true,"name":"technicianProcessData","description":"technicianProcessData","processRule":"{contextVar.loopArray = [];contextVar.loopArray = contextVar.technicianIdsArray.splice(0,contextVar.customBatchSize);}","nodeType":"PROCESS"},"fetchTechsTaskData":{"models":["site","region","customer","workforce","User","ZStatus","workOrder","workOrderTask","taskType","taskScheduleBreakdown","crewAttendance","ZPriority"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTasks"}],"columns":{"statusColor":"ZStatus.colorCode","customerCompanyName":"customer.companyName","regionName":"region.name","siteName":"site.name","taskTypeName":"taskType.name","type":"IF({$workOrderTask.id} IS NULL,'','task')","taskScheduleBreakdownStartDate":"taskScheduleBreakdown.startDate","taskBreakdownId":"taskScheduleBreakdown.id","scheduledStartTime":"workOrderTask.scheduledDate","customerId":"customer.id","workOrderTaskId":"workOrderTask.id","workOrderTaskEstimatedDuration":"Round(({$workOrderTask.estimatedDuration})/60,2)","id":"workOrderTask.id","workOrderTaskEstimatedDurationMinutes":"workOrderTask.estimatedDuration","workOrderTaskCompletedDate":"workOrderTask.completedDate","workOrderTaskAppointmentBasedFlag":"workOrderTask.isAppointmentBasedTask","ZPriorityName":"ZPriority.name","workOrderDeadline":"workOrder.deadline","scheduledEndTime":"workOrderTask.dueDate","taskScheduleBreakdownDuration":"taskScheduleBreakdown.duration","resultWebPageId":"taskType.resultWebPageId","userName":"User.name","priority":"workOrder.priorityPriority","taskTypeCrewTask":"taskType.crewTask","userId":"workOrderTask.assignedToUserId","tId":"workOrderTask.id","workOrderTaskTypeId":"taskType.id","statusId":"workOrderTask.statusId","regionId":"region.id","name":"workOrderTask.id","taskScheduleBreakdownDurationInHours":"Round(({$taskScheduleBreakdown.duration})/60,2)","workOrderId":"workOrder.id","attendance":"crewAttendance.attendance","viewTravelStatus":"taskType.viewTravelStatus","taskScheduleBreakdownEndDate":"taskScheduleBreakdown.endDate","status":"ZStatus.name"},"orderBy":"id ASC","description":"Fetch Task Details","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","newTaskBatchNumber":"batchNumber","pendingAndCompletedStatus":"pendingAndCompletedStatus","loopArray":"loopArray","taskFilter":"filter"},"nodeType":"QUERY","filter":"filter","name":"fetchTechsTaskData","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrderTask","User":"workOrderTask","taskScheduleBreakdown":"workOrderTask","crewAttendance":"workOrderTask","workforce":"workOrderTask","region":"site","ZStatus":"workOrderTask","customer":"site","ZPriority":"workOrder"},"id":"fetchTechsTaskData","outputVarMap":{"data":"taskDataToAppend"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"end":{"name":"End","description":"end","inputVarMap":{"publishEventTaskData":"publishEventTaskData"},"outputVarMap":{"publishEventTaskData":"publishEventTaskData"},"id":"end","nodeType":"END"},"findNumberOfBatchesOfTechnician":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatchesOfTechnician","description":"findNumberOfBatchesOfTechnician","processRule":"{contextVar.noOfBatchesOfTechTask = Math.ceil(contextVar.dispatcherTechs.length / contextVar.customBatchSize);contextVar.technicianIdsArray = JSON.parse(JSON.stringify(contextVar.dispatcherTechs)); }","nodeType":"PROCESS"}}