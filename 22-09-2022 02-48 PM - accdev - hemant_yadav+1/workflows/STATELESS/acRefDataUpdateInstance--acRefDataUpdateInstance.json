{"callUpdateProcessInstanceWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"forEchLoop"}],"notifyUser":"true","name":"callUpdateProcessInstanceWF","description":"will contain reference data def and the same will be updated by this node","inputVarMap":{"newNotifyUser":"notifyUser","newInstanceId":"instanceId","newreferenceData":"referenceData"},"id":"callUpdateProcessInstanceWF","outputVarMap":{"data":"UpdatedData"},"nodeType":"INSTANCEDATA"},"decisionForUpdateInstance":{"connectors":[{"exitPortType":"TrueStep","nodeId":"forEchLoop"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"decisionForUpdateInstance","description":"Use this for decision callCreateProcessInstanceWFin workflow","processRule":"(typeof contextVar.processInstanceIds != 'undefined' && contextVar.processInstanceIds != '' && contextVar.processInstanceIds.length > 0)","id":"decisionForUpdateInstance","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchCompData"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"decisionrn2DB":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchTaskData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"decisionrn2DB","description":"Use this for decision callCreateProcessInstanceWFin workflow","processRule":"(typeof contextVar.comps != 'undefined' && contextVar.comps != '' && contextVar.comps.length > 0)","id":"decisionrn2DB","nodeType":"DECISION"},"fetchTaskData":{"filter":"{$workOrder.id} = {@workOrderId} && {$workOrderTask.processInstanceId} IS NOT NULL","models":["workOrder","workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"processTaskIds"}],"columns":{"processInstanceId":"workOrderTask.processInstanceId","workOrderTaskId":"workOrderTask.id","workOrderId":"workOrder.id"},"name":"fetchTaskData","description":"fetchTaskData","inputVarMap":{"workOrderId":"workOrderId"},"links":{"workOrderTask":"workOrder"},"outputVarMap":{"data":"taskData"},"nodeType":"QUERY","getCount":true},"callCreateProcessInstanceWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"name":"callCreateProcessInstanceWF","description":"Provide some description for your instance node","inputVarMap":{"customTaskData":"customTaskData","workOrderTaskId":"workOrderTaskId","referenceDataKeys":"{@referenceDataKeys}","workOrderTaskScheduledDate":"{@plannedStartTime}","workOrderTaskEstimatedDuration":"workOrderTaskEstimatedDuration","mobileProcessId":"processId","timeTakenForTask":"{@estimatedDurationInHours}"},"id":"callCreateProcessInstanceWF","outputVarMap":{"data":"outputContextVarKey"},"execType":"fork","nodeType":"WORKFLOW"},"processTaskIds":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionForUpdateInstance"}],"contextChangePermitted":true,"name":"processTaskIds","processRule":"{ contextVar.processInstanceIds = []; if (typeof contextVar.taskData != 'undefined' && contextVar.taskData != '' && contextVar.taskData.length > 0) { contextVar.taskData.forEach(function(value) { if (typeof value.processInstanceId != 'undefined' && value.processInstanceId != '') { contextVar.processInstanceIds.push({ 'referenceData': { 'comps': contextVar.comps }, 'instanceId': value.processInstanceId, 'notifyUser': true, }); } }) } }","id":"processTaskIds","nodeType":"PROCESS"},"workflowNodes":["start","fetchCompData","processData","decisionrn2DB","fetchTaskData","processTaskIds","decisionForUpdateInstance","forEchLoop","processAllData","callUpdateProcessInstanceWF","end"],"processReject":{"connectors":[{"exitPortType":"NextStep","nodeId":"notifyUser"}],"contextChangePermitted":true,"name":"processReject","processRule":"{contextVar.dataPayload.layout.buttons[0].targetId = contextVar.instanceId; contextVar.shortText = contextVar.workOrderTaskId; contextVar.longText = 'The submitted information for Section ' + contextVar.itemTitle + ' for Task ' + contextVar.workOrderTaskId + ' has been rejected. Feedback : ' + contextVar.feedback; }","id":"processReject","nodeType":"PROCESS"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionrn2DB"}],"contextChangePermitted":true,"name":"processData","description":"processData","processRule":"contextVar.addressStatus = 'No'; contextVar.comps = []; if (contextVar.compsData.length > 0) { contextVar.compsData.forEach(function(value) { contextVar.comps.push({ 'address': value.address, 'value': contextVar.addressStatus, 'distance': value.distance, 'longitude': value.longitude, 'latitude': value.latitude }); }) }","id":"processData","nodeType":"PROCESS","jsEngine":"es6"},"workflowContext":{},"forEchLoop":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processAllData"},{"exitPortType":"FalseStep","nodeId":"end"}],"data":"processInstanceIds","name":"forEchLoop","description":"Provide some description for your for each node","inputVarMap":{},"id":"forEchLoop","outputVarMap":{},"nodeType":"FOREACHLOOP"},"processAllData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callUpdateProcessInstanceWF"}],"contextChangePermitted":true,"name":"processAllData","description":"processAllData","processRule":"{ contextVar.comps1 = []; if (contextVar.compsData.length > 0) { contextVar.compsData.forEach(function(value) { if (typeof value.instancesWithChecked != 'undefined' && value.instancesWithChecked != '' && value.instancesWithChecked.length > 0) { contextVar.abc = 'abc'; if (value.instancesWithChecked.includes(contextVar.forEchLoop_currentElement.instanceId)) { contextVar.abcd = 'abcd'; contextVar.comps1.push({ 'address': value.address, 'value': value.isChecked, 'distance': value.distance, 'id' : value.id, 'longitude': value.longitude, 'latitude': value.latitude }); } else { contextVar.abcde = 'abcde'; contextVar.comps1.push({ 'address': value.address, 'value': 'No', 'id' : value.id, 'distance': value.distance, 'longitude': value.longitude, 'latitude': value.latitude }); } } else { contextVar.abcdef = 'abcdef'; contextVar.comps1.push({ 'address': value.address, 'value': 'No', 'id' : value.id, 'distance': value.distance, 'longitude': value.longitude, 'latitude': value.latitude }); } }) } contextVar.referenceData = { 'comps': contextVar.comps1 }; if (typeof contextVar.forEchLoop_currentElement != 'undefined' && contextVar.forEchLoop_currentElement != '') { contextVar.newreferenceData = contextVar.referenceData; contextVar.newInstanceId = contextVar.forEchLoop_currentElement.instanceId; contextVar.newNotifyUser = contextVar.forEchLoop_currentElement.notifyUser; } }","id":"processData","nodeType":"PROCESS","jsEngine":"es6"},"end":{"name":"end","description":"End","inputVarMap":{"unassignedTask":"data"},"outputVarMap":{"unassignedTask":"data"},"id":"end","nodeType":"END"},"fetchCompData":{"models":["workOrder","acCompAddress"],"connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"columns":{"address":"acCompAddress.address","distance":"acCompAddress.distanceFromSite","latitude":"acCompAddress.latitude","instancesWithChecked":"acCompAddress.instancesWithChecked","id":"acCompAddress.id","workOrderId":"acCompAddress.workOrderId","isChecked":"acCompAddress.isChecked","longitude":"acCompAddress.longitude"},"orderBy":"distance","description":"fetchCompData","inputVarMap":{"workOrderId":"workOrderId"},"nodeType":"QUERY","filter":"{$workOrderId} = {$workOrder.id} && {$workOrderId} = {@workOrderId} && {$acCompAddress.locationType}='Comparable'","name":"fetchCompData","outputVarMap":{"data":"compsData"},"batchSize":50,"getCount":true,"batchNumber":1}}