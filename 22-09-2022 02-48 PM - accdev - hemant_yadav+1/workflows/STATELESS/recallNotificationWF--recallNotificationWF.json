{"processNodeFetchUserName":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryForFetchUserName"}],"contextChangePermitted":true,"name":"processNodeFetchUserName","description":"Use this for processing data in workflow","processRule":"{contextVar.modifiedByUser= contextVar.taskData[0].modifiedByUser;}","id":"processNodeFetchUserName","nodeType":"PROCESS"},"fetchTaskLogData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkDataArray"}],"processId":"fetchTaskLogData","name":"fetchTaskLogData","description":"Provide some description for your workflow node","inputVarMap":{"workOrderTaskId":"taskId"},"id":"fetchTaskLogData","outputVarMap":{"taskLogData":"taskLogData"},"nodeType":"WORKFLOW"},"checkIsTaskOpen":{"connectors":[{"exitPortType":"FalseStep","nodeId":"isPartialAccess"},{"exitPortType":"TrueStep","nodeId":"end"}],"name":"checkIsTaskOpen","description":"Use this for decision in workflow","processRule":"(contextVar.isTaskOpen === true && contextVar.assignUserId == '')","id":"checkIsTaskOpen","nodeType":"DECISION"},"processNotificationData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIsTaskOpen"}],"contextChangePermitted":true,"name":"processNotificationData","description":"Use this for processing data in workflow","processRule":"{ contextVar.modifiedByUser = contextVar.userData[0].modifiedByUser; contextVar.isTaskOpen = true; for (var i = 1; i < contextVar.taskLogData.length; i++) { if (contextVar.taskLogData[0].log[0].statusId === 'workOrderTaskScheduled') { if (contextVar.taskLogData[i].log[0].statusId === 'workOrderTaskDispatched') { contextVar.isTaskOpen = false; break; } } } contextVar.name = contextVar.userData[0].name; contextVar.taskType = contextVar.taskData[0].taskType; contextVar.workOrderId = contextVar.taskData[0].workOrderId; contextVar.assignUserId = contextVar.taskData[0].assignedToUserId; contextVar.longText = contextVar.notificationData.longText; contextVar.shortText = contextVar.notificationData.shortText; contextVar.longText = contextVar.longText.replace('{@taskId}', contextVar.taskId).replace('{@workOrderId}', contextVar.workOrderId).replace('{@taskType}', contextVar.taskType).replace('{@name}', contextVar.name); }","id":"processNotificationData","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryNodeForFetchingSiteDetails"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"processCrewUsersAfter":{"connectors":[{"exitPortType":"NextStep","nodeId":"notifyAssignUserNodePartialAccess"}],"contextChangePermitted":true,"name":"processCrewUsersAfter","description":"Use this for processing data in workflow","processRule":"contextVar.assignedUserId = contextVar.loopUsers_currentElement.assignUserId;","id":"processCrewUsersAfter Data","nodeType":"PROCESS"},"isPartialAccess":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCrewDetails"},{"exitPortType":"FalseStep","nodeId":"notifyAssignUserNode"}],"name":"isPartialAccess","description":"Use this for decision in workflow","processRule":"typeof contextVar.taskData!='undefined' && contextVar.taskData!='' && typeof contextVar.taskData[0].crewMobileAccess!='undefined' && contextVar.taskData[0].crewMobileAccess!='' && contextVar.taskData[0].crewMobileAccess=='partialAccess'; ","id":"isPartialAccess","nodeType":"DECISION"},"queryNodeForFetchingSiteDetails":{"filter":"{$taskId}={@workOrderTaskId}","models":["taskType","workOrderTask","workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"processNodeFetchUserName"}],"columns":{"assignedToUserId":"workOrderTask.assignedToUserId","taskType":"taskType.name","modifiedByUser":"workOrderTask.modifiedByUser","crewMobileAccess":"taskType.crewMobileAccess","workOrderId":"workOrder.id","taskId":"workOrderTask.id"},"name":"queryNodeForFetchingSiteDetails","description":"Provide some description for your query","links":{"workOrder":"workOrderTask","taskType":"workOrderTask"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"id":"queryNodeForFetchingSiteDetails","outputVarMap":{"data":"taskData"},"nodeType":"QUERY"},"workflowNodes":["start","queryNodeForFetchingSiteDetails","processNodeFetchUserName","queryForFetchUserName","fetchTaskLogData","checkDataArray","processNotificationData","checkIsTaskOpen","isPartialAccess","fetchCrewDetails","processCrewUsers","loopUsers","processCrewUsersAfter","notifyAssignUserNodePartialAccess","notifyAssignUserNode","end"],"notifyAssignUserNode":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"name":"notifyAssignUserNode","description":"Provide some description for your notify node","inputVarMap":{"taskType":"taskType","longText":"longText","assignUserId":"userId","dataPayload":"dataPayload","shortText":"shortText"},"targetType":"user","id":"notifyAssignUserNode","outputVarMap":{},"notificationType":"push","nodeType":"NOTIFY"},"loopUsers":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processCrewUsersAfter"},{"exitPortType":"FalseStep","nodeId":"end"}],"data":"assignUserId","name":"loopUsers","description":"","inputVarMap":{"assignUserId":"assignUserId"},"id":"loopUsers","outputVarMap":{},"nodeType":"FOREACHLOOP"},"workflowContext":{"notificationData":{"longText":"Task {@taskId} - {@taskType} for {@workOrderId} has been recalled and removed from your queue by {@name}","shortText":"Task Recalled"},"dataPayload":{"targetType":"Task"}},"fetchCrewDetails":{"filter":"{$workOrderTaskId} ={@workOrderTaskId} && {$crewMemberStatus} ='workforceCrewOnCrew'","models":["workforceCrew","crew","workOrderTask","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processCrewUsers"}],"columns":{"workforceCrewWorkforceUserId":"workforceCrew.workforceUserId","workOrderTaskId":"workOrderTask.id","crewMemberStatus":"workforceCrew.statusId"},"name":"fetchCrewDetails","description":"To get the crew details","distinct":true,"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"links":{"User":"workforce","workforce":"workforceCrew","workforceCrew":"crew","crew":"workOrderTask"},"id":"fetchCrewDetails","outputVarMap":{"data":"crewDetailsList"},"nodeType":"QUERY"},"notifyAssignUserNodePartialAccess":{"connectors":[{"exitPortType":"NextStep","nodeId":"loopUsers"}],"name":"notifyAssignUserNodePartialAccess","description":"Provide some description for your notify node","inputVarMap":{"taskType":"taskType","longText":"longText","dataPayload":"dataPayload","shortText":"shortText","assignedUserId":"userId"},"targetType":"user","id":"notifyAssignUserNodePartialAccess","outputVarMap":{},"notificationType":"push","nodeType":"NOTIFY"},"end":{"name":"end","description":"End","inputVarMap":{"unassignedTask":"data"},"outputVarMap":{"unassignedTask":"data"},"id":"end","nodeType":"END"},"checkDataArray":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processNotificationData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkDataArray","description":"Use this for decision in workflow","processRule":"(Array.isArray(contextVar.taskData) && contextVar.taskData.length > 0)&& (Array.isArray(contextVar.taskLogData)&& contextVar.taskLogData.length>0)","id":"checkDataArray","nodeType":"DECISION"},"queryForFetchUserName":{"filter":"{$id}={@modifiedByUser}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskLogData"}],"columns":{"name":"User.name","id":"User.id"},"name":"queryForFetchUserName","description":"Provide some description for your query","inputVarMap":{"modifiedByUser":"modifiedByUser"},"id":"queryForFetchUserName","outputVarMap":{"data":"userData"},"nodeType":"QUERY"},"processCrewUsers":{"connectors":[{"exitPortType":"NextStep","nodeId":"loopUsers"}],"contextChangePermitted":true,"name":"processCrewUsers","description":"Use this for processing data in workflow","processRule":"var userIdObj={};contextVar.assignUserId = [];if(Array.isArray(contextVar.crewDetailsList)){contextVar.crewDetailsList.forEach(function(obj){userIdObj={'assignUserId':obj['workforceCrewWorkforceUserId']};contextVar.assignUserId.push(userIdObj);});};","id":"processCrewUsers Data","nodeType":"PROCESS","jsEngine":"es6"}}