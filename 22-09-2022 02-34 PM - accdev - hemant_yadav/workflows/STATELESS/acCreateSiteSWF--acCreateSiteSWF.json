{"processRegionData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callcustomerCustomerSiteParentWF"}],"contextChangePermitted":true,"name":"processRegionData","description":"Use this for processing data in workflow","processRule":"{if(contextVar.regionData.length>0 && contextVar.regionData[0].id!='undefined'){contextVar.regionId=contextVar.regionData[0].id;};contextVar.siteExists = false;contextVar.cancellationSubAction='cancelWorkOrderTask';contextVar.siteSubAction = 'upsertCustomerSite'; contextVar.site = [{ 'country': contextVar.recData.orderedByCountry, 'address': contextVar.checkinAddress, 'statusTargetModel': 'site', 'city': contextVar.recData.city, 'contactEmail': contextVar.recData.contactEmail, 'postalCode': contextVar.recData.zipCode, 'contactPerson': contextVar.recData.contactFirstName +' '+contextVar.recData.contactLastName, 'statusId': 'siteActive', 'name': contextVar.recData.fileNumber, 'customerId': contextVar.customerId, 'state': contextVar.recData.state, 'acAddressTwo': contextVar.recData.addressTwo, 'contactPhone': contextVar.recData.contactPhone, 'acFileNumber': contextVar.recData.fileNumber, 'siteType': 'customerSite', 'latitude': contextVar.addressLatLng.lat, 'longitude': contextVar.addressLatLng.lng, 'regionId': contextVar.regionId, 'acTimeZone':contextVar.acTimeZone }]; }","id":"processRegionData","nodeType":"PROCESS"},"processFileData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchSiteId"}],"contextChangePermitted":true,"name":"processFileData","description":"Use this for processing data in workflow","processRule":"{contextVar.fileNumber = contextVar.recData.fileNumber;}","id":"processFileData","nodeType":"PROCESS"},"processSiteId":{"contextChangePermitted":true,"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"name":"processSiteId","description":"Use this for processing data in workflow","processRule":"{contextVar.siteExists = true;contextVar.siteId = contextVar.fileNumberData[0].siteId;}","id":"processSiteId","nodeType":"PROCESS"},"callacGetTimeZoneWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"processTimeZoneData"}],"processId":"FGWSS34F7Z","name":"callacGetTimeZoneWF","description":"Provide some description for your workflow node","inputVarMap":{"timeZoneLocation":"location","timeZoneStamp":"timestamp"},"id":"callacGetTimeZoneWF","outputVarMap":{"distance":"distance"},"nodeType":"WORKFLOW"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFileData"}],"nodeSource":"./static/media/start.018acd1a.svg","name":"start","description":"Start","id":"start","position":{"x":-305,"y":-347},"nodeType":"START"},"fetchSiteId":{"models":["site"],"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfSiteExists"}],"havingClause":"","inputs":{"id":""},"columns":{"fileNumber":"site.acFileNumber","siteId":"site.id"},"description":"Provide some description for your query","outerJoinOnModel":"","orderBy":"","inputVarMap":{"fileNumber":"fileNumber"},"groupBy":"","nodeType":"QUERY","filter":"{$fileNumber} = {@fileNumber}","name":"fetchSiteId","id":"fetchSiteId","outputVarMap":{"data":"fileNumberData"},"distinctFilter":false},"processTimeZoneData":{"contextChangePermitted":true,"connectors":[{"exitPortType":"NextStep","nodeId":"fetchRegionData"}],"name":"processTimeZoneData","description":"Use this for processing data in workflow","processRule":"{if(contextVar.distance[0]=='undefined'||contextVar.distance[0].status!='OK'){contextVar.acTimeZone='';contextVar.acTimeZoneName='';contextVar.tzOffsetInSeconds=0;}else{contextVar.acTimeZone=contextVar.distance[0].timeZoneId; contextVar.acTimeZoneName=contextVar.distance[0].timeZoneName;contextVar.tzOffsetInSeconds=contextVar.distance[0].rawOffset+contextVar.distance[0].dstOffset;}}","id":"processTimeZoneData","nodeType":"PROCESS"},"workflowNodes":["start","end","processRegionData","callcustomerCustomerSiteParentWF","fetchSiteId","checkIfSiteExists","processSiteId","processFileData","processData","callfetchLatLongFromAddressWF","fetchRegionData","checkIfLatAndLangValue","processTimeZoneData","callacGetTimeZoneWF","processTimeZoneLocation"],"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callfetchLatLongFromAddressWF"}],"contextChangePermitted":true,"name":"processData","description":"Use this for processing data in workflow","processRule":"{contextVar.checkinAddress=[contextVar.recData.address,contextVar.recData.city,contextVar.recData.state,contextVar.recData.orderedByCountry].join(',');contextVar.regionShort=contextVar.recData.state;}","id":"processData","nodeType":"PROCESS"},"fetchRegionData":{"models":["region"],"connectors":[{"exitPortType":"NextStep","nodeId":"processRegionData"}],"havingClause":"","inputs":{"id":""},"columns":{"name":"region.name","short":"region.description","id":"region.id"},"description":"Provide some description for your query","outerJoinOnModel":"","orderBy":"","distinct":false,"inputVarMap":{"regionShort":"regionShort"},"groupBy":"","nodeType":"QUERY","filter":"{$short}={@regionShort} OR {$name}={@regionShort}","name":"fetchRegionData","links":{},"id":"fetchRegionData","outputVarMap":{"data":"regionData"}},"checkIfSiteExists":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processSiteId"},{"exitPortType":"FalseStep","nodeId":"processData"}],"name":"checkIfSiteExists","description":"Use this for decision in workflow","processRule":"(contextVar.fileNumberData.length>0)","id":"checkIfSiteExists","nodeType":"DECISION"},"callcustomerCustomerSiteParentWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"9Y3HVI9FKG","name":"callcustomerCustomerSiteParentWF","description":"Provide some description for your workflow node","inputVarMap":{"site":"site","siteSubAction":"subAction"},"id":"callcustomerCustomerSiteParentWF","outputVarMap":{},"nodeType":"WORKFLOW"},"processTimeZoneLocation":{"contextChangePermitted":true,"connectors":[{"exitPortType":"NextStep","nodeId":"callacGetTimeZoneWF"}],"name":"processTimeZoneLocation","description":"Use this for processing data in workflow","processRule":"{contextVar.timeZoneLocation = contextVar.addressLatLng.lat+' '+contextVar.addressLatLng.lng;contextVar.timeZoneStamp=Math.floor(Date.now() / 1000)}","id":"processTimeZoneLocation","nodeType":"PROCESS"},"callfetchLatLongFromAddressWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfLatAndLangValue"}],"processId":"fetchLatLongFromAddress","name":"callfetchLatLongFromAddressWF","description":"Provide some description for your workflow node","inputVarMap":{"checkinAddress":"checkinAddress"},"id":"callfetchLatLongFromAddressWF","outputVarMap":{"addressLatLng":"addressLatLng"},"nodeType":"WORKFLOW"},"end":{"nodeSource":"./static/media/end.5c5273bd.svg","name":"end","description":"End","inputVarMap":{"siteId":"siteId"},"outputVarMap":{"siteId":"siteId"},"id":"end","position":{"x":856,"y":-338},"nodeType":"END"},"checkIfLatAndLangValue":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processTimeZoneData"},{"exitPortType":"FalseStep","nodeId":"processTimeZoneLocation"}],"name":"checkIfLatAndLangValue","description":"Use this for decision in workflow","processRule":"(contextVar.addressLatLng.lat==0&&contextVar.addressLatLng.lng==0)","id":"checkIfLatAndLangValue","nodeType":"DECISION"}}