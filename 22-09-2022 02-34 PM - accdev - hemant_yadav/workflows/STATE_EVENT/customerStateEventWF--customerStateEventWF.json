{"processWorkOrderData":{"connectors":[{"exitPortType":"NextStep","nodeId":"updateWorkOrderStatus"}],"contextChangePermitted":true,"name":"processWorkOrderData","description":"processWorkOrderData","processRule":"{for(var i=0;i<contextVar.workOrderData.length;i++){contextVar.workOrderData[i].statusId=contextVar.workOrderCancelled; contextVar.workOrderData[i].cancellationDate=new Date().toISOString().replace(/T/, ' ').replace(/\\..+/, '').replace(/Z/, '');contextVar.workOrderData[i].completedDate=new Date().toISOString().replace(/T/, ' ').replace(/\\..+/, '').replace(/Z/, '');contextVar.workOrderData[i].cancelledBy=contextVar. currentUserDetail[0].userId;contextVar.workOrderData[i].cancellationReason = contextVar.workOrderCancellationReason}}","nodeType":"PROCESS"},"updateWorkOrderStatus":{"modelName":"workOrder","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"multirecord":true,"name":"upsertWorkOrder","description":"Save work order to work order Model","inputVarMap":{"workOrderData":"data"},"outputVarMap":{},"nodeType":"MODEL","operation":4},"workflowContext":{"activeWorkOrders":["workOrderOpen","workOrderScheduled"],"customerDeactivated":"customerDeactivated","workOrderCancelled":"workOrderCancelled"},"processWorkOrderTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isWorkOrderTaskPresent"}],"contextChangePermitted":true,"name":"processWorkOrderTaskData","description":"processWorkOrderTaskData","processRule":"{contextVar.workOrderData=[];if(contextVar.workOrderTaskData !=='' && contextVar.workOrderTaskData.length > 0){contextVar.workOrderData=contextVar.workOrderTaskData.filter(function(x){return typeof x.workOrderTaskId === 'undefined'});}}","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchCurrentUser"}],"name":"start","description":"Start","nodeType":"START"},"isWorkOrderTaskPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processWorkOrderData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isWorkOrderTaskPresent","description":"isWorkOrderTaskPresent","processRule":"(contextVar.workOrderData.length > 0)","nodeType":"DECISION"},"end":{"name":"End","description":"End","inputVarMap":{},"outputVarMap":{},"nodeType":"END"},"processModelData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isCustomerDeActivated"}],"contextChangePermitted":true,"name":"processModelData","description":"processModelData","processRule":"{contextVar.customerId=contextVar.data.id; contextVar.customerStatusId=contextVar.data.statusId; contextVar.workOrderCancellationReason='Customer Deactivated'}","nodeType":"PROCESS"},"isCustomerDeActivated":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getWorkOrderData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isCustomerDeActivated","description":"isCustomerDeActivated","processRule":"(contextVar.customerStatusId === contextVar.customerDeactivated)","nodeType":"DECISION"},"getWorkOrderData":{"filter":"{$customerId} = {@customerId} AND {$statusId} IN {@activeWorkOrders}","models":["workOrder","workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"processWorkOrderTaskData"}],"columns":{"workOrderTaskworkOrderId":"workOrderTask.workOrderId","statusId":"workOrder.statusId","workOrderTaskId":"workOrderTask.id","customerId":"workOrder.customerId","id":"workOrder.id"},"name":"getWorkOrderData","description":"getWorkOrderData","outerJoinOnModel":"workOrder","inputVarMap":{"activeWorkOrders":"activeWorkOrders","customerId":"customerId"},"outputVarMap":{"data":"workOrderTaskData"},"nodeType":"QUERY"},"workflowNodes":["start","fetchCurrentUser","processModelData","isCustomerDeActivated","getWorkOrderData","processWorkOrderTaskData","isWorkOrderTaskPresent","processWorkOrderData","updateWorkOrderStatus","end"],"fetchCurrentUser":{"filter":"{$userId}={@userId}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processModelData"}],"columns":{"userName":"User.name","userId":"User.id"},"name":"fetchCurrentUser","description":"fetchCurrentUser","inputVarMap":{"{@userId}":"userId"},"outputVarMap":{"data":"currentUserDetail"},"nodeType":"QUERY"}}