{"pageContext":{},"actionOnLoad":["@actions.isModuleAssets","@actions.setInitialData","@actions.ismaintenancePlanActionEdit"],"localPageContext":true,"jslib":{"backButtonHidden":"function (pageContext) {return !(pageContext.module === 'contracts')}","isWorkOrderGridHidden":"function (pageContext) { return !(Array.isArray(pageContext.maintenanceWorkOrderData) && pageContext.maintenanceWorkOrderData.length > 0); }","isMaintenanceDetailsSectionHidden":"function (pageContext) { return ( (Array.isArray(pageContext.maintenanceScheduleData) && pageContext.maintenanceScheduleData.length > 0) || pageContext.maintenancePlanAction === 'view'); }","areSitesReadonly":"function (pageContext) {return (pageContext.module === 'assets')}","isActionView":"function (pageContext) {return (pageContext.maintenancePlanAction === 'view')}","isCustomerDropdownReadonly":"function (pageContext) {return(pageContext.module === 'contracts' || pageContext.module === 'assets')}","isMaintenancePlanGridHidden":"function (pageContext) { return !(Array.isArray(pageContext.maintenanceScheduleData) && pageContext.maintenanceScheduleData.length > 0); }","isSaveDisabled":"function (pageContext) { if (pageContext.maintenancePlanAction === 'add') { return !((typeof pageContext.assetMaintenancePlanName !== 'undefined' && pageContext.assetMaintenancePlanName !== '') && (Array.isArray(pageContext.workOrderTemplate) && pageContext.workOrderTemplate.length > 0 && pageContext.workOrderTemplate[0] !== null) && (Array.isArray(pageContext.taskType) && pageContext.taskType.length > 0 && pageContext.taskType[0] !== null) && (Array.isArray(pageContext.customer) && pageContext.customer.length > 0) && (Array.isArray(pageContext.selectedSites) && pageContext.selectedSites.length > 0) && (Array.isArray(pageContext.selectedAssets) && pageContext.selectedAssets.length > 0) && (Array.isArray(pageContext.maintenanceScheduleData) && pageContext.maintenanceScheduleData.length > 0)); } if (pageContext.maintenancePlanAction === 'edit') { pageContext.siteCheck = true; pageContext.assetCheck = true; pageContext.scheduleCheck = true; if (Array.isArray(pageContext.selectedSites) && pageContext.selectedSites.length > 0 && pageContext.initialSelectedSites.length === pageContext.selectedSites.length) { for (var i in pageContext.selectedSites) { if (pageContext.initialSelectedSites.indexOf(pageContext.selectedSites[i].value) === -1) { pageContext.siteCheck = false; break; } } } else { pageContext.siteCheck = false; } if (Array.isArray(pageContext.selectedAssets) && pageContext.selectedAssets.length > 0 && (pageContext.initialSelectedAssets.length === pageContext.selectedAssets.length)) { for (var i in pageContext.selectedAssets) { if (pageContext.initialSelectedAssets.indexOf(pageContext.selectedAssets[i].value) === -1) { pageContext.assetCheck = false; break; } } } else { pageContext.assetCheck = false; } if (Array.isArray(pageContext.maintenanceScheduleData) && pageContext.maintenanceScheduleData.length > 0 && (pageContext.initialMaintenanceScheduleData.length === pageContext.maintenanceScheduleData.length)) { function compare(a) { return function (current) { return a.filter(function (b) { return b.createWorkOrderDate == current.createWorkOrderDate && b.id == current.id && b.requestedDate == current.requestedDate && b.deadline == current.deadline }).length == 0; } } var result = pageContext.maintenanceScheduleData.filter(compare(pageContext.initialMaintenanceScheduleData)).concat(pageContext.initialMaintenanceScheduleData.filter(compare(pageContext.maintenanceScheduleData))); if (Array.isArray(result) && result.length > 0) { pageContext.scheduleCheck = false; } } else { pageContext.scheduleCheck = false; } if (Array.isArray(pageContext.workOrderTemplate) && pageContext.workOrderTemplate.length > 0 && pageContext.workOrderTemplate[0] !== null && Array.isArray(pageContext.taskType) && pageContext.taskType.length > 0 && pageContext.taskType[0] !== null && Array.isArray(pageContext.customer) && pageContext.customer.length > 0 && pageContext.customer[0] !== null && Array.isArray(pageContext.selectedAssets) && pageContext.selectedAssets.length > 0 && Array.isArray(pageContext.selectedAssets) && pageContext.selectedAssets.length > 0 && Array.isArray(pageContext.maintenanceScheduleData) && pageContext.maintenanceScheduleData.length > 0) { if (pageContext.initialDescription === pageContext.description && pageContext.initialEndDate === pageContext.endDate && pageContext.initialWorkOrderTemplate === pageContext.workOrderTemplate[0].value && pageContext.initialTasktype === pageContext.taskType[0].value && pageContext.initialCustomer === pageContext.customer[0].value && pageContext.siteCheck && pageContext.assetCheck && pageContext.scheduleCheck) { if (Array.isArray(pageContext.contract) && pageContext.contract.length > 0 && pageContext.contract[0] !== null) { return (pageContext.initialContract === pageContext.contract[0].value); } else if (typeof pageContext.initialContract !== 'undefined' && pageContext.initialContract !== '') { return false; } else return true; } else { return false; } } else { return true; } } }","isActionEdit":"function (pageContext) {return (pageContext.maintenancePlanAction === 'edit')}","isActionAdd":"function (pageContext) {return (pageContext.maintenancePlanAction === 'add')}","isPlanExpired":"function (pageContext) {return (pageContext.maintenancePlanAction !== 'view')}","isDaysInAdvanceBannerHidden":"function (pageContext) { if (pageContext.daysInAdvance > 0 || pageContext.daysInAdvance === '') { pageContext.advanceError = false; return true; } else { pageContext.advanceError = true; return false; } }","isServiceOverlayDisabled":"function (pageContext) {return(pageContext.calendarName === '-')}","isGreaterThanContract":"function (pageContext) { if (typeof pageContext.contractEndDate !== 'undefined' && pageContext.contractEndDate !== '' && pageContext.contractEndDate !== '-') { if (pageContext.contractEndDate < pageContext.lastMaintenanceDate) { pageContext.lmError = true; return false; } else { pageContext.lmError = false; return true; } } else { pageContext.lmError = false; return true; } }","isFrequencyBannerHidden":"function (pageContext) { if (pageContext.frequencyValue > 0 || pageContext.frequencyValue === '') { pageContext.frequencyError = false; return true; } else { pageContext.frequencyError = true; return false; } }","crossButtonHidden":"function (pageContext) {return(pageContext.module === 'contracts')}","dynamicHeaderText":"function (pageContext) { if (pageContext.maintenancePlanAction === 'add') { return '@lang.[\"anmp\",\"Add New Maintenance Plan\"]'; } else if (pageContext.maintenancePlanAction === 'edit') { return '@lang.[\"emp\",\"Edit Maintenance Plan\"]'; } else if (pageContext.maintenancePlanAction === 'view') { return '@lang.[\"vmp\",\"View Maintenance Plan\"]'; } }","isCreateMaintenanceButtonDisabled":"function (pageContext) { return (typeof pageContext.frequencyValue === 'undefined' || pageContext.frequencyValue === '' || typeof pageContext.frequencyUnit === 'undefined' || pageContext.frequencyUnit === '' || typeof pageContext.firstMaintenanceDate === 'undefined' || pageContext.firstMaintenanceDate === '' || typeof pageContext.lastMaintenanceDate === 'undefined' || pageContext.lastMaintenanceDate === '' || typeof pageContext.daysInAdvance === 'undefined' || pageContext.daysInAdvance === '' || pageContext.firstMaintenanceDate > pageContext.lastMaintenanceDate || !(Array.isArray(pageContext.selectedAssets) && pageContext.selectedAssets.length > 0) || pageContext.lmError || pageContext.advanceError || pageContext.frequencyError) }"},"header":{"leftData":{"children":[{"hidden":"@jslib.backButtonHidden","name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.isMaintenancePlanSaved","@actions.openPreviousPanel","@actions.refreshDataGrid","@actions.clearSelectedPageContext"],"type":"buttonIcon"}]},"children":[{"hidden":"@jslib.isActionAdd","statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"buttonType":"primary","hidden":"@jslib.isActionView","actionOnClick":["@actions.setMaintenancePlanAction","@actions.fireProcessEvent","@actions.isModuleContracts","@actions.refreshDataGrid","@actions.clearSelectedPageContext"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"},{"hidden":"@jslib.crossButtonHidden","icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.isMaintenancePlanSaved","@actions.closePanel","@actions.refreshDataGrid","@actions.clearSelectedPageContext"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"hidden":"@jslib.isActionView","children":[{"disabled":"@jslib.isActionEdit","id":"maintenancePlanName","label":"@lang.['mpn','Maintenance Plan Name']","placeholder":"@lang.['epn','Enter plan name']","type":"input","value":"@pageContext.assetMaintenancePlanName"},{"id":"maintenanceDescription","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.description","placeHolder":"@lang.['ed1','Enter description']"},{"actionOnChange":["@actions.fetchWorkOrderTemplateData","@actions.setPriorityAndclearTaskType","@actions.refreshTaskTypeDropdown"],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$workOrderTemplateName} like {@filter}","models":["workOrderTemplateV2"],"columns":{"workOrderTemplateId":"workOrderTemplateV2.id","workOrderTemplateName":"workOrderTemplateV2.name"}}},"optLabelMap":"workOrderTemplateName","optValueMap":"workOrderTemplateId","id":"workOrderTemplateList","label":"@lang.['wot','Work Order Template']","type":"selectDropdown","value":"@pageContext.workOrderTemplate"},{"actionOnChange":[],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$taskTypeName} like {@filter} AND {$workOrderTemplateV2.id} = {@id} AND {$taskType.webTask} = false AND {$taskType.statusId} = 'taskTypeActive' AND {$taskType.crewTask} = 'false'","models":["workOrderTemplateV2","workOrderTemplateTask","taskType"],"inputs":{"id":"@pageContext.workOrderTemplate[0].value"},"columns":{"taskTypeId":"workOrderTemplateTask.taskTypeId","taskTypeName":"taskType.name"},"distinct":true,"links":{"workOrderTemplateV2":"workOrderTemplateTask","workOrderTemplateTask":"taskType"}}},"optLabelMap":"taskTypeName","optValueMap":"taskTypeId","id":"taskTypeList","label":"@lang.['taskType','Task Type']","type":"selectDropdown","value":"@pageContext.taskType"},{"actionOnChange":["@actions.clearSitesAndContracts","@actions.refreshSitesAndContracts"],"isMultiSelect":false,"optLabelMap":"customerName","optValueMap":"customerId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$customerName} like {@filter} AND {$customer.statusId} = 'customerActive'","models":["Customer"],"columns":{"customerAddress":"customer.billingAddress","customerContactPerson":"customer.contactPerson","customerId":"customer.id","customerName":"customer.companyName"},"inputs":{},"orderBy":"customerName ASC","distinct":true}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$customerId} IN {@selectedGroupId}","models":["Customer"],"columns":{"customerAddress":"customer.billingAddress","customerContactPerson":"customer.contactPerson","customerId":"customer.id","customerName":"customer.companyName"},"inputs":{"selectedGroupId":"@pageContext.selectedId"}},"columnsToBeHidden":["customerId"],"selectedRowAdvanceGrid":"AdvancedGridCustomer","dataSourceId":"query/read","rowsToBeSelect":"selectedId","sourceType":"query","tableHeaderDisplayOrder":["customerName","customerAddress","customerContactPerson"],"sidePanelTitle":"@lang.['sc9','Select Customer']","gridHeaderText":"@lang.['navC','Customers']","customColumns":{"customerAddress":"@lang.['address','Address']","customerContactPerson":"@lang.['cp1','Contact Person']","customerName":"@lang.['c16','Customer']"},"searchKeys":["customerName","customerAddress","customerContactPerson"]},"readOnly":"@jslib.isCustomerDropdownReadonly","label":"@lang.['c16','Customer']","id":"customerName","type":"selectDropdown","value":"@pageContext.customer"},{"actionOnChange":["@actions.setSitesIdList","@actions.areAssetsSelected","@actions.refreshAssetsDropdown"],"isMultiSelect":true,"optLabelMap":"customerSiteName","optValueMap":"customerSiteId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$customerSiteName} like {@filter}  AND {$customerId} = {@id} AND {$site.statusId} = 'siteActive'","models":["customer","site"],"columns":{"customerSiteName":"site.name","customerId":"customer.id","customerSiteAddress":"site.address","customerSiteId":"site.id","customerSiteContactPerson":"site.contactPerson","customerName":"customer.companyName"},"inputs":{"id":"@pageContext.customer[0].value"},"orderBy":"customerSiteName ASC","distinct":true,"links":{"customer":"site"}}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$customerSiteId} IN {@selectedGroupId}","models":["customer","site"],"columns":{"customerSiteName":"site.name","customerId":"customer.id","customerSiteAddress":"site.address","customerSiteId":"site.id","customerSiteContactPerson":"site.contactPerson","customerName":"customer.companyName"},"inputs":{"selectedGroupId":"@pageContext.selectedId"},"links":{"customer":"site"}},"columnsToBeHidden":["customerId","customerSiteId"],"selectedRowAdvanceGrid":"AdvancedGridCustomerSite","dataSourceId":"query/read","rowsToBeSelect":"selectedId","sourceType":"query","tableHeaderDisplayOrder":["customerSiteName","customerName","customerSiteAddress","customerSiteContactPerson"],"sidePanelTitle":"@lang.['scs2','Select Customer Sites']","gridHeaderText":"@lang.['navCS','Customer Sites']","customColumns":{"customerSiteName":"@lang.['cs','Customer Site']","customerSiteAddress":"@lang.['address','Address']","customerSiteContactPerson":"@lang.['cp1','Contact Person']","customerName":"@lang.['c16','Customer']"},"searchKeys":["customerSiteName","customerName","customerSiteAddress","customerSiteContactPerson"]},"readOnly":"@jslib.areSitesReadonly","label":"@lang.['cs','Customer Site']","id":"customerSiteList","type":"selectDropdown","value":"@pageContext.selectedSites"},{"actionOnChange":[],"isMultiSelect":true,"optLabelMap":"catalogName","optValueMap":"installedBaseId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$catalogName} like {@filter} AND {$installedBaseSiteId} IN {@siteId} AND {$installedBase.statusId} = 'installedBaseActive'","models":["catalog","manufacturer","installedBase","assetCategory"],"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","installedBaseSiteId":"installedBase.siteId","manufacturerName":"manufacturer.name","installedBaseSerialNo":"installedBase.serialNo","assetCategoryId":"catalog.assetCategoryId","catalogModelNumber":"catalog.modelNumber","catalogTypeId":"catalog.catalogTypeId","installedBaseId":"installedBase.id","assetCategoryName":"assetCategory.name"},"inputs":{"siteId":"@pageContext.sitesIdList"},"outerJoinOnModel":"catalog","distinct":true}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$installedBaseId} IN {@selectedGroupId}","models":["catalog","manufacturer","installedBase","assetCategory"],"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","installedBaseSiteId":"installedBase.siteId","manufacturerName":"manufacturer.name","installedBaseSerialNo":"installedBase.serialNo","assetCategoryId":"catalog.assetCategoryId","catalogModelNumber":"catalog.modelNumber","catalogTypeId":"catalog.catalogTypeId","installedBaseId":"installedBase.id","assetCategoryName":"assetCategory.name"},"inputs":{"selectedGroupId":"@pageContext.selectedId"},"outerJoinOnModel":"catalog"},"columnsToBeHidden":["installedBaseId","catalogId","catalogTypeId","assetCategoryId","installedBaseSiteId"],"selectedRowAdvanceGrid":"AdvancedGridAssets","dataSourceId":"query/read","rowsToBeSelect":"selectedId","sourceType":"query","tableHeaderDisplayOrder":["manufacturerName","catalogName","catalogModelNumber","assetCategoryName","installedBaseSerialNo"],"sidePanelTitle":"@lang.['sa4','Select Assets']","gridHeaderText":"@lang.['assets','Assets']","customColumns":{"catalogName":"@lang.['mn','Model Name']","manufacturerName":"@lang.['m','Manufacturer']","installedBaseSerialNo":"@lang.['sn5','Serial No']","catalogModelNumber":"@lang.['mn1','Model Number']","assetCategoryName":"@lang.['cn5','Category Name']"},"searchKeys":["catalogName","manufacturerName","catalogModelNumber","assetCategoryName"]},"label":"@lang.['assets','Assets']","id":"assetsList","type":"selectDropdown","value":"@pageContext.selectedAssets"},{"actionOnChange":["@actions.fetchContractData","@actions.setDateAndWindow"],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$contractName} like {@filter} AND {$contract.customerId} = {@id} AND {$contract.statusId} != 'contractExpired' AND {$contract.statusId} != 'contractDeactivated' AND {$contract.slaId} != ''","models":["contract"],"columns":{"contractId":"contract.id","contractName":"contract.contractNumber"},"inputs":{"id":"@pageContext.customer[0].value"}}},"optLabelMap":"contractName","optValueMap":"contractId","readOnly":"@jslib.crossButtonHidden","id":"contractName","label":"@lang.['c35','Contract (Optional)']","type":"selectDropdown","value":"@pageContext.contract"},{"readOnly":true,"id":"contractEndDate","title":"@lang.['ced','Contract End Date']","type":"date","value":"@pageContext.contractEndDate"},{"readOnly":true,"id":"calendarName","label":"@lang.['navSW','Service Window']","type":"input","value":"@pageContext.calendarName"},{"children":[{"children":[{"buttonType":"secondary","actionOnClick":["@actions.getWeeklyScheduleData","@actions.enableDataGridAndSetWeeklyScheduleData","@actions.serviceWindowOverlay"],"disabled":"@jslib.isServiceOverlayDisabled","id":"serviceWindow","type":"button","title":"@lang.['vsw','View Service Window']"}],"flex":"2","type":"column"},{"flex":"3","id":"","type":"column"}],"id":"serviceWindow","type":"row"},{"minDate":"@pageContext.currentDate","maxDate":"@pageContext.contractEndDate","id":"maintenanceEndDate","title":"@lang.['mped','Maintenance Plan End Date (Optional)']","type":"date","value":"@pageContext.endDate"}],"label":"@lang.['gi','General Information']","id":"generalInformation","type":"section"},{"hidden":"@jslib.isPlanExpired","children":[{"readOnly":true,"id":"maintenancePlanName","label":"@lang.['mpn','Maintenance Plan Name']","type":"input","value":"@pageContext.assetMaintenancePlanName"},{"readOnly":true,"id":"maintenanceDescription","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.description"},{"readOnly":true,"id":"workOrderTemplateList","label":"@lang.['wot','Work Order Template']","type":"selectDropdown","value":"@pageContext.workOrderTemplate"},{"readOnly":true,"id":"taskTypeList","label":"@lang.['taskType','Task Type']","type":"selectDropdown","value":"@pageContext.taskType"},{"readOnly":true,"label":"@lang.['c16','Customer']","id":"customerName","type":"selectDropdown","value":"@pageContext.customer"},{"actionOnChange":["@actions.setSitesIdList","@actions.areAssetsSelected","@actions.refreshAssetsDropdown"],"isMultiSelect":true,"optLabelMap":"customerSiteName","optValueMap":"customerSiteId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$customerSiteName} like {@filter}  AND {$customerId} = {@id} AND {$site.statusId} = 'siteActive'","models":["customer","site"],"columns":{"customerSiteName":"site.name","customerId":"customer.id","customerSiteAddress":"site.address","customerSiteId":"site.id","customerSiteContactPerson":"site.contactPerson","customerName":"customer.companyName"},"inputs":{"id":"@pageContext.customer[0].value"},"orderBy":"customerSiteName ASC","distinct":true,"links":{"customer":"site"}}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$customerSiteId} IN {@selectedGroupId}","models":["customer","site"],"columns":{"customerSiteName":"site.name","customerId":"customer.id","customerSiteAddress":"site.address","customerSiteId":"site.id","customerSiteContactPerson":"site.contactPerson","customerName":"customer.companyName"},"inputs":{"selectedGroupId":"@pageContext.selectedId"},"links":{"customer":"site"}},"columnsToBeHidden":["customerId","customerSiteId"],"selectedRowAdvanceGrid":"AdvancedGridCustomerSite","dataSourceId":"query/read","rowsToBeSelect":"selectedId","sourceType":"query","tableHeaderDisplayOrder":["customerSiteName","customerName","customerSiteAddress","customerSiteContactPerson"],"sidePanelTitle":"@lang.['scs2','Select Customer Sites']","gridHeaderText":"@lang.['navCS','Customer Sites']","customColumns":{"customerSiteName":"@lang.['cs','Customer Site']","customerSiteAddress":"@lang.['address','Address']","customerSiteContactPerson":"@lang.['cp1','Contact Person']","customerName":"@lang.['c16','Customer']"},"searchKeys":["customerSiteName","customerName","customerSiteAddress","customerSiteContactPerson"]},"readOnly":true,"label":"@lang.['cs','Customer Site']","id":"customerSiteList","type":"selectDropdown","value":"@pageContext.selectedSites"},{"actionOnChange":[],"isMultiSelect":true,"optLabelMap":"catalogName","optValueMap":"installedBaseId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$catalogName} like {@filter} AND {$installedBaseSiteId} IN {@siteId} AND {$installedBase.statusId} = 'installedBaseActive'","models":["catalog","manufacturer","installedBase","assetCategory"],"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","installedBaseSiteId":"installedBase.siteId","manufacturerName":"manufacturer.name","installedBaseSerialNo":"installedBase.serialNo","assetCategoryId":"catalog.assetCategoryId","catalogModelNumber":"catalog.modelNumber","catalogTypeId":"catalog.catalogTypeId","installedBaseId":"installedBase.id","assetCategoryName":"assetCategory.name"},"inputs":{"siteId":"@pageContext.sitesIdList"},"outerJoinOnModel":"catalog","distinct":true}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":"{$installedBaseId} IN {@selectedGroupId}","models":["catalog","manufacturer","installedBase","assetCategory"],"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","installedBaseSiteId":"installedBase.siteId","manufacturerName":"manufacturer.name","installedBaseSerialNo":"installedBase.serialNo","assetCategoryId":"catalog.assetCategoryId","catalogModelNumber":"catalog.modelNumber","catalogTypeId":"catalog.catalogTypeId","installedBaseId":"installedBase.id","assetCategoryName":"assetCategory.name"},"inputs":{"selectedGroupId":"@pageContext.selectedId"},"outerJoinOnModel":"catalog"},"columnsToBeHidden":["installedBaseId","catalogId","catalogTypeId","assetCategoryId","installedBaseSiteId"],"selectedRowAdvanceGrid":"AdvancedGridAssets","dataSourceId":"query/read","rowsToBeSelect":"selectedId","sourceType":"query","tableHeaderDisplayOrder":["manufacturerName","catalogName","catalogModelNumber","assetCategoryName","installedBaseSerialNo"],"sidePanelTitle":"@lang.['sa4','Select Assets']","gridHeaderText":"@lang.['assets','Assets']","customColumns":{"catalogName":"@lang.['mn','Model Name']","manufacturerName":"@lang.['m','Manufacturer']","installedBaseSerialNo":"@lang.['sn5','Serial No']","catalogModelNumber":"@lang.['mn1','Model Number']","assetCategoryName":"@lang.['cn5','Category Name']"},"searchKeys":["catalogName","manufacturerName","catalogModelNumber","assetCategoryName"]},"readOnly":true,"label":"@lang.['assets','Assets']","id":"assetsList","type":"selectDropdown","value":"@pageContext.selectedAssets"},{"readOnly":true,"id":"contractName","label":"@lang.['c35','Contract (Optional)']","type":"selectDropdown","value":"@pageContext.contract"},{"readOnly":true,"id":"contractEndDate","title":"@lang.['ced','Contract End Date']","type":"date","value":"@pageContext.contractEndDate"},{"readOnly":true,"id":"calendarName","label":"@lang.['navSW','Service Window']","type":"input","value":"@pageContext.calendarName"},{"children":[{"children":[{"buttonType":"secondary","actionOnClick":["@actions.getWeeklyScheduleData","@actions.enableDataGridAndSetWeeklyScheduleData","@actions.serviceWindowOverlay"],"disabled":"@jslib.isServiceOverlayDisabled","id":"serviceWindow","type":"button","title":"@lang.['vsw','View Service Window']"}],"flex":"2","type":"column"},{"flex":"3","id":"","type":"column"}],"id":"serviceWindow","type":"row"},{"readOnly":true,"id":"maintenanceEndDate","title":"@lang.['mped','Maintenance Plan End Date (Optional)']","type":"date","value":"@pageContext.endDate"}],"label":"@lang.['gi','General Information']","id":"generalInformation","type":"section"},{"hidden":"@jslib.isPlanExpired","children":[{"readOnly":true,"inputType":"number","id":"frequencyValue","label":"@lang.['re1','Repeat Every']","type":"input","value":"@pageContext.frequencyValueUnit"},{"readOnly":true,"id":"firstMaintenanceDate","title":"@lang.['fmd','First Maintenance Date']","type":"date","value":"@pageContext.firstMaintenanceDate","hoverText":{"title":"@lang.['tirodotfsm','This is Requested On date of the first scheduled maintenance']"}},{"readOnly":true,"id":"lastMaintenanceDate","title":"@lang.['lmd','Last Maintenance Date']","type":"date","value":"@pageContext.lastMaintenanceDate","hoverText":{"title":"@lang.['tirodotlsm','This is Requested On date of the last scheduled maintenance']"}}],"label":"@lang.['mpd','Maintenance Plan Details']","id":"maintenanceScheduleDetails","type":"section"},{"hidden":"@jslib.isMaintenanceDetailsSectionHidden","children":[{"alertMessage":"@lang.['fsbgt0','Frequency should be greater than 0.']","rightIconVisible":false,"alertType":"danger","hidden":"@jslib.isFrequencyBannerHidden","id":"alertMessage","type":"alert","timeout":5000},{"alertMessage":"@lang.['diasbgt0','Days in advance should be greater than 0.']","rightIconVisible":false,"alertType":"danger","hidden":"@jslib.isDaysInAdvanceBannerHidden","id":"alertMessage","type":"alert","timeout":5000},{"alertMessage":"@lang.['lmfateotcsandftlmtp','Last maintenance falls after the expiration of the contract. Select a new date for the last maintenance to proceed.']","rightIconVisible":false,"alertType":"danger","hidden":"@jslib.isGreaterThanContract","id":"alertMessage","type":"alert","timeout":5000},{"children":[{"children":[{"actionOnChange":["@actions.setListOptionKeys","@actions.fetchListOptions","@actions.refreshFrequencyUnitOptions"],"inputType":"number","id":"frequencyValue","label":"@lang.['re1','Repeat Every']","placeholder":"@lang.['en6','Enter number']","type":"input","value":"@pageContext.frequencyValue"}],"flex":"3","type":"column"},{"children":[{"options":"@pageContext.frequencyUnitOptions","id":"frequencyUnit","optTitleKey":"answerOptionText","optValueKey":"listOptionAnswerId","title":"","type":"select","value":"@pageContext.frequencyUnit","placeHolder":"@lang.['su','Select Unit']"}],"flex":"3","type":"column"}],"id":"repeatEveryRow","type":"row"},{"children":[{"children":[{"actionOnChange":[],"minDate":"@pageContext.currentDate","id":"firstMaintenanceDate","title":"@lang.['fmd','First Maintenance Date']","type":"date","value":"@pageContext.firstMaintenanceDate","placeHolder":"@lang.['cpsd','Choose plan start date']","hoverText":{"title":"@lang.['tirodotfsm','This is Requested On date of the first scheduled maintenance']"}}],"flex":"3","type":"column"},{"children":[{"actionOnChange":[],"minDate":"@pageContext.firstMaintenanceDate","id":"lastMaintenanceDate","title":"@lang.['lmd','Last Maintenance Date']","type":"date","value":"@pageContext.lastMaintenanceDate","placeHolder":"@lang.['cped','Choose plan end date']","hoverText":{"title":"@lang.['tirodotlsm','This is Requested On date of the last scheduled maintenance']"}}],"flex":"3","type":"column"}],"id":"maintenanceDateRow","type":"row"},{"isRequired":true,"inputType":"number","id":"generateWorkOrder","label":"@lang.['gwoiad','Generate Work Order in Advance (In Days)']","placeholder":"@lang.['en6','Enter number']","type":"input","value":"@pageContext.daysInAdvance","hoverText":{"title":"@lang.['twontbciaotnodotrod','The Work Order needs to be created in advance of these number of days of the Requested On date.']"}},{"buttonType":"primary","actionOnClick":["@actions.setSubAction","@actions.fireProcessEvent","@actions.setGridData"],"disabled":"@jslib.isCreateMaintenanceButtonDisabled","id":"createMaintenanceButton","type":"button","title":"@lang.['cmp','Create Maintenance Plan']"}],"label":"@lang.['mpd','Maintenance Plan Details']","id":"maintenanceScheduleDetails","type":"section"},{"hidden":"@jslib.isMaintenancePlanGridHidden","children":[{"id":"maintenanceScheduleDataGrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.maintenanceScheduleData"}},"isScrollAble":false,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsEditPurple","hidden":"@jslib.isActionView","name":"@lang.['e1','Edit']","tooltip":"@lang.['e1','Edit']","icon":"@iconlib.ActionsEditGrey","actionOnClick":["@actions.setEditAction","@actions.openNestedSidePanel"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isActionView","icon":"@iconlib.ActionsBinGrey","name":"@lang.['d1','Delete']","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.removeMaintenanceSchedule","@actions.refreshMaintenanceScheduleGrid"],"type":"buttonIcon","title":"@lang.['d1','Delete']"}]},"gridRefreshId":"maintenanceScheduleGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['cwo1','Create Work Order']","options":{"type":"date","showLabel":true},"key":"createWorkOrderDate"},{"name":"@lang.['sd4','Scheduled Date']","options":{"type":"date","showLabel":true},"key":"requestedDate"},{"name":"@lang.['d4','Deadline']","options":{"type":"date","showLabel":true},"key":"deadline"}],"actionOnLoad":[],"jslib":{"isActionView":"function (pageContext) {return (pageContext.maintenancePlanAction === 'view')}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['ms2','Maintenance Schedule']","children":[{"buttonType":"secondary","hidden":"@jslib.isActionView","actionOnClick":["@actions.openResetModal"],"id":"reset","type":"button","title":"@lang.['r12','Reset']"},{"buttonType":"primary","hidden":"@jslib.isActionView","actionOnClick":["@actions.setAddAction","@actions.openNestedSidePanel"],"id":"addDate","type":"button","title":"@lang.['ad3','Add Date']"}]},"isSelectable":false,"actions":[{"subTitle":"@lang.['aysywtganmpawoatwhnbgwbrftmp','Are you sure you want to generate a new maintenance plan? All work order and tasks which have not been generated will be removed from this maintenance plan.']","name":"openResetModal","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal","@actions.clearMaintenanceScheduleData","@actions.setListOptionKeys","@actions.fetchListOptions","@actions.refreshFrequencyUnitOptions","@actions.refreshMaintenanceScheduleGrid"],"type":"button","title":"@lang.['c13','Continue']"},{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"}],"type":"openModal","title":"@lang.['gns','Generate New Schedule']"},{"name":"removeMaintenanceSchedule","type":"script","actionDef":"function (pageContext) {_.remove(pageContext.maintenanceScheduleData, function (element) { if (element.createWorkOrderDate === pageContext.createWorkOrderDate) { return true; } }); }"},{"name":"openNestedSidePanel","type":"openPanel","pageId":"assetMaintenanceScheduleNNSP"},{"name":"setEditAction","type":"script","actionDef":"function (pageContext){pageContext.maintenanceScheduleNNSPAction = 'edit';}"},{"name":"setAddAction","type":"script","actionDef":"function (pageContext){pageContext.maintenanceScheduleNNSPAction = 'add';}"},{"name":"refreshMaintenanceScheduleGrid","gridId":["maintenanceScheduleGrid"],"type":"RefreshGridOnSidePanel"}],"searchKeys":[]}}],"label":"","id":"maintenanceScheduleGrid","type":"section","transparent":true},{"hidden":"@jslib.isWorkOrderGridHidden","children":[{"id":"workOrderDataGrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.maintenanceWorkOrderData"}},"isScrollAble":false,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"tableWidth":"60rem","gridRefreshId":"workOrderGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":1,"colorCode":"statusNameColor","showLabel":true},"key":"statusName"},{"name":"@lang.['woi','Work Order Id']","options":{"flex":1,"showLabel":true},"key":"workOrderId"},{"name":"@lang.['woc','Work Order Created']","options":{"type":"date","showLabel":true},"key":"workOrderCreatedDate"},{"name":"@lang.['ro','Requested On']","options":{"type":"date","showLabel":true},"key":"workOrderRequestedDate"},{"name":"@lang.['d4','Deadline']","options":{"type":"date","showLabel":true},"key":"workOrderDeadline"},{"name":"@lang.['c10','Closed']","options":{"type":"date","showLabel":true},"key":"workOrderCompletedDate"}],"actionOnLoad":[],"jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navWO','Work Orders']"},"isSelectable":false,"actions":[],"searchKeys":[]}}],"label":"","id":"workOrderDetails","type":"section","transparent":true}]},"actions":[{"name":"clearMaintenanceScheduleData","type":"script","actionDef":"function (pageContext) { pageContext.maintenanceScheduleData = []; pageContext.frequencyError = false; pageContext.advanceError = false; pageContext.lmError = false; if (pageContext.firstMaintenanceDate < pageContext.currentDate) { pageContext.firstMaintenanceDate = ''; } }"},{"name":"fetchWorkOrderTemplateData","outputVarMap":{"data":"@pageContext.workOrderTemplateData"},"type":"query","actionDef":{"filter":" {$workOrderTemplateV2.id} = {@id} ","models":["workOrderTemplateV2"],"inputs":{"id":"@pageContext.workOrderTemplate[0].value"},"columns":{"workOrderTemplatePriorityPriority":"workOrderTemplateV2.priorityPriority"}}},{"name":"fetchWorkOrderData","outputVarMap":{"data":"@pageContext.maintenanceWorkOrderData"},"type":"query","actionDef":{"filter":"{$assetMaintenanceSchedule.assetMaintenancePlanId} = {@id} AND {$assetMaintenanceSchedule.workOrderId} != '' ","models":["workOrder","ZStatus","assetMaintenanceSchedule"],"inputs":{"id":"@pageContext.assetMaintenancePlanId"},"columns":{"workOrderCreatedDate":"workOrder.createdDate","workOrderDeadline":"workOrder.deadline","statusName":"ZStatus.name","workOrderId":"workOrder.id","workOrderRequestedDate":"workOrder.requestedDate","statusNameColor":"ZStatus.colorCode","workOrderStatusId":"workOrder.statusId","workOrderCompletedDate":"workOrder.completedDate"},"links":{"workOrder":"ZStatus","assetMaintenanceSchedule":"workOrder"}}},{"name":"fetchContractData","outputVarMap":{"data":"@pageContext.contractData"},"type":"query","continueOnError":true,"actionDef":{"filter":" {$contract.id} = {@id} AND {$calendar.calendarType} = 'serviceWindow' ","models":["contract","calendar"],"inputs":{"id":"@pageContext.contract[0].value"},"columns":{"calendarName":"calendar.name","calendarId":"contract.calendarId","contractEndDate":"contract.endDate","contractSLA":"contract.slaId"}}},{"endPoint":"process/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.outputData"},"type":"api","actionDef":{"data":[{"processId":"createAssetMaintenancePlanAndScheduleWF","contextVar":{"selectedSites":"@pageContext.selectedSites","timezoneOffset":"@pageContext.timezoneOffset","workOrderPriority":"@pageContext.workOrderPriority","subAction":"@pageContext.subAction","maintenancePlanAction":"@pageContext.maintenancePlanAction","maintenanceScheduleData":"@pageContext.maintenanceScheduleData","selectedAssets":"@pageContext.selectedAssets","assetMaintenancePlan":{"lastMaintenanceDate":"@pageContext.lastMaintenanceDate","workOrderTemplateId":"@pageContext.workOrderTemplate[0].value","frequencyUnit":"@pageContext.frequencyUnit","slaId":"@pageContext.slaId","statusTargetModel":"@pageContext.statusTargetModel","endDate":"@pageContext.endDate","firstMaintenanceDate":"@pageContext.firstMaintenanceDate","description":"@pageContext.description","frequencyValue":"@pageContext.frequencyValue","taskTypeId":"@pageContext.taskType[0].value","statusId":"@pageContext.statusId","calendarId":"@pageContext.calendarId","name":"@pageContext.assetMaintenancePlanName","customerId":"@pageContext.customer[0].value","contractId":"@pageContext.contractId","daysInAdvance":"@pageContext.daysInAdvance","id":"@pageContext.assetMaintenancePlanId"}}}]}},{"endPoint":"process/start","name":"getWeeklyScheduleData","outputVarMap":{"data":"@pageContext.weeklyScheduleData"},"type":"api","actionDef":{"data":[{"processId":"settingsGeneralCalendarWeeklyScheduleFetchDataWF","contextVar":{"timezoneOffset":"@pageContext.timezoneOffset","id":"@pageContext.calendarId"}}]}},{"name":"serviceWindowOverlay","type":"openOverlayView","title":"@lang.['navSW','Service Window']","pageDef":[{"id":"weeklyScheduleDatagrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.calendarData"}},"rowTextLength":30,"isSelectable":false,"tableHeader":[{"name":"@lang.['d12','Day']","options":{"sortable":true,"showLabel":true},"key":"weeklyScheduleDay"},{"name":"@lang.['s','Status']","options":{"showLabel":true},"key":"serviceWindowWeeklyScheduleIsOpen"},{"name":"@lang.['t11','Timings']","options":{"flex":2,"dateRangeType":"absoluteTime","sortable":true,"type":"dateRange","showLabel":true},"key":"weeklyScheduleTimings"},{"name":"@lang.['h','Hours']","options":{"sortable":true,"showLabel":true},"key":"weeklyScheduleTotalHours"}]}}]},{"name":"enableDataGridAndSetWeeklyScheduleData","type":"script","actionDef":"function(pageContext){pageContext.enable=true;pageContext.calendarData=pageContext.weeklyScheduleData[0].outputVar.calendarData;}"},{"searchDropdownId":["customerSiteList","contractName","assetsList"],"name":"refreshSitesAndContracts","type":"refreshSearchDropdown"},{"searchDropdownId":["taskTypeList"],"name":"refreshTaskTypeDropdown","type":"refreshSearchDropdown"},{"searchDropdownId":["frequencyUnit"],"name":"refreshFrequencyUnitOptions","type":"refreshSearchDropdown"},{"searchDropdownId":["assetsList"],"name":"refreshAssetsDropdown","type":"refreshSearchDropdown"},{"searchDropdownId":["contractName"],"name":"refreshContractDropdown","type":"refreshSearchDropdown"},{"name":"clearSitesAndContracts","type":"script","actionDef":"function (pageContext) { pageContext.selectedSites = []; pageContext.contract = []; pageContext.selectedAssets = []; if (pageContext.contractEndDate !== '-') { pageContext.contractEndDate = ''; pageContext.calendarName = ''; } pageContext.endDate = ''; }"},{"name":"setPriorityAndclearTaskType","type":"script","actionDef":"function (pageContext) { pageContext.taskType = []; if (Array.isArray(pageContext.workOrderTemplateData) && pageContext.workOrderTemplateData.length > 0) { pageContext.workOrderPriority = pageContext.workOrderTemplateData[0].workOrderTemplatePriorityPriority; } }"},{"name":"setDateAndWindow","type":"script","actionDef":"function (pageContext) { if (Array.isArray(pageContext.contractData) && pageContext.contractData.length > 0 && pageContext.contract[0] !== null) { if (typeof pageContext.contractData[0].contractEndDate !== 'undefined') { pageContext.contractEndDate = pageContext.contractData[0].contractEndDate; pageContext.endDate = pageContext.contractData[0].contractEndDate; } else { pageContext.contractEndDate = '-'; } pageContext.calendarName = pageContext.contractData[0].calendarName; pageContext.calendarId = pageContext.contractData[0].calendarId; pageContext.slaId = pageContext.contractData[0].contractSLA; } else { pageContext.contractEndDate = '-'; pageContext.calendarName = '-'; pageContext.calendarId = ''; pageContext.slaId = ''; } }"},{"name":"setSitesIdList","type":"script","actionDef":"function (pageContext) { pageContext.sitesIdList = []; if (Array.isArray(pageContext.selectedSites) && pageContext.selectedSites.length > 0) { for (var i = 0; i < pageContext.selectedSites.length; i++) { pageContext.sitesIdList.push(pageContext.selectedSites[i].value); } } }"},{"name":"clearSelectedAssets","type":"script","actionDef":"function (pageContext) {pageContext.selectedAssets = [];}"},{"falseStep":["@actions.checkModule"],"trueStep":["@actions.fetchWorkOrderTemplateData","@actions.setPriority","@actions.refreshTaskTypeDropdown","@actions.refreshSitesAndContracts","@actions.setSitesIdList","@actions.refreshAssetsDropdown","@actions.refreshContractDropdown","@actions.setListOptionKeys","@actions.fetchListOptions","@actions.refreshFrequencyUnitOptions","@actions.fetchWorkOrderData"],"name":"ismaintenancePlanActionEdit","type":"decision","actionDef":"function (pageContext) {return(pageContext.maintenancePlanAction === 'edit')}"},{"falseStep":["@actions.isReadOnlyMode"],"trueStep":["@actions.refreshSitesAndContracts","@actions.setSitesIdList","@actions.refreshAssetsDropdown","@actions.fetchContractData","@actions.setDateAndWindow"],"name":"checkModule","type":"decision","actionDef":"function (pageContext) {return(pageContext.maintenancePlanAction === 'add' && (pageContext.module === 'contracts' || pageContext.module === 'assets'))}"},{"falseStep":[],"trueStep":["@actions.fetchWorkOrderData"],"name":"isReadOnlyMode","type":"decision","actionDef":"function (pageContext) {return(pageContext.maintenancePlanAction === 'view')}"},{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { pageContext.enable = true; pageContext.lmError = false; pageContext.frequencyError = false; pageContext.scheduleGenerated = false; var today = new Date(); pageContext.currentDate = today.toISOString().replace('T', ' ').replace('Z', ); pageContext.timezoneOffset = new Date().getTimezoneOffset(); if (pageContext.maintenancePlanAction === 'add') { pageContext.assetMaintenancePlanName = ''; pageContext.description = ''; pageContext.workOrderTemplate = ''; pageContext.taskType = ''; pageContext.customer = ''; pageContext.selectedSites = ''; pageContext.selectedAssets = ''; pageContext.contract = ''; pageContext.firstMaintenanceDate = ''; pageContext.lastMaintenanceDate = ''; pageContext.frequencyUnit = ''; pageContext.contractEndDate = '-'; pageContext.calendarName = '-'; pageContext.calendarId = ''; pageContext.slaId = ''; pageContext.endDate = ''; pageContext.frequencyValue = ''; pageContext.daysInAdvance = ''; if (pageContext.module === 'contracts') { pageContext.customer = []; pageContext.contract = []; pageContext.contract.push({ 'value': pageContext.id, 'label': pageContext.contractNumber }); pageContext.customer.push({ 'value': pageContext.customerId, 'label': pageContext.customerName }); } else if (pageContext.module === 'assets' & Array.isArray(pageContext.customerAndSitesData) && pageContext.customerAndSitesData.length > 0) { pageContext.customer = []; pageContext.selectedSites = []; pageContext.selectedSites.push({ 'value': pageContext.customerAndSitesData[0].siteId, 'label': pageContext.customerAndSitesData[0].siteName }); pageContext.customer.push({ 'value': pageContext.customerAndSitesData[0].customerId, 'label': pageContext.customerAndSitesData[0].customerName }); } } else if (pageContext.maintenancePlanAction === 'edit' || pageContext.maintenancePlanAction === 'view') { pageContext.maintenanceScheduleData = pageContext.assetMaintenanceScheduleData.filter(element => (typeof element.workOrderId === 'undefined' || element.workOrderId === '')); pageContext.selectedSites = []; pageContext.selectedAssets = []; pageContext.customer = []; pageContext.taskType = []; pageContext.workOrderTemplate = []; if (typeof pageContext.contractId !== 'undefined' && pageContext.contractId !== '') { pageContext.contract = []; pageContext.contract.push({ 'value': pageContext.contractId, 'label': pageContext.contractNumber }); } else { pageContext.contractEndDate = '-'; pageContext.calendarName = '-'; } if (typeof pageContext.contractEndDate === 'undefined' || pageContext.contractEndDate === '') { pageContext.contractEndDate = '-'; } pageContext.customer.push({ 'value': pageContext.customerId, 'label': pageContext.companyName }); pageContext.taskType.push({ 'value': pageContext.taskTypeId, 'label': pageContext.taskTypeName }); pageContext.workOrderTemplate.push({ 'value': pageContext.workOrderTemplateId, 'label': pageContext.workOrderTemplateV2Name }); if (typeof pageContext.assetMaintenancePlanInstalledBaseData !== 'undefined' && pageContext.assetMaintenancePlanInstalledBaseData.length > 0) { pageContext.assetMaintenancePlanInstalledBaseData.forEach(element => { pageContext.selectedAssets.push({ 'value': element.installedBaseId, 'label': element.catalogName }); }); } if (typeof pageContext.assetMaintenancePlanSiteData !== 'undefined' && pageContext.assetMaintenancePlanSiteData.length > 0) { pageContext.assetMaintenancePlanSiteData.forEach(element => { pageContext.selectedSites.push({ 'value': element.siteId, 'label': element.siteName }); }) }; if (pageContext.maintenancePlanAction === 'edit') { pageContext.firstMaintenanceDate = ''; pageContext.initialSelectedSites = []; pageContext.initialSelectedAssets = []; pageContext.initialMaintenanceScheduleData = Array.from(pageContext.maintenanceScheduleData); pageContext.initialDescription = pageContext.description; pageContext.initialEndDate = pageContext.endDate; pageContext.initialWorkOrderTemplate = pageContext.workOrderTemplate[0].value; pageContext.initialTasktype = pageContext.taskType[0].value; pageContext.initialCustomer = pageContext.customer[0].value; for (var i = 0; i < pageContext.selectedSites.length; i++) { pageContext.initialSelectedSites.push(pageContext.selectedSites[i].value); } for (var i = 0; i < pageContext.selectedAssets.length; i++) { pageContext.initialSelectedAssets.push(pageContext.selectedAssets[i].value); } if (Array.isArray(pageContext.contract) && pageContext.contract.length > 0) { pageContext.initialContract = pageContext.contract[0].value; } } } }"},{"name":"setSubAction","type":"script","actionDef":"function (pageContext) { pageContext.subAction = 'createMaintenanceSchedule'; }"},{"name":"setMaintenancePlanAction","type":"script","actionDef":"function (pageContext) { pageContext.subAction = 'upsertAssetMaintenancePlan'; pageContext.statusId = 'assetMaintenancePlanActive'; pageContext.statusTargetModel = 'assetMaintenancePlan'; pageContext.scheduleGenerated = false; if (Array.isArray(pageContext.contract) && pageContext.contract.length > 0 && pageContext.contract[0] !== null) { pageContext.contractId = pageContext.contract[0].value; } else if(pageContext.maintenancePlanAction === 'edit'){ pageContext.contractId = ''; } }"},{"name":"setGridData","type":"script","actionDef":"function (pageContext) {pageContext.scheduleGenerated = true;if (Array.isArray(pageContext.outputData) && pageContext.outputData.length > 0) {pageContext.maintenanceScheduleData = pageContext.outputData[0].outputVar.assetMaintenanceScheduleData; } }"},{"name":"closePanel","type":"closePanel"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"openPreviousPanel","type":"backPanel"},{"name":"setPriority","type":"script","actionDef":"function (pageContext) { if (Array.isArray(pageContext.workOrderTemplateData) && pageContext.workOrderTemplateData.length > 0) { pageContext.workOrderPriority = pageContext.workOrderTemplateData[0].workOrderTemplatePriorityPriority; } }"},{"name":"closeModal","type":"closeModal"},{"name":"setDeleteSubAction","type":"script","actionDef":"function (pageContext) {pageContext.subAction = 'deleteAssetMaintenanceSchedule'; pageContext.assetMaintenanceSchedule = {'selectedSchedules': pageContext.maintenanceScheduleData}}"},{"falseStep":[],"trueStep":["@actions.setDeleteSubAction","@actions.deleteMaintenanceScheduleEvent"],"name":"isMaintenancePlanSaved","type":"decision","actionDef":"function (pageContext) {return (pageContext.scheduleGenerated)}"},{"endPoint":"process/start","name":"deleteMaintenanceScheduleEvent","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"processId":"assetMaintenanceScheduleWF","contextVar":{"subAction":"@pageContext.subAction","assetMaintenanceSchedule":"@pageContext.assetMaintenanceSchedule"}}]}},{"name":"setListOptionKeys","type":"script","actionDef":"function (pageContext) {if (pageContext.frequencyValue <= 1) { pageContext.listOptionAnswerkeys = ['day', 'week', 'month']; } else { pageContext.listOptionAnswerkeys = ['days', 'weeks', 'months']; } }"},{"name":"fetchListOptions","outputVarMap":{"data":"@pageContext.frequencyUnitOptions"},"type":"query","actionDef":{"filter":"{$listOption.id} = 'timeDuration' AND {$listOptionAnswerId} IN {@listOptionAnswerkeys}","models":["listOption","listOptionAnswer"],"columns":{"listOptionAnswerId":"listOptionAnswer.id","answerOptionText":"listOptionAnswer.answerOptionText"},"inputs":{"listOptionAnswerkeys":"@pageContext.listOptionAnswerkeys"},"translate":true}},{"falseStep":[],"trueStep":["@actions.fetchCustomerAndSites"],"name":"isModuleAssets","type":"decision","actionDef":"function (pageContext) {return (pageContext.module === 'assets')}"},{"name":"fetchCustomerAndSites","outputVarMap":{"data":"@pageContext.customerAndSitesData"},"type":"query","actionDef":{"filter":"{$siteId} = {@id}","models":["customer","site"],"inputs":{"id":"@pageContext.siteId"},"columns":{"customerId":"customer.id","siteId":"site.id","siteName":"site.name","customerName":"customer.companyName"},"outerJoinOnModel":"site"}},{"name":"clearSelectedPageContext","type":"script","actionDef":"function (pageContext) { if (pageContext.module === 'contracts') { pageContext.assetMaintenancePlanId = ''; pageContext.description = ''; pageContext.endDate = ''; } else { pageContext.assetMaintenancePlanId = ''; pageContext.description = ''; pageContext.contractId = ''; pageContext.contractNumber = ''; pageContext.endDate = ''; pageContext.contractEndDate = ''; pageContext.calendarName = ''; pageContext.slaId = ''; pageContext.calendarId = ''; } }"},{"falseStep":["@actions.clearSelectedAssets"],"trueStep":["@actions.setAssetsIdList","@actions.fetchAssetsInList","@actions.setSelectedAssets"],"name":"areAssetsSelected","type":"decision","actionDef":"function (pageContext) { return(Array.isArray(pageContext.selectedAssets) && pageContext.selectedAssets.length > 0 && pageContext.selectedAssets[0] !== null && Array.isArray(pageContext.sitesIdList) && pageContext.sitesIdList.length>0)}"},{"name":"setAssetsIdList","type":"script","actionDef":"function (pageContext) { pageContext.assetsIdList = []; pageContext.selectedAssets.forEach(element => { pageContext.assetsIdList.push(element.value); }); }"},{"name":"setSelectedAssets","type":"script","actionDef":"function (pageContext) { pageContext.selectedAssets = []; if(Array.isArray(pageContext.assetsListData) && pageContext.assetsListData.length>0){pageContext.assetsListData.forEach(element => { pageContext.selectedAssets.push({ value : element.installedBaseId, label : element.catalogName }); }); }}"},{"name":"fetchAssetsInList","outputVarMap":{"data":"@pageContext.assetsListData"},"type":"query","actionDef":{"filter":"{$installedBase.siteId} IN  {@sitesIdList} AND {$installedBaseId} IN  {@assetsIdList}","models":["installedBase","catalog"],"inputs":{"assetsIdList":"@pageContext.assetsIdList","sitesIdList":"@pageContext.sitesIdList"},"columns":{"catalogName":"catalog.name","installedBaseId":"installedBase.id"},"outerJoinOnModel":"installedBase"}},{"falseStep":["@actions.closePanel"],"trueStep":["@actions.openPreviousPanel"],"name":"isModuleContracts","type":"decision","actionDef":"function (pageContext) { return(pageContext.module === 'contracts')}"}]}