{"pageContext":{},"actionOnLoad":["@actions.setInitialData"],"localPageContext":true,"jslib":{"isAssetReactivateEnabled":"function (pageContext) { return (typeof pageContext.data[0].statusName !== 'undefined' && pageContext.data[0].statusName === 'Deactivated')}","isAssetSaveDisabled":"function (pageContext) { return (pageContext.initialSelectedCatalog == pageContext.selectedCatalog[0].value && pageContext.initialInstalledBaseSerialNo == pageContext.installedBaseSerialNo || (pageContext.initialInstalledBaseSerialNo === pageContext.installedBaseSerialNo && pageContext.initialInstalledBaseNotes === pageContext.installedBaseNotes));}","popUpText":"function (pageContext) { if (Array.isArray(pageContext.assetTasksData) && pageContext.assetTasksData.length > 0) { if (pageContext.assetTasksData[0].countOfOpen > 0) { return '@lang.[\"dtawrifatttihbatahnbdy\",\"Decommissioning this asset will remove it from all the tasks that have not been dispatched yet.\"]' } else return '@lang.[\"aysywtdta\",\"Are you sure you want to decommission this Asset?\"]' } }","isAssetDecommissionEnabled":"function(pageContext){ return !(pageContext.installedBaseAssetAction === 'edit' && pageContext.installedBaseStatusName === 'Active') }","isMaintenancePlanHidden":"function(pageContext){return(pageContext.installedBaseAssetAction==='add')}","dynamicHeaderText":"function (pageContext) { if (pageContext.installedBaseAssetAction === 'add') { return '@lang.[\"ana\",\"Add New Asset\"]' } else if (pageContext.installedBaseAssetAction === 'edit') { return 'Edit Asset' } }","isDecommisioned":"function(pageContext){ return (pageContext.installedBaseStatusName === 'Decommissioned') }","isAssetSaveContinueDisabled":"function (pageContext) { return (typeof pageContext.selectedCatalog === 'undefined' || pageContext.selectedCatalog[0] === null || typeof pageContext.installedBaseSerialNo === 'undefined' || pageContext.installedBaseSerialNo === '');}","isActionEdit":"function(pageContext){return(pageContext.installedBaseAssetAction==='edit')}","isActionAdd":"function(pageContext){return(pageContext.installedBaseAssetAction==='add')}","isAssetReactivateHidden":"function (pageContext) { return !(pageContext.installedBaseAssetAction === 'edit' && pageContext.installedBaseStatusName === 'Decommissioned') }","isLogsHidden":"function(pageContext){return(pageContext.installedBaseAssetAction==='add')}"},"header":{"children":[{"hidden":"@jslib.isActionAdd","statusColor":"@pageContext.installedBaseStatusNameColor","id":"status","type":"status","value":"@pageContext.installedBaseStatusName"},{"buttonType":"primary","hidden":"@jslib.isActionEdit","actionOnClick":["@actions.setSubActionUpsertInstalledBase","@actions.setInstallBaseStatusId","@actions.fireProcessEvent","@actions.changeAction","@actions.fetchStatusName","@actions.setStatus","@actions.setInitialData","@actions.refreshAssetsDataGrid","@actions.refreshCustomerSiteDataGrid"],"disabled":"@jslib.isAssetSaveContinueDisabled","id":"submitCustomerSiteAsset","type":"button","title":"@lang.['sc1','Save & Continue']"},{"buttonType":"primary","hidden":"@jslib.isActionAdd","actionOnClick":["@actions.setSubActionUpsertInstalledBase","@actions.fireProcessEvent","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isAssetSaveDisabled","id":"submitCustomerSiteAsset","type":"button","title":"@lang.['s12','Save']"},{"buttonType":"secondary","hidden":"@jslib.isAssetDecommissionEnabled","actionOnClick":["@actions.fetchTasksAttached","@actions.checkDecommissionStatus"],"id":"decommissionAsset","type":"button","title":"@lang.['d30','Decommission']"},{"buttonType":"secondary","hidden":"@jslib.isAssetReactivateHidden","actionOnClick":["@actions.setSubActionUpsertInstalledBase","@actions.setStatus","@actions.fireProcessEvent","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isAssetReactivateEnabled","id":"reactivateAsset","type":"button","title":"@lang.['r6','Reactivate']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"children":[{"actionOnChange":["@actions.isModelNameEmpty"],"optLabelMap":"modelName","optValueMap":"catalogId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$modelName} like {@filter} AND {$catalogTypeId}='partAndAsset'","models":["catalog","manufacturer","assetCategory"],"columns":{"modelName":"catalog.name","catalogId":"catalog.id","catalogManufacturerId":"catalog.manufacturerId","manufacturerId":"manufacturer.id","assetCategoryId":"catalog.assetCategoryId","catalogTypeId":"catalog.catalogTypeId","modelNumber":"catalog.modelNumber","assetCategoryName":"assetCategory.name","manufacturer":"manufacturer.name"},"outerJoinOnModel":"catalog","orderBy":"modelName ASC","distinct":true}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":" {$catalogId} = {@selectedCatalogId}","models":["catalog","manufacturer","assetCategory"],"columns":{"modelName":"catalog.name","catalogId":"catalog.id","catalogManufacturerId":"catalog.manufacturerId","manufacturerId":"manufacturer.id","assetCategoryId":"catalog.assetCategoryId","catalogTypeId":"catalog.catalogTypeId","modelNumber":"catalog.modelNumber","assetCategoryName":"assetCategory.name","manufacturer":"manufacturer.name"},"inputs":{"selectedCatalogId":"@pageContext.selectedId"},"outerJoinOnModel":"catalog"},"columnsToBeHidden":["catalogTypeId","catalogId","manufacturerId","catalogManufacturerId","assetCategoryId"],"selectedRowAdvanceGrid":"AdvancedGridCatalog","rowsToBeSelect":"selectedId","sourceType":"query","sidePanelTitle":"@lang.['sa2','Select Asset']","gridHeaderText":"@lang.['pc2','Parts Catalog']","customColumns":{"modelName":"@lang.['mn','Model Name']","modelNumber":"@lang.['mn1','Model Number']","assetCategoryName":"@lang.['cn5','Category Name']","manufacturer":"@lang.['m','Manufacturer']"},"searchKeys":["modelName","modelNumber","manufacturerId","manufacturer"]},"disabled":"@jslib.isActionEdit","label":"@lang.['mn','Model Name']","id":"selectedCatalog","type":"selectDropdown","value":"@pageContext.selectedCatalog"},{"readOnly":true,"inputType":"text","id":"manufacturer","label":"@lang.['m','Manufacturer']","placeholder":"@lang.['mibomn','Manufacturer is based on model name']","type":"input","value":"@pageContext.manufacturerName"},{"readOnly":true,"inputType":"text","id":"category","label":"@lang.['c33','Category']","placeholder":"@lang.['cibomn','Category is based on model name']","type":"input","value":"@pageContext.installedBaseCategoryName"},{"readOnly":true,"inputType":"text","id":"modelNumber","label":"@lang.['mn1','Model Number']","placeholder":"@lang.['mnibomn','Model number is based on model name']","type":"input","value":"@pageContext.catalogModelNumber"},{"isRequired":true,"disabled":"@jslib.isDecommisioned","id":"serialNumber","label":"@lang.['sn','Serial Number']","placeholder":"@lang.['eypsnosn','Enter your product serial no. or SKU no.']","type":"input","value":"@pageContext.installedBaseSerialNo"},{"disabled":"@jslib.isDecommisioned","id":"notes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.installedBaseNotes","placeHolder":"@lang.['en','Enter Notes (Optional)']"}],"label":"@lang.['ad2','Asset Details']","id":"Asset Details","type":"section"}],"label":"@lang.['ad2','Asset Details']","id":"Asset Details","type":"tab"},{"hidden":"@jslib.isMaintenancePlanHidden","children":[{"children":[{"id":"maintenanceScheduleDataGrid","type":"dataGrid","jsonDef":{"isScrollAble":false,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[]},"gridRefreshId":"maintenanceScheduleGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['si3','Schedule Id']","options":{"hidden":true,"flex":1,"showLabel":false},"key":"assetMaintenanceScheduleId","primaryKey":true},{"name":"@lang.['cwo1','Create Work Order']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"assetMaintenanceScheduleCreatedDate"},{"name":"@lang.['sd4','Scheduled Date']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"assetMaintenanceScheduleRequestedDate"},{"name":"@lang.['d4','Deadline']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"type":"date","showLabel":true},"key":"assetMaintenanceScheduleDeadline"},{"name":"@lang.['mp','Maintenance Plan']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"assetMaintenancePlanName"}],"dataToBeSent":{"filter":"{$assetMaintenancePlan.id} in ({@selectedPlanIds}) and {$assetMaintenancePlan.statusId} = 'assetMaintenancePlanActive' and  {$assetMaintenanceSchedule.workOrderId} = ''","models":["assetMaintenancePlan","assetMaintenanceSchedule"],"inputs":{"selectedPlanIds":{"filter":"{$installedBaseId} = {@selectedAsset}","models":["assetMaintenancePlanInstalledBase"],"columns":{"assetMaintenancePlanId":"assetMaintenancePlanInstalledBase.assetMaintenancePlanId","installedBaseId":"assetMaintenancePlanInstalledBase.installedBaseId"},"inputs":{"selectedAsset":"@pageContext.installedBaseId"},"selectColumns":["assetMaintenancePlanId"]}},"columns":{"assetMaintenanceScheduleRequestedDate":"assetMaintenanceSchedule.requestedDate","assetMaintenancePlanId":"assetMaintenancePlan.id","assetMaintenanceScheduleCreatedDate":"assetMaintenanceSchedule.createWorkOrderDate","assetMaintenanceScheduleId":"assetMaintenanceSchedule.id","assetMaintenancePlanName":"assetMaintenancePlan.name","assetMaintenanceScheduleDeadline":"assetMaintenanceSchedule.deadline"},"orderBy":"assetMaintenanceScheduleCreatedDate","distinct":true,"links":{"assetMaintenanceSchedule":"assetMaintenancePlan"},"getCount":true},"actionOnLoad":[],"dataSourceId":"query/read","jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['ms2','Maintenance Schedule']","children":[]},"isSelectable":false,"actions":[],"searchKeys":["assetMaintenancePlanName"]}}],"label":"","id":"maintenanceScheduleGrid","type":"section","transparent":true},{"children":[{"id":"workOrderDataGrid","type":"dataGrid","jsonDef":{"isScrollAble":false,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"tableWidth":"60rem","gridRefreshId":"workOrderGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['si3','Schedule Id']","options":{"hidden":true,"flex":1,"showLabel":false},"key":"assetMaintenanceScheduleId","primaryKey":true},{"name":"@lang.['s','Status']","options":{"flex":1,"sortOrder":"ASC","colorCode":"statusNameColor","sortable":true,"showLabel":true},"key":"statusName"},{"name":"@lang.['woi','Work Order Id']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"assetMaintenanceScheduleWorkOrderId"},{"name":"@lang.['woc','Work Order Created']","options":{"flex":1,"sortOrder":"ASC","type":"date","showLabel":true},"key":"assetMaintenanceScheduleCreatedDate"},{"name":"@lang.['ro','Requested On']","options":{"flex":1,"sortOrder":"ASC","type":"date","showLabel":true},"key":"assetMaintenanceScheduleRequestedDate"},{"name":"@lang.['d4','Deadline']","options":{"flex":1,"sortOrder":"ASC","type":"date","showLabel":true},"key":"assetMaintenanceScheduleDeadline"},{"name":"@lang.['c10','Closed']","options":{"flex":1,"type":"date","showLabel":true},"key":"workOrderCompletedDate"},{"name":"@lang.['mp','Maintenance Plan']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"assetMaintenancePlanName"}],"dataToBeSent":{"filter":"{$assetMaintenancePlan.id} in ({@selectedPlanIds}) and {$assetMaintenancePlan.statusId} = 'assetMaintenancePlanActive' and  {$assetMaintenanceSchedule.workOrderId} != ''","models":["assetMaintenancePlan","assetMaintenanceSchedule","workOrder","ZStatus"],"inputs":{"selectedPlanIds":{"filter":"{$installedBaseId} = {@selectedAsset}","models":["assetMaintenancePlanInstalledBase"],"columns":{"assetMaintenancePlanId":"assetMaintenancePlanInstalledBase.assetMaintenancePlanId","installedBaseId":"assetMaintenancePlanInstalledBase.installedBaseId"},"inputs":{"selectedAsset":"@pageContext.installedBaseId"},"selectColumns":["assetMaintenancePlanId"]}},"columns":{"assetMaintenanceScheduleRequestedDate":"assetMaintenanceSchedule.requestedDate","assetMaintenancePlanId":"assetMaintenancePlan.id","assetMaintenanceScheduleCreatedDate":"assetMaintenanceSchedule.createWorkOrderDate","statusName":"ZStatus.name","assetMaintenanceScheduleId":"assetMaintenanceSchedule.id","assetMaintenancePlanName":"assetMaintenancePlan.name","assetMaintenanceScheduleWorkOrderId":"assetMaintenanceSchedule.workOrderId","assetMaintenanceScheduleDeadline":"assetMaintenanceSchedule.deadline","statusNameColor":"ZStatus.colorCode","workOrderCompletedDate":"workOrder.completedDate"},"orderBy":"assetMaintenanceScheduleCreatedDate","distinct":true,"links":{"workOrder":"assetMaintenanceSchedule","assetMaintenanceSchedule":"assetMaintenancePlan","ZStatus":"workOrder"},"getCount":true},"actionOnLoad":[],"dataSourceId":"query/read","jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navWO','Work Orders']"},"isSelectable":false,"actions":[],"searchKeys":["statusName","assetMaintenancePlanName"]}}],"label":"","id":"workOrderDetails","type":"section","transparent":true}],"label":"@lang.['mp','Maintenance Plan']","type":"tab"},{"hidden":"@jslib.isLogsHidden","children":[{"children":[{"label":"","id":"assetLogs","type":"dataGrid","jsonDef":{"isScrollAble":true,"tableWidth":"70rem","searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['timeStamp','Timestamp']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"installedBaseLogLogDate"},{"name":"@lang.['e10','Event']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"installedBaseLogEvent"},{"name":"@lang.['mb1','Modified By']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"userName"},{"name":"@lang.['WorkOrderId','Work Order ID']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderTaskWorkOrderId"},{"name":"@lang.['taskType','Task Type']","options":{"flex":2,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"taskTypeName"},{"name":"@lang.['taskId','Task ID']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"installedBaseLogWorkOrderTaskId"}],"dataToBeSent":{"filter":"{$installedBaseLogInstalledBaseId} = {@installedBaseId}","models":["installedBaseLog","workOrderTask","User","taskType"],"columns":{"installedBaseLogWorkOrderTaskId":"installedBaseLog.workOrderTaskId","installedBaseLogLogDate":"installedBaseLog.logDate","installedBaseLogId":"installedBaseLog.id","installedBaseLogEvent":"installedBaseLog.event","installedBaseLogInstalledBaseId":"installedBaseLog.installedBaseId","workOrderTaskWorkOrderId":"workOrderTask.workOrderId","taskTypeName":"taskType.name","userName":"User.name"},"inputs":{"installedBaseId":"@pageContext.installedBaseId"},"name":"fetchAssetLogs","outerJoinOnModel":"installedBaseLog","orderBy":"installedBaseLogLogDate DESC","distinct":true,"description":"fetchAssetLogs","links":{"workOrderTask":"installedBaseLog","taskType":"installedBaseLog","User":"installedBaseLog"},"translate":true},"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['al2','Asset Logs']"},"isSelectable":false,"updateAllowed":true,"actions":[],"searchKeys":["installedBaseLogEvent","installedBaseLogWorkOrderTaskId","userName","workOrderTaskWorkOrderId","taskTypeName"]}}],"label":"","id":"assetLogGrid","type":"section","transparent":true}],"label":"@lang.['navL','Logs']","type":"tab"}],"label":"","type":"tab"}]},"actions":[{"name":"refreshAssetsDataGrid","gridId":["assetsDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"refreshCustomerSiteDataGrid","gridId":["customerSiteDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"closePanel","type":"closePanel"},{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { if (pageContext.installedBaseAssetAction === 'add') { pageContext.installedBaseId = ''; pageContext.manufacturerName = ''; pageContext.catalogModelNumber = ''; pageContext.installedBaseSerialNo = ''; pageContext.installedBasePurchasedDate = ''; pageContext.installedBaseInstalledDate = ''; pageContext.installedBaseLastVisitedDate = ''; pageContext.installedBaseDecommDate = ''; pageContext.installedBaseNotes = ''; pageContext.installedBaseCategoryName = ''; } else if (pageContext.installedBaseAssetAction === 'edit') { pageContext.initialInstalledBaseSerialNo = pageContext.installedBaseSerialNo; pageContext.initialInstalledBasePurchasedDate = pageContext.installedBasePurchasedDate; pageContext.initialInstalledBaseInstalledDate = pageContext.installedBaseInstalledDate; pageContext.initialInstalledBaseLastVisitedDate = pageContext.installedBaseLastVisitedDate; pageContext.initialInstalledBaseDecommDate = pageContext.installedBaseDecommDate; pageContext.initialInstalledBaseCatalogId = pageContext.installedBaseCatalogId; pageContext.initialInstalledBaseNotes = pageContext.installedBaseNotes; pageContext.initialInstalledBaseCategoryName = pageContext.installedBaseCategoryName; if(Array.isArray(pageContext.selectedCatalog)){ pageContext.selectedCatalog = pageContext.selectedCatalog; } else { pageContext.selectedCatalog = []; pageContext.selectedCatalog.push({ 'value': pageContext.catalogId, 'label': pageContext.catalogName }); } } }"},{"name":"getSelectedCatalogData","outputVarMap":{"data":"@pageContext.catalogData"},"type":"query","actionDef":{"filter":"{$catalogId} = {@catalogId}","models":["catalog","manufacturer","assetCategory"],"inputs":{"catalogId":"@pageContext.selectedCatalog[0].value"},"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","manufacturerName":"manufacturer.name","catalogModelNumber":"catalog.modelNumber","assetCategoryName":"assetCategory.name","categoryId":"catalog.assetCategoryId"},"outerJoinOnModel":"catalog"}},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"QPYBKL7WY1","contextVar":{"installedBase":[{"decommDate":"@pageContext.installedBaseDecommDate","catalogId":"@pageContext.installedBaseCatalogId","notes":"@pageContext.installedBaseNotes","statusId":"@pageContext.status","statusTargetModel":"installedBase","recver":"@pageContext.installedBaseRecver","siteId":"@pageContext.siteId","id":"@pageContext.installedBaseId","serialNo":"@pageContext.installedBaseSerialNo"}],"subAction":"@pageContext.subAction"}}]}},{"name":"setSubActionUpsertInstalledBase","type":"script","actionDef":"function(pageContext){pageContext.subAction = 'upsertInstalledBase';}"},{"falseStep":["@actions.setSelectedCatalogData"],"trueStep":["@actions.getSelectedCatalogData","@actions.setSelectedCatalogData"],"name":"isModelNameEmpty","type":"decision","actionDef":"function (pageContext) {return(pageContext.selectedCatalog[0])}"},{"name":"setSelectedCatalogData","type":"script","actionDef":"function (pageContext) { if (pageContext.catalogData && pageContext.selectedCatalog[0]) { pageContext.installedBaseCatalogId = pageContext.selectedCatalog[0].value; pageContext.manufacturerName = pageContext.catalogData[0].manufacturerName; pageContext.catalogModelNumber = pageContext.catalogData[0].catalogModelNumber; pageContext.installedBaseCategoryName = pageContext.catalogData[0].assetCategoryName; }; if (!pageContext.selectedCatalog || !pageContext.selectedCatalog[0]) { pageContext.manufacturerName = ''; pageContext.catalogModelNumber = ''; pageContext.installedBaseCategoryName = ''; } }"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"setInstallBaseStatusId","type":"script","actionDef":"function (pageContext) { if (pageContext.installedBaseAssetAction === 'add') { pageContext.status = 'installedBaseActive'; } }"},{"subTitle":"@jslib.popUpText","name":"decommissionAsset","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionUpsertInstalledBase","@actions.setStatus","@actions.fireProcessEvent","@actions.closeModal","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['c13','Continue']"}],"type":"openModal","title":"@lang.['da','Decommission Asset']"},{"name":"closeModal","type":"closeModal"},{"name":"setStatus","type":"script","actionDef":"function (pageContext) { if (pageContext.installedBaseStatusName === 'Decommissioned') { pageContext.status = 'installedBaseActive'; pageContext.installedBaseDecommDate = ''; pageContext.installedBaseDecommDate = ''; } else if (pageContext.installedBaseStatusName === 'Active') { pageContext.status = 'installedBaseDecommissioned'; pageContext.installedBaseDecommDate = new Date().toISOString().replace('T', ' ').replace('Z', ''); } else if (Array.isArray(pageContext.statusData)) { pageContext.installedBaseStatusName = pageContext.statusData[0].installedBaseStatusName; pageContext.installedBaseStatusNameColor = pageContext.statusData[0].installedBaseStatusNameColor; pageContext.status = 'installedBaseActive'; } }"},{"name":"changeAction","type":"script","actionDef":"function(pageContext) {pageContext.installedBaseAssetAction = 'edit'; pageContext.installedBaseId = pageContext.responseData[0].data[0].data[0].id }"},{"name":"fetchStatusName","outputVarMap":{"data":"@pageContext.statusData"},"type":"query","actionDef":{"filter":"{$installedBaseId} = {@installedBaseId}","models":["installedBase","ZStatus"],"inputs":{"installedBaseId":"@pageContext.installedBaseId"},"columns":{"installedBaseStatusNameColor":"ZStatus.colorCode","installedBaseStatusName":"ZStatus.name","installedBaseId":"installedBase.id"},"outerJoinOnModel":"installedBase"}},{"name":"fetchTasksAttached","outputVarMap":{"data":"@pageContext.assetTasksData"},"type":"query","actionDef":{"filter":"{$installedBaseId} = {@id}","models":["workOrderTaskInstalledBase","workOrderTask"],"inputs":{"id":"@pageContext.installedBaseId"},"columns":{"countOfInProgress":"COUNT(CASE WHEN {$workOrderTask.statusId} = 'workOrderTaskInProgress' OR {$workOrderTask.statusId} = 'workOrderTaskDispatched' OR {$workOrderTask.statusId} = 'workOrderTaskPendingReview' OR {$workOrderTask.statusId} = 'workOrderTaskDelayed' OR {$workOrderTask.statusId} = 'workOrderTaskDiscontinued' OR {$workOrderTask.statusId} = 'workOrderTaskIncident' OR {$workOrderTask.statusId} = 'workOrderTaskInTransit' THEN 1 ELSE NULL END)","countOfOpen":"COUNT(CASE WHEN {$workOrderTask.statusId} = 'workOrderTaskOpen' OR {$workOrderTask.statusId} = 'workOrderTaskReopened' OR {$workOrderTask.statusId} = 'workOrderTaskScheduled'  OR {$workOrderTask.statusId} = 'workOrderTaskDraft' THEN 1 ELSE NULL END)","countOfClose":"COUNT(CASE WHEN {$workOrderTask.statusId} = 'workOrderTaskCancelled' OR {$workOrderTask.statusId} = 'workOrderTaskCompleted' THEN 1 ELSE NULL END)","installedBaseId":"workOrderTaskInstalledBase.installedBaseId"},"links":{"workOrderTask":"workOrderTaskInstalledBase"},"getCount":true}},{"falseStep":["@actions.decommissionAsset"],"trueStep":["@actions.assetCantBeDecommissioned"],"name":"checkDecommissionStatus","type":"decision","actionDef":"function (pageContext) {if(Array.isArray(pageContext.assetTasksData) && pageContext.assetTasksData.length > 0){return(pageContext.assetTasksData[0].countOfInProgress > 0)}}"},{"subTitle":"@lang.[\"tacbdbtaoomtippcotf\",\"This asset cannot be decommissioned because there are one or more tasks in progress. Please cancel ongoing tasks first.\"]","name":"assetCantBeDecommissioned","options":[{"buttonType":"primary","name":"yes","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['o2','OK']"}],"type":"openModal","title":"@lang.['da','Decommission Asset']"}]}