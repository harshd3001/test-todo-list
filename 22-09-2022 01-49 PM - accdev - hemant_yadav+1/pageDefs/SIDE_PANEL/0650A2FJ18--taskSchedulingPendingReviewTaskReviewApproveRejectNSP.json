{"pageContext":{},"actionOnLoad":[],"localPageContext":true,"jslib":{"isActionApprove":"function (pageContext) { return (pageContext.taskReviewResult === 'approve')}","isActionReject":"function (pageContext) { return (pageContext.taskReviewResult === 'reject')}","isSubmitDisabled":"function (pageContext) { if (pageContext.taskReviewResult === 'reject' && ((typeof pageContext.rejectionReason === 'undefined' || pageContext.rejectionReason === '') || (typeof pageContext.taskReviewLogAction === 'undefined' || pageContext.taskReviewLogAction === ''))) { return true; }else { return false; } }","dynamicHeaderText":"function (pageContext) { if (pageContext.taskReviewResult === 'approve') { return 'Task Approval' } else if (pageContext.taskReviewResult === 'reject') { return 'Task Rejection' }}"},"header":{"leftData":{"children":[{"icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel"],"id":"back","type":"buttonIcon"}]},"children":[{"buttonType":"primary","hidden":"@jslib.isActionApprove","actionOnClick":["@actions.fetchCrewLeadData","@actions.setSubAction","@actions.setModalAction","@actions.rejectDecisionAction"],"disabled":"@jslib.isSubmitDisabled","id":"reject","type":"button","title":"@lang.['r4','Reject']"},{"buttonType":"primary","hidden":"@jslib.isActionReject","actionOnClick":["@actions.setSubAction","@actions.fetchTaskDependencyCheck","@actions.setDependencyCheck","@actions.decisionAction"],"disabled":"@jslib.isSubmitDisabled","id":"approve","type":"button","title":"@lang.['a1','Approve']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"hidden":"@jslib.isActionReject","children":[{"inputType":"text","id":"taskReviewLogReviewNotes","label":"@lang.['rn','Review Notes (Optional)']","type":"textarea","value":"@pageContext.taskReviewLogReviewNotes","placeHolder":"@lang.['en2','Enter notes']"}],"id":"reviewNotes","label":"","type":"section"},{"hidden":"@jslib.isActionApprove","children":[{"options":"@pageContext.listOption","optTitleKey":"listOptionAnswerOptionText","optValueKey":"listOptionAnswerOptionId","id":"rejectionReason","title":"@lang.['rejectionReason','Rejection Reason']","type":"select","value":"@pageContext.rejectionReason","placeHolder":"@lang.['selectReason','Select reason']"},{"inputType":"text","id":"taskReviewLogReviewNotes","label":"@lang.['rn','Review Notes (Optional)']","type":"textarea","value":"@pageContext.taskReviewLogReviewNotes","placeHolder":"@lang.['en2','Enter notes']"},{"isRequired":true,"options":[{"name":"@lang.['sbtst','Send back to same technician']","id":"workOrderTaskDispatched"},{"name":"@lang.['rfsar','Reopen for scheduling and reassignment']","id":"workOrderTaskReopened"}],"id":"taskReviewLogAction","optTitleKey":"name","optValueKey":"id","title":"@lang.['ta','Task Action']","type":"select","value":"@pageContext.taskReviewLogAction","placeHolder":"@lang.['sns','Select next step']"}],"id":"rejectNotes","label":"","type":"section"}]},"actions":[{"name":"clearPageContext","type":"clearPageContext"},{"name":"setSubAction","type":"script","actionDef":"function (pageContext) { pageContext.subAction = pageContext.taskReviewResult; if (pageContext.subAction === 'approve') { pageContext.statusId = 'workOrderTaskCompleted'; pageContext.eventType = 'workOrderTaskCompleted';} if (pageContext.subAction === 'reject') { pageContext.statusId = pageContext.taskReviewLogAction; var reOpenCount = parseInt(pageContext.workOrderTaskReOpenCount); pageContext.workOrderTaskReOpenCount = ++reOpenCount; if (pageContext.taskReviewLogAction === 'workOrderTaskDispatched') { pageContext.instanceSubAction = 'createInstance'; pageContext.eventType = 'workOrderTaskRejected';} else if (pageContext.taskReviewLogAction === 'workOrderTaskReopened') { pageContext.workOrderTaskAssignedToUserId = ''; pageContext.workOrderTaskAssignedToCrewId = '';pageContext.eventType = 'workOrderTaskReopened'; } } }"},{"endPoint":"process/start","name":"fetchTaskDependencyCheck","outputVarMap":{"data":"@pageContext.dependencyCheckData"},"type":"api","actionDef":{"data":[{"inputVar":{},"processId":"taskSchedulingTaskDependencyCheckWF","contextVar":{"dependentTaskStatusId":"@pageContext.statusId","workOrderTaskId":"@pageContext.workOrderTaskId","workOrderId":"@pageContext.workOrderId"}}]}},{"name":"setDependencyCheck","type":"script","actionDef":"function (pageContext) {if(typeof pageContext.dependencyCheckData !== 'undefined' && pageContext.dependencyCheckData !== '') {pageContext.dependencyCheck = pageContext.dependencyCheckData[0].outputVar.dependencyCheck;} }"},{"falseStep":["@actions.fireProcessEventForTaskReviewLogWF","@actions.fireProcessEventForWorkOrderTask","@actions.closePanel","@actions.refreshDataGrid"],"trueStep":["@actions.rejectIsNotPossible"],"name":"rejectDecisionAction","type":"decision","actionDef":"function(pageContext){return(pageContext.modalAction === 'rejectNotAllowed')}"},{"subTitle":"@lang.['utstbttcstclhbdaaclorttfsartp','Unable to send task back to the Crew since the Crew Lead has been deactivated. Assign another Crew Lead or reopen the task for scheduling and reassignment to proceed.']","name":"rejectIsNotPossible","options":[{"buttonType":"primary","name":"yes","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['o2','OK']"}],"type":"openModal","title":"@lang.['cld','Crew Lead Deactivated']"},{"name":"setModalAction","type":"script","actionDef":"function (pageContext) { pageContext.modalAction = ''; if (pageContext.taskReviewResult === 'reject' && typeof pageContext.crewLeadData !== 'undefined' && pageContext.crewLeadData.length > 0 && pageContext.crewLeadData[0].workforceCrewStatusId !== 'workforceCrewOnCrew' && typeof pageContext.taskReviewLogAction !== 'undefined' && pageContext.taskReviewLogAction !== '' && pageContext.taskReviewLogAction === 'workOrderTaskDispatched') { pageContext.modalAction = 'rejectNotAllowed'; } else { pageContext.modalAction = 'rejectAllowed'; } }"},{"name":"fetchCrewLeadData","outputVarMap":{"data":"@pageContext.crewLeadData"},"type":"query","actionDef":{"filter":"{$workOrderTaskId}={@workOrderTaskId} && {$crewStatusId}='crewDraft'","models":["crew","workOrderTask"],"inputs":{"workOrderTaskId":"@pageContext.workOrderTaskId"},"columns":{"workOrderTaskId":"workOrderTask.id","crewStatusId":"crew.statusId"},"distinct":true,"links":{"workOrderTask":"crew"}}},{"falseStep":["@actions.fireProcessEventForTaskReviewLogWF","@actions.fireProcessEventForWorkOrderTask","@actions.closePanel","@actions.refreshDataGrid"],"trueStep":["@actions.openModalOverrideDependency"],"name":"decisionAction","type":"decision","actionDef":"function (pageContext) {return pageContext.dependencyCheck; }"},{"subTitle":"@lang.['ttshapddywtotdacwa','This task still has a pending dependency. Do you want to override the dependency and continue with approval?']","name":"openModalOverrideDependency","options":[{"buttonType":"secondary","name":"no","actionOnClick":["@actions.closeModal"],"type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal","@actions.setDependencyOverrideSourceReview","@actions.openOverrideNSP"],"type":"button","title":"@lang.['c13','Continue']"}],"type":"openModal","title":"@lang.['at6','Approve Task']"},{"name":"closeModal","type":"closeModal"},{"endPoint":"process/start","name":"fireProcessEventForTaskReviewLogWF","type":"api","actionDef":{"data":[{"processId":"V4NYJ58HL1","contextVar":{"listOptionAnswerId":"@pageContext.rejectionReason","statusId":"@pageContext.statusId","subAction":"@pageContext.taskReviewResult","workOrderTaskId":"@pageContext.workOrderTaskId","taskReviewLogAction":"@pageContext.taskReviewLogAction","taskReviewLogReviewNotes":"@pageContext.taskReviewLogReviewNotes"}}]}},{"endPoint":"batch/apis","name":"fireProcessEventForWorkOrderTask","type":"api","actionDef":{"data":[{"workOrderTaskWF":{"data":[{"processId":"QIFGIU7FDJ","contextVar":{"workOrderTask":{"processInstanceId":"@pageContext.workOrderTaskProcessInstanceId","assignedToUserId":"@pageContext.workOrderTaskAssignedToUserId","statusId":"@pageContext.statusId","statusTargetModel":"workOrderTask","taskTypeWebTask":"@pageContext.taskTypeWebTask","cancellationNotes":"@pageContext.workOrderTaskCancellationNotes","recver":"@pageContext.workOrderTaskRecver","eventType":"@pageContext.eventType","id":"@pageContext.workOrderTaskId","assignedToCrewId":"@pageContext.workOrderTaskAssignedToCrewId","reopenCount":"@pageContext.workOrderTaskReOpenCount"},"subAction":"upsertWorkOrderTask"}}],"actionUrl":"process/start"}}]}},{"name":"setDependencyOverrideSourceReview","type":"script","actionDef":"function (pageContext) {pageContext.dependencyOverrideSource = 'review';}"},{"name":"openOverrideNSP","type":"openPanel","pageId":"7EXQWZDPS8"},{"name":"closePanel","type":"closePanel"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"openPreviousPanel","type":"backPanel"}]}