{"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"contextVar.noOfAllTechsBatches = Math.ceil(contextVar.allTechsCount / contextVar.customBatchSize);contextVar.newAllTechsBatchNumber = contextVar.allTechsBatchNumber + 1;","id":"findNumberOfBatches","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchTechsData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"contextVar.noOfAllTechsBatches >= 2 && contextVar.noOfAllTechsBatches >= contextVar.newAllTechsBatchNumber","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchUnavailableTechniciansPartOfCrew"}],"name":"start","description":"Start","nodeType":"START"},"isEligibleTechnicianIdsListPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"initializeParams"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isEligibleTechnicianIdsListPresent","description":"Use this for decision in workflow","processRule":"(typeof contextVar.finalFilteredUserIdList !== 'undefined' && contextVar.finalFilteredUserIdList !== '' && typeof contextVar.finalFilteredUserIdList[contextVar.workOrderTaskIdList[0]]!=='undefined' && contextVar.finalFilteredUserIdList[contextVar.workOrderTaskIdList[0]].length > 0)","id":"isEligibleTechnicianIdsListPresent","nodeType":"DECISION"},"fetchUnavailableTechniciansPartOfCrew":{"connectors":[{"exitPortType":"NextStep","nodeId":"getEligibleTechnicianIds"}],"processId":"workforceFieldForceCrewFetchUnavailableTechsWF","name":"fetchUnavailableTechniciansPartOfCrew","description":"fetchUnavailableTechniciansPartOfCrew","inputVarMap":{"startDateFilter":"startDateFilter","endDate":"endDate","endDateFilter":"endDateFilter","startDate":"startDate"},"outputVarMap":{"unavailableTechs":"unavailableTechs"},"nodeType":"WORKFLOW"},"workflowNodes":["start","fetchUnavailableTechniciansPartOfCrew","getEligibleTechnicianIds","isEligibleTechnicianIdsListPresent","initializeParams","getMobileTechnicianData","findNumberOfBatches","areMoreTechsPresent","fetchTechsData","appendTechs","end"],"initializeParams":{"connectors":[{"exitPortType":"NextStep","nodeId":"getMobileTechnicianData"}],"contextChangePermitted":true,"name":"initializeParams","description":"Initialize params for workflow","processRule":"{ if (typeof contextVar === 'undefined' || typeof contextVar.filter === 'undefined' || contextVar.filter === '') { contextVar.allTechsFilter = '{$UserGroup.groupId} IN {@userGroupGroupId} AND {$User.status} != {@userStatus} AND {$workforce.statusId} = {@workforceStatusId} AND ({$workforce.workforceType} = {@technician} OR {$workforce.workforceType} IS NULL)'; } else { contextVar.allTechsFilter = '(' + contextVar.filter + ') AND {$UserGroup.groupId} IN {@userGroupGroupId} AND {$User.status} != {@userStatus} AND {$workforce.statusId} = {@workforceStatusId} AND ({$workforce.workforceType} = {@technician} OR {$workforce.workforceType} IS NULL)'; } taskId = contextVar.workOrderTaskIdList[0]; if (Array.isArray(contextVar.finalFilteredUserIdList[taskId]) && contextVar.finalFilteredUserIdList[taskId].length > 0) { contextVar.finalUserIdList = contextVar.finalFilteredUserIdList[taskId]; if (typeof contextVar.finalUserIdList !== 'undefined' && contextVar.finalUserIdList.length > 0) { contextVar.allTechsFilter = contextVar.allTechsFilter + ' AND {$workforceUserId} IN {@finalUserIdList}'; } } if (Array.isArray(contextVar.unavailableTechs) && contextVar.unavailableTechs.length > 0) { contextVar.allTechsFilter = contextVar.allTechsFilter + ' AND {$workforce.userId} NOT IN {@unavailableTechs}'; } }","id":"initializeParams","nodeType":"PROCESS"},"appendTechs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTechs","description":"appendTechs","processRule":"{if (Array.isArray(contextVar.techDataToAppend)) { contextVar.technicianListData = contextVar.technicianListData.concat(contextVar.techDataToAppend); } contextVar.newAllTechsBatchNumber = contextVar.newAllTechsBatchNumber + 1;}","id":"appendTechs","nodeType":"PROCESS"},"workflowContext":{"customBatchSize":1000,"userStatus":"Deactivated","newTechBatchNumber":0,"noOfAllTechniciansBatches":0,"workforceStatusFilter":"workforceActive","workforceType":"webUser","noOfBatchesOfTech":0,"technician":"technician","workforceStatusId":"workforceActive","userStatusFilter":"Deactivated"},"getEligibleTechnicianIds":{"connectors":[{"exitPortType":"NextStep","nodeId":"isEligibleTechnicianIdsListPresent"}],"processId":"workGroupFilterForTechniciansAndTasksWF","name":"getEligibleTechnicianIds","description":"getEligibleTechnicianIds","inputVarMap":{"workOrderTaskIdList":"workOrderTaskIdList"},"outputVarMap":{"finalFilteredUserIdList":"finalFilteredUserIdList"},"nodeType":"WORKFLOW"},"getMobileTechnicianData":{"models":["UserGroup","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"userStatus":"User.status","timezoneOffset":"workforce.timezoneOffset","userPhoneNumber":"User.phoneNumber","userEmail":"User.emailId","userName":"User.name","workforceUserId":"workforce.userId","userId":"User.id","workforceCalendarId":"workforce.calendarId"},"description":"getMobileTechnicianData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","userStatus":"userStatus","allTechsFilter":"filter","technician":"technician","finalUserIdList":"finalUserIdList","workforceStatusId":"workforceStatusId","unavailableTechs":"unavailableTechs","userGroupGroupId":"userGroupGroupId"},"nodeType":"QUERY","filter":"filter","name":"getMobileTechnicianData","links":{"User":"UserGroup","workforce":"User"},"outputVarMap":{"data":"technicianListData","count":"allTechsCount","batchNumber":"allTechsBatchNumber"},"batchSize":"batchSize","getCount":true},"end":{"name":"End","description":"end","inputVarMap":{"technicianListData":"technicianListData"},"outputVarMap":{"technicianListData":"technicianListData"},"id":"end","nodeType":"END"},"fetchTechsData":{"models":["UserGroup","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTechs"}],"columns":{"userStatus":"User.status","timezoneOffset":"workforce.timezoneOffset","userPhoneNumber":"User.phoneNumber","userEmail":"User.emailId","userName":"User.name","workforceUserId":"workforce.userId","userId":"User.id","workforceCalendarId":"workforce.calendarId"},"orderBy":"userName ASC","description":"Fetch Task Details","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","userStatus":"userStatus","allTechsFilter":"filter","newAllTechsBatchNumber":"batchNumber","finalFilteredUserIdList":"finalFilteredUserIdList","workforceStatusId":"workforceStatusId","unavailableTechs":"unavailableTechs"},"nodeType":"QUERY","filter":"filter","name":"fetchTechsData","links":{"User":"UserGroup","workforce":"User"},"id":"fetchTechsData","outputVarMap":{"data":"techDataToAppend"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"}}