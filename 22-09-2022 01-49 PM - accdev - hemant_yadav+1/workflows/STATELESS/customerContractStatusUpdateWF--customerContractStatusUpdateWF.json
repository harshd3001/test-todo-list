{"workflowContext":{"customBatchSize":1000},"fetchAllContractsData":{"filter":"{$statusId}!= 'contractDeactivated'","models":["contract"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfAllContractsBatches"}],"columns":{"statusId":"contract.statusId","endDate":"contract.endDate","recver":"contract.recver","contractNumber":"contract.contractNumber","id":"contract.id","startDate":"contract.startDate"},"name":"fetchAllContractsData","distinct":true,"description":"fetchAllContractsData","inputVarMap":{"customBatchSize":"batchSize"},"outputVarMap":{"data":"allContractsData","count":"allContractsDataCount","batchNumber":"allContractsBatchNumber"},"batchSize":"batchSize","nodeType":"QUERY","getCount":true},"fetchMoreAllContractsData":{"filter":"{$statusId}!= 'contractDeactivated'","models":["contract"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfAllContractsBatches"}],"columns":{"statusId":"contract.statusId","endDate":"contract.endDate","recver":"contract.recver","contractNumber":"contract.contractNumber","id":"contract.id","startDate":"contract.startDate"},"name":"fetchMoreAllContractsData","distinct":true,"description":"fetchMoreAllContractsData","inputVarMap":{"customBatchSize":"batchSize","allContractsBatchNumber":"batchNumber"},"outputVarMap":{"data":"allContractsData"},"batchSize":"batchSize","nodeType":"QUERY"},"processContractData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfAnyContractsToBeUpdated"}],"contextChangePermitted":true,"name":"processContractData","description":"process allContractsData to set the statusId","processRule":"{ if (typeof contextVar.allContractsData != 'undefined' && contextVar.allContractsData != '' && contextVar.allContractsData.length > 0) { contextVar.jsonObj = []; var updated = false; var currentDate = new Date(); var startDate, endDate; contextVar.allContractsData.forEach(function (element) { updated = false; if (typeof element.startDate !== 'undefined' && element.startDate !== '') { startDate = new Date(element.startDate); if (startDate > currentDate) { if(element.statusId!=='contractNotStarted'){ updated=true; } element.statusId = 'contractNotStarted'; } } if (typeof element.endDate !== 'undefined' && element.endDate !== '') { endDate = new Date(element.endDate); if (endDate < currentDate) { if(element.statusId!=='contractExpired'){ updated=true; } element.statusId = 'contractExpired'; } } if (updated) { contextVar.jsonObj.push(element); } }); contextVar.allContractsData = []; } }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchAllContractsData"}],"name":"start","description":"Start","nodeType":"START"},"checkIfAnyContractsToBeUpdated":{"connectors":[{"exitPortType":"TrueStep","nodeId":"upsertContractModel"},{"exitPortType":"FalseStep","nodeId":"areMoreContractsPresent"}],"name":"checkIfAnyContractsToBeUpdated","description":"checkIfAnyContractsToBeUpdated","processRule":"typeof contextVar.jsonObj !== 'undefined' && contextVar.jsonObj !=='' && contextVar.jsonObj.length>0","nodeType":"DECISION"},"areMoreContractsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreAllContractsData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areMoreContractsPresent","description":"areMoreContractsPresent","processRule":"contextVar.noOfAllContractsBatches >= 2 && contextVar.noOfAllContractsBatches >= contextVar.allContractsBatchNumber","id":"areMoreContractsPresent","nodeType":"DECISION"},"end":{"name":"End","description":"end","nodeType":"END"},"findNumberOfAllContractsBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"processContractData"}],"contextChangePermitted":true,"name":"findNumberOfAllContractsBatches","description":"findNumberOfAllContractsBatches","processRule":"contextVar.noOfAllContractsBatches = Math.ceil(contextVar.allContractsDataCount / contextVar.customBatchSize);contextVar.allContractsBatchNumber = contextVar.allContractsBatchNumber + 1;","nodeType":"PROCESS"},"workflowNodes":["start","fetchAllContractsData","findNumberOfAllContractsBatches","processContractData","checkIfAnyContractsToBeUpdated","upsertContractModel","areMoreContractsPresent","fetchMoreAllContractsData","end"],"upsertContractModel":{"modelName":"contract","connectors":[{"exitPortType":"NextStep","nodeId":"areMoreContractsPresent"}],"multirecord":true,"name":"upsertContractModel","description":"upsertContractModel","inputVarMap":{"jsonObj":"data"},"nodeType":"MODEL","operation":4}}