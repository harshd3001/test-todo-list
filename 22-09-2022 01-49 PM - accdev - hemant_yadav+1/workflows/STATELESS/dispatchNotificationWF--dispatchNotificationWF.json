{"processNodeFetchUserName":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryForFetchUserName"}],"contextChangePermitted":true,"name":"processNodeFetchUserName","description":"Use this for processing data in workflow","processRule":"{contextVar.modifiedByUser= contextVar.taskData[0].modifiedByUser;}","id":"processNodeFetchUserName","nodeType":"PROCESS"},"fetchTaskLogData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkDataArray"}],"processId":"fetchTaskLogData","name":"fetchTaskLogData","description":"Provide some description for your workflow node","inputVarMap":{"workOrderTaskId":"taskId"},"id":"fetchTaskLogData","outputVarMap":{"taskLogData":"taskLogData"},"nodeType":"WORKFLOW"},"checkUnassignUserData":{"connectors":[{"exitPortType":"FalseStep","nodeId":"notifyAssignUserNode"},{"exitPortType":"TrueStep","nodeId":"notifyUnassignUserNode"}],"name":"checkUnassignUserData","description":"Use this for decision in workflow","processRule":"typeof contextVar.unassignUserId !== 'undefined' && contextVar.unassignUserId !=='' ","id":"checkUnassignUserData","nodeType":"DECISION"},"processNotificationData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isPartialAccess"}],"contextChangePermitted":true,"name":"processNotificationData","description":"Use this for processing data in workflow","processRule":"{ contextVar.modifiedByUser = contextVar.userData[0].modifiedByUser; contextVar.assignUserId = contextVar.taskData[0].assignedToUserId; contextVar.longTextAssigned = contextVar.notificationDataAssigned.longText; contextVar.shortTextAssigned = contextVar.notificationDataAssigned.shortText; for (var i = 1; i < contextVar.taskLogData.length; i++) { if (contextVar.taskLogData[0].log[0].statusId === 'workOrderTaskDispatched') { if (contextVar.taskLogData[i].log[0].statusId === 'workOrderTaskOpen') { break; } else if (contextVar.taskLogData[i].log[0].statusId === 'workOrderTaskDispatched') { contextVar.longTextUnassigned = contextVar.notificationDataUnassigned.longText; contextVar.shortTextUnassigned = contextVar.notificationDataUnassigned.shortText; contextVar.unassignUserId = contextVar.taskLogData[i].log[0].assignedToUserId; break; } else if (contextVar.taskLogData[i].log[0].statusId === 'workOrderTaskPendingReview') { contextVar.assignUserId = contextVar.taskData[0].assignedToUserId; contextVar.longTextAssigned = contextVar.notificationDataPendingReview.longText; contextVar.shortTextAssigned = contextVar.notificationDataPendingReview.shortText; contextVar.unassignUserId = ''; break; } } } contextVar.name = contextVar.userData[0].name; contextVar.siteName = contextVar.taskData[0].siteName; contextVar.customerName = contextVar.taskData[0].customerName; contextVar.taskType = contextVar.taskData[0].taskType; if (typeof contextVar.longTextAssigned !== 'undefined' && contextVar.longTextAssigned !== '' && typeof contextVar.shortTextAssigned !== 'undefined' && contextVar.shortTextAssigned !== '') { contextVar.longTextAssigned = contextVar.longTextAssigned.replace('{@siteName}', contextVar.siteName).replace('{@customerName}', contextVar.customerName).replace('{@taskType}', contextVar.taskType).replace('{@taskId}', contextVar.taskId); contextVar.shortTextAssigned = contextVar.shortTextAssigned.replace('{@taskType}', contextVar.taskType); contextVar.dataAssigned = { longText: contextVar.longTextAssigned, shortText: contextVar.shortTextAssigned, }; } if (typeof contextVar.longTextUnassigned !== 'undefined' && contextVar.longTextUnassigned !== '' && typeof contextVar.shortTextUnassigned !== 'undefined' && contextVar.shortTextUnassigned !== '') { contextVar.longTextUnassigned = contextVar.longTextUnassigned.replace('{@taskId}', contextVar.taskId).replace('{@workOrderId}', contextVar.workOrderId).replace('{@taskType}', contextVar.taskType).replace('{@name}', contextVar.name); contextVar.shortTextUnassigned = contextVar.shortTextUnassigned.replace('{@taskType}', contextVar.taskType); contextVar.dataUnassigned = { longText: contextVar.longTextUnassigned, shortText: contextVar.shortTextUnassigned }; } }","id":"processNotificationData","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryNodeForFetchingSiteDetails"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"processCrewUsersAfter":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkUnassignUserDataPartialAccess"}],"contextChangePermitted":true,"name":"processCrewUsersAfter","description":"Use this for processing data in workflow","processRule":"contextVar.assignedUserId = contextVar.loopUsers_currentElement.assignUserId;","id":"processCrewUsersAfter Data","nodeType":"PROCESS"},"isPartialAccess":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCrewDetails"},{"exitPortType":"FalseStep","nodeId":"checkUnassignUserData"}],"name":"isPartialAccess","description":"Use this for decision in workflow","processRule":"typeof contextVar.taskData!='undefined' && contextVar.taskData!='' && typeof contextVar.taskData[0].crewMobileAccess!='undefined' && contextVar.taskData[0].crewMobileAccess!='' && contextVar.taskData[0].crewMobileAccess=='partialAccess'; ","id":"isPartialAccess","nodeType":"DECISION"},"queryNodeForFetchingSiteDetails":{"filter":"{$taskId}={@workOrderTaskId}","models":["taskType","workOrderTask","workOrder","customer","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"processNodeFetchUserName"}],"columns":{"assignedToUserId":"workOrderTask.assignedToUserId","taskType":"taskType.name","modifiedByUser":"workOrderTask.modifiedByUser","siteName":"site.name.","crewMobileAccess":"taskType.crewMobileAccess","workOrderId":"workOrder.id","customerName":"customer.companyName","taskId":"workOrderTask.id"},"name":"queryNodeForFetchingSiteDetails","description":"Provide some description for your query","links":{"workOrder":"workOrderTask","workOrderTask":"site","taskType":"workOrderTask","site":"customer","customer":"workOrder"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"id":"queryNodeForFetchingSiteDetails","outputVarMap":{"data":"taskData"},"nodeType":"QUERY"},"workflowNodes":["start","queryNodeForFetchingSiteDetails","queryForFetchUserName","processNodeFetchUserName","fetchTaskLogData","checkDataArray","processNotificationData","isPartialAccess","fetchCrewDetails","processCrewUsers","loopUsers","processCrewUsersAfter","checkUnassignUserDataPartialAccess","notifyUnassignUserNodePartialAccess","checkUnassignUserData","notifyAssignUserNodePartialAccess","notifyAssignUserNode","notifyUnassignUserNode","end"],"checkUnassignUserDataPartialAccess":{"connectors":[{"exitPortType":"FalseStep","nodeId":"notifyAssignUserNodePartialAccess"},{"exitPortType":"TrueStep","nodeId":"notifyUnassignUserNodePartialAccess"}],"name":"checkUnassignUserDataPartialAccess","description":"Use this for decision in workflow","processRule":"typeof contextVar.unassignUserId !== 'undefined' && contextVar.unassignUserId !=='' ","id":"checkUnassignUserDataPartialAccess","nodeType":"DECISION"},"notifyAssignUserNode":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"multirecord":true,"name":"notifyAssignUserNode","description":"Provide some description for your notify node","inputVarMap":{"taskType":"taskType","longTextAssigned":"longText","assignUserId":"userId","dataPayload":"dataPayload","dataAssigned":"data","siteName":"siteName","shortTextAssigned":"shortText","customerName":"customerName"},"targetType":"user","id":"notifyAssignUserNode","outputVarMap":{},"notificationType":"push","nodeType":"NOTIFY"},"notifyUnassignUserNodePartialAccess":{"connectors":[{"exitPortType":"NextStep","nodeId":"notifyAssignUserNodePartialAccess"}],"name":"notifyUnassignUserNodePartialAccess","description":"Provide some description for your notify node","inputVarMap":{"taskType":"taskType","shortTextUnassigned":"shortText","longTextUnassigned":"longText","dataPayload":"dataPayload","siteName":"siteName","dataUnassigned":"data","assignedUserId":"userId","customerName":"customerName"},"targetType":"user","id":"notifyUnassignUserNodePartialAccess","outputVarMap":{"data":"outputContextVarKey"},"notificationType":"push","nodeType":"NOTIFY"},"loopUsers":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processCrewUsersAfter"},{"exitPortType":"FalseStep","nodeId":"end"}],"data":"assignUserId","name":"loopUsers","description":"","inputVarMap":{"assignUserId":"assignUserId"},"id":"loopUsers","outputVarMap":{},"nodeType":"FOREACHLOOP"},"workflowContext":{"notificationDataAssigned":{"longText":"You\u2019ve been assigned a new task: {@taskType} for {@customerName} at {@siteName}","shortText":"New Task: {@taskType}"},"dataPayload":{"targetType":"Task"},"notificationDataUnassigned":{"longText":"Task {@taskId}- {@taskType} for {@workOrderId} has been removed from your queue by {@name}","shortText":"Task Reassigned"},"notificationDataPendingReview":{"longText":"Task {@taskId} - {@taskType} has been rejected after review and reassigned to you.","shortText":"Task Rejected"}},"fetchCrewDetails":{"filter":"{$workOrderTaskId} ={@workOrderTaskId} && {$crewMemberStatus} ='workforceCrewOnCrew'","models":["workforceCrew","crew","workOrderTask","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processCrewUsers"}],"columns":{"workforceCrewWorkforceUserId":"workforceCrew.workforceUserId","workOrderTaskId":"workOrderTask.id","crewMemberStatus":"workforceCrew.statusId"},"name":"fetchCrewDetails","description":"To get the crew details","distinct":true,"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"links":{"User":"workforce","workforce":"workforceCrew","workforceCrew":"crew","crew":"workOrderTask"},"id":"fetchCrewDetails","outputVarMap":{"data":"crewDetailsList"},"nodeType":"QUERY"},"notifyUnassignUserNode":{"connectors":[{"exitPortType":"NextStep","nodeId":"notifyAssignUserNode"}],"name":"notifyUnassignUserNode","description":"Provide some description for your notify node","inputVarMap":{"taskType":"taskType","shortTextUnassigned":"shortText","longTextUnassigned":"longText","unassignUserId":"userId","dataPayload":"dataPayload","siteName":"siteName","dataUnassigned":"data","customerName":"customerName"},"targetType":"user","id":"notifyUnassignUserNode","outputVarMap":{"data":"outputContextVarKey"},"notificationType":"push","nodeType":"NOTIFY"},"notifyAssignUserNodePartialAccess":{"connectors":[{"exitPortType":"NextStep","nodeId":"loopUsers"}],"multirecord":true,"name":"notifyAssignUserNodePartialAccess","description":"Provide some description for your notify node","inputVarMap":{"taskType":"taskType","longTextAssigned":"longText","dataPayload":"dataPayload","dataAssigned":"data","siteName":"siteName","assignedUserId":"userId","shortTextAssigned":"shortText","customerName":"customerName"},"targetType":"user","id":"notifyAssignUserNodePartialAccess","outputVarMap":{},"notificationType":"push","nodeType":"NOTIFY"},"end":{"name":"end","description":"End","inputVarMap":{"unassignedTask":"data"},"outputVarMap":{"unassignedTask":"data"},"id":"end","nodeType":"END"},"checkDataArray":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processNotificationData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkDataArray","description":"Use this for decision in workflow","processRule":"(Array.isArray(contextVar.taskData) && contextVar.taskData.length > 0)&& (Array.isArray(contextVar.taskLogData)&& contextVar.taskLogData.length>0)","id":"checkDataArray","nodeType":"DECISION"},"queryForFetchUserName":{"filter":"{$id}={@modifiedByUser}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskLogData"}],"columns":{"name":"User.name","id":"User.id"},"name":"queryForFetchUserName","description":"Provide some description for your query","inputVarMap":{"modifiedByUser":"modifiedByUser"},"id":"queryForFetchUserName","outputVarMap":{"data":"userData"},"nodeType":"QUERY"},"processCrewUsers":{"connectors":[{"exitPortType":"NextStep","nodeId":"loopUsers"}],"contextChangePermitted":true,"name":"processCrewUsers","description":"Use this for processing data in workflow","processRule":"var userIdObj={};contextVar.assignUserId = [];if(Array.isArray(contextVar.crewDetailsList)){contextVar.crewDetailsList.forEach(function(obj){userIdObj={'assignUserId':obj['workforceCrewWorkforceUserId']};contextVar.assignUserId.push(userIdObj);});};","id":"processCrewUsers Data","nodeType":"PROCESS","jsEngine":"es6"}}