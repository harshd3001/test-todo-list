{"processScheduledDate":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkScheduledDateData"}],"contextChangePermitted":true,"name":"processScheduledDate","description":"processScheduledDate","processRule":"var currentDate = new Date(); if (new Date(contextVar.workOrderTaskData[0].workOrderTaskScheduledDate) < currentDate) { contextVar.scheduledDateIssue=true;}contextVar.endDate = contextVar.workOrderTaskData[0].workOrderTaskDueDate;contextVar.workforceUserId = contextVar.workOrderTaskData[0].workOrderTaskAssignedToUserId;contextVar.startDate = contextVar.workOrderTaskData[0].workOrderTaskScheduledDate;contextVar.workOrderId = contextVar.workOrderTaskData[0].workOrderId;contextVar.taskTypeCrewTask = contextVar.workOrderTaskData[0].taskTypeCrewTask;","nodeType":"PROCESS"},"fetchWorkOrderTaskData":{"filter":"{$workOrderTaskId} = {@workOrderTaskId}","models":["workOrderTask","workOrder","taskType","site","customer","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processScheduledDate"}],"columns":{"workOrderTaskAssignedToUserId":"workOrderTask.assignedToUserId","workOrderTaskStatusId":"workOrderTask.statusId","customerCompanyName":"customer.companyName","taskTypeName":"taskType.name","taskTypeCrewTask":"taskType.crewTask","userId":"User.id","customerSiteName":"site.name","workOrderTaskDueDate":"workOrderTask.dueDate","workOrderTaskTypeId":"workOrderTask.taskTypeId","workOrderTaskId":"workOrderTask.id","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id","assignee":"User.name"},"name":"fetchWorkOrderTaskData","description":"fetchWorkOrderTaskData","distinct":true,"links":{"workOrderTask":"workOrder","taskType":"workOrderTask","site":"workOrdertask","User":"workOrderTask","customer":"workOrder"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"workOrderTaskData"},"nodeType":"QUERY","getCount":true},"fetchTaskDependencyCheckData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkCrewTask"}],"contextChangePermitted":true,"processId":"taskSchedulingTaskDependencyCheckWF","name":"fetchTaskDependencyCheckData","description":"fetchTaskDependencyCheckData","inputVarMap":{"dependentTaskStatusId":"dependentTaskStatusId","workOrderTaskId":"workOrderTaskId","workOrderId":"workOrderId"},"id":"fetchTaskDependencyCheckData","outputVarMap":{"dependencyCheck":"dependencyIssue"},"nodeType":"WORKFLOW"},"fetchCrewName":{"filter":"{$workOrderTask.id} = {@workOrderTaskId}","models":["workOrderTask","crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"processCrewAssignee"}],"columns":{"crewId":"crew.id","workOrderTaskAssigneeToCrewId":"workOrderTask.assignedToCrewId","crewName":"crew.name"},"name":"fetchCrewName","description":"fetchCrewName","distinct":true,"links":{"workOrderTask":"crew"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"crewAssigneeName"},"nodeType":"QUERY","getCount":true},"processErrorMessages":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processErrorMessages","description":"processErrorMessages","processRule":"if (typeof contextVar.techCrewData !== 'undefined' && contextVar.techCrewData.length > 0) { contextVar.crewIssue = true; } ","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkWorkOrderTaskId"}],"name":"Start","description":"Start","nodeType":"START"},"checkWorkOrderTaskId":{"connectors":[{"exitPortType":"TrueStep","nodeId":"end"},{"exitPortType":"FalseStep","nodeId":"fetchWorkOrderTaskData"}],"name":"checkWorkOrderTaskId","description":"checkCrewTask","processRule":"(typeof contextVar.workOrderTaskId === 'undefined' || contextVar.workOrderTaskId === '') ","nodeType":"DECISION"},"fetchCrewAssignedData":{"filter":"((({$crew.startDate} BETWEEN {@startDate} AND {@endDate}) OR ({$crew.endDate} BETWEEN {@startDate} AND {@endDate}) OR ({@startDate} BETWEEN {$crew.startDate} AND {$crew.endDate}) OR ({@endDate} BETWEEN {$crew.startDate} AND {$crew.endDate})) AND {$workforceCrew.statusId} = {@workforceCrewStatusId} AND {$crew.statusId} != {@crewStatusId}) AND {$workforceCrew.workforceUserId} ={@workforceUserId}","models":["workforceCrew","crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"processErrorMessages"}],"columns":{"crewId":"workforceCrew.crewId"},"name":"fetchCrewAssignedData","description":"fetchCrewAssignedData","distinct":true,"links":{"workforceCrew":"crew"},"inputVarMap":{"workforceCrewStatusId":"workforceCrewStatusId","endDate":"endDate","crewStatusId":"crewStatusId","workforceUserId":"workforceUserId","startDate":"startDate"},"outputVarMap":{"data":"techCrewData"},"nodeType":"QUERY","getCount":true},"workflowNodes":["start","checkWorkOrderTaskId","fetchWorkOrderTaskData","processScheduledDate","checkScheduledDateData","fetchTaskDependencyCheckData","checkCrewTask","fetchCrewName","processCrewAssignee","fetchCrewAssignedData","processErrorMessages","end"],"checkScheduledDateData":{"connectors":[{"exitPortType":"TrueStep","nodeId":"end"},{"exitPortType":"FalseStep","nodeId":"fetchTaskDependencyCheckData"}],"name":"checkScheduledDateData","description":"checkScheduledDateData","processRule":"contextVar.scheduledDateIssue===true;","nodeType":"DECISION"},"processCrewAssignee":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processCrewAssignee","description":"processCrewAssignee","processRule":"{if(Array.isArray(contextVar.workOrderTaskData) && contextVar.workOrderTaskData.length > 0 && Array.isArray(contextVar.crewAssigneeName) && contextVar.crewAssigneeName.length>0){ contextVar.workOrderTaskData[0]['assignee']=contextVar.crewAssigneeName[0].crewName;}}","nodeType":"PROCESS"},"workflowContext":{"workforceCrewStatusId":"workforceCrewOnCrew","crewIssue":false,"crewStatusId":"crewDeactivated","scheduledDateIssue":false,"dependencyIssue":false},"end":{"name":"end","description":"End","inputVarMap":{"crewIssue":"crewIssue","scheduledDateIssue":"scheduledDateIssue","dependencyIssue":"dependencyIssue","workOrderTaskData":"workOrderTaskData"},"outputVarMap":{"crewIssue":"crewIssue","scheduledDateIssue":"scheduledDateIssue","dependencyIssue":"dependencyIssue","workOrderTaskData":"workOrderTaskData"},"nodeType":"END"},"checkCrewTask":{"connectors":[{"condition":"contextVar.taskTypeCrewTask!==true;","exitPortType":"NextStep","nodeId":"fetchCrewAssignedData"},{"condition":"contextVar.taskTypeCrewTask===true && typeof contextVar.timeFrameFilter !== 'undefined';","exitPortType":"NextStep","nodeId":"fetchCrewName"},{"condition":"contextVar.taskTypeCrewTask===true;","exitPortType":"NextStep","nodeId":"end"}],"name":"checkCrewTask","description":"checkCrewTask","processRule":"contextVar.taskTypeCrewTask===true;","nodeType":"MULTIDECISION"}}