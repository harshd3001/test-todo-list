{"pageContext":{},"actionOnLoad":["@actions.fireFetchStockLocationDataProcessEventWF","@actions.setFilter","@actions.fetchSiteIdForAssginedToUserId","@actions.initialData"],"localPageContext":true,"jslib":{"isRequestDetails2Hidden":"function (pageContext) {return !(pageContext.inventoryRequestAction == 'view');}","isReasonToCancelHidden":"function (pageContext) { return (pageContext.inventoryRequestStatusId !== 'inventoryRequestCancelled'); }","isModelNameHidden":"function (pageContext) {return !(pageContext.inventoryRequestAction === 'add')}","isSubmitHidden":"function (pageContext) {return (pageContext.inventoryRequestAction === 'edit' || pageContext.inventoryRequestAction === 'view');}","isRequestDetails1Hidden":"function (pageContext) {return !(pageContext.inventoryRequestAction == 'edit');}","isRequestDetailsHidden":"function (pageContext) {if (pageContext.inventoryRequestAction == 'add' && typeof pageContext.catalogId != 'undefined' && pageContext.catalogId != '') { return false; } else { return true; }}","isSaveHidden":"function (pageContext) {return (pageContext.inventoryRequestAction === 'add' || pageContext.inventoryRequestAction === 'view')}","isSubmitDisabled":"function (pageContext) {return (typeof pageContext.catalogId === 'undefined' || pageContext.catalogId === '' || typeof pageContext.inventoryRequestRequestedQty === 'undefined' || Number(pageContext.inventoryRequestRequestedQty) < 1 || pageContext.inventoryRequestRequestedQty === '' || typeof pageContext.siteId === 'undefined' || pageContext.siteId === '');}","dynamicHeaderText":"function (pageContext) { if (pageContext.inventoryRequestAction === 'add') { return 'New Inventory Request' } else if (pageContext.inventoryRequestAction === 'edit') { return '@lang.[\"edit\",\"Edit\"] ' + pageContext.inventoryRequestId; } else { return 'View ' + pageContext.inventoryRequestId; } }","isSaveDisabled":"function (pageContext) {function nullCheck(a) { return (typeof a === 'undefined' || a === '' || a === null) } function compareInitialChanged(a, b) { return a === b } if (pageContext.inventoryRequestStatusId === 'inventoryRequestCancelled') { return nullCheck(pageContext.inventoryRequestCancellationReason); } let quantityCheck = true; if (!nullCheck(pageContext.inventoryRequestRequestedQty) && Number(pageContext.inventoryRequestRequestedQty) > 0) { quantityCheck = compareInitialChanged(Number(pageContext.inventoryRequestRequestedQty), Number(pageContext.initialInventoryRequestRequestedQty)); } return ((compareInitialChanged(pageContext.catalogId, pageContext.initialCatalogId) && quantityCheck && compareInitialChanged(pageContext.siteId, pageContext.initialSiteId) && compareInitialChanged(pageContext.inventoryRequestDeliverBy, pageContext.initialInventoryRequestDeliverBy) && compareInitialChanged(pageContext.inventoryRequestNotes, pageContext.initialInventoryRequestNotes)) || nullCheck(pageContext.catalogId) || nullCheck(pageContext.inventoryRequestRequestedQty) || nullCheck(pageContext.siteId));}","isActionAdd":"function (pageContext) { return (pageContext.inventoryRequestAction === 'add') }"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel","@actions.refreshInventoryRequestGrid"],"type":"buttonIcon"}]},"children":[{"hidden":"@jslib.isActionAdd","statusColor":"@pageContext.inventoryRequestStatusNameColor","id":"status","type":"status","value":"@pageContext.inventoryRequestStatusName"},{"buttonType":"primary","hidden":"@jslib.isSubmitHidden","actionOnClick":["@actions.setDataToUpsert","@actions.upsertData","@actions.setFilterForIR","@actions.openPreviousPanel","@actions.clearData","@actions.refreshInventoryRequestGrid"],"disabled":"@jslib.isSubmitDisabled","id":"submit","type":"button","title":"@lang.['submitRequest','Submit Request']"},{"buttonType":"primary","hidden":"@jslib.isSaveHidden","actionOnClick":["@actions.setDataToUpsert","@actions.upsertData","@actions.setFilterForIR","@actions.openPreviousPanel","@actions.clearData","@actions.refreshInventoryRequestGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"hidden":"@jslib.isModelNameHidden","children":[{"actionOnChange":["@actions.setCatalogId","@actions.decisionActionToFetchData","@actions.setCatalogData"],"optLabelMap":"catalogName","optValueMap":"catalogId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"process/start","sourceType":"api","columns":["catalogId","catalogName","catalogModelNumber","manufacturerName","catalogTypeName","stockUnitName","catalogCustomerPrice","catalogUnitPrice"],"dataToBeSent":{"apiResponseParams":["count"],"inputVar":{},"processId":"KUK08XW4QQ","apiResponseFormat":true,"contextVar":{"filter":"@pageContext.staticFilter","searchText":"%%","catalogIdList":"@pageContext.catalogIdList"},"apiResponseObject":"catalogData"}},"isMainPage":false,"isAdvanceSearch":{"selectedRowAdvanceGrid":"AdvancedGridCatalog","rowsToBeSelect":"selectedId","columnsNotSelected":["catalogModelNumber","manufacturerName","catalogTypeName","stockUnitName","catalogCustomerPrice","catalogUnitPrice"],"tableHeaderDisplayOrder":["catalogName","catalogModelNumber","catalogTypeName","stockUnitName","catalogUnitPrice","catalogCustomerPrice","manufacturerName"],"rowsToSelectSourceType":"pageContext","customColumns":{"catalogName":"@lang.['mn','Model Name']","manufacturerName":"@lang.['m','Manufacturer']","catalogCustomerPrice":"@lang.['lp','List Price']","catalogModelNumber":"@lang.['mn1','Model Number']","catalogTypeName":"@lang.['t5','Type']","catalogUnitPrice":"@lang.['cp6','Cost Price']","stockUnitName":"@lang.['stockUnit','Stock Unit']"},"filter":"@pageContext.staticFilter","rowsToSelect":"@pageContext.catalogIdArray","columnsToBeHidden":["catalogId"],"dataSourceId":"pageContext","sourceType":"pageContext","sidePanelTitle":"@lang.['sm3','Select Model']","gridHeaderText":"@lang.['navC4','Catalog']","searchKeys":["catalogName","catalogModelNumber","catalogTypeName","stockUnitName","catalogUnitPrice","catalogCustomerPrice","manufacturerName"]},"label":"@lang.['mn','Model Name']","id":"selectDropdownForCatalog","type":"selectDropdown","value":"@pageContext.catalogDropdownData","placeHolder":"@lang.['so','Select option']"}],"label":"@lang.['mn','Model Name']","id":"modelNameSection","type":"section"},{"hidden":"@jslib.isRequestDetailsHidden","children":[{"children":[{"children":[{"readOnly":true,"id":"estQuantity","label":"@lang.['estimatedQuantity','Estimated Quantity']","type":"input","value":"@pageContext.estimatedQty"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"requestedDate","label":"@lang.['onHandQty','On Hand Qty']","type":"input","value":"@pageContext.inventoryQty"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"inputType":"number","id":"deliveredQuantity","label":"@lang.['rq1','Requested Quantity']","type":"input","value":"@pageContext.inventoryRequestRequestedQty"},{"actionOnChange":["@actions.setSiteIdAndFilter","@actions.fireFetchStockAvailabilityProcessEvent","@actions.processSiteData"],"isMultiSelect":false,"optLabelMap":"siteName","optValueMap":"siteId","searchByOptions":{"dataSourceId":"process/start","sourceType":"api","columns":[],"dataToBeSent":{"apiResponseParams":["count"],"inputVar":{},"processId":"UXT3UYWAPW","apiResponseFormat":true,"contextVar":{"filter":"({$siteName} like {@searchText} OR {$siteAddress} like {@searchText})"},"apiResponseObject":"sitesData"}},"label":"@lang.['dl','Destination Location']","id":"selectDropdownForDestinationLocation","type":"selectDropdown","value":"@pageContext.sourceSiteDropdownData","placeHolder":"@lang.['so','Select option']"},{"readOnly":true,"id":"destinationaddress","label":"@lang.['da1','Destination Address']","type":"input","value":"@pageContext.destinationSiteAddress"},{"minDate":"@pageContext.currentDateAndTime","id":"startDateTime","title":"@lang.['dlvrbyop','Deliver By ( Optional )']","type":"datetime","value":"@pageContext.inventoryRequestDeliverBy","placeHolder":"@lang.['sdb','Select Deliver By']"},{"id":"notes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.inventoryRequestNotes","placeHolder":"@lang.['en2','Enter notes']"},{"children":[{"children":[{"readOnly":true,"id":"workOrderID","label":"@lang.['WorkOrderId','Work Order ID']","type":"input","value":"@pageContext.workOrderId"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"taskID","label":"@lang.['taskId','Task ID']","type":"input","value":"@pageContext.workOrderTaskId"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"hidden":"@jslib.isReasonToCancelHidden","readOnly":true,"id":"reasonToCancel","label":"@lang.['rtc','Reason To Cancel']","type":"input","value":"@pageContext.inventoryRequestCancellationReason"}],"id":"requestDetailsSection","label":"@lang.['rd2','Request Details']","type":"section"},{"hidden":"@jslib.isRequestDetails1Hidden","children":[{"actionOnChange":["@actions.setCatalogId","@actions.decisionActionToFetchData","@actions.setCatalogData"],"optLabelMap":"catalogName","optValueMap":"catalogId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"process/start","sourceType":"api","columns":["catalogId","catalogName","catalogModelNumber","manufacturerName","catalogTypeName","stockUnitName","catalogCustomerPrice","catalogUnitPrice"],"dataToBeSent":{"apiResponseParams":["count"],"inputVar":{},"processId":"KUK08XW4QQ","apiResponseFormat":true,"contextVar":{"filter":"@pageContext.staticFilter","catalogIdList":"@pageContext.catalogIdList"},"apiResponseObject":"catalogData"}},"isMainPage":false,"isAdvanceSearch":{"selectedRowAdvanceGrid":"AdvancedGridCatalog","rowsToBeSelect":"selectedId","columnsNotSelected":["catalogModelNumber","manufacturerName","catalogTypeName","stockUnitName","catalogCustomerPrice","catalogUnitPrice"],"tableHeaderDisplayOrder":["catalogName","catalogModelNumber","catalogTypeName","stockUnitName","catalogUnitPrice","catalogCustomerPrice","manufacturerName"],"rowsToSelectSourceType":"pageContext","customColumns":{"catalogName":"@lang.['mn','Model Name']","manufacturerName":"@lang.['m','Manufacturer']","catalogCustomerPrice":"@lang.['lp','List Price']","catalogModelNumber":"@lang.['mn1','Model Number']","catalogTypeName":"@lang.['t5','Type']","catalogUnitPrice":"@lang.['cp6','Cost Price']","stockUnitName":"@lang.['stockUnit','Stock Unit']"},"filter":"@pageContext.staticFilter","rowsToSelect":"@pageContext.catalogIdArray","columnsToBeHidden":["catalogId"],"dataSourceId":"pageContext","sourceType":"pageContext","sidePanelTitle":"@lang.['sm3','Select Model']","gridHeaderText":"@lang.['navC4','Catalog']","searchKeys":["catalogName","catalogModelNumber","catalogTypeName","stockUnitName","catalogUnitPrice","catalogCustomerPrice","manufacturerName"]},"label":"@lang.['mn','Model Name']","id":"selectDropdownForCatalog","type":"selectDropdown","value":"@pageContext.catalogDropdownData","placeHolder":"@lang.['so','Select option']"},{"children":[{"children":[{"readOnly":true,"id":"modelNumber","label":"@lang.['mn1','Model Number']","type":"input","value":"@pageContext.catalogModelNumber"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"manufacturer","label":"@lang.['m','Manufacturer']","type":"input","value":"@pageContext.manufacturerName"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"category","label":"@lang.['c33','Category']","type":"input","value":"@pageContext.assetCategoryName"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"type","label":"@lang.['t5','Type']","type":"input","value":"@pageContext.catalogTypeName"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"stockUnit","label":"@lang.['stockUnit','Stock Unit']","type":"input","value":"@pageContext.stockUnitName"}],"flex":"3","type":"column"},{"children":[],"flex":"3","type":"column"}],"id":"","type":"row"},{"inputType":"number","id":"deliveredQuantity","label":"@lang.['rq1','Requested Quantity']","type":"input","value":"@pageContext.inventoryRequestRequestedQty"},{"actionOnChange":["@actions.setSiteIdAndFilter","@actions.fireFetchStockAvailabilityProcessEvent","@actions.processSiteData"],"isMultiSelect":false,"optLabelMap":"siteName","optValueMap":"siteId","searchByOptions":{"dataSourceId":"process/start","sourceType":"api","columns":[],"dataToBeSent":{"apiResponseParams":["count"],"inputVar":{},"processId":"UXT3UYWAPW","apiResponseFormat":true,"contextVar":{"filter":"({$siteName} like {@searchText} OR {$siteAddress} like {@searchText})"},"apiResponseObject":"sitesData"}},"hidden":false,"label":"@lang.['dl','Destination Location']","id":"selectDropdownForDestinationLocation","type":"selectDropdown","value":"@pageContext.sourceSiteDropdownData","placeHolder":"@lang.['so','Select option']"},{"readOnly":true,"id":"destinationaddress","label":"@lang.['da1','Destination Address']","type":"input","value":"@pageContext.destinationSiteAddress"},{"id":"startDateTime","title":"@lang.['dlvrbyop','Deliver By ( Optional )']","type":"datetime","value":"@pageContext.inventoryRequestDeliverBy","placeHolder":"@lang.['sdb','Select Deliver By']"},{"id":"notes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.inventoryRequestNotes","placeHolder":"@lang.['en2','Enter notes']"},{"children":[{"children":[{"readOnly":true,"id":"workOrderID","label":"@lang.['WorkOrderId','Work Order ID']","type":"input","value":"@pageContext.workOrderId"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"taskID","label":"@lang.['taskId','Task ID']","type":"input","value":"@pageContext.workOrderTaskId"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"hidden":"@jslib.isReasonToCancelHidden","readOnly":true,"id":"reasonToCancel","label":"@lang.['rtc','Reason To Cancel']","type":"input","value":"@pageContext.inventoryRequestCancellationReason"}],"id":"requestDetailsSection","label":"@lang.['rd2','Request Details']","type":"section"},{"hidden":"@jslib.isRequestDetails2Hidden","children":[{"children":[{"children":[{"readOnly":true,"id":"category","label":"@lang.['mn','Model Name']","type":"input","value":"@pageContext.catalogName"}],"flex":"3","type":"column"},{"children":[],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"modelNumber","label":"@lang.['mn1','Model Number']","type":"input","value":"@pageContext.catalogModelNumber"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"manufacturer","label":"@lang.['m','Manufacturer']","type":"input","value":"@pageContext.manufacturerName"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"category","label":"@lang.['c33','Category']","type":"input","value":"@pageContext.assetCategoryName"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"type","label":"@lang.['t5','Type']","type":"input","value":"@pageContext.catalogTypeName"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"stockUnit","label":"@lang.['stockUnit','Stock Unit']","type":"input","value":"@pageContext.stockUnitName"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"deliveredQuantity","label":"@lang.['rq1','Requested Quantity']","type":"input","value":"@pageContext.inventoryRequestRequestedQty"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"destinationAddress","label":"@lang.['dl','Destination Location']","type":"input","value":"@pageContext.siteName"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"deliverBy","label":"@lang.['dlvrbyop','Deliver By ( Optional )']","type":"input","value":"@pageContext.inventoryRequestDeliverBy"}],"flex":"3","type":"column"}],"id":"","type":"row"},{"children":[{"children":[{"readOnly":true,"id":"workOrderID","label":"@lang.['WorkOrderId','Work Order ID']","type":"input","value":"@pageContext.workOrderId"}],"flex":"3","type":"column"},{"children":[{"readOnly":true,"id":"taskID","label":"@lang.['taskId','Task ID']","type":"input","value":"@pageContext.workOrderTaskId"}],"flex":"3","type":"column"}],"id":"","type":"row"}],"id":"reqDetailsSection","label":"@lang.['rd2','Request Details']","type":"section"}]},"actions":[{"name":"initialData","type":"script","actionDef":"function(pageContext) { function nullCheck(value, defaultValue) { if (typeof value === 'undefined' || value === '' || value === null) { if (typeof defaultValue !== 'undefined') return defaultValue; return '-'; } return value; } pageContext.currentDateAndTime = new Date().toISOString().replace('T', ' ').replace('Z', ''); pageContext.inventoryRequestRequestedQty = nullCheck(pageContext.inventoryRequestRequestedQty, 0); pageContext.inventoryRequestRequestedDate = nullCheck(pageContext.inventoryRequestRequestedDate); pageContext.inventoryRequestDeliveredQty = nullCheck(pageContext.inventoryRequestDeliveredQty, 0); pageContext.calledFromInventoryRequestModule = true; if (pageContext.inventoryRequestAction !== 'add') { if (pageContext.inventoryRequestAction === 'view') { pageContext.siteName = nullCheck(pageContext.siteName); pageContext.inventoryRequestDeliverBy = nullCheck(pageContext.inventoryRequestDeliverBy); pageContext.siteContactPerson = nullCheck(pageContext.siteContactPerson); pageContext.siteContactPhone = nullCheck(pageContext.siteContactPhone); pageContext.workOrderId = nullCheck(pageContext.workOrderId); pageContext.workOrderTaskId = nullCheck(pageContext.workOrderTaskId); pageContext.inventoryRequestNotes = nullCheck(pageContext.inventoryRequestNotes); } pageContext.catalogIdArray = []; pageContext.assetCategoryName = nullCheck(pageContext.assetCategoryName); pageContext.catalogDropdownData = {}; if (pageContext.catalogId) { pageContext.catalogIdArray.push({ 'catalogId': pageContext.catalogId, 'catalogName': pageContext.catalogName }); pageContext.catalogDropdownData = [{ value: pageContext.catalogId, label: pageContext.catalogName }]; } if (pageContext.inventoryRequestDestinationSiteId) { pageContext.sourceSiteDropdownData = [{ label: pageContext.siteName, value: pageContext.inventoryRequestDestinationSiteId }]; } pageContext.destinationSiteAddress = pageContext.siteAddress; pageContext.inventoryRequestDeliverBy = pageContext.inventoryRequestDeliverBy ? pageContext.inventoryRequestDeliverBy : ''; pageContext.inventoryRequestNotes = pageContext.inventoryRequestNotes ? pageContext.inventoryRequestNotes : ''; pageContext.initialCatalogId = pageContext.catalogId; pageContext.initialSiteId = pageContext.siteId; pageContext.initialInventoryRequestRequestedQty = pageContext.inventoryRequestRequestedQty; pageContext.initialInventoryRequestDestinationSiteId = pageContext.inventoryRequestDestinationSiteId; pageContext.initialInventoryRequestDeliverBy = pageContext.inventoryRequestDeliverBy; pageContext.initialInventoryRequestNotes = pageContext.inventoryRequestNotes; } else { if (typeof pageContext.siteIdData != 'undefined' && Array.isArray(pageContext.siteIdData) && pageContext.siteIdData.length > 0 && Array.isArray(pageContext.siteIdData[0].data[0].sitesData)) { pageContext.sourceSiteDropdownData = [{ label: pageContext.siteIdData[0].data[0].sitesData[0].siteName, value: pageContext.siteIdData[0].data[0].sitesData[0].siteId }]; pageContext.siteId = pageContext.siteIdData[0].data[0].sitesData[0].siteId; pageContext.destinationSiteAddress = pageContext.siteIdData[0].data[0].sitesData[0].siteAddress; } else { pageContext.destinationSiteAddress = '@lang.[\"afbosd\",\"Auto-filled based on selected destination\"]'; } }}"},{"name":"setCatalogId","type":"script","actionDef":"function (pageContext) {pageContext.catalogId = ''; pageContext.catalogIdArray = []; if (typeof pageContext.catalogDropdownData !== 'undefined' && pageContext.catalogDropdownData !== '' && pageContext.catalogDropdownData.toString() !== '{}' && pageContext.catalogDropdownData[0] !== null) { pageContext.catalogId = pageContext.catalogDropdownData[0].value; pageContext.disableReqDetails = true; pageContext.catalogIdArray.push({ 'catalogId': pageContext.catalogId, 'catalogName': pageContext.catalogDropdownData[0].label }); } if (pageContext.catalogId != '' && (typeof pageContext.siteId != 'undefined' && pageContext.siteId != '')) { pageContext.fetchStockAvailability = true; } else { pageContext.fetchStockAvailability = false; }pageContext.filterForStockAvailability = `({$siteId} = '${pageContext.siteId}') AND ({$catalogId} = '${pageContext.catalogId}')`;}"},{"falseStep":["@actions.fetchWorkOrderInventoryData","@actions.setPartsData"],"trueStep":["@actions.fetchWorkOrderInventoryData","@actions.fireFetchStockAvailabilityProcessEvent","@actions.setStockData"],"name":"decisionActionToFetchData","type":"decision","actionDef":"function(pageContext){ return pageContext.fetchStockAvailability;}"},{"endPoint":"process/start","name":"fetchWorkOrderInventoryData","outputVarMap":{"data":"@pageContext.partsData"},"type":"api","actionDef":{"data":[{"inputVar":{},"processId":"fetchPartsRequiredForTaskWF","apiResponseFormat":true,"contextVar":{"catalogId":"@pageContext.catalogId","workOrderTaskAssignedToUserId":"@pageContext.workOrderTaskAssignedToUserId","workOrderTaskId":"@pageContext.workOrderTaskId","workOrderId":"@pageContext.workOrderId"}}]}},{"name":"setCatalogData","type":"script","actionDef":"function (pageContext) { if (Array.isArray(pageContext.catalogData)) { pageContext.catalogModelNumber = pageContext.catalogData[0].catalogData[0].catalogModelNumber; pageContext.manufacturerName = pageContext.catalogData[0].catalogData[0].manufacturerName; pageContext.assetCategoryName = (typeof pageContext.catalogData[0].catalogData[0].assetCategoryName !== 'undefined' && pageContext.catalogData[0].catalogData[0].assetCategoryName !== '') ? pageContext.catalogData[0].catalogData[0].assetCategoryName : '-'; pageContext.catalogTypeName = pageContext.catalogData[0].catalogData[0].catalogTypeName; pageContext.stockUnitName = (typeof pageContext.catalogData[0].catalogData[0].stockUnitName !== 'undefined' && pageContext.catalogData[0].catalogData[0].stockUnitName !== '') ? pageContext.catalogData[0].catalogData[0].stockUnitName : '-'; } if (typeof pageContext.catalogDropdownData === 'undefined' || pageContext.catalogDropdownData === '' || pageContext.catalogDropdownData.toString() === '{}' || pageContext.catalogDropdownData[0] === null) { pageContext.catalogModelNumber = '-'; pageContext.manufacturerName = '-'; pageContext.assetCategoryName = '-'; pageContext.catalogTypeName = '-'; pageContext.stockUnitName = '-'; } }"},{"name":"setPartsData","type":"script","actionDef":"function (pageContext) {if (typeof pageContext.partsData != 'undefined' && Array.isArray(pageContext.partsData) && pageContext.partsData[0].partsData.length) { pageContext.estimatedQty = pageContext.partsData[0].partsData[0].estimatedQty; pageContext.inventoryQty = pageContext.partsData[0].partsData[0].inventoryQty; }}"},{"name":"setStockData","type":"script","actionDef":"function (pageContext) {if (typeof pageContext.partsData != 'undefined' && Array.isArray(pageContext.partsData) && pageContext.partsData[0].partsData.length) { pageContext.estimatedQty = pageContext.partsData[0].partsData[0].estimatedQty; } if (typeof pageContext.siteData != 'undefined' && Array.isArray(pageContext.siteData) && pageContext.siteData[0].data[0].inventoryMPData.length) { pageContext.inventoryQty = pageContext.siteData[0].data[0].inventoryMPData[0].inventoryQuantity; } else { pageContext.inventoryQty = '-'; }}"},{"name":"setDataToUpsert","type":"script","actionDef":"function (pageContext) {pageContext.inventoryRequestRequestedDate = pageContext.inventoryRequestAction === 'add' ? new Date().toISOString().replace('T', ' ').replace('Z', '') : pageContext.inventoryRequestRequestedDate; pageContext.inventoryRequestStatusId = pageContext.inventoryRequestAction === 'add' ? 'inventoryRequestOpen' : pageContext.inventoryRequestStatusId; pageContext.inventoryRequestId = pageContext.inventoryRequestAction == 'add' ? '' : pageContext.inventoryRequestId; pageContext.inventoryRequest = [{ 'deliverBy': pageContext.inventoryRequestDeliverBy, 'catalogId': pageContext.catalogId, 'notes': pageContext.inventoryRequestNotes, 'requestedQty': pageContext.inventoryRequestRequestedQty, 'statusId': pageContext.inventoryRequestStatusId, 'statusTargetModel': 'inventoryRequest', 'workOrderTaskId': pageContext.workOrderTaskId, 'workOrderId': pageContext.workOrderId, 'destinationSiteId': pageContext.siteId, 'id': pageContext.inventoryRequestId, 'requestedDate': pageContext.inventoryRequestRequestedDate, 'cancellationReason': pageContext.inventoryRequestCancellationReason, }];}"},{"name":"closePanel","type":"closePanel"},{"endPoint":"event/start","name":"upsertData","outputVarMap":{"data":"@pageContext.inventoryRequestData"},"type":"api","actionDef":{"data":[{"eventId":"inventoryRequestModelProcessEvent","contextVar":{"inventoryRequest":"@pageContext.inventoryRequest"}}]}},{"name":"processSiteData","type":"script","actionDef":"function(pageContext) {if (typeof pageContext.siteId !== 'undefined' && pageContext.siteId !== '') { pageContext.sitesData.forEach(element => { if (pageContext.siteId == element.siteId) { pageContext.destinationSiteAddress = element.siteAddress; pageContext.destinationSiteId = element.siteId; } }); if (pageContext.siteData[0].data[0].inventoryMPData.length) { pageContext.inventoryQty = pageContext.siteData[0].data[0].inventoryMPData[0].inventoryQuantity; } else { pageContext.inventoryQty = '-'; } } else { if (pageContext.inventoryRequestAction == 'add') { pageContext.destinationSiteAddress = '@lang.[\"afbosd\",\"Auto-filled based on selected destination\"]'; pageContext.destinationSiteId = ''; } }}"},{"name":"setSiteIdAndFilter","type":"script","actionDef":"function(pageContext) {if (typeof pageContext.sourceSiteDropdownData !== 'undefined' && pageContext.sourceSiteDropdownData !== '' && pageContext.sourceSiteDropdownData.toString() !== '{}' && pageContext.sourceSiteDropdownData[0] !== null) { pageContext.siteId = pageContext.sourceSiteDropdownData[0].value; pageContext.siteName = pageContext.sourceSiteDropdownData[0].label; } pageContext.filterForStockAvailability = `({$siteId} = '${pageContext.siteId}') AND ({$catalogId} = '${pageContext.catalogId}')`;}"},{"name":"setFilterForIR","type":"script","actionDef":"function(pageContext){pageContext.invntoryRequestFilter = `{$inventoryRequestWorkOrderTaskId} = '${pageContext.workOrderTaskId}'`;}"},{"name":"clearData","type":"script","actionDef":"function(pageContext){pageContext.inventoryRequestId = ''; pageContext.inventoryRequestRequestedQty = 0; pageContext.catalogId = '';pageContext.inventoryRequestDeliverBy = '';}"},{"endPoint":"event/start","name":"fireFetchStockAvailabilityProcessEvent","outputVarMap":{"data":"@pageContext.siteData"},"type":"api","actionDef":{"data":[{"eventId":"fetchStockAvailabilityProcessEvent","contextVar":{"filter":"@pageContext.filterForStockAvailability"}}]}},{"endPoint":"event/start","name":"fetchSiteIdForAssginedToUserId","outputVarMap":{"data":"@pageContext.siteIdData"},"type":"api","actionDef":{"data":[{"eventId":"fetchStockLocationDataProcessEvent","contextVar":{"filter":"@pageContext.staticSiteFilter"}}]}},{"endPoint":"process/start","name":"fireFetchStockLocationDataProcessEventWF","outputVarMap":{"data":"@pageContext.sitesData"},"type":"api","actionDef":{"data":[{"processId":"fireFetchStockLocationDataProcessEventWF","apiResponseFormat":true,"contextVar":{"abc":"abc","siteIdList":"@pageContext.siteIdList"},"apiResponseObject":"sitesData"}]}},{"name":"setFilter","type":"script","actionDef":"function(pageContext){pageContext.staticSiteFilter = `{$siteType}= 'truck' AND ({$site.assignedToUserId} = '${pageContext.workOrderTaskAssignedToUserId}')`;}"},{"name":"refreshInventoryRequestGrid","gridId":["inventoryRequestGrid"],"type":"RefreshGridOnSidePanel"},{"name":"openPreviousPanel","type":"backPanel"},{"name":"closeModal","type":"closeModal"}]}