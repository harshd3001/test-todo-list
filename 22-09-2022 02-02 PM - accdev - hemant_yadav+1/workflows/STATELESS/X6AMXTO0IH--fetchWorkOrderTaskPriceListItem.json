{"fetchWorkOrderTaskResult":{"filter":"{$workOrderTask.id} = {@workOrderTaskId}","models":["workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"processWorkOrderTaskResult"}],"columns":{"workOrderTaskResult":"workOrderTask.result"},"name":"fetchWorkOrderTaskResult","description":"fetchWorkOrderTaskResult","distinct":true,"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"workOrderTaskResultData"},"nodeType":"QUERY"},"workflowContext":{"eventType":["assetInstallation","assetReplacement"]},"processBatch":{"connectors":[{"exitPortType":"NextStep","nodeId":"getWorkOrderTaskInventoryDetails"}],"contextChangePermitted":true,"name":"processBatch","description":"Add dafault value for batchSize and batchNumber if not available in inputVarmap","processRule":"{if (typeof contextVar === 'undefined' || typeof contextVar.batchNumber === 'undefined' || contextVar.batchNumber === '') { contextVar.batchNumber = 1; } else { contextVar.batchNumber = contextVar.batchNumber; } if (typeof contextVar === 'undefined' || typeof contextVar.batchSize === 'undefined' || contextVar.batchSize === '') { contextVar.batchSize = 50; } else { contextVar.batchSize = contextVar.batchSize; }if (typeof contextVar.filter !== 'undefined' && contextVar.filter !== '') {contextVar.searchKey = contextVar.filter.split('%')[1]; }}","id":"processBatch","nodeType":"PROCESS"},"processWorkOrderTaskResult":{"connectors":[{"exitPortType":"NextStep","nodeId":"processResultForInventory"}],"contextChangePermitted":true,"name":"processWorkOrderTaskResult","description":"Add dafault value for batchSize and batchNumber if not available in inputVarmap","processRule":"{if (typeof contextVar.workOrderTaskResult !== 'undefined'  || contextVar.workOrderTaskResult !== '') { contextVar.workOrderTaskResult = contextVar.workOrderTaskResultData[0].workOrderTaskResult; }  }","id":"processWorkOrderTaskResult","nodeType":"PROCESS"},"getWorkOrderTaskInventoryDetails":{"models":["workOrderInventory","catalog","stockUnit","manufacturer","catalogType"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkOrderTaskResult"}],"columns":{"unitPrice":"workOrderInventory.unitPrice","estimatedQty":"workOrderInventory.estimatedQty","catalogType":"catalogType.name","manufacturerName":"manufacturer.name","catalogTypeId":"catalogType.id","actualQty":"IF({$workOrderInventory.actualQty}!='' AND {$workOrderInventory.actualQty} IS NOT NULL,{$workOrderInventory.actualQty},'-')","customerPrice":"workOrderInventory.customerPrice","stockUnitName":"stockUnit.name","modelName":"catalog.name","catalogId":"workOrderInventory.catalogId","workOrderTaskId":"workOrderInventory.workOrderTaskId","modelNumber":"catalog.modelNumber","id":"workOrderInventory.id","workOrderId":"workOrderInventory.workOrderId"},"description":"getWorkOrderTaskInventoryDetails","distinct":true,"inputVarMap":{"workOrderTaskId":"workOrderTaskId","batchSize":"batchSize","batchNumber":"batchNumber"},"nodeType":"QUERY","translate":true,"filter":"{$workOrderTaskId}={@workOrderTaskId}","name":"getWorkOrderTaskInventoryDetails","links":{"catalogType":"catalog","workOrderInventory":"catalog","manufacturer":"catalog","stockUnit":"catalog"},"outputVarMap":{"data":"workOrderTaskIventoryData","count":"count"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processBatch"}],"name":"start","description":"Start","nodeType":"START"},"fetchActionListOptions":{"filter":"{$listOptionAnswer.listOptionId}='assetMaintenanceOptions'","models":["listOptionAnswer"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchCatalogType"}],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText"},"name":"fetchActionListOptions","description":"fetchActionListOptions","outputVarMap":{"data":"actionListOptionsData"},"nodeType":"QUERY","translate":true},"end":{"name":"end","description":"End","inputVarMap":{"count":"count","workOrderTaskIventoryData":"workOrderTaskIventoryData"},"outputVarMap":{"count":"count","workOrderTaskIventoryData":"workOrderTaskIventoryData"},"nodeType":"END"},"ProcessWebAndMobileInventory":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"ProcessWebAndMobileInventory","description":"ProcessWebAndMobileInventory","processRule":"{ contextVar.workOrderTaskIventoryData = (typeof contextVar.workOrderTaskIventoryData !== 'undefined' && contextVar.workOrderTaskIventoryData !== '') ? contextVar.workOrderTaskIventoryData : []; contextVar.workOrderTaskIventoryData.map(webInventory => { if (contextVar.workOrderInventory.find(mobileInventory => (mobileInventory.id === webInventory.id) || (mobileInventory.catalogId === webInventory.catalogId && mobileInventory.unitPrice === webInventory.unitPrice && mobileInventory.customerPrice === webInventory.customerPrice)) === undefined) { contextVar.workOrderInventory.push(webInventory); } }); contextVar.workOrderTaskIventoryData = (contextVar.workOrderInventory || []).slice(); contextVar.workOrderTaskIventoryData.forEach(inventory => { inventory.actualQty = (inventory.actualQty === 0 || inventory.actualQty === '-') ? '-' : ((inventory.catalogTypeId === 'material' && typeof inventory.stockUnitName !== 'undefined') ? inventory.actualQty + ' ' + inventory.stockUnitName : inventory.actualQty); inventory.estimatedQty = inventory.estimatedQty === 0 ? '-' : ((inventory.catalogTypeId === 'material' && typeof inventory.stockUnitName !== 'undefined') ? inventory.estimatedQty + ' ' + inventory.stockUnitName : inventory.estimatedQty); contextVar.catalogTypeData.find(catalog => { if (catalog.catalogTypeId === inventory.catalogTypeId) { inventory.catalogType = catalog.catalogTypeName; } }); if (typeof inventory.partDetail !== 'undefined' && inventory.partDetail !== '' && (Array.isArray(inventory.partDetail) && inventory.partDetail.length > 0)) { inventory.partDetail.forEach(part => { contextVar.actionListOptionsData.find(action => { if (action.listOptionAnswerId === part.action) { part.action = action.listOptionAnswerAnswerOptionText; } }); }) } }); if (typeof contextVar.searchKey !== 'undefined' && contextVar.searchKey !== '') { const res = contextVar.workOrderTaskIventoryData.filter(obj => Object.values(obj).some(val => val.toString().toLocaleLowerCase().includes(contextVar.searchKey.toLocaleLowerCase()))); contextVar.workOrderTaskIventoryData = res; } contextVar.count = contextVar.workOrderTaskIventoryData.length; }","id":"ProcessWebAndMobileInventory","nodeType":"PROCESS","jsEngine":"es6"},"processResultForInventory":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchActionListOptions"}],"contextChangePermitted":true,"name":"processResultForInventory","description":"processResultForInventory","processRule":"@FWFLKROPDL","nodeType":"PROCESS","jsEngine":"es6"},"workflowNodes":["start","processBatch","getWorkOrderTaskInventoryDetails","fetchWorkOrderTaskResult","processWorkOrderTaskResult","processResultForInventory","fetchActionListOptions","fetchCatalogType","ProcessWebAndMobileInventory","end"],"fetchCatalogType":{"filter":"","models":["catalogType"],"connectors":[{"exitPortType":"NextStep","nodeId":"ProcessWebAndMobileInventory"}],"columns":{"catalogTypeId":"catalogType.id","catalogTypeName":"catalogType.name"},"name":"fetchCatalogType","description":"fetchCatalogType","outputVarMap":{"data":"catalogTypeData"},"nodeType":"QUERY","translate":true}}