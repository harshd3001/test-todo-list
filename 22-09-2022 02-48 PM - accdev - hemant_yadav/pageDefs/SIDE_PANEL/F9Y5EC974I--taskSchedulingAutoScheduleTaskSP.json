{"pageContext":{},"actionOnLoad":["@actions.fetchInProgressSchedulerLogData","@actions.setInitialData","@actions.fetchSchedulingFilterData","@actions.processSchedulingFilterData"],"jslib":{"isContinueDisable":"function(pageContext){ return ((typeof pageContext.selectedRowIds === 'undefined' || pageContext.selectedRowIds.length === 0));}","isRegionDisabled":"function (pageContext) { return (typeof pageContext.allRegionSelected !=='undefined' && pageContext.allRegionSelected)}","bannerTextContinue":"function(pageContext){return pageContext.bannerTextContinue='@lang.[\"ytabsintbtctafmtcymctpacw\",\"Your tasks are being scheduled in the background. This could take a few minutes to complete. You may close this panel and continue working.\"]';}","isDataGridHidden":"function (pageContext) { return (typeof pageContext.taskAutoScheduleData === 'undefined' || pageContext.taskAutoScheduleData.length === 0 ) }","isSuggestionBannerHidden":"function (pageContext) {if (pageContext.showSuggestionBanner) { return false; } else { return true; }}","isTaskStatus1Hidden":"function (pageContext) { return !(typeof pageContext.schedulerDecision !== 'undefined' && pageContext.schedulerDecision === 'scheduleAndAssign') }","isPreviewTasksDisabled":"function (pageContext) {if ((typeof pageContext.schedulerDecision !== 'undefined' && pageContext.schedulerDecision === 'scheduleAndAssign') && !(pageContext.startDate === '' || pageContext.endDate === '' || pageContext.regionList === '' || pageContext.taskTypeList === ''  || pageContext.taskStatusFilter1 === '')) {return false;}if ((typeof pageContext.schedulerDecision !== 'undefined' && pageContext.schedulerDecision === 'onlyAssign') && !(pageContext.startDate === '' || pageContext.endDate === '' || pageContext.regionList === '' || pageContext.taskTypeList === '' || pageContext.taskStatusFilter2 === '')) {return false;} else {return true;}}","isTaskStatus2Hidden":"function (pageContext) { return !(typeof pageContext.schedulerDecision !== 'undefined' && pageContext.schedulerDecision === 'onlyAssign') }","isBannerHiddenContinue":"function (pageContext) { if (pageContext.bannerType === 'showBannerContinue') { return false; } else { return true; } }","isTaskTypeDisabled":"function (pageContext) { return (typeof pageContext.allTaskTypeSelected !=='undefined' && pageContext.allTaskTypeSelected)}","isBannerHidden":"function (pageContext) {if (pageContext.showAlertBanner) { return false; } else { return true; }}"},"header":{"children":[{"buttonType":"primary","actionOnClick":["@actions.filteringTaskId","@actions.decisionActionScheduler","@actions.setBannerType","@actions.refreshDataGrid","@actions.clearPageContextManually","@actions.fetchInProgressSchedulerLogData","@actions.setInitialData","@actions.fetchSchedulingFilterData","@actions.processSchedulingFilterData"],"disabled":"@jslib.isContinueDisable","id":"submit","type":"button","title":"@lang.['c13','Continue']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext","@actions.refreshGridOnMainPage","@actions.refreshScheduler"],"id":"close","type":"buttonIcon"}],"title":"@lang.['ast','Auto Schedule Tasks']"},"body":{"children":[{"alertMessage":"@lang.['aasriiptnasrwbqupgttlsitsmtvtrip','Another auto scheduling run is in progress. The new auto scheduling run will be queued up. Please go to the Logs section in Task Scheduling module to view the run in progress.']","alertType":"warning","rightIconVisible":false,"hidden":"@jslib.isBannerHidden","id":"alertMessage","type":"alert"},{"alertMessage":"@lang.['wrstftal2hitftetttasr','We recommend selecting the \"From\" time at least 2 hours into the future to ensure that the tasks are scheduled reliably.']","alertType":"warning","rightIconVisible":false,"hidden":"@jslib.isSuggestionBannerHidden","id":"alertMessage","type":"alert"},{"alertMessage":"@jslib.bannerTextContinue","actionOnChange":"@actions.clearBannerType","onClose":"@actions.clearBannerType","alertType":"success","hidden":"@jslib.isBannerHiddenContinue","id":"alertMessage","type":"alert","timeout":300000},{"children":[{"isRequired":true,"actionOnChange":["@actions.showSuggestionBanner"],"options":[{"label":"@lang.['saat','Schedule and Assign Tasks']","value":"scheduleAndAssign"},{"label":"@lang.['apttt','Assign Pre-Scheduled Tasks to Technicians']","value":"onlyAssign"}],"optTitleKey":"label","optValueKey":"value","id":"schedulerDecision","title":"@lang.['iwt1','I want to']","type":"dropdown","value":"@pageContext.schedulerDecision","placeHolder":""},{"children":[{"children":[{"actionOnChange":["@actions.setMinDate"],"minDate":"@pageContext.currentDate","id":"fromDate","title":"@lang.['f5','From']","type":"datetime","value":"@pageContext.startDate","placeHolder":"@lang.['ssdt3','Select start date & time']"}],"flex":"3","type":"column"},{"children":[{"minDate":"@pageContext.minDate","maxDate":"@pageContext.maxDate","id":"toDate","title":"@lang.['t17','To']","type":"datetime","value":"@pageContext.endDate","placeHolder":"@lang.['sedt1','Select end date & time']"}],"flex":"3","type":"column"}],"id":"timeFrameRow","type":"row"},{"isRequired":true,"actionOnChange":["@actions.clearRegionList"],"isMultiSelect":true,"searchByOptions":{"dataSourceId":"process/start","sourceType":"api","columns":["label","value"],"dataToBeSent":{"apiResponseParams":["regionData"],"inputVar":{},"processId":"autoSchedulingFilterDataFetchWF","apiResponseFormat":true,"contextVar":{"abc":"abc"},"apiResponseObject":"regionData"}},"optLabelMap":"label","optValueMap":"value","disabled":"@jslib.isRegionDisabled","id":"regionList","label":"@lang.['market','Market']","type":"selectDropdown","value":"@pageContext.regionList","placeHolder":"@lang.['selectMarket','Select market']"},{"actionOnChange":["@actions.setRegionData"],"id":"allRegions","label":"","placeholder":"@lang.['sam','Select All Market']","type":"switchComponent","value":"@pageContext.allRegionSelected"},{"isRequired":true,"actionOnChange":["@actions.clearTaskTypeList"],"isMultiSelect":true,"searchByOptions":{"dataSourceId":"process/start","sourceType":"api","columns":["label","value"],"dataToBeSent":{"apiResponseParams":["taskTypeData"],"inputVar":{},"processId":"autoSchedulingFilterDataFetchWF","apiResponseFormat":true,"contextVar":{"abc":"abc"},"apiResponseObject":"taskTypeData"}},"optLabelMap":"label","optValueMap":"value","disabled":"@jslib.isTaskTypeDisabled","id":"taskTypeList","label":"@lang.['navTT','Task Types']","type":"selectDropdown","value":"@pageContext.taskTypeList","placeHolder":"@lang.['stt','Select task type']"},{"actionOnChange":["@actions.setTaskTypeData"],"id":"allTaskTypes","label":"","placeholder":"@lang.['satt','Select All Task Types']","type":"switchComponent","value":"@pageContext.allTaskTypeSelected"},{"isRequired":true,"actionOnChange":["@actions.clearTaskStatusFilter1"],"hidden":"@jslib.isTaskStatus1Hidden","optLabelMap":"name","optValueMap":"id","isMultiSelect":true,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$id} = 'workOrderTaskOpen' || {$id} ='workOrderTaskScheduled' || {$id} ='workOrderTaskDispatched'","models":["ZStatus"],"inputs":{},"columns":{"name":"name","id":"id"},"translate":true}},"label":"@lang.['ts2','Task Status']","id":"taskStatusFilter1","type":"selectDropdown","value":"@pageContext.taskStatusFilter1","placeHolder":"@lang.['so','Select option']"},{"isRequired":true,"actionOnChange":["@actions.clearTaskStatusFilter2"],"hidden":"@jslib.isTaskStatus2Hidden","optLabelMap":"name","optValueMap":"id","isMultiSelect":true,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$id} = 'workOrderTaskOpen' || {$id} ='workOrderTaskScheduled'","models":["ZStatus"],"inputs":{},"columns":{"name":"name","id":"id"},"translate":true}},"label":"@lang.['ts2','Task Status']","id":"taskStatusFilter2","type":"selectDropdown","value":"@pageContext.taskStatusFilter2","placeHolder":"@lang.['so','Select option']"},{"children":[{"children":[{"buttonType":"primary","actionOnClick":["@actions.formulatingData","@actions.clearTaskAutoScheduleDataResponseObject","@actions.fireProcessEventForAutoScheduleTaskFilter","@actions.enableDataGridAndSetData","@actions.refreshGridOnSidePanel"],"disabled":"@jslib.isPreviewTasksDisabled","id":"generateTaskForAutoScheduling","type":"button","title":"@lang.['pt3','Preview Tasks']"}],"flex":"3","type":"column"},{"flex":"3","id":"","type":"column"}],"id":"generateTaskForAutoSchedulingRow","type":"row"}],"label":"@lang.['ftfas1','Filter Tasks for Auto Scheduling']","id":"generateTaskForAutoSchedulingSection","type":"section"},{"hidden":"@jslib.isDataGridHidden","children":[{"id":"autoSchedulingGrid","label":"","type":"datagrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{"source":"@pageContext.taskAutoScheduleData"}},"isScrollAble":true,"deleteAllowed":false,"searchAllowed":true,"tableWidth":"80rem","searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"modifyRowActions":[],"gridRefreshId":"autoSchedulingDataGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":1.6,"sortOrder":"ASC","colorCode":"statusNameColor","sortable":true,"showLabel":true},"key":"statusName"},{"name":"@lang.['taskId','Task ID']","options":{"flex":1.2,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderTaskId","primaryKey":true},{"name":"@lang.['customer','Customer']","options":{"flex":1.8,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"customerCompanyName"},{"name":"@lang.['ci11','Customer Id']","options":{"hidden":true,"showLabel":false},"key":"customerId","primaryKey":true},{"name":"@lang.['woti1','Work Order Type Id']","options":{"hidden":true,"showLabel":false},"key":"workOrderTypeId","primaryKey":true},{"name":"@lang.['ri2','Region Id']","options":{"hidden":true,"showLabel":false},"key":"regionId","primaryKey":true},{"name":"@lang.['tti','Task Type Id']","options":{"hidden":true,"showLabel":false},"key":"taskTypeId","primaryKey":true},{"name":"@lang.['cs','Customer Site']","options":{"flex":1.8,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"siteName"},{"name":"@lang.['taskType','Task Type']","options":{"flex":4,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"taskTypeName"},{"name":"@lang.['market','Market']","options":{"flex":1.2,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"regionName"},{"name":"@lang.['d4','Deadline']","options":{"flex":2,"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workOrderDeadline"},{"name":"@lang.['s7','Scheduled']","options":{"flex":2,"sortOrder":"ASC","sortable":true,"type":"dateTime","showLabel":true},"key":"workOrderTaskScheduledDate"}],"rowsToSelect":{},"isMultiSelect":true,"jslib":{},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['tfas','Tasks for Auto Scheduling']","children":[]},"isSelectable":true,"dataSource":[],"actions":[],"searchKeys":["workOrderTaskId","regionName","taskTypeName","statusName"]}}],"label":"@lang.['s16','Search']","id":"","type":"section","transparent":true}]},"actions":[{"name":"setMinDate","type":"script","actionDef":"function (pageContext) {pageContext.minDate = new Date(pageContext.startDate); pageContext.maxDate = new Date(pageContext.startDate); pageContext.minDate.setSeconds(pageContext.minDate.getSeconds() + 1, 0); pageContext.minDate = moment(pageContext.minDate).format(); pageContext.maxDate.setDate(pageContext.maxDate.getDate() + 10); pageContext.maxDate = moment(pageContext.maxDate).format();}"},{"name":"clearPageContextManually","type":"script","actionDef":"function (pageContext) { for(const key in pageContext){ pageContext[key] = ''; } }"},{"name":"showSuggestionBanner","type":"script","actionDef":"function(pageContext){if(pageContext.schedulerDecision ==='scheduleAndAssign'){pageContext.showSuggestionBanner = true;}else{pageContext.showSuggestionBanner = false;}}"},{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.inProgressSchedulerLogData !== 'undefined' && Array.isArray(pageContext.inProgressSchedulerLogData) && pageContext.inProgressSchedulerLogData.length > 0) { pageContext.showAlertBanner = true; } else { pageContext.showAlertBanner = false; } pageContext.schedulerDecision = 'scheduleAndAssign'; pageContext.showSuggestionBanner = true; pageContext.currentDate = new Date(); pageContext.currentDate.setHours(pageContext.currentDate.getHours() + 2); pageContext.currentDate = pageContext.currentDate.toISOString().replace('T', ' ').replace('Z', ''); pageContext.bannerType = 'showBanner'; pageContext.startDate = ''; pageContext.endDate = ''; pageContext.regionList = ''; pageContext.taskTypeList = ''; pageContext.taskStatusFilter1 = ''; pageContext.taskStatusFilter2 = ''; pageContext.taskAutoScheduleData = ''; }"},{"name":"fetchInProgressSchedulerLogData","outputVarMap":{"data":"@pageContext.inProgressSchedulerLogData"},"type":"query","actionDef":{"filter":"{$schedulerLogStatus} = 'schedulerLogInProgress'","models":["schedulerLog"],"columns":{"schedulerLogStatus":"schedulerLog.status","schedulerLogId":"schedulerLog.id"},"distinct":true,"getCount":true}},{"name":"clearBannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType = '';}"},{"name":"setBannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType = 'showBannerContinue'; pageContext.schedulerDecision = 'scheduleAndAssign';}"},{"name":"formulatingData","type":"script","actionDef":"function(pageContext) { pageContext.regionFilter = []; pageContext.taskTypeFilter = []; if (typeof pageContext.regionList != 'undefined' && pageContext.regionList != '' && pageContext.regionList.length > 0 ) { pageContext.regionList.forEach(function(element){ pageContext.regionFilter.push(element.value); }); } if (typeof pageContext.taskTypeList != 'undefined' && pageContext.taskTypeList != '' && pageContext.taskTypeList.length > 0 ) { pageContext.taskTypeList.forEach(function(element){ pageContext.taskTypeFilter.push(element.value); }); } }"},{"name":"filteringTaskId","type":"script","actionDef":"function (pageContext) { pageContext.taskIdList = []; let workOrderTypeIdList = [], customerIdList = [], regionIdList = [], taskTypeIdList = []; if (typeof pageContext.selectedRowIds != 'undefined' && pageContext.selectedRowIds != '' && pageContext.selectedRowIds.length > 0) { pageContext.selectedRowIds.forEach(function (element) { pageContext.taskIdList.push(element.workOrderTaskId); workOrderTypeIdList.push(element.workOrderTypeId); customerIdList.push(element.customerId); regionIdList.push(element.regionId); taskTypeIdList.push(element.taskTypeId); }); pageContext.workOrderTypeIdList = Array.from(new Set(workOrderTypeIdList)); pageContext.customerIdList = Array.from(new Set(customerIdList)); pageContext.regionIdList = Array.from(new Set(regionIdList)); pageContext.taskTypeIdList = Array.from(new Set(taskTypeIdList)); } }"},{"endPoint":"event/start","isAsync":true,"name":"fireProcessEvent","type":"api","actionDef":{"data":[{"eventId":"taskSchedulingAutoSchedulerCallProcessEvent","contextVar":{"taskIdList":"@pageContext.taskIdList","taskTypeIdList":"@pageContext.taskTypeIdList","customerIdList":"@pageContext.customerIdList","endDate":"@pageContext.endDate","regionIdList":"@pageContext.regionIdList","workOrderTypeIdList":"@pageContext.workOrderTypeIdList","startDate":"@pageContext.startDate"}}]}},{"endPoint":"event/start","isAsync":true,"name":"fireProcessEventForBatchScheduler","type":"api","actionDef":{"data":[{"eventId":"taskSchedulingBatchSchedulerCallProcessEvent","contextVar":{"taskIdList":"@pageContext.taskIdList","taskTypeIdList":"@pageContext.taskTypeIdList","customerIdList":"@pageContext.customerIdList","endDate":"@pageContext.endDate","regionIdList":"@pageContext.regionIdList","workOrderTypeIdList":"@pageContext.workOrderTypeIdList","schedulerDecision":"@pageContext.schedulerDecision","startDate":"@pageContext.startDate"}}]}},{"name":"enableDataGridAndSetData","type":"script","actionDef":"function(pageContext){pageContext.enable=true;pageContext.taskAutoScheduleData=pageContext.taskScheduleBreakdownData[0].taskAutoScheduleData;}"},{"name":"clearTaskAutoScheduleDataResponseObject","type":"script","actionDef":"function(pageContext){pageContext.taskAutoScheduleData='';}"},{"name":"clearRegionList","type":"script","actionDef":"function(pageContext){if(pageContext.regionList == null) {pageContext.regionList = '';}}"},{"name":"clearTaskTypeList","type":"script","actionDef":"function(pageContext){if(pageContext.taskTypeList == null) {pageContext.taskTypeList = '';}}"},{"name":"setRegionData","type":"script","actionDef":"function(pageContext){if(pageContext.allRegionSelected) {pageContext.regionList = pageContext.regionData;}}"},{"name":"setTaskTypeData","type":"script","actionDef":"function(pageContext){if(pageContext.allTaskTypeSelected) {pageContext.taskTypeList = pageContext.taskTypeData;}}"},{"name":"clearTaskStatusFilter1","type":"script","actionDef":"function(pageContext){if(pageContext.taskStatusFilter1 == null) {pageContext.taskStatusFilter1 = '';}}"},{"name":"clearTaskStatusFilter2","type":"script","actionDef":"function(pageContext){if(pageContext.taskStatusFilter2 == null) {pageContext.taskStatusFilter2 = '';}}"},{"endPoint":"process/start","name":"fireProcessEventForAutoScheduleTaskFilter","outputVarMap":{"data":"@pageContext.taskScheduleBreakdownData"},"type":"api","actionDef":{"data":[{"apiResponseParams":["count"],"processId":"FFJ4EC9FLF","apiResponseFormat":true,"contextVar":{"taskStatusFilter2":"@pageContext.taskStatusFilter2","taskStatusFilter1":"@pageContext.taskStatusFilter1","endDate":"@pageContext.endDate","taskTypeFilter":"@pageContext.taskTypeFilter","schedulerDecision":"@pageContext.schedulerDecision","regionFilter":"@pageContext.regionFilter","startDate":"@pageContext.startDate"},"apiResponseObject":"@pageContext.taskAutoScheduleData"}]}},{"name":"closePanel","type":"closePanel"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"refreshGridOnMainPage","gridId":["taskSchedulingOpenTaskDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"refreshScheduler","type":"refreshScheduler"},{"name":"refreshGridOnSidePanel","gridId":["autoSchedulingDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"clearPageContext","type":"clearPageContext"},{"falseStep":["@actions.fireProcessEventForBatchScheduler"],"trueStep":["@actions.fireProcessEvent"],"name":"decisionActionScheduler","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.schedulerDecision !=='undefined' && pageContext.schedulerDecision ==='onlyAssign') {return true;} return false;}"},{"endPoint":"process/start","name":"fetchSchedulingFilterData","outputVarMap":{"data":"@pageContext.schedulingFilterData"},"type":"api","actionDef":{"data":[{"processId":"autoSchedulingFilterDataFetchWF","contextVar":{"abc":"abc"}}]}},{"name":"processSchedulingFilterData","type":"script","actionDef":"function(pageContext){if(typeof pageContext.schedulingFilterData !== 'undefined') {pageContext.regionData = pageContext.schedulingFilterData[0].outputVar.regionData;pageContext.taskTypeData = pageContext.schedulingFilterData[0].outputVar.taskTypeData;}}"}]}