{"pageContext":{},"actionOnLoad":["@actions.initialData","@actions.fireProcessEventFetchAllData","@actions.setCategory"],"jslib":{"setNumberForCost":"function(pageContext) { if ((typeof pageContext.catalogUnitPrice !== 'undefined' &&pageContext.catalogUnitPrice !== '')) { return (Number(pageContext.catalogUnitPrice) < 0); } else { return false; } }","setNumberForListPrice":"function(pageContext) { if ((typeof pageContext.catalogCustomerPrice !== 'undefined' && pageContext.catalogCustomerPrice !== '')) { return (Number(pageContext.catalogCustomerPrice) < 0); } else { return false; } }","dynamicHeaderText":"function(pageContext){ if(pageContext.servicesAction === 'add'){return '@lang.[\"ans1\",\"Add New Service\"]'}else if(pageContext.servicesAction === 'edit'){return '@lang.[\"es4\",\"Edit Service\"]'}}","isSaveDisabled":"function(pageContext){ if (pageContext.servicesAction === 'add') {return ( typeof pageContext.catalogName === 'undefined' || pageContext.catalogName == '' || (Number(pageContext.catalogUnitPrice) < 0) );} else if (pageContext.servicesAction === 'edit') {return (( (pageContext.catalogDescription=== pageContext.initialCatalogDescription) && (pageContext.catalogName === pageContext.initialCatalogName) && (Number(pageContext.catalogUnitPrice) === pageContext.initialCatalogUnitPrice) && (Number(pageContext.catalogCustomerPrice) === pageContext.initialCatalogCustomerPrice) && (pageContext.catalogCategoryId === pageContext.initialCatalogCategoryId)) || (pageContext.catalogName == '') );}}"},"header":{"children":[{"hidden":true,"icon":"@iconlib.ActionsBinGrey","actionOnClick":[],"id":"deleteContract","type":"buttonIcon"},{"buttonType":"primary","actionOnClick":["@actions.setPrice","@actions.setSubActionUpsertCatalog","@actions.fireProcessEvent","@actions.closePanel","@actions.clearPageContext","@actions.refreshGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save ']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.clearPageContext","@actions.closePanel"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"isRequired":true,"inputType":"text","id":"catalogName","label":"@lang.['n','Name']","placeholder":"@lang.['esn1','Enter service name']","type":"input","value":"@pageContext.catalogName"},{"id":"catalogDescription","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.catalogDescription","placeHolder":"@lang.['ed1','Enter description']"}],"label":"@lang.['gi','General Information']","id":"generalInformationSection","type":"section"},{"children":[{"errorText":"@lang.['epevp','Error! Please enter valid price']","validator":"@jslib.setNumberForCost","inputType":"number","id":"catalogUnitPrice","label":"@lang.['c31','Cost']","placeholder":"@lang.['ep','Enter price']","type":"currency","value":"@pageContext.catalogUnitPrice","hoverText":{"title":"@lang.['pph','Price per hour']"}},{"errorText":"@lang.['epevp','Error! Please enter valid price']","validator":"@jslib.setNumberForListPrice","inputType":"number","id":"catalogCustomerPrice","label":"@lang.['lp','List Price']","placeholder":"@lang.['ep','Enter price']","type":"currency","value":"@pageContext.catalogCustomerPrice"},{"actionOnChange":["@actions.emptyCategoryTaxRate","@actions.setSelectedCategoryId","@actions.getTaxCategory","@actions.changeInCategory"],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$name} like {@filter} AND {$categoryTypeId} = 'tax'","models":["category"],"columns":{"rate":"category.taxRate","name":"category.name","id":"category.id"}}},"optLabelMap":"name","optValueMap":"id","id":"selectedCategory","label":"@lang.['tc2','Tax Category']","type":"selectDropdown","value":"@pageContext.selectedCategory","placeHolder":"@lang.['stc','Select tax category']"},{"disabled":true,"id":"categoryTaxRate","label":"@lang.['tr','Tax Rate (%)']","placeholder":"@lang.['tribostc','Tax Rate (%) is based on selected tax category']","type":"input","value":"@pageContext.categoryTaxRate"}],"label":"@lang.['a12','Accounting (Optional)']","id":"accountingSection","type":"section"}]},"actions":[{"name":"setPrice","type":"script","continueOnError":true,"actionDef":"function(pageContext) {var roundoff=pageContext.catalogUnitPrice;roundoff=roundoff.toFixed(2);pageContext.catalogUnitPrice=roundoff;var ToFixed=pageContext.catalogCustomerPrice;ToFixed=ToFixed.toFixed(2);pageContext.catalogCustomerPrice=ToFixed;}"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"billingCatalogProcessEvent","contextVar":{"catalog":{"unitPrice":"@pageContext.catalogUnitPrice","recver":"@pageContext.catalogRecver","name":"@pageContext.catalogName","description":"@pageContext.catalogDescription","catalogTypeId":"@pageContext.catalogTypeId","id":"@pageContext.catalogId","customerPrice":"@pageContext.catalogCustomerPrice","categoryId":"@pageContext.catalogCategoryId"},"subAction":"@pageContext.subAction"}}]}},{"endPoint":"process/start","name":"fireProcessEventFetchAllData","outputVarMap":{"data":"@pageContext.allQueryData"},"type":"api","actionDef":{"data":[{"processId":"4BMNCJ85IP","contextVar":{"catalogCategoryId":"@pageContext.catalogCategoryId"}}]}},{"name":"changeInCategory","type":"script","actionDef":"function(pageContext){pageContext.categoryTaxRate=pageContext.taxCategoryList[0].categoryTaxRate;}"},{"name":"initialData","type":"script","actionDef":"function(pageContext){if (pageContext.servicesAction == 'edit') {pageContext.initialCatalogName = pageContext.catalogName;pageContext.initialCatalogDescription = pageContext.catalogDescription;pageContext.initialCatalogCategoryId = pageContext.catalogCategoryId;pageContext.initialCatalogUnitPrice = pageContext.catalogUnitPrice; pageContext.initialCatalogCustomerPrice = pageContext.catalogCustomerPrice;pageContext.catalogTypeId='service';} else if (pageContext.servicesAction == 'add') {pageContext.catalogTypeId='service';  pageContext.initialcatalogName = '';pageContext.initialCatalogDescription = '';pageContext.initialCatalogCategoryId = '';pageContext.initialCatalogUnitPrice = '';pageContext.catalogCustomerPrice='';}}"},{"name":"setCategory","type":"script","actionDef":"function(pageContext){if(typeof pageContext.allQueryData[0].outputVar.taxCategoryList == 'object') {pageContext.selectedCategory = [];if (pageContext.allQueryData[0].outputVar.taxCategoryList.length > 0) {for(var j = 0; j < pageContext.allQueryData[0].outputVar.taxCategoryList.length; j++) {var obj = {label: pageContext.allQueryData[0].outputVar.taxCategoryList[j].categoryName,value: pageContext.allQueryData[0].outputVar.taxCategoryList[j].categoryId};pageContext.selectedCategory.push(obj);}}pageContext.arrCategory = pageContext.selectedCategory;}}"},{"name":"emptyCategoryTaxRate","type":"script","actionDef":"function(pageContext){pageContext.categoryTaxRate='';}"},{"name":"setSelectedCategoryId","type":"script","actionDef":"function(pageContext){if(typeof pageContext.selectedCategory!=='undefined' && pageContext.selectedCategory.length>0 && pageContext.selectedCategory[0]!==null)pageContext.catalogCategoryId=pageContext.selectedCategory[0].value; else pageContext.catalogCategoryId='';}"},{"name":"getTaxCategory","outputVarMap":{"data":"@pageContext.taxCategoryList"},"type":"query","actionDef":{"filter":"{@catalogCategoryId}={$categoryId}","models":["category"],"columns":{"categoryTaxRate":"category.taxRate","categoryName":"category.name","categoryId":"category.id"},"inputs":{"catalogCategoryId":"@pageContext.catalogCategoryId"}}},{"name":"setSubActionUpsertCatalog","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertCatalog';}"},{"name":"closeModal","type":"closeModal"},{"name":"closePanel","type":"closePanel"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"refreshGrid","type":"refreshDataGrid"}]}