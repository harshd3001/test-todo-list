{"pageContext":{},"actionOnLoad":["@actions.fetchSiteData","@actions.processSiteData","@actions.checkIfCustomerPortalInstalled","@actions.initialData1","@actions.setCustomerStatus","@actions.decisionActionForCustomerData"],"localPageContext":true,"jslib":{"isDeactivated":"function(pageContext){return (pageContext.customerSiteAction=='view');}","isSwitchHidden":"function(pageContext){if (pageContext.isCustomerPortalOrderDetailsModelPresent && pageContext.customerSiteAction == 'add'){ return false;}else{ return true;}}","secondaryContactNeeded":"function(pageContext){if (pageContext.isCustomerPortalOrderDetailsModelPresent && typeof pageContext.secondaryContactNeeded != 'undefined' && pageContext.secondaryContactNeeded) { return false; } else { return true; }}","cannotReactivate":"function(pageContext){return (pageContext.customerSiteAction !== 'view' || (pageContext.customerSiteAction === 'view' && pageContext.customerStatusId!=='customerActive'));}","canReactivate":"function(pageContext){return (pageContext.customerSiteAction !== 'view' || (pageContext.customerSiteAction === 'view' && pageContext.customerStatusId==='customerActive'));}","canDeactivate":"function(pageContext){return ((pageContext.customerSiteAction !== 'edit' && pageContext.customerSiteAction !== 'editInitial') || ((pageContext.customerSiteAction === 'editInitial' || pageContext.customerSiteAction === 'edit') && (typeof pageContext.inProgressTasksCount === 'undefined' || pageContext.inProgressTasksCount === '' ||pageContext.inProgressTasksCount === 0 )));}","isAdd":"function(pageContext){return(pageContext.customerSiteAction === 'add');}","dynamicHeaderText":"function(pageContext){ if(pageContext.customerSiteAction === 'add'){return '@lang.[\"ancs\",\"Add New Customer Site\"]'}else if(pageContext.customerSiteAction === 'edit' || pageContext.customerSiteAction === 'editInitial' || pageContext.customerSiteAction === 'view'){return '@lang.[\"ecs\",\"Edit Customer Site\"]'}}","cannotDeactivate":"function(pageContext){return ((pageContext.customerSiteAction !== 'edit' && pageContext.customerSiteAction !== 'editInitial') || ((pageContext.customerSiteAction === 'editInitial' || pageContext.customerSiteAction === 'edit') && (typeof pageContext.inProgressTasksCount === 'undefined' || pageContext.inProgressTasksCount === '' || pageContext.inProgressTasksCount >0)));}","getLocationCoordinates":"function(pageContext){if((typeof pageContext.siteAddress!=='undefined'&&pageContext.siteAddress!=='')&&((typeof pageContext.latitude!=='undefined'&&pageContext.latitude!=='')&&(typeof pageContext.longitude!=='undefined'&&pageContext.longitude!==''))){return[Number(pageContext.latitude),Number(pageContext.longitude)];}return[0,0];}","isSaveDisabled":"function(pageContext) {if (pageContext.customerSiteAction === 'add') { return ((typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.city === '') || (typeof pageContext.addressObj !== 'undefined' && pageContext.sitePostalCode === '') || (typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.country === '') || (typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.zipCode === '') || (typeof pageContext.selectedCustomerId !== 'undefined' && pageContext.selectedCustomerId[0] === null) || (typeof pageContext.siteName === 'undefined') || (pageContext.siteName === '') || (typeof pageContext.siteFileNumber === 'undefined') || (pageContext.siteFileNumber === '') || (typeof pageContext.siteCustomerId === 'undefined') || (pageContext.siteCustomerId === '') || (typeof pageContext.siteAddress === 'undefined') || (pageContext.siteAddress === '') || (typeof pageContext.siteRegionId === 'undefined') || (pageContext.siteRegionId === '') || (typeof pageContext.latitude === 'undefined') || (pageContext.latitude === '') || (typeof pageContext.longitude === 'undefined') || (pageContext.longitude === '') || (typeof pageContext.customerContactPerson === 'undefined') || (pageContext.customerContactPerson === '') || (typeof pageContext.customerContactPhone === 'undefined') || (pageContext.customerContactPhone === '') || (typeof pageContext.customerContactEmail === 'undefined') || (pageContext.customerContactEmail === '')) } else if (pageContext.customerSiteAction === 'edit' || pageContext.customerSiteAction === 'editInitial') { return (((typeof pageContext.fetchSiteDetails !== 'undefined') && (pageContext.initialCustomerContactPerson == pageContext.customerContactPerson) && (pageContext.initialCustomerContactTitle == pageContext.customerContactTitle) && (pageContext.initialCustomerContactPhone == pageContext.customerContactPhone) && (pageContext.initialCustomerContactEmail == pageContext.customerContactEmail) && (pageContext.siteName === pageContext.initialName) && (pageContext.siteFileNumber === pageContext.initialFileNumber) && (pageContext.initialDescription === pageContext.siteDescription) && (pageContext.siteCustomerId === pageContext.initialCustomerId) && (pageContext.initialAddress === pageContext.siteAddress) && (pageContext.initialAddressTwo === pageContext.siteAddressTwo) && (pageContext.siteRegionId === pageContext.initialRegionId) && (pageContext.initialSubRegionId === pageContext.siteSubRegionId) && (pageContext.initialLatitude === pageContext.latitude) && (pageContext.initialLongitude === pageContext.longitude) && (typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.city === pageContext.siteCity) && (pageContext.addressObj.zipCode === pageContext.sitePostalCode) && (pageContext.addressObj.country === pageContext.siteCountry) && (pageContext.addressObj.state === pageContext.siteState)) || ((typeof pageContext.siteName === 'undefined') || (pageContext.siteName === ''))|| ((typeof pageContext.siteFileNumber === 'undefined') || (pageContext.siteFileNumber === '')) || (typeof pageContext.siteCustomerId !== 'undefined' && pageContext.siteCustomerId === '') || (typeof pageContext.siteAddress !== 'undefined' && pageContext.siteAddress === '') || (typeof pageContext.siteRegionId !== 'undefined' && pageContext.siteRegionId === '') || (typeof pageContext.selectedCustomerId !== 'undefined' && pageContext.selectedCustomerId[0] === null) || (typeof pageContext.latitude !== 'undefined' && pageContext.latitude === '') || (typeof pageContext.longitude !== 'undefined' && pageContext.longitude === '') || (typeof pageContext.customerContactPerson !== 'undefined' && pageContext.customerContactPerson === '') || (typeof pageContext.customerContactPhone !== 'undefined' && pageContext.customerContactPhone === '') || (typeof pageContext.customerContactEmail !== 'undefined' && pageContext.customerContactEmail === '') || (typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.city === '') || (typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.zipCode === '') || (typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.country === '')); } else if (pageContext.customerSiteAction === 'view') { return true; }}"},"header":{"children":[{"hidden":"@jslib.isAdd","statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"buttonType":"secondary","hidden":"@jslib.canDeactivate","actionOnClick":["@actions.openCannotDeactivateModal"],"id":"submitDeactivateCustomerSite","type":"button","title":"@lang.['d10','Deactivate']"},{"buttonType":"secondary","hidden":"@jslib.cannotDeactivate","actionOnClick":["@actions.openCanDeactivateModal"],"id":"submitDeactivateCustomerSite","type":"button","title":"@lang.['d10','Deactivate']"},{"buttonType":"secondary","hidden":"@jslib.canReactivate","actionOnClick":["@actions.openCannotReactivateModal"],"id":"submitReactivateCustomerSite","type":"button","title":"@lang.['r6','Reactivate']"},{"buttonType":"secondary","hidden":"@jslib.cannotReactivate","actionOnClick":["@actions.openCanReactivateModal"],"id":"submitReactivateCustomerSite","type":"button","title":"@lang.['r6','Reactivate']"},{"buttonType":"primary","actionOnClick":["@actions.setSubActionUpsertCustomerSite","@actions.setLatLongData","@actions.fetchTimeZoneData","@actions.processTimeZoneData","@actions.fireProcessEvent","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submitCustomerSite","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"text","id":"siteName","label":"@lang.['sn1','Site Name']","placeholder":"@lang.['esn','Enter site name']","type":"input","value":"@pageContext.siteName"},{"disabled":"@jslib.isDeactivated","id":"siteDescription","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.siteDescription","placeHolder":"@lang.['ed1','Enter description']"},{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"text","id":"siteFileNumber","label":"@lang.['fn01','File Number']","placeholder":"@lang.['efn01','Enter File Number']","type":"input","value":"@pageContext.siteFileNumber"}],"label":"@lang.['gi','General Information']","id":"customerSiteInfo","type":"section"},{"children":[{"actionOnChange":["@actions.decisionActionForCustomerData"],"optLabelMap":"customerCompanyName","optValueMap":"siteCustomerId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":" {$customerCompanyName} like {@filter} AND {$customer.statusId}='customerActive' ","models":["customer"],"columns":{"customerContactPerson":"customer.contactPerson","customerContactPhone":"customer.contactPhone","siteCity":"customer.city","customerContactEmail":"customer.contactEmail","customerCompanyName":"customer.companyName","customerContactTitle":"customer.contactTitle","siteCustomerId":"customer.id"},"inputs":{},"orderBy":"customerCompanyName ASC","distinct":true}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":" {$siteCustomerId} = {@selectedCustomer} AND {$customer.statusId}='customerActive'","models":["customer"],"columns":{"customerContactPerson":"customer.contactPerson","customerContactPhone":"customer.contactPhone","siteCity":"customer.city","customerContactEmail":"customer.contactEmail","customerCompanyName":"customer.companyName","customerContactTitle":"customer.contactTitle","siteCustomerId":"customer.id"},"inputs":{"selectedCustomer":"@pageContext.selectedId"}},"columnsToBeHidden":["customerContactPerson","customerContactPhone","customerContactEmail","customerContactTitle","siteCustomerId"],"dataSourceId":"query/read","selectedRowAdvanceGrid":"AdvancedGridCustomerSite","rowsToBeSelect":"selectedId","sourceType":"query","sidePanelTitle":"@lang.['sc','Select Customer']","gridHeaderText":"@lang.['navC','Customers']","customColumns":{"siteCity":"@lang.['c','city']","customerCompanyName":"@lang.['c16','Customer']"},"searchKeys":["customerCompanyName"]},"disabled":"@jslib.isDeactivated","id":"selectedCustomerId","placeholder":"@lang.['c16','Customer']","type":"selectDropdown","value":"@pageContext.selectedCustomerId"}],"label":"@lang.['c16','Customer']","id":"customerSiteDetails","type":"section"},{"children":[{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"text","id":"customerContactPerson","label":"@lang.['cpn','Contact Person Name']","placeholder":"@lang.['en1','Enter name']","type":"input","value":"@pageContext.customerContactPerson"},{"isRequired":false,"disabled":"@jslib.isDeactivated","inputType":"text","id":"customerContactTitle","label":"@lang.['cpt','Contact Person Title']","placeholder":"@lang.['et','Enter title']","type":"input","value":"@pageContext.customerContactTitle"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"customerContactPhone","label":"@lang.['cp','Contact Phone']","type":"phoneNumber","value":"@pageContext.customerContactPhone"},{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"email","id":"customerContactEmail","label":"@lang.['ce','Contact Email']","placeholder":"@lang.['ee','Enter email']","type":"input","value":"@pageContext.customerContactEmail"},{"hidden":"@jslib.isSwitchHidden","id":"secondaryContact","label":"Additional Contact","placeholder":"Add a secondary contact for this Customer Site?","type":"switchComponent","value":"@pageContext.secondaryContactNeeded"},{"hidden":"@jslib.secondaryContactNeeded","disabled":"@jslib.isDeactivated","inputType":"text","id":"customerSecondaryContactPerson","label":"Secondary Contact Person Name","placeholder":"@lang.['en1','Enter name']","type":"input","value":"@pageContext.customerSecondaryContactPerson"},{"hidden":"@jslib.secondaryContactNeeded","disabled":"@jslib.isDeactivated","inputType":"text","id":"customerSecondaryContactTitle","label":"Secondary Contact Person Title","placeholder":"@lang.['et','Enter title']","type":"input","value":"@pageContext.customerSecondaryContactTitle"},{"hidden":"@jslib.secondaryContactNeeded","disabled":"@jslib.isDeactivated","id":"customerSecondaryContactPhone","label":"Secondary Contact Phone","type":"phoneNumber","value":"@pageContext.customerSecondaryContactPhone"},{"hidden":"@jslib.secondaryContactNeeded","disabled":"@jslib.isDeactivated","inputType":"email","id":"customerSecondaryContactEmail","label":"Secondary Contact Email","placeholder":"@lang.['ee','Enter email']","type":"input","value":"@pageContext.customerSecondaryContactEmail"}],"label":"@lang.['ci','Contact Information']","id":"customerSiteInfo","type":"section"},{"children":[{"containerElementHeight":"30rem","item":{"fieldsToShow":[]},"defaultZoom":17,"disabled":"@jslib.isDeactivated","preserveViewport":false,"location":{"children":[{"dataType":"label","id":"locationText","type":"text","value":"@pageContext.siteAddress"}],"coordinates":"@jslib.getLocationCoordinates","icon":"https://cdn.zeplin.io/5be3ee39a464fd7e89ffaaa0/assets/57BF1B12-69E2-4E77-881C-A53900EB4260.svg","type":"Point"},"id":"mapForShowStatic","type":"map","renderType":"location","mapElementHeight":"100%","mapJson":{}},{"isRequired":true,"actionOnChange":"@actions.clearLocation","disabled":"@jslib.isDeactivated","id":"siteAddress","label":"@lang.['address','Address']","placeholder":"@lang.['ea','Enter address']","type":"address","value":"@pageContext.siteAddress"},{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"text","id":"siteAddressTwo","label":"@lang.['at01','Address Two (Optional)']","placeholder":"@lang.['eat01','Enter Address Two']","type":"input","value":"@pageContext.siteAddressTwo"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"siteCity","label":"@lang.['c','City']","placeholder":"@lang.['ec','Enter city']","type":"input","value":"@pageContext.addressObj.city"},{"disabled":"@jslib.isDeactivated","id":"siteState","label":"@lang.['s30','State (Optional)']","placeholder":"@lang.['es','Enter state']","type":"input","value":"@pageContext.addressObj.state"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"sitePostalCode","label":"@lang.['pc','Postal Code']","placeholder":"@lang.['epc','Enter postal code']","type":"input","value":"@pageContext.addressObj.zipCode"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"siteCountry","label":"@lang.['c1','Country']","placeholder":"@lang.['ec1','Enter country']","type":"input","value":"@pageContext.addressObj.country"},{"isRequired":true,"actionOnChange":["@actions.subRegionQuery"],"options":"@pageContext.regionsList","disabled":"@jslib.isDeactivated","id":"regions","optTitleKey":"regionName","optValueKey":"regionId","title":"@lang.['m12','Market']","type":"dropdown","value":"@pageContext.siteRegionId","placeHolder":"@lang.['sm12','Select market']"},{"hidden":true,"options":"@pageContext.subRegionsList","disabled":"@jslib.isDeactivated","id":"subRegions","optTitleKey":"subRegionName","optValueKey":"subRegionId","title":"@lang.['sm13','Submarket (Optional)']","type":"dropdown","value":"@pageContext.siteSubRegionId","placeHolder":"@lang.['ssm13','Select submarket']"},{"address":"@pageContext.siteAddress","disabled":"@jslib.isDeactivated","id":"latitude","label":"@lang.['l','Latitude']","placeholder":"@lang.['el','Enter latitude']","type":"latitude","value":"@pageContext.latitude"},{"address":"@pageContext.siteAddress","disabled":"@jslib.isDeactivated","id":"longitude","label":"@lang.['l1','Longitude']","placeholder":"@lang.['el1','Enter longitude']","type":"longitude","value":"@pageContext.longitude"}],"label":"@lang.['sl','Site Location']","id":"customerSiteDetails","type":"section"}]},"actions":[{"subTitle":"@lang.['aysywtdtcsatpftswbac','Are you sure you want to deactivate this customer site? Any tasks planned for this site will be automatically cancelled.']","name":"openCanDeactivateModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeactivateCustomerSite","@actions.fireProcessEvent","@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"type":"button","title":"@lang.['d10','Deactivate']"}],"type":"openModal","title":"@lang.['dcs','Deactivate Customer Site']"},{"subTitle":"@lang.['tcscbdaoomtawtcsaco','This customer site cannot be deactivated, as one or more tasks associated with the customer site are currently ongoing.']","name":"openCannotDeactivateModal","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal"],"type":"button","title":"@lang.['o2','OK']"}],"type":"openModal","title":"@lang.['dcs','Deactivate Customer Site']"},{"subTitle":"@lang.['aysywtrtcs','Are you sure you want to reactivate this customer site?']","name":"openCanReactivateModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionReactivateCustomerSite","@actions.fireProcessEvent","@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"type":"button","title":"@lang.['r6','Reactivate']"}],"type":"openModal","title":"@lang.['rcs','Reactivate Customer Site']"},{"subTitle":"@lang.['tscbrbtcidprtcf','This site cannot be reactivated because the customer is deactivated. Please reactivate the customer first.']","name":"openCannotReactivateModal","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal"],"type":"button","title":"@lang.['o2','OK']"}],"type":"openModal","title":"@lang.['rcs','Reactivate Customer Site']"},{"name":"setSubActionDeactivateCustomerSite","type":"script","actionDef":"function(pageContext){pageContext.subAction='deactivateCustomerSite';pageContext.siteStatusId='siteDeactivated';}"},{"name":"setSubActionReactivateCustomerSite","type":"script","actionDef":"function(pageContext){pageContext.subAction='reactivateCustomerSite';pageContext.siteStatusId='siteActive';}"},{"falseStep":["@actions.clearCustomerData"],"trueStep":["@actions.selectCustomer","@actions.setSelectedCustomerData"],"name":"decisionActionForCustomerData","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.selectedCustomerId !=='undefined' && pageContext.selectedCustomerId !=='' && pageContext.selectedCustomerId[0] !== null) {return true;} return false;}"},{"name":"clearCustomerData","type":"script","actionDef":"function(pageContext){pageContext.customerContactPerson='';pageContext.customerContactTitle='';pageContext.customerContactPhone='';pageContext.customerContactEmail='';}"},{"name":"subRegionQuery","outputVarMap":{"data":"@pageContext.subRegionsList"},"type":"query","actionDef":{"filter":"{$subRegionRegionId} = {@idFilter}","models":["subRegion"],"columns":{"subRegionId":"subRegion.id","subRegionRegionId":"subRegion.regionId","subRegionName":"subRegion.name"},"inputs":{"idFilter":"@pageContext.siteRegionId"},"orderBy":"subRegionName ASC"}},{"name":"setCustomerStatus","type":"script","actionDef":"function(pageContext){if(typeof pageContext.customerStatus !== 'undefined' && pageContext.customerStatus !== '' && pageContext.customerStatus.length >0){ pageContext.customerStatusId = pageContext.customerStatus[0].customerStatusId; }}"},{"name":"clearLocation","type":"script","actionDef":"function(pageContext){if(typeof pageContext.siteAddress !== 'undefined'&&pageContext.siteAddress === ''){ pageContext.latitude = ''; pageContext.longitude = '' ;}}"},{"name":"initialData1","type":"script","actionDef":"function(pageContext) { pageContext.isCustomerPortalOrderDetailsModelPresent = pageContext.isCustomerPortalOrderDetailsModelPresent[0].outputVar.isCustomerPortalOrderDetailsModelPresent; if (pageContext.customerSiteAction == 'addInitial') { pageContext.siteStatusId = 'siteActive'; pageContext.siteName = ''; pageContext.siteDescription = ''; pageContext.siteAddress = ''; pageContext.siteAddressTwo = ''; pageContext.addressObj = {}; pageContext.addressObj.zipCode = ''; pageContext.addressObj.country = ''; pageContext.addressObj.state = ''; pageContext.addressObj.city = ''; pageContext.siteRegionId = ''; pageContext.siteFileNumber = ''; pageContext.siteSubRegionId = ''; pageContext.latitude = ''; pageContext.longitude = ''; pageContext.customerSiteAction == 'add'; } else if (pageContext.customerSiteAction == 'editInitial' || pageContext.customerSiteAction === 'view') { if (pageContext.customerSiteAction === 'editInitial') { pageContext.customerSiteAction = 'edit'; } pageContext.initialName = pageContext.siteName; pageContext.initialFileNumber = pageContext.siteFileNumber; pageContext.siteDescription = (typeof pageContext.siteDescription != 'undefined') ? pageContext.siteDescription : ''; pageContext.initialDescription = pageContext.siteDescription; pageContext.initialCustomerId = pageContext.siteCustomerId; pageContext.initialAddress = pageContext.siteAddress; pageContext.initialAddressTwo = pageContext.siteAddressTwo; pageContext.siteSubRegionId = (typeof pageContext.siteSubRegionId != 'undefined') ? pageContext.siteSubRegionId : ''; pageContext.initialRegionId = pageContext.siteRegionId; pageContext.initialSubRegionId = pageContext.siteSubRegionId; pageContext.initialLatitude = pageContext.latitude; pageContext.initialLongitude = pageContext.longitude; pageContext.customerCompanyName = pageContext.fetchSiteDetails[0].customerCompanyName; pageContext.initialCustomerCompanyName = pageContext.customerCompanyName; pageContext.customerContactEmail = (typeof pageContext.fetchSiteDetails[0].siteContactEmail != 'undefined') ? pageContext.fetchSiteDetails[0].siteContactEmail : ''; pageContext.initialCustomerContactEmail = pageContext.customerContactEmail; pageContext.customerContactPerson = (typeof pageContext.fetchSiteDetails[0].siteContactPerson != 'undefined') ? pageContext.fetchSiteDetails[0].siteContactPerson : ''; pageContext.initialCustomerContactPerson = pageContext.customerContactPerson; pageContext.customerContactPhone = (typeof pageContext.fetchSiteDetails[0].siteContactPhone != 'undefined') ? pageContext.fetchSiteDetails[0].siteContactPhone : ''; pageContext.initialCustomerContactPhone = pageContext.customerContactPhone; pageContext.customerContactTitle = (typeof pageContext.fetchSiteDetails[0].siteContactTitle != 'undefined') ? pageContext.fetchSiteDetails[0].siteContactTitle : ''; pageContext.initialCustomerContactTitle = pageContext.customerContactTitle; pageContext.customerSecondaryContactEmail = (typeof pageContext.fetchSiteDetails[0].siteSecondaryContactEmail != 'undefined') ? pageContext.fetchSiteDetails[0].siteSecondaryContactEmail : ''; pageContext.initialCustomerSecondaryContactEmail = pageContext.customerSecondaryContactEmail; pageContext.customerSecondaryContactPerson = (typeof pageContext.fetchSiteDetails[0].siteSecondaryContactPerson != 'undefined') ? pageContext.fetchSiteDetails[0].siteSecondaryContactPerson : ''; pageContext.initialCustomerSecondaryContactPerson = pageContext.customerSecondaryContactPerson; pageContext.customerSecondaryContactPhone = (typeof pageContext.fetchSiteDetails[0].siteSecondaryContactPhone != 'undefined') ? pageContext.fetchSiteDetails[0].siteSecondaryContactPhone : ''; pageContext.initialCustomerSecondaryContactPhone = pageContext.customerSecondaryContactPhone; pageContext.customerSecondaryContactTitle = (typeof pageContext.fetchSiteDetails[0].siteSecondaryContactTitle != 'undefined') ? pageContext.fetchSiteDetails[0].siteSecondaryContactTitle : ''; pageContext.initialCustomerSecondaryContactTitle = pageContext.customerSecondaryContactTitle; if (typeof pageContext.customerSecondaryContactEmail != 'undefined' && pageContext.customerSecondaryContactEmail !== '') { pageContext.secondaryContactNeeded = true; } pageContext.addressObj = {}; pageContext.addressObj.zipCode = pageContext.sitePostalCode; pageContext.addressObj.country = pageContext.siteCountry; pageContext.addressObj.state = pageContext.siteState; pageContext.addressObj.city = pageContext.siteCity; pageContext.selectedCustomerId = []; pageContext.selectedCustomerId.push({ 'value': pageContext.siteCustomerId, 'label': pageContext.customerCompanyName }); } }"},{"name":"setSubActionUpsertCustomerSite","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertCustomerSite';pageContext.siteStatusId='siteActive';}"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"customerCustomerSiteProcessEvent","contextVar":{"site":[{"country":"@pageContext.addressObj.country","city":"@pageContext.addressObj.city","postalCode":"@pageContext.addressObj.zipCode","latitude":"@pageContext.latitude","description":"@pageContext.siteDescription","contactPerson":"@pageContext.customerContactPerson","acTimeZone":"@pageContext.acTimeZone","contactTitle":"@pageContext.customerContactTitle","customerId":"@pageContext.selectedCustomerId[0].value","id":"@pageContext.siteId","state":"@pageContext.addressObj.state","secondaryContactPhone":"@pageContext.customerSecondaryContactPhone","acFileNumber":"@pageContext.siteFileNumber","longitude":"@pageContext.longitude","siteType":"customerSite","address":"@pageContext.siteAddress","statusTargetModel":"site","contactEmail":"@pageContext.customerContactEmail","secondaryContactPerson":"@pageContext.customerSecondaryContactPerson","secondaryContactTitle":"@pageContext.customerSecondaryContactTitle","statusId":"@pageContext.siteStatusId","regionId":"@pageContext.siteRegionId","secondaryContactEmail":"@pageContext.customerSecondaryContactEmail","name":"@pageContext.siteName","subRegionId":"@pageContext.siteSubRegionId","acAddressTwo":"@pageContext.siteAddressTwo","contactPhone":"@pageContext.customerContactPhone"}],"cancellationSubAction":"cancelWorkOrderTask","subAction":"@pageContext.subAction","siteId":"@pageContext.siteId"}}]}},{"name":"selectCustomer","outputVarMap":{"data":"@pageContext.fetchCustomerDetails"},"type":"query","actionDef":{"filter":"{$customerId}={@id}","models":["customer"],"columns":{"customerContactPerson":"customer.contactPerson","customerContactPhone":"customer.contactPhone","customerContactEmail":"customer.contactEmail","customerCompanyName":"customer.companyName","customerContactTitle":"customer.contactTitle","customerId":"customer.id"},"inputs":{"id":"@pageContext.selectedCustomerId[0].value"}}},{"name":"setSelectedCustomerData","type":"script","actionDef":"function(pageContext) {pageContext.siteCustomerId = pageContext.fetchCustomerDetails[0].customerId;pageContext.customerCompanyName = pageContext.fetchCustomerDetails[0].customerCompanyName; pageContext.customerContactEmail=pageContext.fetchCustomerDetails[0].customerContactEmail;pageContext.customerContactPerson=pageContext.fetchCustomerDetails[0].customerContactPerson;pageContext.customerContactPhone=pageContext.fetchCustomerDetails[0].customerContactPhone; pageContext.customerContactTitle=pageContext.fetchCustomerDetails[0].customerContactTitle;pageContext.initialCustomerContactTitle = pageContext.customerContactTitle }"},{"endPoint":"process/start","name":"checkIfCustomerPortalInstalled","outputVarMap":{"data":"@pageContext.isCustomerPortalOrderDetailsModelPresent"},"type":"api","actionDef":{"data":[{"processId":"checkIfCustomerPortalOrderDetailsModelPresentWF","contextVar":{"checkIfCustomerPortalOrderDetailsModelPresentWF":"checkIfCustomerPortalOrderDetailsModelPresentWF"}}]}},{"name":"processSiteData","type":"script","actionDef":"function(pageContext){pageContext.regionsList=pageContext.queryData[0].data[0].regionsList;if(pageContext.customerSiteAction=='editInitial' || pageContext.customerSiteAction=='view'){pageContext.fetchSiteDetails=pageContext.queryData[0].data[0].fetchSiteDetails;pageContext.subRegionsList=pageContext.queryData[0].data[0].subRegionsList;pageContext.inProgressTasks=pageContext.queryData[0].data[0].inProgressTasks;pageContext.customerStatus=pageContext.queryData[0].data[0].customerStatus;pageContext.inProgressTasksCount=pageContext.queryData[0].data[0].inProgressTasksCount;}}"},{"endPoint":"event/start","name":"fetchSiteData","outputVarMap":{"data":"@pageContext.queryData"},"type":"api","actionDef":{"data":[{"eventId":"customerCustomerSiteFetchDataProcessEvent","contextVar":{"siteRegionId":"@pageContext.siteRegionId","statusFilter":["workOrderTaskInProgress","workOrderTaskPendingReview","workOrderTaskAutoScheduling","workOrderTaskInTransit","workOrderTaskDelayed","workOrderTaskDiscontinued","workOrderTaskIncident"],"siteId":"@pageContext.siteId","siteCustomerId":"@pageContext.siteCustomerId"}}]}},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"closePanel","type":"closePanel"},{"name":"closeModal","type":"closeModal"},{"endPoint":"process/start","name":"fetchTimeZoneData","outputVarMap":{"data":"@pageContext.fetchTimeZoneData"},"type":"api","actionDef":{"data":[{"inputVar":{},"processId":"FGWSS34F7Z","contextVar":{"location":"@pageContext.location","timestamp":"@pageContext.timestamp"}}]}},{"name":"setLatLongData","type":"script","actionDef":"function(pageContext) { if (typeof pageContext.latitude !== 'undefined' && pageContext.latitude !== '' && typeof pageContext.longitude !== 'undefined' && pageContext.longitude !== '') {  pageContext.location = pageContext.latitude + ' ' + pageContext.longitude; pageContext.timestamp = +Math.floor(Date.now() / 1000); } }"},{"name":"processTimeZoneData","type":"script","actionDef":"function(pageContext) { if(pageContext.fetchTimeZoneData !== '' && typeof pageContext.fetchTimeZoneData !== 'undefined' ){pageContext.acTimeZone = pageContext.fetchTimeZoneData[0].outputVar.distance[0].timeZoneId;}}"}]}