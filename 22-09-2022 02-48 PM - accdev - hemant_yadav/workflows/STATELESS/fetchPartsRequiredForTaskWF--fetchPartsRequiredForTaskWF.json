{"getAssociatedSite":{"filter":"{$site.assignedToUserId} = {@workOrderTaskAssignedToUserId}","models":["site"],"connectors":[{"exitPortType":"NextStep","nodeId":"processResponseData"}],"columns":{"siteId":"site.id"},"name":"getAssociatedSite","description":"getAssociatedSite","inputVarMap":{"workOrderTaskAssignedToUserId":"workOrderTaskAssignedToUserId"},"outputVarMap":{"data":"siteData"},"nodeType":"QUERY"},"getRequiredParts":{"models":["workOrderInventory","catalog","stockUnit"],"connectors":[{"exitPortType":"NextStep","nodeId":"isTechnicianAssigned"}],"columns":{"catalogName":"catalog.name","estimatedQty":"workOrderInventory.estimatedQty","workOrderInventoryEstimatedQty":"CONCAT({$workOrderInventory.estimatedQty},' ',{$stockUnit.name})","catalogId":"catalog.id","catalogModelNumber":"catalog.modelNumber","catalogCatalogTypeId":"catalog.catalogTypeId","workOrderInventoryActualQty":"IF({$workOrderInventory.actualQty}!='' AND {$workOrderInventory.actualQty} IS NOT NULL,{$workOrderInventory.actualQty},0)","stockUnitName":"stockUnit.name"},"description":"getRequiredParts","orderBy":"catalogName ASC","outerJoinOnModel":"catalog","distinct":true,"inputVarMap":{"catalogId":"catalogId","initialFilter":"filter","workOrderTaskId":"workOrderTaskId","workOrderId":"workOrderId"},"nodeType":"QUERY","translate":true,"filter":"filter","name":"getRequiredParts","outputVarMap":{"data":"partsData","count":"partsCount"},"getCount":true},"isTechnicianAssigned":{"connectors":[{"exitPortType":"TrueStep","nodeId":"createFilter"},{"exitPortType":"FalseStep","nodeId":"processData"}],"name":"isTechnicianAssigned","description":"isTechnicianAssigned","processRule":"(typeof contextVar.workOrderTaskAssignedToUserId != 'undefined' && contextVar.workOrderTaskAssignedToUserId != '')","nodeType":"DECISION"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processData","description":"processData","processRule":"if (typeof contextVar.inventoryData != 'undefined' && Array.isArray(contextVar.inventoryData) && contextVar.inventoryData.length > 0) { contextVar.inventoryData = contextVar.inventoryData[0].inventoryData; contextVar.partsData.forEach(element => { for (let i = 0; i < contextVar.inventoryData.length; i++) { if (contextVar.inventoryData[i].inventoryCatalogId == element.catalogId) { element['inventoryQty'] = contextVar.inventoryData[i].inventoryQuantity; } } }); } else { contextVar.partsData.forEach(element => { element['inventoryQty'] = '-'; }); }","nodeType":"PROCESS","jsEngine":"es6"},"workflowContext":{"inventoryModelFilter":"{$inventoryCatalogId} IN {@catalogIdFilteredList} AND {$inventorySiteId} IN {@siteIdFilteredList}","onlyNeedInStockRecords":true},"processResponseData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fireFetchInventoryDataProcessEvent"}],"contextChangePermitted":true,"name":"processResponseData","description":"processResponseData","processRule":"if (Array.isArray(contextVar.siteData) && contextVar.siteData.length) { contextVar.siteIdFilteredList = []; contextVar.siteIdFilteredList.push(contextVar.siteData[0].siteId); }","id":"processResponseData","nodeType":"PROCESS","jsEngine":"es6"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"createInitialFilter"}],"name":"start","description":"Start","nodeType":"START"},"createInitialFilter":{"connectors":[{"exitPortType":"NextStep","nodeId":"getRequiredParts"}],"contextChangePermitted":true,"name":"createInitialFilter","description":"createInitialFilter","processRule":"{ if (typeof contextVar.catalogId != 'undefined' && contextVar.catalogId != '') { contextVar.initialFilter = '{$workOrderInventory.workOrderId} = {@workOrderId} AND {$workOrderInventory.workOrderTaskId} = {@workOrderTaskId} AND {$catalog.id} = {@catalogId}'; } else { contextVar.initialFilter = '{$workOrderInventory.workOrderId} = {@workOrderId} AND {$workOrderInventory.workOrderTaskId} = {@workOrderTaskId}'; } }","nodeType":"PROCESS","jsEngine":"es6"},"createFilter":{"connectors":[{"exitPortType":"NextStep","nodeId":"getAssociatedSite"}],"contextChangePermitted":true,"name":"createFilter","description":"createFilter","processRule":"{ contextVar.catalogIdFilteredList = []; if (typeof contextVar.partsData != 'undefined' && Array.isArray(contextVar.partsData) && contextVar.partsData.length > 0 && (typeof contextVar.catalogId == 'undefined')) { contextVar.partsData.forEach(element => { contextVar.catalogIdFilteredList.push(element.catalogId); }); } else { contextVar.catalogIdFilteredList.push(contextVar.catalogId); } }","nodeType":"PROCESS","jsEngine":"es6"},"fireFetchInventoryDataProcessEvent":{"eventId":"fetchInventoryDataProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"contextChangePermitted":true,"name":"fireFetchInventoryDataProcessEvent","description":"fireFetchInventoryDataProcessEvent","inputVarMap":{"siteIdFilteredList":"siteIdFilteredList","inventoryModelFilter":"inventoryModelFilter","catalogIdFilteredList":"catalogIdFilteredList","onlyNeedInStockRecords":"onlyNeedInStockRecords"},"outputVarMap":{"data":"inventoryData"},"nodeType":"PUBLISH","captureOutput":true},"end":{"name":"end","description":"End","inputVarMap":{"partsCount":"count","partsData":"partsData"},"outputVarMap":{"count":"count","partsData":"partsData"},"nodeType":"END"},"workflowNodes":["start","createInitialFilter","getRequiredParts","isTechnicianAssigned","createFilter","getAssociatedSite","processResponseData","fireFetchInventoryDataProcessEvent","processData","end"]}