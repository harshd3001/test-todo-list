{"acceptableStatuses":{"connectors":[{"exitPortType":"TrueStep","nodeId":"callTranslationWF"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"acceptableStatuses","description":"Use this for decision in workflow","processRule":"typeof contextVar.workOrderTaskStatusId !== 'undefined' &&  contextVar.workOrderTaskStatusId!== '' && contextVar.listOfStatuses.indexOf(contextVar.workOrderTaskStatusId) !== -1","id":"acceptableStatuses","nodeType":"DECISION"},"processNotificationData":{"connectors":[{"exitPortType":"NextStep","nodeId":"processDataSendNotification"}],"contextChangePermitted":true,"name":"processNotificationData","description":"Use this for processing data in workflow","processRule":"@KNUJH1IQDE","id":"processNotificationData","nodeType":"PROCESS","jsEngine":"es6"},"sendNotification":{"connectors":[{"exitPortType":"TrueStep","nodeId":"isCrewTask1"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"sendNotification","description":"sendNotification","processRule":"(contextVar.sendNotification)","nodeType":"DECISION"},"isCrewTask1":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCrewList"},{"exitPortType":"FalseStep","nodeId":"fetchUserList"}],"name":"isCrewTask1","description":"Use this for decision in workflow","processRule":"contextVar.crewTask","id":"isCrewTask1","nodeType":"DECISION"},"pushNotificationToUsers":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"pushNotificationToUsers","name":"pushNotificationToUsers","description":"pushNotificationToUsers","inputVarMap":{"userList":"userList","longText":"longText","shortText":"shortText"},"nodeType":"WORKFLOW"},"callTranslationWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"taskDetails"}],"processId":"fetchResourcesForLocale","name":"callTranslationWF","description":"callTranslationWF","inputVarMap":{"defaultLocale":"defaultLocale","resourceIdList":"resourceIdList","primaryLocale":"userLocale"},"id":"callTranslationWF","nodeType":"WORKFLOW"},"workflowContext":{"defaultLocale":"en-us","resourceIdList":["newTaskPushNotificationShort","newTaskPushNotificationLong","taskRejectPushNotificationLong","taskRejectPushNotificationShort","taskDiscontinuePushNotificationLong","taskDiscontinuePushNotificationShort","taskRecalledPushNotificationLong","taskRecalledPushNotificationShort","taskCancelPushNotificationLong","taskCancelPushNotificationShort"],"landingStatuses":{"trackParams":["assignedToUserId"],"workOrderTaskDispatched":{"workOrderTaskPendingReview":{"localizedshortText":"taskRejectPushNotificationShort","longText":"Task {@taskId} - {@taskType} has been rejected after review and reassigned to you.","shortText":"Task Rejected","localizedlongText":"taskRejectPushNotificationLong","replaceStr":["{@taskType}","{@taskId}"]},"workOrderTaskDiscontinued":{"localizedshortText":"taskDiscontinuePushNotificationShort","longText":"Task {@taskId} - {@taskType} has been discontinued and reassigned to you.","shortText":"Task Discontinued","localizedlongText":"taskDiscontinuePushNotificationLong","replaceStr":["{@taskType}","{@taskId}"]},"workOrderTaskOpen":{"localizedshortText":"newTaskPushNotificationShort","longText":"You\u2019ve been assigned a new task: {@taskType} for {@customerName} at {@siteName}","shortText":"New Task: {@taskType}","localizedlongText":"newTaskPushNotificationLong","replaceStr":["{@taskType}","{@customerName}","{@siteName}"]},"workOrderTaskScheduled":{"localizedshortText":"newTaskPushNotificationShort","longText":"You\u2019ve been assigned a new task: {@taskType} for {@customerName} at {@siteName}","shortText":"New Task: {@taskType}","localizedlongText":"newTaskPushNotificationLong","replaceStr":["{@taskType}","{@customerName}","{@siteName}"]}},"workOrderTaskCancelled":{"workOrderTaskInTransit":{"localizedshortText":"taskCancelPushNotificationShort","longText":"{@taskId} - {@taskType} for {@workOrderId} has been cancelled and removed from your queue by {@modifiedUser}: {@taskCancellationReason}","sendToPreviousAssignee":false,"shortText":"Task Cancelled","localizedlongText":"taskCancelPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}","{@taskCancellationReason}"]},"workOrderTaskDispatched":{"localizedshortText":"taskCancelPushNotificationShort","longText":"{@taskId} - {@taskType} for {@workOrderId} has been cancelled and removed from your queue by {@modifiedUser}: {@taskCancellationReason}","sendToPreviousAssignee":true,"shortText":"Task Cancelled","localizedlongText":"taskCancelPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}","{@taskCancellationReason}"]},"workOrderTaskDiscontinued":{"localizedshortText":"taskCancelPushNotificationShort","longText":"{@taskId} - {@taskType} for {@workOrderId} has been cancelled and removed from your queue by {@modifiedUser}: {@taskCancellationReason}","sendToPreviousAssignee":false,"shortText":"Task Cancelled","localizedlongText":"taskCancelPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}","{@taskCancellationReason}"]},"workOrderTaskScheduled":{"localizedshortText":"taskCancelPushNotificationShort","longText":"{@taskId} - {@taskType} for {@workOrderId} has been cancelled and removed from your queue by {@modifiedUser}: {@taskCancellationReason}","sendToPreviousAssignee":false,"shortText":"Task Cancelled","localizedlongText":"taskCancelPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}","{@taskCancellationReason}"]},"workOrderTaskInProgress":{"localizedshortText":"taskCancelPushNotificationShort","longText":"{@taskId} - {@taskType} for {@workOrderId} has been cancelled and removed from your queue by {@modifiedUser}: {@taskCancellationReason}","sendToPreviousAssignee":false,"shortText":"Task Cancelled","localizedlongText":"taskCancelPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}","{@taskCancellationReason}"]}},"workOrderTaskScheduled":{"workOrderTaskInTransit":{"localizedshortText":"taskRecalledPushNotificationShort","longText":"Task {@taskId} - {@taskType} for {@workOrderId} has been recalled and removed from your queue by {@modifiedUser}","shortText":"Task Recalled","localizedlongText":"taskRecalledPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}"]},"workOrderTaskDispatched":{"localizedshortText":"taskRecalledPushNotificationShort","longText":"Task {@taskId} - {@taskType} for {@workOrderId} has been recalled and removed from your queue by {@modifiedUser}","shortText":"Task Recalled","localizedlongText":"taskRecalledPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}"]},"workOrderTaskInProgress":{"localizedshortText":"taskRecalledPushNotificationShort","longText":"Task {@taskId} - {@taskType} for {@workOrderId} has been recalled and removed from your queue by {@modifiedUser}","shortText":"Task Recalled","localizedlongText":"taskRecalledPushNotificationLong","replaceStr":["{@taskType}","{@taskId}","{@workOrderId}","{@modifiedUser}"]}},"crewTrackParams":["assignedToCrewId"]},"listOfStatuses":["workOrderTaskDispatched","workOrderTaskScheduled","workOrderTaskCancelled"],"primaryLocale":"en-us"},"fetchCrewDetails":{"filter":"{$workOrderTaskId} ={@workOrderTaskId} AND {$crewMemberStatus} = 'workforceCrewOnCrew'","models":["workforceCrew","crew","workOrderTask","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskLogData"}],"columns":{"workforceCrewWorkforceUserId":"workforceCrew.workforceUserId","workOrderTaskId":"workOrderTask.id","crewMemberStatus":"workforceCrew.statusId"},"name":"fetchCrewDetails","description":"To get the crew details","distinct":true,"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"links":{"User":"workforce","workforce":"workforceCrew","workforceCrew":"crew","crew":"workOrderTask"},"id":"fetchCrewDetails","outputVarMap":{"data":"crewDetailsList"},"nodeType":"QUERY"},"userPreferences":{"filter":"{$taskId}={@workOrderTaskId}","models":["User","UserPref","workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"processPreferences"}],"columns":{"preferences":"UserPref.preferences","userId":"User.id"},"name":"userPreferences","distinct":true,"description":"Provide some description for your query","links":{"User":"workOrderTask","UserPref":"User"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"id":"userPreferences","outputVarMap":{"data":"userPreferences"},"nodeType":"QUERY"},"end":{"name":"end","description":"End","inputVarMap":{},"outputVarMap":{},"id":"end","nodeType":"END"},"isTaskReopened":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchtaskReviewLog"},{"exitPortType":"FalseStep","nodeId":"processNotificationData"}],"name":"isTaskReopened","description":"isTaskReopened","processRule":"(isNaN(contextVar.workOrderTaskReOpenCount) == false && contextVar.workOrderTaskReOpenCount > 0 )","nodeType":"DECISION","jsEngine":"es6"},"taskDetails":{"filter":"{$taskId}={@workOrderTaskId}","models":["taskType","workOrderTask","workOrder","customer","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"isCrewTask"}],"columns":{"taskType":"taskType.name","cancellationNotes":"workOrderTask.cancellationReason","modifiedByUser":"workOrderTask.modifiedByUser","siteName":"site.name","customerName":"customer.companyName","taskId":"workOrderTask.id"},"name":"taskDetails","distinct":true,"description":"Provide some description for your query","links":{"workOrder":"workOrderTask","workOrderTask":"site","taskType":"workOrderTask","site":"customer","customer":"workOrder"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"id":"taskDetails","outputVarMap":{"data":"taskData"},"nodeType":"QUERY"},"fetchTaskLogData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkDataArray"}],"processId":"fetchTaskLogData","name":"fetchTaskLogData","description":"Provide some description for your workflow node","inputVarMap":{"workOrderTaskId":"taskId"},"id":"fetchTaskLogData","outputVarMap":{"taskLogData":"taskLogData"},"nodeType":"WORKFLOW"},"fetchCrewList":{"filter":"{$id} = {@crewId} AND {$crewMemberStatus} ='workforceCrewOnCrew'","models":["User","workforceCrew","crew","workforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"processUserdata"}],"columns":{"workforceCrewWorkforceUserId":"workforceCrew.workforceUserId","crewMemberStatus":"workforceCrew.statusId","id":"crew.id"},"name":"fetchCrewList","distinct":true,"description":"Provide some description for your query","links":{"workforce":"User","workforceCrew":"workforce","crew":"workforceCrew"},"inputVarMap":{"currUser":"crewId"},"id":"fetchCrewList","outputVarMap":{"data":"newCrewDetails"},"nodeType":"QUERY"},"fetchModifiedUser":{"filter":"{$id} = {@user}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"pushNotificationToUsers"}],"columns":{"name":"User.name","id":"User.id"},"name":"fetchModifiedUser","distinct":true,"description":"Provide some description for your query","inputVarMap":{"modUser":"user"},"id":"fetchModifiedUser","outputVarMap":{"data":"modifiedUserData"},"nodeType":"QUERY"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"isContextVarNull"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"processDataSendNotification":{"connectors":[{"exitPortType":"NextStep","nodeId":"sendNotification"}],"contextChangePermitted":true,"name":"processDataSendNotification","description":"Processing site data and task details","processRule":"contextVar.logLevel = 'DEBUG'; contextVar.message='before sendNotification'+ JSON.stringify(contextVar);","id":"processDataSendNotification","nodeType":"PROCESS"},"workflowNodes":["start","isContextVarNull","acceptableStatuses","userPreferences","processPreferences","callTranslationWF","taskDetails","isCrewTask","fetchCrewDetails","fetchTaskLogData","checkDataArray","isTaskReopened","fetchtaskReviewLog","processNotificationData","processDataSendNotification","loggerSendNotification","sendNotification","fetchUserList","fetchCrewList","processUserdata","isCrewTask1","fetchUserPrefs","callTranslationWF1","fetchModifiedUser","pushNotificationToUsers","end"],"fetchtaskReviewLog":{"models":["workOrderTask","taskReviewLog","taskLog"],"connectors":[{"exitPortType":"NextStep","nodeId":"processNotificationData"}],"columns":{"taskLogEventType":"taskLog.eventType","cancellationNotes":"taskReviewLog.reviewNotes","cancellationReason":"taskReviewLog.listOptionAnswerId","modifiedDate":"taskReviewLog.modifiedDate","modifiedDate1TaskLog":"taskLog.modifiedDate","action":"taskReviewLog.action"},"description":"fetch task details","distinct":true,"orderBy":"modifiedDate DESC","inputVarMap":{"workOrderTaskId":"tId"},"nodeType":"QUERY","filter":"{$workOrderTask.id}={@tId}","name":"fetchtaskReviewLog","id":"fetchtaskReviewLog","outputVarMap":{"data":"taskReviewLogData"},"batchSize":"1"},"isCrewTask":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCrewDetails"},{"exitPortType":"FalseStep","nodeId":"fetchTaskLogData"}],"name":"isCrewTask","description":"Use this for decision in workflow","processRule":"contextVar.crewTask","id":"isCrewTask","nodeType":"DECISION"},"loggerSendNotification":{"connectors":[{"exitPortType":"NextStep","nodeId":"sendNotification"}],"name":"loggerSendNotification","description":"Provide some description for your logger node","inputVarMap":{"logLevel":"logLevel","message":"message"},"id":"loggerSendNotification","nodeType":"LOGGER"},"processPreferences":{"connectors":[{"exitPortType":"NextStep","nodeId":"callTranslationWF"}],"contextChangePermitted":true,"name":"processPreferences","description":"Use this for processing data in workflow","processRule":"if(Array.isArray(contextVar.userPreferences) && contextVar.userPreferences.length > 0 &&  contextVar.userPreferences[0].preferences && contextVar.userPreferences[0].preferences.userLocale){contextVar.primaryLocale = contextVar.userPreferences[0].preferences.userLocale.toLocaleLowerCase();}else{contextVar.primaryLocale = 'en-us';}","id":"processPreferences","nodeType":"PROCESS","jsEngine":"es6"},"fetchUserList":{"filter":"{$id} = {@user}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processUserdata"}],"columns":{"id":"User.id"},"name":"fetchUserList","distinct":true,"description":"Provide some description for your query","inputVarMap":{"currUser":"user"},"id":"fetchUserList","outputVarMap":{"data":"newUserDetails"},"nodeType":"QUERY"},"fetchUserPrefs":{"connectors":[{"exitPortType":"NextStep","nodeId":"callTranslationWF1"}],"processId":"fetchUserPreferences","name":"fetchUserPrefs","description":"fetchUserPrefs","inputVarMap":{"userList":"userList"},"nodeType":"WORKFLOW"},"checkDataArray":{"connectors":[{"exitPortType":"TrueStep","nodeId":"isTaskReopened"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkDataArray","description":"Use this for decision in workflow","processRule":"(Array.isArray(contextVar.taskData) && contextVar.taskData.length > 0)","id":"checkDataArray","nodeType":"DECISION"},"callTranslationWF1":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchModifiedUser"}],"processId":"fetchResourcesForLocale","name":"callTranslationWF1","description":"callTranslationWF1","inputVarMap":{"resourceIdList":"resourceIdList","listOfLocales":"userLocale"},"id":"callTranslationWF1","nodeType":"WORKFLOW"},"processUserdata":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchUserPrefs"}],"contextChangePermitted":true,"name":"processUserdata","description":"Use this for processing data in workflow","processRule":"contextVar.modUser = (Array.isArray(contextVar.taskData) && contextVar.taskData.length > 0 && contextVar.taskData[0].modifiedByUser) ? contextVar.taskData[0].modifiedByUser : '1AB'; contextVar.userList = []; if (contextVar.crewTask) { if (Array.isArray(contextVar.newCrewDetails) && contextVar.newCrewDetails.length > 0) { contextVar.newCrewDetails.forEach(obj => { if ((contextVar.crewMobileAccess === 'partialAccess') || (obj.workforceCrewWorkforceUserId === contextVar.workOrderTaskAssignedToUserId)) { contextVar.userList.push(obj.workforceCrewWorkforceUserId) } }); } } else { if (Array.isArray(contextVar.newUserDetails) && contextVar.newUserDetails.length > 0) { contextVar.newUserDetails.forEach(obj => contextVar.userList.push(obj.id)); } } contextVar.userList = new Set(contextVar.userList); contextVar.userList = [...contextVar.userList];","id":"processUserdata","nodeType":"PROCESS","jsEngine":"es6"},"isContextVarNull":{"connectors":[{"exitPortType":"TrueStep","nodeId":"acceptableStatuses"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isContextVarNull","description":"Use this for decision in workflow","processRule":"typeof contextVar !== 'undefined' &&  contextVar !== ''  && contextVar != null","id":"isContextVarNull","nodeType":"DECISION"}}