{"checkCrewId":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processFilterForCrewMembers"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkCrewId","description":"checkCrewId","processRule":"(typeof contextVar.crewId !== 'undefined' && contextVar.crewId !== '')","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkCrewId"}],"name":"start","description":"start","nodeType":"START"},"processFilterForCrewMembers":{"connectors":[{"exitPortType":"NextStep","nodeId":"getCrewsMemberData"}],"contextChangePermitted":true,"name":"processFilterForCrewMembers","description":"processFilterForCrewMembers","processRule":"contextVar.crewFilter = ''; if (typeof contextVar.filter !== 'undefined' && contextVar.filter != '') { contextVar.crewFilter += '{$workforceCrewId}= {@crewId} AND ' + contextVar.filter; } else { contextVar.crewFilter += '{$workforceCrewId}= {@crewId}' }","nodeType":"PROCESS"},"processCrewMemberStatusData":{"connectors":[{"exitPortType":"NextStep","nodeId":"processCrewMemberData"}],"contextChangePermitted":true,"name":"processCrewMemberStatusData","description":"processCrewMemberStatusData","processRule":"if (typeof contextVar.crewMembersData != 'undefined' && contextVar.crewMembersData != '' && contextVar.crewMembersData.length > 0 && typeof contextVar.crewMembersStatusData != 'undefined' && contextVar.crewMembersStatusData != '' && contextVar.crewMembersStatusData.length > 0) { contextVar.crewMembersData.forEach(function (crewMembersElement) { contextVar.crewMembersStatusData.forEach(function (crewMemberStatusElement) { if (crewMembersElement.workforceUserId === crewMemberStatusElement.workforceCrewUserId) { crewMembersElement['statusName'] = crewMemberStatusElement.statusName; crewMembersElement['statusNameColor'] = crewMemberStatusElement.statusNameColor; } }); }); }","nodeType":"PROCESS"},"workflowNodes":["start","checkCrewId","processFilterForCrewMembers","getCrewsMemberData","getCrewsMemberStatusData","processCrewMemberStatusData","processCrewMemberData","multiDecisionNode","getCrewInformationData","processCrewInformationData","fetchWeeklyScheduleData","getWorkGroupData","getPublicHolidayData","getWorkOrderTaskData","end"],"getCrewInformationData":{"filter":"{$crewId} = {@crewId}","models":["crew","contractor","region","calendar","workforce","ZStatus"],"connectors":[{"exitPortType":"NextStep","nodeId":"processCrewInformationData"}],"columns":{"crewLeadUserId":"crew.leadUserId","crewStatusName":"ZStatus.name","statusColor":"ZStatus.colorCode","regionName":"region.name","contractorName":"contractor.name","crewLongitude":"crew.longitude","crewStatusId":"crew.statusId","crewName":"crew.name","crewStartDate":"crew.startDate","calendarName":"calendar.name","crewAddress":"crew.address","crewLatitude":"crew.latitude","calendarCalendarType":"calendar.calendarType","crewRegionId":"crew.regionId","crewCalendarId":"crew.calendarId","crewId":"crew.id","crewDescription":"crew.description","crewContractorId":"crew.contractorId","crewEndDate":"crew.endDate"},"name":"getCrewInformationData","outerJoinOnModel":"crew","distinct":true,"description":"getCrewInformationData","links":{"calendar":"crew","contractor":"crew","workforce":"crew","region":"crew","crew":"contractor","ZStatus":"crew"},"inputVarMap":{"crewId":"crewId"},"outputVarMap":{"data":"crewInformationData"},"nodeType":"QUERY"},"getPublicHolidayData":{"filter":"{$calendarHolidayId} = {@calendarId}","models":["calendarHoliday","holiday"],"connectors":[{"exitPortType":"NextStep","nodeId":"getWorkOrderTaskData"}],"columns":{"calendarHolidayId":"calendarHoliday.calendarId","holidayRecver":"holiday.recver","holidayName":"holiday.name","holidayDate":"holiday.date","holidayId":"holiday.id"},"name":"getPublicHolidayData","description":"getPublicHolidayData","inputVarMap":{"calendarId":"calendarId"},"outputVarMap":{"data":"crewCalendarHolidayData"},"nodeType":"QUERY"},"getWorkOrderTaskData":{"filter":"{$assignedToCrewId} = {@crewId} ","models":["workOrderTask","ZStatus","crew","site","taskType"],"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","zStatusName":"ZStatus.name","workOrderTaskCreatedDate":"workOrderTask.createdDate","siteName":"site.name","assignedToCrewId":"workOrderTask.assignedToCrewId","workforceUserId":"workOrderTask.assignedToUserId","taskTypeName":"taskType.name","zStatusNameColor":"ZStatus.colorCode","workOrderTaskSiteId":"workOrderTask.siteId","workOrderTaskId":"workOrderTask.id","workOrderTaskWorkOrderId":"workOrderTask.workOrderId","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderTaskEstimatedDuration":"workOrderTask.estimatedDuration","workOrderTaskTaskTypeId":"workOrderTask.taskTypeId"},"name":"getWorkOrderTaskData","description":"getWorkOrderTaskData","inputVarMap":{"crewId":"crewId"},"links":{"taskType":"workOrderTask","site":"workOrderTask","ZStatus":"workOrderTask","crew":"workOrderTask"},"outputVarMap":{"data":"crewWorkOrderTaskData"},"nodeType":"QUERY"},"processCrewMemberData":{"connectors":[{"exitPortType":"NextStep","nodeId":"multiDecisionNode"}],"contextChangePermitted":true,"name":"processCrewMemberData","description":"processCrewMemberData","processRule":"if (typeof contextVar.crewMembersData !== 'undefined' && contextVar.crewMembersData !== '') { contextVar.crewMembersData.forEach(function (element) { var userSkill = '', userContractor = ''; element.skill.forEach(function (item) { userSkill = userSkill + ', ' + item.name; }); if(userSkill.length>0){element.skill = userSkill.slice('1');} else {element.skill = '-'} element.contractor.forEach(function (item) { userContractor = userContractor + ', ' + item.name; }); if(userContractor.length>0){element.contractor = userContractor.slice('1');} else{element.contractor = '-'} }); }","nodeType":"PROCESS"},"workflowContext":{},"processCrewInformationData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWeeklyScheduleData"}],"contextChangePermitted":true,"name":"processCrewInformationData","description":"processCrewInformationData","processRule":"{if(typeof contextVar.crewInformationData !== 'undefined' && contextVar.crewInformationData.length > 0){contextVar.calendarId=contextVar.crewInformationData[0].crewCalendarId;contextVar.workforceUserId=contextVar.crewInformationData[0].crewLeadUserId;}}","nodeType":"PROCESS"},"getCrewsMemberStatusData":{"filter":"{$workforceCrewId} = {@crewId}","models":["workforceCrew","ZStatus"],"connectors":[{"exitPortType":"NextStep","nodeId":"processCrewMemberStatusData"}],"columns":{"workforceCrewId":"workforceCrew.crewId","statusName":"ZStatus.name","workforceCrewUserId":"workforceCrew.workforceUserId","statusNameColor":"ZStatus.colorCode"},"name":"getCrewsMemberStatusData","distinct":true,"description":"getCrewsMemberStatusData","links":{"ZStatus":"workforceCrew"},"inputVarMap":{"crewId":"crewId"},"outputVarMap":{"data":"crewMembersStatusData"},"nodeType":"QUERY"},"multiDecisionNode":{"connectors":[{"condition":"contextVar.crewAction ==='edit' ","exitPortType":"NextStep","nodeId":"getCrewInformationData"},{"DefaultStep":true,"condition":"contextVar.crewAction=== ''","exitPortType":"NextStep","nodeId":"end"}],"name":"multiDecisionNode","description":"multiDecisionNode","nodeType":"MULTIDECISION"},"fetchWeeklyScheduleData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getWorkGroupData"}],"contextChangePermitted":true,"processId":"settingsGeneralCalendarWeeklyScheduleFetchDataWF","name":"fetchWeeklyScheduleData","description":"fetchWeeklyScheduleData","inputVarMap":{"calendarId":"id","timezoneOffset":"timezoneOffset"},"outputVarMap":{"calendarData":"calendarData"},"nodeType":"WORKFLOW"},"end":{"name":"end","description":"end","inputVarMap":{"crewCalendarHolidayData":"crewCalendarHolidayData","workGroup":"workGroup","crewInformationData":"crewInformationData","calendarData":"calendarData","crewMemberCount":"count","crewWorkOrderTaskData":"crewWorkOrderTaskData","crewMembersData":"crewMembersData"},"outputVarMap":{"crewCalendarHolidayData":"crewCalendarHolidayData","workGroup":"workGroup","crewInformationData":"crewInformationData","count":"count","calendarData":"calendarData","crewWorkOrderTaskData":"crewWorkOrderTaskData","crewMembersData":"crewMembersData"},"nodeType":"END"},"getCrewsMemberData":{"models":["workforceCrew","User","workforce","ZStatus"],"connectors":[{"exitPortType":"NextStep","nodeId":"getCrewsMemberStatusData"}],"columns":{"contractor":"[workforce]->[contractorWorkforce]->[contractorRegion]->[contractor](name)","workforceCrewId":"workforceCrew.crewId","workforceCity":"workforce.city","workforceCrewStatusId":"workforceCrew.statusId","skill":"[workforce]->[workforceSkill]->[Skill](name)","userPhoneNumber":"User.phoneNumber","statusName":"ZStatus.name","workforceCrewRecver":"workforceCrew.recver","workforceStatusId":"workforce.statusId","userName":"User.name","workforceUserId":"workforce.userId"},"outerJoinOnModel":"workforce","distinct":true,"description":"getCrewsMemberData","inputVarMap":{"crewFilter":"filter","crewId":"crewId","orderBy":"orderBy"},"nodeType":"QUERY","filter":"filter","name":"getCrewsMemberData","links":{"workforce":"User","workforceCrew":"workforce","ZStatus":"workforceCrew"},"outputVarMap":{"data":"crewMembersData","count":"crewMemberCount"},"getCount":true},"getWorkGroupData":{"filter":"{$crewId} = {@crewId}","models":["workGroup","crewWorkGroup"],"connectors":[{"exitPortType":"NextStep","nodeId":"getPublicHolidayData"}],"columns":{"crewId":"crewWorkGroup.crewId","workGroupName":"workGroup.name","workGroupId":"crewWorkGroup.workGroupId"},"name":"getWorkGroupData","description":"getWorkGroupData","distinct":true,"links":{"workGroup":"crewWorkGroup"},"inputVarMap":{"crewId":"crewId"},"outputVarMap":{"data":"workGroup"},"nodeType":"QUERY"}}