{"appendTechData":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendTechData","description":"appendTechData","processRule":"{ if (Array.isArray(contextVar.moreEligibleTechsData)) { contextVar.eligibleTechsData = contextVar.eligibleTechsData.concat(contextVar.moreEligibleTechsData); } contextVar.eligibileTechsBatchNumber++; }","nodeType":"PROCESS"},"areMoreBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreEligibleTechnicians"},{"exitPortType":"FalseStep","nodeId":"processFinalTechArray"}],"name":"areMoreBatchesPresent","description":"areMoreBatchesPresent","processRule":"(contextVar.noOfEligibleBatches >= 2 && contextVar.noOfEligibleBatches >= contextVar.eligibileTechsBatchNumber)","nodeType":"DECISION"},"workflowContext":{"customBatchSize":1000,"filterMethod":"workOrderType","emptyJunkData":[" "],"noOfEligibleBatches":0,"workforceStatusFilter":"workforceActive","eligibleTechsIds":[],"userStatusFilter":"Deactivated"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{ contextVar.noOfEligibleBatches = Math.ceil(contextVar.eligibleTechsCount / contextVar.customBatchSize);contextVar.eligibileTechsBatchNumber++; }","nodeType":"PROCESS"},"processFilter":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchAllEligibleTechnicians"}],"contextChangePermitted":true,"name":"processFilter","description":"processFilter","processRule":"{ if (typeof contextVar.workGroupDataObject !== 'undefined' && typeof contextVar.workGroupDataObject.workOrderType !== 'undefined' && Array.isArray(contextVar.workGroupDataObject.workOrderType.workGroupIdList) && contextVar.workGroupDataObject.workOrderType.workGroupIdList.length > 0) { contextVar.workOrderTypeWGIds = JSON.parse(JSON.stringify(contextVar.workGroupDataObject.workOrderType.workGroupIdList)); } var filter = '({$workforce.workforceType} IS NULL OR {$workforce.workforceType} != \"webUser\") AND {$workforce.statusId} = {@workforceStatusFilter} AND {$User.status} != {@userStatusFilter}'; if (typeof contextVar.workOrderTypeWGIds !== 'undefined' && contextVar.workOrderTypeWGIds.length > 0) { /* Setting the filter when workOrderType ids are present*/ contextVar.workOrderTypeFilter = '(' + filter + ' AND {$workforceUserId} NOT IN ({@fetchTechniciansToRemove})) OR (' + filter + 'AND ({$workforceWorkGroup.workGroupId} IN {@workOrderTypeWGIds} OR {$workforceWorkGroup.workGroupId} =\"all\"))'; } else { contextVar.workOrderTypeWGIds = JSON.parse(JSON.stringify(contextVar.emptyJunkData)); /* Setting the filter when workOrderType ids are empty or undefined i.e no work order type work group filter is applied*/ contextVar.workOrderTypeFilter =  '(' + filter + ' AND {$workforceUserId} NOT IN ({@fetchTechniciansToRemove})) OR (' + filter + ')'; } }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFilter"}],"name":"Start","description":"Start","id":"start","nodeType":"START"},"processFinalTechArray":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processFinalTechArray","description":"processFinalTechArray","processRule":"{ if (typeof contextVar.eligibleTechsData !== 'undefined' && contextVar.eligibleTechsData.length > 0) { contextVar.eligibleTechsIds = contextVar.eligibleTechsData.map(function (element) { return element.workforceUserId; }); } }","nodeType":"PROCESS"},"fetchAllEligibleTechnicians":{"models":["workforceWorkGroup","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"workforceUserId":"workforce.userId"},"inputs":{"fetchTechniciansToRemove":{"filter":"({$workforceWorkGroup.workGroupId} NOT IN {@workOrderTypeWGIds} AND {$workGroup.filterMethod} = \"workOrderType\")","models":["workforceWorkGroup","workGroup","workforce"],"columns":{"workforceWorkGroupUserId":"workforceWorkGroup.workforceUserId"},"name":"fetchTechniciansToRemove","distinct":true,"description":"fetchTechniciansToRemove","links":{"workforceWorkGroup":"workforce","workGroup":"workforceWorkGroup"},"inputVarMap":{"workOrderTypeWGIds":"workOrderTypeWGIds"},"selectColumns":["workforceWorkGroupUserId"]}},"distinct":true,"description":"fetchAllEligibleTechnicians","outerJoinOnModel":"workforce","inputVarMap":{"workOrderTypeFilter":"filter","customBatchSize":"batchSize","workOrderTypeWGIds":"workOrderTypeWGIds","workforceStatusFilter":"workforceStatusFilter","userStatusFilter":"userStatusFilter"},"nodeType":"QUERY","filter":"filter","name":"fetchAllEligibleTechnicians","links":{"workforceWorkGroup":"workforce","User":"workforce"},"outputVarMap":{"data":"eligibleTechsData","count":"eligibleTechsCount","batchNumber":"eligibileTechsBatchNumber"},"batchSize":"batchSize","getCount":true},"end":{"name":"End","description":"end","inputVarMap":{"filterMethod":"filterMethod","eligibleTechsIds":"eligibleTechsIds"},"outputVarMap":{"filterMethod":"filterMethod","eligibleTechsIds":"eligibleTechsIds"},"id":"end","nodeType":"END"},"workflowNodes":["start","processFilter","fetchAllEligibleTechnicians","findNumberOfBatches","areMoreBatchesPresent","fetchMoreEligibleTechnicians","appendTechData","processFinalTechArray","end"],"fetchMoreEligibleTechnicians":{"models":["workforceWorkGroup","workGroup","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTechData"}],"columns":{"workforceUserId":"workforce.userId"},"inputs":{"fetchTechniciansToRemove":{"filter":"({$workforceWorkGroup.workGroupId} NOT IN {@workOrderTypeWGIds} AND {$workGroup.filterMethod} = \"workOrderType\")","models":["workforceWorkGroup","workGroup","workforce"],"columns":{"workforceWorkGroupUserId":"workforceWorkGroup.workforceUserId"},"name":"fetchTechniciansToRemove","distinct":true,"description":"fetchTechniciansToRemove","links":{"workforceWorkGroup":"workforce","workGroup":"workforceWorkGroup"},"inputVarMap":{"workOrderTypeWGIds":"workOrderTypeWGIds"},"selectColumns":["workforceWorkGroupUserId"]}},"outerJoinOnModel":"workforce","distinct":true,"description":"fetchMoreEligibleTechnicians","inputVarMap":{"workOrderTypeFilter":"filter","customBatchSize":"batchSize","workOrderTypeWGIds":"workOrderTypeWGIds","workforceStatusFilter":"workforceStatusFilter","eligibileTechsBatchNumber":"batchNumber","userStatusFilter":"userStatusFilter"},"nodeType":"QUERY","filter":"filter","name":"fetchMoreEligibleTechnicians","links":{"workforceWorkGroup":"workforce","User":"workforce","workGroup":"workforceWorkGroup"},"outputVarMap":{"data":"moreEligibleTechsData"},"batchSize":"batchSize","getCount":true}}