{"pageContext":{},"actionOnLoad":["@actions.fetchCorrectiveTaskRequestData","@actions.setCorrectiveTaskRequestData","@actions.setInitialData","@actions.fireProcessEventForTaskReviewFetchData","@actions.fireProcessEventForSiteChangeLogData","@actions.processResponseData","@actions.fetchAssetData","@actions.calculateActualTaskDuration","@actions.getCurrentLatLong","@actions.processSiteChangeData","@actions.getUpdatedLatLong","@actions.setCoordinate","@actions.isHidden"],"localPageContext":true,"jslib":{"isDisabled":"function(pageContext){ if (pageContext.workOrderTaskAction === 'completed' ||pageContext.status==='workOrderTaskPendingReview' ) {return true;}}","isSubmitDisabled":"function(pageContext){if(pageContext.taskReviewResult===''||typeof pageContext.taskReviewResult==='undefined'){return true;}else if(pageContext.taskReviewResult==='approve'||pageContext.taskReviewResult==='reject'){return false;}}","dynamicHeaderText":"function(pageContext){ if(pageContext.action =='pendingReview' || pageContext.actionHeader =='completed'){return 'Task Review'}else if(pageContext.subAction === 'calendarViewTask'){return 'View Task'}}","getLocationCoordinates":"function(pageContext){if((typeof pageContext.siteAddress!=='undefined'&&pageContext.siteAddress!=='')&&((typeof pageContext.siteLatitude!=='undefined'&&pageContext.siteLatitude!=='')&&(typeof pageContext.siteLongitude!=='undefined'&&pageContext.siteLongitude!==''))){return[Number(pageContext.siteLatitude),Number(pageContext.siteLongitude)];}return[0,0];}","isNotesVisible":"function(pageContext) {if (pageContext.taskReviewResult === '' || typeof pageContext.taskReviewResult === 'undefined') {return true;}return false;}","isActionCompleted":"function(pageContext) { if (pageContext.workOrderTaskAction === 'completed') {return true;}}"},"header":{"children":[{"statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"buttonType":"primary","hidden":"@jslib.isActionCompleted","actionOnClick":["@actions.setBannerType","@actions.setSubAction","@actions.handleResponseData","@actions.fetchTaskTypeServices","@actions.setStatus","@actions.fireProcessEventForWorkOrderTask","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"disabled":"@jslib.isSubmitDisabled","id":"submit","type":"button","title":"@lang.['s20','Submit']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"id":"close","type":"buttonIcon"}],"title":"@lang.['tr1','Task Review']"},"body":{"children":[{"children":[{"children":[{"children":[{"isRequired":true,"actionOnChange":["@actions.isHidden","@actions.clearTaskReviewLogReviewNotes"],"options":[{"name":"@lang.['aact','Approve and Create Task']","id":"approve"},{"name":"@lang.['r4','Reject']","id":"reject"}],"disabled":"@jslib.isActionCompleted","id":"correctiveTaskReview","optTitleKey":"name","optValueKey":"id","title":"@lang.['ctr','Corrective Task Review']","type":"select","value":"@pageContext.taskReviewResult","placeHolder":"@lang.['co','Choose option']"},{"hidden":"@pageContext.isActionApprove","options":"@pageContext.listOption","disabled":"@jslib.isActionCompleted","optTitleKey":"listOptionAnswerOptionText","optValueKey":"listOptionAnswerOptionId","id":"rejectionReason","title":"@lang.['rejectionReason','Rejection Reason']","type":"select","value":"@pageContext.rejectionReason","placeHolder":"@lang.['selectReason','Select reason']"},{"hidden":"@pageContext.isReviewNoteVisible","disabled":"@jslib.isActionCompleted","inputType":"text","id":"taskReviewLogReviewNotes","label":"@lang.['rn','Review Notes (Optional)']","type":"textarea","value":"@pageContext.taskReviewLogReviewNotes","placeHolder":"@lang.['en2','Enter notes']"}],"id":"taskReview","label":"","type":"section"},{"children":[{"disabled":"@jslib.isDisabled","inputType":"text","id":"taskType","label":"@lang.['taskType','Task Type']","type":"input","value":"@pageContext.taskTypeName"},{"disabled":"@jslib.isDisabled","inputType":"text","id":"reason","label":"@lang.['r5','Reason']","type":"input","value":"@pageContext.reasonOfCorrectiveTaskRequest"},{"disabled":true,"inputType":"text","id":"asset","label":"@lang.['a','Asset']","type":"input","value":"@pageContext.asset"},{"hidden":"@pageContext.evidenceOne","aspectRation":"","id":"photoEvidenceOne","label":"@lang.['pe','Photo Evidence']","type":"image","value":"@pageContext.photoEvidenceOne"},{"hidden":"@pageContext.evidenceOne","disabled":"@jslib.isActionCompleted","inputType":"text","id":"taskReviewLogReviewNotesOne","label":"@lang.['n3','Notes']","type":"textarea","value":"@pageContext.taskReviewLogReviewNotesOne"},{"hidden":"@pageContext.evidenceTwo","aspectRation":"","id":"photoEvidenceTwo","label":"@lang.['pe','Photo Evidence']","type":"image","value":"@pageContext.photoEvidenceTwo"},{"hidden":"@pageContext.evidenceTwo","disabled":"@jslib.isActionCompleted","inputType":"text","id":"taskReviewLogReviewNotesTwo","label":"@lang.['n3','Notes']","type":"textarea","value":"@pageContext.taskReviewLogReviewNotesTwo"}],"id":"taskResult","label":"@lang.['rct','Requested Corrective Task']","type":"section"}],"label":"@lang.['rr1','Request Review']","type":"tab"},{"children":[{"children":[{"disabled":true,"inputType":"text","id":"workOrderTypeName","label":"@lang.['wot1','Work Order Type']","placeholder":"@lang.['wot1','Work Order Type']","type":"input","value":"@pageContext.workOrderTypeName"},{"disabled":true,"inputType":"text","id":"workOrderTaskWorkOrderId","label":"@lang.['WorkOrderId','Work Order ID']","placeholder":"@lang.['WorkOrderId','Work Order ID']","type":"input","value":"@pageContext.workOrderTaskWorkOrderId"}],"id":"workOrder","label":"@lang.['wo','Work Order']","type":"section"},{"children":[{"disabled":true,"inputType":"text","id":"taskTypeName","label":"@lang.['taskType','Task Type']","placeholder":"@lang.['taskType','Task Type']","type":"input","value":"@pageContext.taskTypeName"},{"disabled":true,"inputType":"text","id":"workOrderTaskNotes","label":"@lang.['n2','Notes (Optional)']","placeholder":"@lang.['n2','Notes (Optional)']","type":"input","value":"@pageContext.workOrderTaskNotes"}],"id":"taskDetails","label":"@lang.['taskDetails','Task Details']","type":"section"}],"label":"@lang.['otd','Original Task Details']","type":"tab"},{"children":[{"children":[{"disabled":true,"inputType":"text","id":"customerCompanyName","label":"@lang.['customer','Customer']","placeholder":"@lang.['cn2','Customer Name']","type":"input","value":"@pageContext.customerCompanyName"},{"disabled":true,"inputType":"text","id":"customerContactPerson","label":"@lang.['cpn','Contact Person Name']","placeholder":"@lang.['cpn','Contact Person Name']","type":"input","value":"@pageContext.customerContactPerson"},{"disabled":true,"inputType":"text","id":"customerContactTitle","label":"@lang.['ct3','Contact Title']","placeholder":"@lang.['ct3','Contact Title']","type":"input","value":"@pageContext.customerContactTitle"},{"disabled":true,"inputType":"text","id":"customerContactPhone","label":"@lang.['cp','Contact Phone']","type":"phoneNumber","value":"@pageContext.customerContactPhone","placeHolder":"@lang.['cp','Contact Phone']"},{"disabled":true,"inputType":"text","id":"customerContactEmail","label":"@lang.['ce','Contact Email']","placeholder":"@lang.['ce','Contact Email']","type":"input","value":"@pageContext.customerContactEmail"}],"id":"customer","label":"@lang.['customer','Customer']","type":"section"},{"children":[{"disabled":true,"inputType":"text","id":"siteName","label":"@lang.['cs','Customer Site']","placeholder":"@lang.['cs','Customer Site']","type":"input","value":"@pageContext.siteName"},{"disabled":true,"inputType":"text","id":"siteAddress","label":"@lang.['address','Address']","type":"address","value":"@pageContext.siteAddress","placeHolder":"@lang.['address','Address']"},{"containerElementHeight":"30rem","item":{"fieldsToShow":[]},"defaultZoom":17,"preserveViewport":false,"location":{"children":[{"dataType":"label","id":"siteAddressMap","type":"text","value":"@pageContext.siteAddress"}],"coordinates":"@jslib.getLocationCoordinates","icon":"https://cdn.zeplin.io/5be3ee39a464fd7e89ffaaa0/assets/57BF1B12-69E2-4E77-881C-A53900EB4260.svg","type":"Point"},"id":"mapForShowStatic","type":"map","renderType":"location","mapElementHeight":"100%","mapJson":{}}],"id":"location","label":"@lang.['l3','Location']","type":"section"}],"label":"@lang.['osd','Original Site Details']","id":"originalSiteDetail","type":"tab"}],"label":"","type":"tab"}]},"actions":[{"name":"calculateActualTaskDuration","type":"script","actionDef":"function(pageContext) {pageContext.asset=pageContext.assetData[0].catalogName; if (pageContext.workOrderTaskActualStartTime != undefined && pageContext.workOrderTaskCompletedDate != undefined) {var startDate = new Date(pageContext.workOrderTaskActualStartTime);var completedDate = new Date(pageContext.workOrderTaskCompletedDate);var diffTime = Math.abs(completedDate - startDate);pageContext.actualTaskDuration = Math.ceil(diffTime / (1000 * 60));}}"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"closePanel","type":"closePanel"},{"endPoint":"event/start","name":"fireProcessEventForTaskReviewFetchData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"LHCUF48WQB","contextVar":{"workOrderTaskTypeId":"@pageContext.workOrderTaskTypeId","workOrderTaskId":"@pageContext.workOrderTaskId"}}]}},{"endPoint":"event/start","name":"fireProcessEventForSiteChangeLogData","outputVarMap":{"data":"@pageContext.siteChangeLogData"},"type":"api","actionDef":{"data":[{"eventId":"OG76EF8DXK","contextVar":{"workOrderTaskId":"@pageContext.workOrderTaskId"}}]}},{"name":"isHidden","type":"script","actionDef":"function(pageContext){if((pageContext.taskReviewResult === 'approve') || (pageContext.taskReviewResult === 'reject')) {pageContext.isReviewNoteVisible = false;}if (pageContext.taskReviewResult === 'approve') { pageContext.taskTypeId = 'L4SW9O8XJU';pageContext.isActionReject = false;pageContext.isActionApprove = true;}if (pageContext.taskReviewResult === 'reject') {pageContext.isActionApprove = false;pageContext.isActionReject = true; pageContext.taskTypeId=pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskTaskTypeId; }}"},{"name":"clearTaskReviewLogReviewNotes","type":"script","actionDef":"function(pageContext) {pageContext.taskReviewLogReviewNotes = '';}"},{"name":"setStatus","type":"script","actionDef":"function(pageContext){pageContext.subAction=pageContext.taskReviewResult;if (pageContext.taskReviewResult === 'approve'){pageContext.statusId = 'workOrderTaskOpen';} else if (pageContext.taskReviewResult === 'reject') {pageContext.statusId = 'workOrderTaskRejected';}}"},{"name":"setBannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType = 'showBanner';}"},{"name":"setSubAction","type":"script","actionDef":"function(pageContext){if (pageContext.taskReviewResult == 'approve'){pageContext.subAction = 'upsertCustomerSite';}}"},{"endPoint":"batch/apis","name":"fireProcessEventForWorkOrderTask","type":"api","actionDef":{"data":[{"workOrderTaskWF":{"data":[{"processId":"QIFGIU7FDJ","contextVar":{"workOrderTask":{"processInstanceId":"@pageContext.workOrderTaskProcessInstanceId","assignedToUserId":"","taskTypeId":"@pageContext.taskTypeId","statusId":"@pageContext.statusId","statusTargetModel":"workOrderTask","taskTypeWebTask":"@pageContext.taskTypeWebTask","services":"@pageContext.taskTypeServices[0].services","id":"@pageContext.workOrderTaskId","reopenCount":"@pageContext.workOrderTaskReOpenCount"},"subAction":"upsertWorkOrderTask"}}],"actionUrl":"process/start"},"taskReviewWF":{"data":[{"processId":"V4NYJ58HL1","contextVar":{"listOptionAnswerId":"@pageContext.listOptionAnswerId","statusId":"@pageContext.statusId","subAction":"@pageContext.taskReviewResult","workOrderTaskId":"@pageContext.workOrderTaskId","taskReviewLogAction":"@pageContext.taskReviewLogAction","taskReviewLogReviewNotes":"@pageContext.taskReviewLogReviewNotes"}}],"actionUrl":"process/start"}}]}},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"handleResponseData","type":"script","actionDef":"function(pageContext){pageContext.subAction= pageContext.taskReviewResult; if(pageContext.subAction==='reject' && pageContext.responseData[0].data[0] != ''){pageContext.workOrderTaskProcessInstanceId = pageContext.responseData[0].data[0].zProcessInstanceId}; if(pageContext.subAction=='approve'){pageContext.statusId='workOrderTaskOpen'}else if(pageContext.subAction=='reject'){pageContext.statusId='workOrderTaskCompleted'}}"},{"name":"fetchCorrectiveTaskRequestData","outputVarMap":{"data":"@pageContext.correctiveTaskRequestData"},"type":"query","actionDef":{"filter":"{$id}={@workOrderTaskId}","models":["workOrderTask"],"columns":{"result":"workOrderTask.result","id":"workOrderTask.id"},"inputs":{"workOrderTaskId":"@pageContext.workOrderTaskId"}}},{"name":"fetchTaskTypeServices","outputVarMap":{"data":"@pageContext.taskTypeServices"},"type":"query","actionDef":{"filter":"{$id}={@taskTypeId}","models":["taskType"],"columns":{"services":"tasktype.services","id":"taskType.id"},"inputs":{"taskTypeId":"L4SW9O8XJU"}}},{"name":"fetchAssetData","outputVarMap":{"data":"@pageContext.assetData"},"type":"query","actionDef":{"filter":"{$id}={@id}","models":["catalog"],"columns":{"catalogName":"catalog.name","id":"catalog.id"},"inputs":{"id":"@pageContext.correctiveTaskRequestData[0].result[0].assetsDataGrid"}}},{"name":"getCurrentLatLong","type":"script","actionDef":"function(pageContext){pageContext.currentLatLong = pageContext.siteLatitude + ',' + pageContext.siteLongitude}"},{"name":"setCorrectiveTaskRequestData","type":"script","actionDef":"function(pageContext){ if (typeof pageContext.correctiveTaskRequestData[0].result !== 'undefined' || pageContext.correctiveTaskRequestData[0].result.length > 0) { pageContext.reasonOfCorrectiveTaskRequest = pageContext.correctiveTaskRequestData[0].result[0].reasonOfCorrectiveTaskRequest; if ((typeof pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst === 'undefined' || pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst === '') && (typeof pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoSecond === 'undefined' || pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoSecond === '')) { pageContext.evidenceOne = true; pageContext.evidenceTwo = true; } else if ((typeof pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst !== 'undefined' || pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst !== '') && (typeof pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoSecond === 'undefined' || pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoSecond === '')) { pageContext.photoEvidenceOne = pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst.media; pageContext.taskReviewLogReviewNotesOne = pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst.comment; pageContext.evidenceOne = false; pageContext.evidenceTwo = true; } else { pageContext.photoEvidenceOne = pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst.media; pageContext.taskReviewLogReviewNotesOne = pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoFirst.comment; pageContext.photoEvidenceTwo = pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoSecond.media; pageContext.taskReviewLogReviewNotesTwo = pageContext.correctiveTaskRequestData[0].result[0].correctiveTaskRequestPhotoSecond.comment; pageContext.evidenceOne = false; pageContext.evidenceTwo = false; } } }"},{"name":"getUpdatedLatLong","type":"script","actionDef":"function(pageContext){pageContext.updatedLatLong = pageContext.updatedLat + ',' + pageContext.updatedLong}"},{"name":"setCoordinate","type":"script","actionDef":"function(pageContext){pageContext.corrdinate1=[parseFloat(pageContext.siteLatitude),parseFloat(pageContext.siteLongitude)];pageContext.corrdinate2=[parseFloat(pageContext.updatedLat),parseFloat(pageContext.updatedLong)];pageContext.arr1=[];var obj1={coordinates:pageContext.corrdinate1,icon:'https://zinier-static.s3-us-west-2.amazonaws.com/workflow-images/Red%40svg.svg',type:'Point',children:[{id:'text1',type:'text',dataType:'label',value:'Current Address'}]};var obj2={coordinates:pageContext.corrdinate2,icon:'https://zinier-static.s3-us-west-2.amazonaws.com/workflow-images/Green%40svg.svg',type:'Point',children:[{id:'text2',type:'text',dataType:'label',value:'Updated Address'}]};pageContext.arr1.push(obj1);pageContext.arr1.push(obj2);}"},{"name":"setInitialData","type":"script","actionDef":"function(pageContext){pageContext.isReviewNoteVisible = true;pageContext.isActionApprove = true;pageContext.isActionReject = true; if (pageContext.status ==='workOrderTaskCompleted'){pageContext.taskReviewResult = 'approve'}}"},{"name":"processResponseData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.responseData !== 'undefined' && pageContext.responseData !== '') { if (pageContext.responseData[0].data[0].workOrderTaskData.length > 0) { for (var i = 0; i < pageContext.responseData[0].data[0].workOrderTaskData.length; i++) { if (typeof pageContext.responseData[0].data[0].workOrderTaskData[i].workOrderTaskData !== 'undefined') { pageContext.workOrderTaskData = pageContext.responseData[0].data[0].workOrderTaskData[i].workOrderTaskData; } } } else { pageContext.workOrderTaskData = pageContext.responseData[0].data[0].workOrderTaskData; } pageContext.workOrderTaskId = pageContext.workOrderTaskData.workOrderTaskId; pageContext.taskTypeName = pageContext.workOrderTaskData.taskTypeName; pageContext.workOrderTaskWorkOrderId = pageContext.workOrderTaskData.workOrderTaskWorkOrderId; pageContext.workOrderTypeName = pageContext.workOrderTaskData.workOrderTypeName; pageContext.ZPriorityName = pageContext.workOrderTaskData.ZPriorityName; pageContext.siteName = pageContext.workOrderTaskData.siteName; pageContext.workOrderTaskNotes = pageContext.workOrderTaskData.workOrderTaskNotes; pageContext.workOrderTaskDueDate = pageContext.workOrderTaskData.workOrderTaskDueDate; pageContext.workOrderTaskEstimatedDuration = pageContext.workOrderTaskData.workOrderTaskEstimatedDuration; pageContext.workOrderTaskActualStartTime = pageContext.workOrderTaskData.workOrderTaskActualStartTime; pageContext.workOrderTaskCompletedDate = pageContext.workOrderTaskData.workOrderTaskCompletedDate; pageContext.listOption = pageContext.responseData[0].data[0].listOptionData; pageContext.actualTaskDuration = pageContext.workOrderTaskData.actualTaskDuration; pageContext.customerContactPerson = pageContext.workOrderTaskData.customerContactPerson; pageContext.customerContactTitle = pageContext.workOrderTaskData.customerContactTitle; pageContext.customerContactPhone = pageContext.workOrderTaskData.customerContactPhone; pageContext.customerContactEmail = pageContext.workOrderTaskData.customerContactEmail; pageContext.siteAddress = pageContext.workOrderTaskData.siteAddress; pageContext.siteLongitude = pageContext.workOrderTaskData.siteLongitude; pageContext.siteLatitude = pageContext.workOrderTaskData.siteLatitude; pageContext.taskTypeWebTask = pageContext.workOrderTaskData.taskTypeWebTask; } }"},{"name":"processSiteChangeData","type":"script","actionDef":"function(pageContext){ if(typeof pageContext.siteChangeLogData !== 'undefined' && pageContext.siteChangeLogData !== '') {pageContext.updatedLocation = pageContext.siteChangeLogData[0].data[0].siteChangeLogData[0].siteChangeLogAddress;pageContext.photoEvidence = pageContext.siteChangeLogData[0].data[0].siteChangeLogData[0].siteChangeLogPhotoUrl;pageContext.reason = pageContext.siteChangeLogData[0].data[0].siteChangeLogData[0].siteChangeLogReason;pageContext.notes = pageContext.siteChangeLogData[0].data[0].siteChangeLogData[0].siteChangeLogNotes;pageContext.updatedLat = pageContext.siteChangeLogData[0].data[0].siteChangeLogData[0].siteChangeLogLatitude;pageContext.updatedLong = pageContext.siteChangeLogData[0].data[0].siteChangeLogData[0].siteChangeLogLongitude;pageContext.siteId = pageContext.responseData[0].data[0].workOrderTaskData.siteId}}"}]}