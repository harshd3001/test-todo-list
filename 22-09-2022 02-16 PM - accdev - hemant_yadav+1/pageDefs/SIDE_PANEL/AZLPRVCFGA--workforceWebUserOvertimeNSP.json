{"pageContext":{},"actionOnLoad":["@actions.initialData"],"localPageContext":true,"jslib":{"isDeleteDisabled":"function(pageContext){return (pageContext.overtimeAction === 'add');}","bannerText":"function(pageContext){ if(pageContext.showBanner==='leaveConflict'){ return pageContext.bannerText = '@lang.[\"oicwpl\",\"Overtime is conflicting with planned leave\"]';} else if(pageContext.showBanner==='shiftConflict'){ return pageContext.bannerText = '@lang.[\"oicwns\",\"Overtime is conflicting with normal shift\"]'; } }","dynamicHeaderText":"function(pageContext){ if(pageContext. overtimeAction === 'add'){return '@lang.[\"ao3\",\"Add Overtime\"]'}else if(pageContext. overtimeAction === 'edit'){return '@lang.[\"eo\",\"Edit Overtime\"]'}}","isSaveDisabled":"function(pageContext){return (((pageContext.initialWorkforceOvertimeStartDate == pageContext.workforceOvertimeStartDate) && (pageContext.initialWorkforceOvertimeEndDate == pageContext.workforceOvertimeEndDate) && (pageContext.initialWorkforceOvertimeTotalTime == pageContext.workforceOvertimeTotalTime) && (pageContext.initialWorkforceOvertimeNotes == pageContext.workforceOvertimeNotes)) || ((pageContext.workforceOvertimeStartDate === '') || (pageContext.workforceOvertimeEndDate === '') || (pageContext.workforceOvertimeStartDate === pageContext.workforceOvertimeEndDate)|| (pageContext.workforceOvertimeTotaltime === '') || (pageContext.buttonDisabled!=false))) }","isBannerHidden":"function(pageContext){if (pageContext.bannerType==='hide') { return true; } else if(pageContext.bannerType==='show') { return false; }}"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel","@actions.refreshDataGrid"],"type":"buttonIcon"}]},"children":[{"hidden":"@jslib.isDeleteDisabled","icon":"@iconlib.ActionsBinGrey","actionOnClick":["@actions.setSubActionDelete","@actions.fireProcessEvent","@actions.openPreviousPanel","@actions.refreshDataGrid"],"id":"deleteOvertime","type":"buttonIcon"},{"buttonType":"primary","actionOnClick":["@actions.setSubActionUpsert","@actions.fireProcessEvent","@actions.openPreviousPanel","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save ']"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"alertMessage":"@jslib.bannerText","actionOnChange":"@actions.clearBannerType","onClose":"@actions.clearBannerType","alertType":"warning","hidden":"@jslib.isBannerHidden","id":"alertMessage","type":"alert","timeout":300000},{"children":[{"actionOnChange":["@actions.checkEndDate","@actions.calculateTotalTime","@actions.checkingOvertimeConflict"],"minDate":"1970-01-01 00:00","id":"startDateTime","title":"@lang.['sdt','Start Date & Time']","type":"datetime","value":"@pageContext.workforceOvertimeStartDate","placeHolder":"@lang.['sdt1','Select date & time']"},{"actionOnChange":["@actions.calculateTotalTime","@actions.checkingOvertimeConflict"],"minDate":"@pageContext.workforceOvertimeStartDate","id":"endDateTime","title":"@lang.['edt','End Date & Time']","type":"datetime","value":"@pageContext.workforceOvertimeEndDate","placeHolder":"@lang.['sdt1','Select date & time']"},{"disabled":true,"id":"totalTime","label":"@lang.['tt2','Total Time']","placeholder":"@lang.['a5','Autofilled']","type":"input","value":"@pageContext.workforceOvertimeTotalTime"},{"inputType":"text","id":"notes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.workforceOvertimeNotes","placeHolder":"@lang.['en2','Enter notes']"}],"label":"@lang.['o','Overtime']","id":"overtime","type":"section"}]},"actions":[{"name":"openPreviousPanel","type":"backPanel"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceTechnicianOvertimeProcessEvent","contextVar":{"workforceOvertime":[{"notes":"@pageContext.workforceOvertimeNotes","endDate":"@pageContext.workforceOvertimeEndDate","recver":"@pageContext.workforceOvertimeRecver","id":"@pageContext.workforceOvertimeId","workforceUserId":"@pageContext.workforceUserId","startDate":"@pageContext.workforceOvertimeStartDate"}],"overTimeAction":"@pageContext.overtimeAction","subAction":"@pageContext.subAction","notificationEndDate":"@pageContext.notificationEndDate","notificationStartDate":"@pageContext.notificationStartDate"}}]}},{"name":"calculateTotalTime","type":"script","actionDef":"function(pageContext) { if (typeof pageContext.workforceOvertimeStartDate !== 'undefined' && pageContext.workforceOvertimeStartDate !== '' && typeof pageContext.workforceOvertimeEndDate !== 'undefined' && pageContext.workforceOvertimeEndDate !== '') { var overtimeStartDate = new Date(pageContext.workforceOvertimeStartDate); var overtimeEndDate = new Date(pageContext.workforceOvertimeEndDate); var timeDifferenceMiliSeconds = overtimeEndDate.getTime() - overtimeStartDate.getTime(); var days = parseInt(timeDifferenceMiliSeconds / 86400000); timeDifferenceMiliSeconds -= days * 86400000; var hours = parseInt(timeDifferenceMiliSeconds / 3600000); timeDifferenceMiliSeconds -= hours * 3600000; var minute = parseInt(timeDifferenceMiliSeconds / 60000 ); pageContext.workforceOvertimeTotalTime = days + ' @lang.[\" d12 \",\" Day \"] ' + hours + ' @lang.[\" h \",\" Hours \"] ' + minute + ' @lang.[\" m2 \",\" Minutes \"]'; } else { pageContext.workforceOvertimeTotalTime; } }"},{"name":"initialData","type":"script","actionDef":"function(pageContext){if (pageContext. overtimeAction == 'edit') {pageContext.initialWorkforceOvertimeStartDate = pageContext.workforceOvertimeStartDate;pageContext.initialWorkforceOvertimeEndDate = pageContext.workforceOvertimeEndDate;pageContext.initialWorkforceOvertimeTotalTime = pageContext.workforceOvertimeTotalTime; pageContext.initialWorkforceOvertimeNotes = pageContext.workforceOvertimeNotes;} else if (pageContext. overtimeAction == 'add') {pageContext.workforceOvertimeStartDate=''; pageContext.workforceOvertimeNotes = ''; pageContext.workforceOvertimeEndDate = '';pageContext.workforceOvertimeTotalTime = '';pageContext.showBanner='';pageContext.bannerType='hide';pageContext.buttonDisabled=false;}}"},{"name":"setSubActionDelete","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteWorkforceOvertime';}"},{"name":"setSubActionUpsert","type":"script","actionDef":" function(pageContext){pageContext.subAction='upsertWorkforceOvertime';}"},{"name":"checkingOvertimeConflict","type":"script","actionDef":"function(pageContext) { var checkCondition = true; var leaves = []; leaves = pageContext.leaveData; var calendar = []; calendar = pageContext.calendarData; pageContext.bannerType = 'hide'; pageContext.buttonDisabled = false; pageContext.showBanner = ''; var overTimeStartDisplayOrder = new Date(pageContext.workforceOvertimeStartDate).getDay(); var overTimeEndDisplayOrder = new Date(pageContext.workforceOvertimeEndDate).getDay(); for (var values in leaves) { var startDate = new Date(leaves[values].workforceLeaveStartDate); var endDate = new Date(leaves[values].workforceLeaveEndDate); if (new Date(pageContext.workforceOvertimeStartDate) >= startDate && new Date(pageContext.workforceOvertimeStartDate) <= endDate || new Date(pageContext.workforceOvertimeEndDate) >= endDate && new Date(pageContext.workforceOvertimeEndDate) <= startDate) { checkCondition = false; pageContext.bannerType = 'show'; pageContext.buttonDisabled = true; pageContext.showBanner = 'leaveConflict'; } } if (checkCondition == true) { for (var value in calendar) { if (overTimeStartDisplayOrder == parseInt(calendar[value].weeklyScheduleDisplayOrder)) { if (calendar[value].weeklyScheduleIsOpen) { if (calendar[value].weeklyScheduleIsAllDay == true) { pageContext.bannerType = 'show'; pageContext.buttonDisabled = true; pageContext.showBanner = 'shiftConflict'; } else if (calendar[value].weeklyScheduleSchedule.length !== 0) { calendar[value].weeklyScheduleSchedule.forEach(function(element) { var startTime = element.startTime.split(' ')[1]; var endTime = element.endTime.split(' ')[1]; if ((startTime <= pageContext.workforceOvertimeStartDate.split(' ')[1] && pageContext.workforceOvertimeStartDate.split(' ')[1] <= endTime) || (pageContext.workforceOvertimeEndDate.split(' ')[1] >= startTime && pageContext.workforceOvertimeEndDate.split(' ')[1] <= endTime)) { pageContext.bannerType = 'show'; pageContext.buttonDisabled = true; pageContext.showBanner = 'shiftConflict'; } }); } } } if (overTimeEndDisplayOrder == parseInt(calendar[value].weeklyScheduleDisplayOrder)) { if (calendar[value].weeklyScheduleIsOpen) { if (calendar[value].weeklyScheduleIsAllDay == true) { pageContext.bannerType = 'show'; pageContext.buttonDisabled = true; pageContext.showBanner = 'shiftConflict'; } else if (calendar[value].weeklyScheduleSchedule.length !== 0) { calendar[value].weeklyScheduleSchedule.forEach(function(element) { var startTime = element.startTime.split(' ')[1]; var endTime = element.endTime.split(' ')[1]; if ((pageContext.workforceOvertimeEndDate.split(' ')[1] >= startTime && pageContext.workforceOvertimeEndDate.split(' ')[1] <= endTime)) {pageContext.bannerType = 'show'; pageContext.buttonDisabled = true; pageContext.showBanner = 'shiftConflict'; } }); } } } } } }"},{"name":"clearBannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType ='hide';}"},{"name":"refreshDataGrid","gridId":["workforceOvertime"],"type":"RefreshGridOnSidePanel"},{"name":"checkEndDate","type":"script","actionDef":"function(pageContext) { if (typeof pageContext.workforceOvertimeStartDate !== 'undefined' && pageContext.workforceOvertimeStartDate !== '' && typeof pageContext.workforceOvertimeEndDate !== 'undefined' && pageContext.workforceOvertimeEndDate !== '' ) { pageContext.overtimeStartDate = new Date(pageContext.workforceOvertimeStartDate);  pageContext.overtimeEndDate = new Date(pageContext.workforceOvertimeEndDate); if (pageContext.overtimeStartDate > pageContext.overtimeEndDate){pageContext.workforceOvertimeEndDate=''; pageContext.workforceOvertimeTotalTime='';} } }"}]}