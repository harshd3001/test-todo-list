{"pageContext":{},"actionOnLoad":["@actions.fireProcessEventForTaskReviewFetchData","@actions.processResponseData","@actions.calculateEstimatedDurationInHours","@actions.calculatedActualTaskDuration","@actions.setInitialData","@actions.isHidden","@actions.getListOptionAnswerData"],"jslib":{"isCancelTaskHidden":"function(pageContext){return(pageContext.status === 'workOrderTaskCancelled' || pageContext.status === 'workOrderTaskCompleted');}","isDeleteTaskHidden":"function(pageContext){return(pageContext.status === 'workOrderTaskPendingReview' || pageContext.status === 'workOrderTaskSiteChangeRequest');}","isSumbitDisabled":"function(pageContext){if (pageContext.taskReviewResult === '' || typeof pageContext.taskReviewResult === 'undefined') {return true;} else if (pageContext.taskReviewResult === 'approve') {return false;}else if (pageContext.taskReviewResult === 'reject') {return ((pageContext.rejectionReason === '' ||typeof pageContext.rejectionReason === 'undefined') || (pageContext.taskReviewLogAction === '' || typeof pageContext.taskReviewLogAction === 'undefined'))}}","backButtonAction":"function(pageContext){ return (pageContext.workOrderTaskAction !== 'view')}","isSaveDisabled":"function(pageContext){return ((pageContext.initialWorkOrderTaskCancellationNotes==pageContext.workOrderTaskCancellationNotes)||(pageContext.workOrderTaskCancellationNotes===''))}","isIncidentReportHidden":"function(pageContext){if(typeof pageContext.incidentDetails === 'undefined' || pageContext.incidentDetails === '' || pageContext.incidentDetails.length <= 0){return true;}else{return false;}}","isTaskCancelled":"function(pageContext){ if (pageContext.status === 'workOrderTaskCancelled') {return false;} return true;}","isCalendarViewOrCancelledTask":"function(pageContext){ if (pageContext.subAction === 'calendarViewTask' || pageContext.taskTypeWebTask === true || pageContext.status === 'workOrderTaskCancelled') {return true;}}","isTaskReviewHide":"function(pageContext){ if (pageContext.status === 'workOrderTaskCancelled') {return true;} return false;}","isScheduleHidden":"function(pageContext){ if (pageContext.subAction !== 'calendarViewTask') {return true;}}","isCalendarView":"function(pageContext){ if (pageContext.subAction === 'calendarViewTask' || pageContext.taskTypeWebTask === true) {return true;}}","dynamicHeaderText":"function(pageContext){ if(pageContext.statusId === 'workOrderTaskPendingReview'){return '@lang.[\"tr1\",\"Task Review\"]'} else if(pageContext.subAction === 'calendarViewTask' || pageContext.actionHeader =='completed'){return '@lang.[\"vt\",\"View Task\"]'} }","viewTaskResult":"function(pageContext){ return (pageContext.workOrderTaskAction === 'view')}","isActionCompleted":"function(pageContext){ return (pageContext.workOrderTaskAction === 'completed' || pageContext.workOrderTaskAction === 'view')}"},"header":{"leftData":{"children":[{"hidden":"@jslib.backButtonAction","name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel","@actions.refreshDataGrid"],"type":"buttonIcon"}]},"children":[{"statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"buttonType":"secondary","hidden":"@jslib.isCancelTaskHidden","actionOnClick":["@actions.cancelTaskModal"],"id":"cancelTask","type":"button","title":"@lang.['ct4','Cancel Task']"},{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isDeleteTaskHidden","icon":"@iconlib.ActionsBinGrey","actionOnClick":["@actions.deleteTaskModal"],"id":"deleteTask","type":"buttonIcon","title":"@lang.['dt1','Delete Task']"},{"buttonType":"primary","hidden":"@jslib.isTaskCancelled","actionOnClick":["@actions.setSubActionUpsertWorkOrderTask","@actions.fireProcessEventForTaskReviewLogWF","@actions.fireProcessEventForWorkOrderTask","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"save","type":"button","title":"@lang.['s12','Save']"},{"buttonType":"primary","hidden":"@jslib.isActionCompleted","actionOnClick":["@actions.setSubAction","@actions.fireProcessEventForTaskReviewLogWF","@actions.fireProcessEventForWorkOrderTask","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isSumbitDisabled","id":"submit","type":"button","title":"@lang.['s20','Submit']"},{"hidden":"@jslib.viewTaskResult","icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"hidden":"@jslib.isTaskCancelled","children":[{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderTaskCancelledOn","title":"@lang.['co1','Cancelled On']","type":"datetime","value":"@pageContext.workOrderTaskCancelledDate"},{"disabled":true,"id":"workOrderTaskCancelledBy","label":"@lang.['cb','Cancelled By']","placeholder":"@lang.['cb','Cancelled By']","type":"input","value":"@pageContext.workOrderTaskCancelledBy"},{"disabled":true,"id":"workOrderTaskCancellationReason","label":"@lang.['cr','Cancellation Reason']","placeholder":"@lang.['er1','Enter reason']","type":"input","value":"@pageContext.workOrderTaskCancellationReason"},{"inputType":"text","id":"cancellationNotes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.workOrderTaskCancellationNotes","placeHolder":"@lang.['en2','Enter notes']"}],"id":"","label":"@lang.['cd2','Cancellation Details']","type":"section"},{"hidden":"@jslib.isTaskReviewHide","children":[{"isRequired":true,"actionOnChange":["@actions.isHidden","@actions.clearTaskReviewLogReviewNotes"],"options":[{"name":"@lang.['a1','Approve']","id":"approve"},{"name":"@lang.['r4','Reject']","id":"reject"}],"disabled":"@jslib.isActionCompleted","id":"taskReviewResult","optTitleKey":"name","optValueKey":"id","title":"@lang.['trr','Task Review Result']","type":"select","value":"@pageContext.taskReviewResult","placeHolder":"@lang.['co','Choose option']"},{"hidden":"@pageContext.isActionApprove","options":"@pageContext.listOption","disabled":"@jslib.isActionCompleted","optTitleKey":"listOptionAnswerOptionText","optValueKey":"listOptionAnswerOptionId","id":"rejectionReason","title":"@lang.['rejectionReason','Rejection Reason']","type":"select","value":"@pageContext.rejectionReason","placeHolder":"@lang.['selectReason','Select reason']"},{"hidden":"@pageContext.isReviewNoteVisible","disabled":"@jslib.isActionCompleted","inputType":"text","id":"taskReviewLogReviewNotes","label":"@lang.['rn','Review Notes (Optional)']","type":"textarea","value":"@pageContext.taskReviewLogReviewNotes","placeHolder":"@lang.['en2','Enter notes']"},{"isRequired":true,"hidden":"@pageContext.isActionApprove","options":[{"name":"@lang.['sbtst','Send back to same techician']","id":"workOrderTaskDispatched"},{"name":"@lang.['rfsar','Reopen for scheduling and reassignment']","id":"workOrderTaskReopened"}],"disabled":"@jslib.isActionCompleted","id":"taskReviewLogAction","optTitleKey":"name","optValueKey":"id","title":"@lang.['ta','Task Action']","type":"select","value":"@pageContext.taskReviewLogAction","placeHolder":"@lang.['sns','Select next step']"}],"id":"","label":"@lang.['ta1','Task approval']","type":"section"},{"children":[],"id":"taskResult","label":"@lang.['tr2','Task Result']","type":"section"}],"label":"@lang.['tr3','Task Results']","type":"tab"},{"children":[{"hidden":"@jslib.isScheduleHidden","children":[{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderDeadline","title":"@lang.['d4','Deadline']","type":"datetime","value":"@pageContext.workOrderDeadline"},{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderTaskScheduledDate","title":"@lang.['ssdt1','Scheduled Start Date & Time']","type":"datetime","value":"@pageContext.workOrderTaskScheduledDate"},{"disabled":true,"id":"workOrderTaskEstimatedDuration","label":"@lang.['etd1','Estimated Task Duration (Minutes)']","placeholder":"@lang.['eetd1','Enter Estimated Task Duration (Minutes)']","type":"input","value":"@pageContext.workOrderTaskEstimatedDuration"}],"id":"schedule","label":"@lang.['s19','Schedule']","type":"section"},{"children":[{"disabled":true,"id":"workOrderTaskId","label":"@lang.['taskId','Task ID']","type":"input","value":"@pageContext.workOrderTaskId"},{"disabled":true,"id":"taskTypeName","label":"@lang.['taskType','Task Type']","type":"input","value":"@pageContext.taskTypeName"},{"disabled":true,"id":"workOrderTaskWorkOrderId","label":"@lang.['WorkOrderId','Work Order ID']","type":"input","value":"@pageContext.workOrderTaskWorkOrderId"},{"disabled":true,"id":"workOrderTypeName","label":"@lang.['wot1','Work Order Type']","type":"input","value":"@pageContext.workOrderTypeName"},{"disabled":true,"id":"ZPriorityName","label":"@lang.['priority','Priority']","type":"input","value":"@pageContext.ZPriorityName"},{"disabled":true,"id":"siteName","label":"@lang.['cs','Customer Site']","type":"input","value":"@pageContext.siteName"},{"disabled":true,"inputType":"text","id":"workOrderTaskNotes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.workOrderTaskNotes","placeHolder":"@lang.['en','Enter Notes (Optional)']"}],"id":"taskDetails","label":"@lang.['taskDetails','Task Details']","type":"section"},{"hidden":"@jslib.isCalendarView","children":[{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderTaskScheduledDate","title":"@lang.['ssdt','Schedule Start Date & Time']","type":"datetime","value":"@pageContext.workOrderTaskScheduledDate"},{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderTaskDueDate","title":"@lang.['sedt','Schedule End Date & Time']","type":"datetime","value":"@pageContext.workOrderTaskDueDate"},{"disabled":true,"id":"workOrderTaskEstimatedDuration","label":"@lang.['etd1','Estimated Task Duration (Minutes)']","placeholder":"@lang.['eetd1','Enter Estimated Task Duration (Minutes)']","type":"input","value":"@pageContext.workOrderTaskEstimatedDuration"}],"id":"originalSchedule","label":"@lang.['os','Original Schedule']","type":"section"},{"hidden":"@jslib.isCalendarViewOrCancelledTask","children":[{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderTaskActualStartTime","title":"@lang.['asdt','Actual Start Date & Time']","type":"datetime","value":"@pageContext.workOrderTaskActualStartTime"},{"minDate":"1970-01-01 00:00","disabled":true,"id":"workOrderTaskCompletedDate","title":"@lang.['aedt','Actual End Date & Time']","type":"datetime","value":"@pageContext.workOrderTaskCompletedDate"},{"disabled":true,"id":"actualTaskDuration","label":"@lang.['atd','Actual Task Duration (Minutes)']","placeholder":"@lang.['eatd','Enter Actual Task Duration (Minutes)']","type":"input","value":"@pageContext.actualTaskDuration"}],"id":"actualSchedule","label":"@lang.['as','Actual Schedule']","type":"section"}],"label":"@lang.['taskDetails','Task Details']","type":"tab"},{"hidden":"@jslib.viewTaskResult","children":[{"children":[{"disabled":true,"id":"customerCompanyName","label":"@lang.['customer','Customer']","type":"input","value":"@pageContext.customerCompanyName"},{"disabled":true,"id":"customerContactPerson","label":"@lang.['cpn','Contact Person Name']","type":"input","value":"@pageContext.customerContactPerson"},{"disabled":true,"id":"customerContactPhone","label":"@lang.['cp','Contact Phone']","type":"phoneNumber","value":"@pageContext.customerContactPhone"},{"disabled":true,"id":"customerContactEmail","label":"@lang.['ce','Contact Email']","placeholder":"@lang.['eea','Enter Email Address']","type":"input","value":"@pageContext.customerContactEmail"},{"disabled":true,"id":"customerContactTitle","label":"@lang.['ct3','Contact Title']","type":"input","value":"@pageContext.customerContactTitle"}],"id":"customer","label":"@lang.['customer','Customer']","type":"section"},{"children":[{"disabled":true,"id":"siteName","label":"@lang.['cs','Customer Site']","type":"input","value":"@pageContext.siteName"},{"disabled":true,"id":"siteAddress","label":"@lang.['address','Address']","placeholder":"@lang.['afscs','Autofilled from selected customer site']","type":"address","value":"@pageContext.siteAddress"},{"hidden":"@jslib.isScheduleHidden","disabled":true,"id":"siteRegion","label":"@lang.['r1','Region']","type":"input","value":"@pageContext.regionName"},{"mapElementStyle":{"width":"100%","height":"14rem"},"defaultZoom":17,"preserveViewport":true,"location":[{"coordinates":"@pageContext.coordinates","icon":"https://cdn.zeplin.io/5be3ee39a464fd7e89ffaaa0/assets/57BF1B12-69E2-4E77-881C-A53900EB4260.svg","type":"Point"}],"id":"mapForShowStatic","type":"map","renderType":"location","mapElementHeight":"100%","mapJson":{}}],"id":"location","label":"@lang.['l3','Location']","type":"section"}],"label":"@lang.['sd3','Site Details']","id":"siteDetails ","type":"tab"},{"children":[{"children":[{"disabled":true,"id":"taskTypeName","label":"@lang.['taskType','Task Type']","type":"input","value":"@pageContext.taskTypeName"}],"id":"location","type":"section"},{"children":[{"label":"","id":"servicesGrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{}},"isScrollAble":true,"searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['navS3','Services']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"catalogName"},{"name":"@lang.['d','Description']","options":{"sortOrder":"ASC","sortable":false,"showLabel":true},"key":"description"}],"dataToBeSent":{"filter":"  {$catalogId} IN {@serviceList}","models":["catalog"],"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","description":"catalog.description","modelNumber":"catalog.modelNumber"},"inputs":{"serviceList":"@pageContext.workOrderTaskServicesArray"},"name":"workOrderTaskServices","distinct":true,"description":"workOrderTaskServices"},"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['navS3','Services']"},"isSelectable":false,"updateAllowed":true,"actions":[],"searchKeys":["catalogName"]}}],"id":"location","label":"@lang.['los1','List of services']","type":"section"}],"label":"@lang.['navS3','Services']","type":"tab"},{"hidden":"@jslib.isIncidentReportHidden","children":[{"children":[{"id":"incidentReports","type":"dataGrid","jsonDef":{"isScrollAble":true,"searchAllowed":false,"tableWidth":"70rem","rowActions":{"children":[{"activeIcon":"@iconlib.ActionsVisiblePurple","name":"@lang.['t1','taskView']","icon":"@iconlib.ActionsVisibleGrey","tooltip":"@lang.['v1','View']","actionOnClick":["@actions.openIncidentDetailsSidePanel"],"type":"buttonIcon"}]},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['it','Incident Type']","options":{"flex":1.5,"sortable":false,"showLabel":true},"key":"incidentType","primaryKey":true},{"name":"@lang.['r5','Reason']","options":{"flex":1.5,"sortable":false,"showLabel":true},"key":"travelIncidentReason"},{"name":"@lang.['st9','Submission Time']","options":{"flex":1.5,"sortable":false,"showLabel":true},"key":"reportIssueCapturedTime"},{"name":"@lang.['action','Action']","options":{"flex":1.5,"sortable":false,"showLabel":true},"key":"reportIssueType"},{"name":"@lang.['dm','Delay (In Minutes)']","options":{"flex":1.5,"sortable":false,"showLabel":true},"key":"taskDelay"}],"dataToBeSent":{"apiResponseParams":["count"],"processId":"workorderTaskIncidentReportWF","apiResponseFormat":true,"contextVar":{"workOrderTaskId":"@pageContext.workOrderTaskId"},"apiResponseObject":"incidentReportsData"},"dataSourceId":"process/start","sourceType":"api","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['il','Incident Logs']"},"isSelectable":false,"updateAllowed":true,"actions":[{"name":"openIncidentDetailsSidePanel","type":"openPanel","pageId":"UGWILUCH1E"}],"searchKeys":[]}}],"id":"incidentReports","type":"section","transparent":true}],"label":"@lang.['ir1','Incident Reports']","type":"tab"}],"label":"","type":"tab"}]},"actions":[{"name":"clearPageContext","type":"clearPageContext"},{"name":"closePanel","type":"closePanel"},{"name":"openPreviousPanel","type":"backPanel","pageId":"SKFTPK7JHU"},{"name":"fetchSelectedServicesForTask","outputVarMap":{"data":"@pageContext.selectedServicesList"},"type":"query","actionDef":{"filter":"{$workOrderTask.id} = {@workOrderTaskId}","models":["workOrderTask"],"inputs":{"workOrderTaskId":"@pageContext.workOrderTaskId"},"columns":{"catalogId":"workOrderTask.services"}}},{"subTitle":"@lang.['aysywtctt','Are you sure you want to cancel this task?']","name":"cancelTaskModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal","@actions.openCancelTaskNestedSidePanel"],"type":"button","title":"@lang.['yp','Yes, Proceed']"}],"type":"openModal","title":"@lang.['ct4','Cancel Task']"},{"name":"openCancelTaskNestedSidePanel","type":"openPanel","pageId":"1RFSG2AF8J"},{"subTitle":"@lang.['aysywtdtttcbu','Are you sure you want to delete this task? This cannot be undone.']","name":"deleteTaskModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeleteWorkOrderTask","@actions.fireProcessEventForWorkOrderTaskDelete","@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"type":"button","title":"@lang.['d1','Delete']"}],"type":"openModal","title":"@lang.['dt1','Delete Task']"},{"name":"setSubActionDeleteWorkOrderTask","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteWorkOrderTask';}"},{"endPoint":"event/start","name":"fireProcessEventForTaskReviewFetchData","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"LHCUF48WQB","contextVar":{"workOrderTaskId":"@pageContext.workOrderTaskId"}}]}},{"endPoint":"process/start","name":"fireProcessEventForTaskReviewLogWF","type":"api","actionDef":{"data":[{"processId":"V4NYJ58HL1","contextVar":{"listOptionAnswerId":"@pageContext.rejectionReason","statusId":"@pageContext.statusId","subAction":"@pageContext.taskReviewResult","workOrderTaskId":"@pageContext.workOrderTaskId","taskReviewLogAction":"@pageContext.taskReviewLogAction","taskReviewLogReviewNotes":"@pageContext.taskReviewLogReviewNotes"}}]}},{"endPoint":"batch/apis","name":"fireProcessEventForWorkOrderTask","type":"api","actionDef":{"data":[{"workOrderTaskWF":{"data":[{"processId":"QIFGIU7FDJ","contextVar":{"workOrderTask":{"processInstanceId":"@pageContext.workOrderTaskProcessInstanceId","assignedToUserId":"@pageContext.workOrderTaskAssignedToUserId","statusId":"@pageContext.statusId","statusTargetModel":"workOrderTask","taskTypeWebTask":"@pageContext.taskTypeWebTask","cancellationNotes":"@pageContext.workOrderTaskCancellationNotes","recver":"@pageContext.workOrderTaskRecver","id":"@pageContext.workOrderTaskId","assignedToCrewId":"@pageContext.workOrderTaskAssignedToCrewId","reopenCount":"@pageContext.workOrderTaskReOpenCount"},"subAction":"upsertWorkOrderTask"}}],"actionUrl":"process/start"}}]}},{"endPoint":"event/start","name":"instantiateMobileWorkflow","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"DFRTNF8ISK","inputVar":{"assignedToUserId":"@pageContext.workOrderTaskAssignedToUserId","plannedStartTime":"@pageContext.workOrderTaskScheduledDate","estimatedDurationInHours":"@pageContext.estimatedDurationInHours","workOrderTaskId":"@pageContext.workOrderTaskId","subAction":"@pageContext.instanceSubAction","mobileProcessId":"@pageContext.taskTypeMobileProcessId","workOrderTaskReOpenCount":"@pageContext.workOrderTaskReOpenCount"},"contextVar":{"assignedToUserId":"@pageContext.workOrderTaskAssignedToUserId","plannedStartTime":"@pageContext.workOrderTaskScheduledDate","estimatedDurationInHours":"@pageContext.estimatedDurationInHours","workOrderTaskId":"@pageContext.workOrderTaskId","subAction":"@pageContext.instanceSubAction","mobileProcessId":"@pageContext.taskTypeMobileProcessId","workOrderTaskReOpenCount":"@pageContext.workOrderTaskReOpenCount"}}]}},{"name":"handleResponseData","type":"script","actionDef":"function(pageContext){if(pageContext.subAction==='reject' && pageContext.responseData[0].data[0] != ''){pageContext.workOrderTaskProcessInstanceId = pageContext.responseData[0].data[0].zProcessInstanceId}}"},{"name":"closeModal","type":"closeModal"},{"name":"calculatedActualTaskDuration","type":"script","actionDef":"function(pageContext){let startDate=new Date(pageContext.workOrderTaskActualStartTime);let completedDate=new Date(pageContext.workOrderTaskCompletedDate);let diffTime=Math.abs(completedDate-startDate);pageContext.actualTaskDuration=Math.ceil(diffTime/(1000*60));}"},{"name":"isHidden","type":"script","actionDef":"function(pageContext){if ((pageContext.taskReviewResult === 'approve') || (pageContext.taskReviewResult === 'reject')) {pageContext.isReviewNoteVisible = false;}if (pageContext.taskReviewResult === 'approve')  {pageContext.isActionReject = false;pageContext.isActionApprove = true;}if (pageContext.taskReviewResult === 'reject') {pageContext.isActionApprove = false;pageContext.isActionReject = true;}if (pageContext.taskReviewResult === '')  {pageContext.isActionReject = true;pageContext.isActionApprove = true;}}"},{"name":"clearTaskReviewLogReviewNotes","type":"script","actionDef":"function(pageContext) {pageContext.taskReviewLogReviewNotes = '';}"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"setInitialData","type":"script","actionDef":"function(pageContext){pageContext.isReviewNoteVisible = true;pageContext.isActionApprove = true;pageContext.isActionReject = true; if (pageContext.statusId =='workOrderTaskCompleted'){pageContext.taskReviewResult = 'approve'}if(typeof pageContext.siteLatitude != 'undefined' && typeof pageContext.siteLongitude!= 'undefined') { pageContext.coordinates=[pageContext.siteLatitude,pageContext.siteLongitude];} else {pageContext.coordinates=[0,0];}}"},{"name":"processResponseData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.responseData !== 'undefined' && pageContext.responseData.length > 0) { pageContext.workOrderTaskServicesArray = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskServicesArray; pageContext.workOrderTaskId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskId; pageContext.workOrderTaskRecver = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskRecver; pageContext.taskTypeName = pageContext.responseData[0].data[0].workOrderTaskData.taskTypeName; pageContext.workOrderTaskWorkOrderId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskWorkOrderId; pageContext.workOrderId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskWorkOrderId; pageContext.workOrderTypeName = pageContext.responseData[0].data[0].workOrderTaskData.taskTypeName; pageContext.ZPriorityName = pageContext.responseData[0].data[0].workOrderTaskData.ZPriorityName; pageContext.siteName = pageContext.responseData[0].data[0].workOrderTaskData.siteName; pageContext.incidentDetails = (pageContext.responseData[0].data[0].workOrderTaskData.incidentDetails) ? pageContext.responseData[0].data[0].workOrderTaskData.incidentDetails : ''; pageContext.workOrderTaskNotes = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskNotes; pageContext.workOrderTaskDueDate = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskDueDate; pageContext.workOrderTaskEstimatedDuration = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskEstimatedDuration; pageContext.workOrderTaskActualStartTime = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskActualStartTime; pageContext.workOrderTaskCompletedDate = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskCompletedDate; pageContext.actualTaskDuration = pageContext.responseData[0].data[0].workOrderTaskData.actualTaskDuration; pageContext.customerContactPerson = pageContext.responseData[0].data[0].workOrderTaskData.customerContactPerson; pageContext.customerContactTitle = pageContext.responseData[0].data[0].workOrderTaskData.customerContactTitle; pageContext.customerContactPhone = pageContext.responseData[0].data[0].workOrderTaskData.customerContactPhone; pageContext.customerContactEmail = pageContext.responseData[0].data[0].workOrderTaskData.customerContactEmail; pageContext.siteAddress = pageContext.responseData[0].data[0].workOrderTaskData.siteAddress; pageContext.siteLongitude = pageContext.responseData[0].data[0].workOrderTaskData.siteLongitude; pageContext.siteLatitude = pageContext.responseData[0].data[0].workOrderTaskData.siteLatitude; pageContext.listOption = pageContext.responseData[0].data[0].listOptionData; pageContext.customerCompanyName = pageContext.responseData[0].data[0].workOrderTaskData.customerCompanyName; pageContext.workOrderTaskScheduledDate = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskScheduledDate; pageContext.statusNameColor = pageContext.responseData[0].data[0].workOrderTaskData.statusNameColor; pageContext.statusName = pageContext.responseData[0].data[0].workOrderTaskData.statusName; pageContext.statusId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskStatusId; pageContext.taskTypeMobileProcessId = pageContext.responseData[0].data[0].workOrderTaskData.taskTypeMobileProcessId; pageContext.workOrderTaskAssignedToUserId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskAssignedToUserId; pageContext.workOrderTaskAssignedToCrewId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskAssignedToCrewId; pageContext.workOrderTaskReOpenCount = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskReOpenCount; pageContext.taskTypeWebTask = pageContext.responseData[0].data[0].workOrderTaskData.taskTypeWebTask; pageContext.workOrderTaskProcessInstanceId = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskProcessInstanceId; if (pageContext.status === 'workOrderTaskCancelled') { pageContext.workOrderTaskCancelledDate = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskCancelledDate; if (typeof pageContext.responseData[0].data[0].workOrderTaskCancelled !== 'undefined' && pageContext.responseData[0].data[0].workOrderTaskCancelled !== '') { pageContext.workOrderTaskCancelledBy = pageContext.responseData[0].data[0].workOrderTaskCancelled[0].cancelledByUserName; }; pageContext.workOrderTaskCancellationReason = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskCancellationReasonData; pageContext.workOrderTaskCancellationNotes = pageContext.responseData[0].data[0].workOrderTaskData.workOrderTaskCancellationNotes; if (typeof pageContext.workOrderTaskCancellationNotes !== 'undefined' && pageContext.workOrderTaskCancellationNotes !== '') { pageContext.initialWorkOrderTaskCancellationNotes = pageContext.workOrderTaskCancellationNotes; } } if (typeof pageContext.responseData[0].data[0].taskReviewLogData != 'undefined' && pageContext.responseData[0].data[0].taskReviewLogData != '' && pageContext.responseData[0].data[0].taskReviewLogData.length > 0) { if (pageContext.statusId !== 'undefined' && pageContext.statusId == 'workOrderTaskCompleted') { pageContext.taskReviewLogReviewNotes = pageContext.responseData[0].data[0].taskReviewLogData[0].taskReviewLogReviewNotes; } pageContext.regionName = pageContext.responseData[0].data[0].workOrderTaskData.regionName; } } }"},{"name":"setSubAction","type":"script","actionDef":"function (pageContext) { pageContext.subAction = 'upsertWorkOrderTask'; if (pageContext.taskReviewResult === 'approve') { pageContext.statusId = 'workOrderTaskCompleted'; } if (pageContext.taskReviewResult === 'reject') { pageContext.statusId = pageContext.taskReviewLogAction; var reOpenCount = parseInt(pageContext.workOrderTaskReOpenCount); pageContext.workOrderTaskReOpenCount = ++reOpenCount; if (pageContext.taskReviewLogAction === 'workOrderTaskDispatched') { pageContext.instanceSubAction = 'createInstance'; } else if (pageContext.taskReviewLogAction === 'workOrderTaskReopened') { pageContext.workOrderTaskAssignedToUserId = ''; pageContext.workOrderTaskAssignedToCrewId =''; } } }"},{"name":"getListOptionAnswerData","outputVarMap":{"data":"@pageContext.cancellationReasonList"},"type":"query","actionDef":{"filter":"{$listOptionAnswerId}={@workOrderTaskCancellationReason}","models":["listOptionAnswer"],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText","listOptionAnswerRank":"listOptionAnswer.rank"},"inputs":{"workOrderTaskCancellationReason":"@pageContext.workOrderTaskCancellationReason"},"orderBy":"listOptionAnswerRank"}},{"name":"setSubActionUpsertWorkOrderTask","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertWorkOrderTask';}"},{"name":"calculateEstimatedDurationInHours","type":"script","actionDef":"function(pageContext){if(pageContext.workOrderTaskEstimatedDuration !== '' || typeof pageContext.workOrderTaskEstimatedDuration !== 'undefined'){pageContext.estimatedDurationInHours = Math.round(pageContext.workOrderTaskEstimatedDuration / 60);}}"},{"name":"setCoordinatesForMap","type":"script","actionDef":"function(pageContext) {if (pageContext.coordinates.length > 0) {pageContext.newCoordinates = [pageContext.customerSiteData[0].siteLatitude, pageContext.customerSiteData[0].siteLongitude];pageContext.coordinates=pageContext.newCoordinates;} }"}]}