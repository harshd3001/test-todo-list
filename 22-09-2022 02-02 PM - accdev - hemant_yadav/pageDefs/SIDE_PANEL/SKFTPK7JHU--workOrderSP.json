{"pageContext":{},"actionOnLoad":["@actions.getTimeZone","@actions.fetchWorkOrderQueryData","@actions.normalizeWorkflowData","@actions.processContractData","@actions.fetchAllCalendar","@actions.initialData","@actions.enableRecordGrid","@actions.refreshWorkOrderDataGrid"],"jslib":{"isActionDropdownHidden":"function(pageContext) {if(pageContext.workOrderAction == 'edit') {if(pageContext.workOrderStatusId === 'workOrderInProgress' || pageContext.workOrderStatusId === 'workOrderScheduled' || pageContext.workOrderStatusId === 'workOrderOpen') {return false} else {return true;}}return true;}","isBanner":"function(pageContext){if(pageContext.bannerType=='workOrderTaskSchedule' || pageContext.bannerType=='workOrderDuplicate' || pageContext.bannerType=='taskDeleteBanner'){return false;}else{return true;}}","isDeadlineDisabled":"function(pageContext) {return (pageContext.workOrderAction=='view' || pageContext.workOrderAction=='showWorkOrder' || (typeof pageContext.workOrderSlaResolutionTime !== 'undefined' && pageContext.workOrderSlaResolutionTime !== '' && pageContext.workOrderSlaResolutionTime !== '-')); }","hideCalendarWithNoContract":"function (pageContext) { return (typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length > 0 || (!(pageContext.workOrderAction == 'add'))); }","workOrderTaskSuccessMessage":"function (pageContext) { if (pageContext.bannerType == 'workOrderTaskSchedule') { return '@lang.[\"twsc\",\"Task was succesfully created\"]'; } else if (pageContext.bannerType == 'workOrderDuplicate') { return '@lang.[\"twsd\",\"Task was succesfully duplicated\"]'; }else if(pageContext.bannerType=='taskDeleteBanner'){ return '@lang.[\"twsd1\",\"Task was successfully deleted\"]'; } }","isTaskDependencyGridHidden":"function(pageContext) { var count = 0; if (pageContext.workOrderStatusId !== '' && typeof pageContext.workOrderStatusId != 'undefined') { if (typeof pageContext.workOrderTaskData != 'undefined' && pageContext.workOrderTaskData !== '' && pageContext.workOrderTaskData.length > 1) { pageContext.workOrderTaskData.forEach(function(element) { if (element.workOrderTaskStatusId !== 'workOrderTaskCancelled') { count++; } }); } } return (count < 2); }","isWorkOrderActionNotAdd":"function(pageContext){return (!(pageContext.workOrderAction=='add')); }","isWorkOrderOpen":"function(pageContext){return (pageContext.workOrderStatusId !== 'workOrderCompleted')}","isNotesDisable":"function(pageContext){return (pageContext.workOrderAction=='showWorkOrder' || pageContext.workOrderAction=='view'); }","isWorkOrderCancelled":"function(pageContext) { return (!(pageContext.workOrderStatusId === 'workOrderCancelled')); }","isShowWorkorderId":"function(pageContext){return (!(pageContext.workOrderAction=='edit'||pageContext.workOrderAction=='view' || pageContext.workOrderAction=='showWorkOrder'));}","isSaveHidden":"function(pageContext){return(!(pageContext.workOrderAction=='edit')); }","dynamicHeaderText":"function(pageContext){ if(pageContext.workOrderAction === 'add'){return '@lang.[\"anwo\",\"Add New Work Order\"]'} else if (pageContext.workOrderAction ==='edit' ){return '@lang.[\"ewo\",\"Edit Work Order\"]'} else if(pageContext.workOrderAction==='showWorkOrder' || pageContext.workOrderAction==='view'){return '@lang.[\"vwo\",\"View Work Order\"]'} }","isSaveDisable":"function(pageContext){return (((pageContext.initialWorkOrderRequestedDate==pageContext.workOrderRequestedDate)&&(pageContext.initialWorkOrderWorkOrderTypeId==pageContext.workOrderWorkOrderTypeId)&&(pageContext.initialWorkOrderPriorityPriority==pageContext.workOrderPriorityPriority)&&(pageContext.initialWorkOrderCustomerId==pageContext.workOrderCustomerId)&&(pageContext.initialWorkOrderContractId==pageContext.workOrderContractId)&&(pageContext.initialWorkOrderDeadline==pageContext.workOrderDeadline)&&(pageContext.initialWorkOrderNotes==pageContext.workOrderNotes))||((pageContext.workOrderId==='')||(pageContext.workOrderRequestedDate==='')||(pageContext.workOrderWorkOrderTypeId==='')||(pageContext.workOrderPriorityPriority==='')||(pageContext.workOrderCustomerId==='')||(typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length>0 && pageContext.workOrderContractId==='')))}","isDisableContract":"function(pageContext){return (pageContext.workOrderAction=='view'|| pageContext.workOrderAction=='showWorkOrder'||(typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length==0)); }","hideCalendarWithContract":"function (pageContext) { return (typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length == 0 || (!(pageContext.workOrderAction == 'add'))); }","isWorkOrderActionAdd":"function(pageContext){return (pageContext.workOrderAction=='add');}","isSaveAndContinueDisabled":"function(pageContext){return((pageContext.workOrderRequestedDate==''||typeof pageContext.workOrderRequestedDate== 'undefined')||(pageContext.workOrderWorkOrderTypeId==''||typeof pageContext.workOrderWorkOrderTypeId== 'undefined')||(pageContext.workOrderPriorityPriority==''||typeof pageContext.workOrderPriorityPriority== 'undefined')||(pageContext.workOrderCustomerId==''||typeof pageContext.workOrderCustomerId== 'undefined')||(pageContext.workOrderCalendarId==''||typeof pageContext.workOrderCalendarId== 'undefined')); }","isDeleteButtonHidden":"function(pageContext){return (!(pageContext.workOrderStatusId=='workOrderCancelled' || pageContext.workOrderStatusId=='workOrderCompleted' ));}","isBannerHidden":"function(pageContext){if(pageContext.bannerType=='workOrderTaskSchedule' || pageContext.bannerType=='workOrderDuplicate' || pageContext.bannerType=='taskDeleteBanner' ){return false;}else{return true;}}","isWorkOrderDetailsSectionHidden":"function(pageContext){return (pageContext.customerId == '' || pageContext.workOrderCustomerId == ''); }","isSaveDisabledForCancellationNotes":"function(pageContext){return ((pageContext.initialWorkOrderCancellationNotes==pageContext.workOrderCancellationNotes)||(pageContext.workOrderCancellationNotes===''))}","isBannerText":"function(pageContext){if(pageContext.bannerType=='workOrderDuplicate'){return pageContext.bannerText='@lang.[\"wosd\",\"Work order successfully duplicated\"]';}else if(pageContext.bannerType=='workOrderTemplate'){return pageContext.bannerText='@lang.[\"twsc1\",\"Template was successfully created\"]';}}","isWorkOrderActionShowWorkOrder":"function(pageContext){return (pageContext.workOrderAction=='showWorkOrder');}","isShowBannerForTemplateAndDuplicate":"function(pageContext){if(pageContext.bannerType=='workOrderDuplicate'||pageContext.bannerType=='workOrderTemplate'){return false;}else{return true;}}"},"header":{"children":[{"hidden":"@jslib.isWorkOrderActionShowWorkOrder","statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isDeleteButtonHidden","name":"@lang.['dwo','Delete Work Order']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['dwo','Delete Work Order ']","actionOnClick":["@actions.setActionForWorkOrderDelete","@actions.openWorkOrderCancelDeleteModal"],"type":"buttonIcon"},{"buttonType":"secondary","hidden":"@jslib.isWorkOrderOpen","actionOnClick":["@actions.openCloseOutSidepanel"],"id":"closeOutButton","type":"button","title":"@lang.['cp5','Closeout Package']"},{"buttonType":"primary","hidden":"@jslib.isWorkOrderCancelled","actionOnClick":["@actions.setSubAction","@actions.fireProcessEvent","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabledForCancellationNotes","id":"submit1","type":"button","title":"@lang.['s12','Save']"},{"buttonType":"primary","hidden":"@jslib.isWorkOrderActionNotAdd","actionOnClick":["@actions.setActionForButtonHidden","@actions.setSubAction","@actions.fireProcessEvent","@actions.setWorkOrderId","@actions.subActionForWorkOrderEdit","@actions.fetchWorkOrderQueryData","@actions.normalizeWorkflowData","@actions.initialData","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveAndContinueDisabled","id":"saveAndContinue","type":"button","title":"@lang.['sc1','Save & Continue']"},{"hidden":"@jslib.isActionDropdownHidden","data":[{"buttonType":"secondary","actionOnClick":["@actions.openTemplateSidepanel","@actions.setSubAction"],"id":"saveAsTemplate","type":"button","title":"@lang.['sat','Save as Template']"},{"buttonType":"secondary","actionOnClick":["@actions.fetchAutoSchedulingTasks","@actions.popUpDisplayCheck"],"id":"cancelWorkOrder","type":"button","title":" @lang.['cwo','Cancel Work Order']"}],"type":"actionDropdown","title":"@lang.['o4','Options']"},{"buttonType":"primary","hidden":"@jslib.isSaveHidden","actionOnClick":["@actions.setSubAction","@actions.setWorkOrderStatus","@actions.fireProcessEvent","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisable","id":"submit2","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext"],"id":"close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"alertMessage":"@jslib.isBannerText","actionOnChange":"@actions.clearbannerType","onClose":"@actions.clearbannerType","alertType":"success","hidden":"@jslib.isShowBannerForTemplateAndDuplicate","id":"alertMessage","type":"alert","timeout":5000},{"children":[{"actionOnChange":["@actions.decisionActionForWorkOrderTemplate"],"optLabelMap":"templateName","optValueMap":"templateId","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":" {$templateName} like {@filter}","models":["workOrderTemplateV2"],"columns":{"templateName":"workOrderTemplateV2.name","templateId":"workOrderTemplateV2.id"},"inputs":{},"orderBy":"templateName ASC","distinct":true}},"hidden":"@jslib.isWorkOrderActionNotAdd","isMainPage":false,"id":"templateId","label":"@lang.['wot2','Work Order Template (Optional)']","type":"selectDropdown","value":"@pageContext.templateId","placeHolder":"@lang.['st2','Select template']"},{"hidden":"@jslib.isShowWorkorderId","disabled":true,"id":"workOrderId","label":"@lang.['WorkOrderId','Work Order ID']","type":"input","value":"@pageContext.workOrderId"}],"label":"","id":"workOrderInformation","type":"section"},{"children":[{"minDate":"1970-01-01 12:00","actionOnChange":["@actions.getTimeZone","@actions.setCalendarId","@actions.getSlaTimeAndDeadline","@actions.setSlaResponseTimeAndDeadline"],"hidden":"@jslib.isWorkOrderActionNotAdd","id":"workOrderRequestedDate","title":"@lang.['ro1','Requested on']","type":"datetime","value":"@pageContext.workOrderRequestedDate"},{"hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"workOrderRequestedDateOnEdit","title":"@lang.['ro1','Requested on']","type":"datetime","value":"@pageContext.workOrderRequestedDate"},{"isRequired":true,"hidden":"@jslib.isWorkOrderActionNotAdd","options":"@pageContext.workOrderTypeList","optTitleKey":"workOrderTypeName","optValueKey":"workOrderTypeId","id":"workOrderTypeList","title":"@lang.['wot1','Work Order Type']","type":"select","value":"@pageContext.workOrderWorkOrderTypeId","placeHolder":"@lang.['swot','Select work order type']"},{"hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"workOrderTypeName","label":"@lang.['wot1','Work Order Type']","placeholder":"@lang.['swot','Select work order type']","type":"input","value":"@pageContext.workOrderTypeName"},{"isRequired":true,"actionOnChange":["@actions.setSlaResponseTimeAndDeadline"],"hidden":"@jslib.isWorkOrderActionNotAdd","options":"@pageContext.priorityList","optTitleKey":"ZPriorityPriorityName","optValueKey":"ZPriorityPriorityId","id":"priorityList","title":"@lang.['priority','Priority']","type":"select","value":"@pageContext.workOrderPriorityPriority","placeHolder":"@lang.['sp','Select priority']"},{"hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"ZPriorityPriorityName","label":"@lang.['priority','Priority']","type":"input","value":"@pageContext.priorityName"},{"isRequired":true,"actionOnChange":["@actions.decisionActionForCustomerData"],"optLabelMap":"customerCompanyName","optValueMap":"customerId","hidden":"@jslib.isWorkOrderActionNotAdd","isMainPage":false,"label":"@lang.['customer','Customer']","type":"selectDropdown","isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":" {$customerCompanyName} like {@filter} AND {$customer.statusId}!='customerDeactivated'","models":["customer"],"columns":{"customerCompanyName":"customer.companyName","customerId":"customer.id"},"inputs":{},"orderBy":"customerCompanyName ASC","distinct":true}},"id":"customerId","value":"@pageContext.customerId","placeHolder":"@lang.['sc','Select customer']"},{"hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"customerCompanyName","label":"@lang.['customer','Customer']","placeholder":"@lang.['sc','Select customer']","type":"input","value":"@pageContext.customerCompanyName"}],"label":"@lang.['gi','General Information']","id":"generalInformationSection","type":"section"},{"hidden":"@jslib.isWorkOrderDetailsSectionHidden","children":[{"isRequired":true,"actionOnChange":["@actions.clearSlaAndCalendarData","@actions.fetchCalendar","@actions.setCalendarId","@actions.getSlaTimeAndDeadline","@actions.setSlaResponseTimeAndDeadline"],"hidden":"@jslib.isWorkOrderActionNotAdd","options":"@pageContext.contractList","disabled":"@jslib.isDisableContract","optTitleKey":"contractContractNumber","optValueKey":"contractId","id":"contractList","title":"@lang.['c12','Contract']","type":"select","value":"@pageContext.workOrderContractId","placeHolder":"@lang.['ncawtc','No contracts associated with this customer']"},{"hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"contractNumber","label":"@lang.['c12','Contract']","type":"input","value":"@pageContext.contractContractNumber"},{"isRequired":true,"hidden":"@jslib.hideCalendarWithContract","options":"@pageContext.calendarList","disabled":true,"optTitleKey":"calendarName","optValueKey":"calendarId","id":"calendarList","title":"@lang.['navSW','Service Window']","type":"select","value":"@pageContext.workOrderCalendarId","placeHolder":"@lang.['swwbabotsc','Service window will be autofilled based on the selected contract']"},{"isRequired":true,"hidden":"@jslib.hideCalendarWithNoContract","options":"@pageContext.calendarAllList","optTitleKey":"calendarName","optValueKey":"calendarId","id":"calendarListForNoContracts","title":"@lang.['navSW','Service Window']","type":"select","value":"@pageContext.workOrderCalendarId","placeHolder":"@lang.['saswtdsoh','Select a service window to define standard operating hours']"},{"hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"workOrderCalendarName","label":"@lang.['navSW','Service Window']","type":"input","value":"@pageContext.workOrderCalendarName"},{"readOnly":true,"id":"slaResolutionTime","label":"@lang.['srt1','SLA Resolution Time']","type":"input","value":"@pageContext.workOrderSlaResolutionTime"},{"minDate":"@pageContext.workOrderRequestedDate","hidden":"@jslib.isWorkOrderActionNotAdd","disabled":"@jslib.isDeadlineDisabled","id":"workOrderDeadline","title":"@lang.['d14','Deadline (Optional)']","type":"datetime","value":"@pageContext.workOrderDeadline"},{"minDate":"@pageContext.workOrderRequestedDate","hidden":"@jslib.isWorkOrderActionAdd","readOnly":true,"id":"workOrderDeadline","title":"@lang.['d14','Deadline (Optional)']","type":"datetime","value":"@pageContext.workOrderDeadline"},{"disabled":"@jslib.isNotesDisable","id":"notes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.workOrderNotes","placeHolder":"@lang.['en3','Enter notes (Optional)']"}],"label":"@lang.['wod','Work Order Details']","id":"workOrderDetailsSection","type":"section"}],"label":"@lang.['woi1','Work Order Information']","type":"tab"},{"hidden":"@jslib.isWorkOrderActionAdd","children":[{"children":[{"alertMessage":"@jslib.workOrderTaskSuccessMessage","actionOnChange":"@actions.clearbannerType","onClose":"@actions.clearbannerType","alertType":"success","hidden":"@jslib.isBannerHidden","id":"alertMessage","type":"alert","timeout":5000},{"children":[{"label":"@lang.['t7','Tasks']","id":"workOrderTaskDataGrid","type":"dataGrid","jsonDef":{"isScrollAble":true,"searchAllowed":true,"tableWidth":"90rem","searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsBinPurple","hidden":true,"name":"@lang.['dt1','Delete Task']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.setActionDelete"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsDuplicatePurple","hidden":{"workOrderTaskStatusId":["workOrderTaskRejected","workOrderTaskSiteChangeRequest","workOrderTaskCompleted","workOrderTaskCancelled","workOrderTaskAutoScheduling"]},"name":"@lang.['d15','duplicateWorkOrderTask']","icon":"@iconlib.ActionsDuplicateGrey","tooltip":"@lang.['d6','Duplicate']","actionOnClick":["@actions.setActionDuplicate","@actions.duplicateModal"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsEditPurple","hidden":{"workOrderTaskStatusId":["workOrderTaskDispatched","workOrderTaskInTransit","workOrderTaskDelayed","workOrderTaskIncident","workOrderTaskDiscontinued","workOrderTaskInProgress","workOrderTaskPendingReview","workOrderTaskRejected","workOrderTaskCompleted","workOrderTaskSiteChangeRequest","workOrderTaskCancelled","workOrderTaskAutoScheduling"]},"name":"@lang.['et1','Edit Task']","icon":"@iconlib.ActionsEditGrey","tooltip":"@lang.['e1','Edit']","actionOnClick":["@actions.setActionEdit","@actions.openWorkTaskSP"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsVisiblePurple","hidden":true,"name":"@lang.['vtr','View Task Results']","icon":"@iconlib.ActionsVisibleGrey","tooltip":"@lang.['vtr','View Task Results']","actionOnClick":["@actions.setActionView","@actions.openWorkOrderTaskResultSP"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsVisiblePurple","hidden":{"workOrderTaskStatusId":["workOrderTaskDraft","workOrderTaskOpen","workOrderTaskScheduled","workOrderTaskReopened"]},"name":"@lang.['vt','View Task']","icon":"@iconlib.ActionsVisibleGrey","tooltip":"@lang.['vt','View Task']","actionOnClick":["@actions.setActionView","@actions.openWorkTaskSP"],"type":"buttonIcon"}]},"gridRefreshId":"workOrderTaskDataGrid","emptyScreen":{"image":"@iconlib.ActionsSearchGrey","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"dataToBeSent":{"filter":"{$workOrderTaskWorkOrderId} = {@workOrderId}","models":["ZStatus","workOrderTask","taskType","site","workOrderTaskAppointmentWindow"],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","workOrderTaskStatusName":"ZStatus.name","workOrderTaskScheduledDateSP":"workOrderTask.scheduledDate","workOrderTaskAppointmentWindow":"workOrderTaskAppointmentWindow.startEndJson","siteName":"site.name","siteAddress":"site.address","taskTypeName":"taskType.name","workOrderTaskRecver":"workOrderTask.recver","siteLatitude":"site.latitude","workOrderTaskSiteId":"workOrderTask.siteId","workOrderTaskStatusNameColor":"ZStatus.colorCode","workOrderTaskNotes":"workOrderTask.notes","workOrderTaskId":"workOrderTask.id","workOrderTaskWorkOrderId":"workOrderTask.workOrderId","workOrderTaskModifiedDate":"workOrderTask.modifiedDate","workOrderTaskEstimatedDuration":"ROUND({$workOrderTask.estimatedDuration}/60,2)","workOrderTaskTaskTypeId":"workOrderTask.taskTypeId","siteLongitude":"site.longitude","workOrderTaskStatusTargetModel":"workOrderTask.statusTargetModel"},"inputs":{"workOrderId":"@pageContext.workOrderId"},"orderBy":"workOrderTaskScheduledDateSP DESC","outerJoinOnModel":"workOrderTask","distinct":true,"links":{"taskType":"workOrderTask","site":"workOrderTask","ZStatus":"workOrderTask"},"getCount":true},"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":1,"colorCode":"workOrderTaskStatusNameColor","showLabel":true},"key":"workOrderTaskStatusName"},{"name":"@lang.['taskId','Task ID']","options":{"flex":0.8,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderTaskId","primaryKey":true},{"name":"@lang.['taskType','Task Type']","options":{"flex":1.4,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"taskTypeName"},{"name":"@lang.['cs','Customer Site']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"siteName"},{"name":"@lang.['sst','Scheduled Start Time']","options":{"flex":1.2,"currentSorted":true,"sortable":true,"type":"datetime","showLabel":true},"key":"workOrderTaskScheduledDateSP"},{"name":"@lang.['navAW','Appointment Window']","options":{"flex":1,"dateRangeType":"datetime","type":"dateRange","showLabel":true},"key":"workOrderTaskAppointmentWindow"},{"name":"@lang.['d28','Duration (hrs)']","options":{"flex":1.2,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderTaskEstimatedDuration"}],"dataSourceId":"query/read","jslib":{"isWorkOrderClosed":"function(pageContext){if(pageContext.workOrderStatusId === 'workOrderCompleted' || pageContext.workOrderStatusId === 'workOrderCancelled' || pageContext.workOrderAction=='view' || pageContext.workOrderAction=='showWorkOrder'){return true;}else {return false;}}"},"rowTextLength":50,"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['t7','Tasks']","children":[{"buttonType":"primary","hidden":"@jslib.isWorkOrderClosed","actionOnClick":["@actions.setActionAdd","@actions.openWorkTaskSP"],"id":"addNew","type":"button","title":"@lang.['at3','Add Task']"}]},"isSelectable":false,"updateAllowed":true,"actions":[{"name":"setActionAdd","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskAction='add';}"},{"name":"setActionEdit","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskAction='edit';}"},{"name":"setActionView","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskAction='view';pageContext.workOrderTaskTypeId=pageContext.workOrderTaskTaskTypeId;}"},{"name":"setActionDuplicate","type":"script","actionDef":"function(pageContext){pageContext.subAction='duplicateWorkOrderTask'}"},{"name":"openWorkTaskSP","type":"openPanel","pageId":"CJXUPK78YL"},{"name":"openWorkOrderTaskResultSP","type":"openPanel","pageId":"PORTE48LUB"},{"subTitle":"@lang.['aysywtdtt1','Are you sure you want to duplicate this task?']","name":"duplicateModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.fireProcessEventForDuplicateTask","@actions.workOrderTaskDuplicateSuccessMessage","@actions.refreshWorkOrderDataGrid","@actions.closeModal","@actions.clearScheduledDate"],"type":"button","title":"@lang.['c13','Continue']"}],"type":"openModal","title":"@lang.['dt8','Duplicate Task']"}],"searchKeys":["workOrderTaskId","workOrderTaskStatusName","taskTypeName","siteName"]}}],"id":"dataGridForTasks","type":"section","transparent":true}],"id":"datagridTask","label":"","type":"section","transparent":true},{"hidden":"@jslib.isTaskDependencyGridHidden","children":[{"label":"@lang.['d27','Dependencies']","id":"dependencies","type":"dataGrid","jsonDef":{"isScrollAble":true,"searchAllowed":false,"tableWidth":"60rem","searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isActionDependencyHidden","name":"@lang.['dtd','Delete Task Dependency']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":"@actions.deleteTaskDependencyData","type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsEditPurple","hidden":"@jslib.isActionDependencyHidden","name":"@lang.['et3','Edit Task Dependency']","icon":"@iconlib.ActionsEditGrey","tooltip":"@lang.['e1','Edit']","actionOnClick":["@actions.setTaskDependencyActionEdit","@actions.openTaskDependencyNSP"],"type":"buttonIcon"}]},"gridRefreshId":"dependencies","emptyScreen":{"image":"@iconlib.ActionsSearchGrey","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['t7','Tasks']","options":{"flex":0.8,"showLabel":true},"key":"taskDependencyPrecedentTask"},{"name":"@lang.['c26','Condition']","options":{"flex":0.6,"showLabel":true},"key":"taskDependencyEnforceAllDependency"},{"name":"@lang.['s','Status']","options":{"flex":0.55,"showLabel":true},"key":"taskDependencyPrecedentStatusName"},{"name":"@lang.['dt5','Dependent Tasks']","options":{"flex":0.8,"showLabel":true},"key":"taskDependencyDependentTask"},{"name":"@lang.['ds3','Dependent Status']","options":{"flex":0.55,"showLabel":true},"key":"taskDependencyDependentStatusName"}],"dataToBeSent":{"apiResponseParams":["count"],"processId":"workOrderTaskDependencyDataFetchWF","apiResponseFormat":true,"contextVar":{"workOrderId":"@pageContext.workOrderId"},"apiResponseObject":"taskDependencyData"},"dataSourceId":"process/start","sourceType":"api","jslib":{"isActionDependencyHidden":"function(pageContext){return(pageContext.workOrderStatusId === 'workOrderPendingReview' || pageContext.workOrderStatusId === 'workOrderRejected' || pageContext.workOrderStatusId === 'workOrderCompleted'  || pageContext.workOrderStatusId === 'workOrderCancelled' || pageContext.workOrderAction=='view' || pageContext.workOrderAction=='showWorkOrder');}","isWorkOrderClosed":"function(pageContext){if(pageContext.workOrderStatusId === 'workOrderCompleted' || pageContext.workOrderStatusId === 'workOrderCancelled' || pageContext.workOrderAction=='view' || pageContext.workOrderAction=='showWorkOrder'){return true;}else {return false;}}"},"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['td3','Task Dependencies']","children":[{"buttonType":"primary","hidden":"@jslib.isWorkOrderClosed","actionOnClick":["@actions.setTaskDependencyActionAdd","@actions.openTaskDependencyNSP"],"id":"addNew","type":"button","title":"@lang.['ad1','Add Dependency']"}]},"isSelectable":false,"updateAllowed":true,"actions":[{"name":"setTaskDependencyActionAdd","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskDependencyAction='add';}"},{"name":"setTaskDependencyActionEdit","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskDependencyAction='edit';}"},{"name":"openTaskDependencyNSP","type":"openPanel","pageId":"3E3E1ODVST"},{"subTitle":"@lang.['aysywtrtdtwrterwotitwo','Are you sure you want to remove this dependency? This will remove the existing relationships with other tasks in the work order.']","name":"deleteTaskDependencyData","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeleteTaskDependency","@actions.fireProcessEventToDeleteTaskDependency","@actions.subActionForWorkOrderEdit","@actions.closeModal","@actions.refreshDataGrid"],"type":"button","title":"@lang.['yc','Yes, Continue']"}],"type":"openModal","title":"@lang.['cd','Confirm Delete']"},{"name":"refreshDataGrid","type":"refreshDataGrid"}],"searchKeys":[]}}],"id":"dataGridForTasksDependencies","type":"section","transparent":true}],"label":"@lang.['t7','Tasks']","type":"tab"},{"hidden":"@jslib.isWorkOrderCancelled","children":[{"children":[{"minDate":"1970-01-01 12:00","disabled":true,"id":"workOrderCancelledOn","title":"@lang.['co1','Cancelled On']","type":"datetime","value":"@pageContext.workOrderCancelledDate"},{"disabled":true,"id":"workOrderTaskCancelledBy","label":"@lang.['cb','Cancelled By']","placeholder":"@lang.['cb','Cancelled By']","type":"input","value":"@pageContext.workOrderCancelledBy"},{"disabled":true,"id":"workOrderCancellationReason","label":"@lang.['cr','Cancellation Reason']","placeholder":"@lang.['er1','Enter reason']","type":"input","value":"@pageContext.workOrderCancellationReason"},{"inputType":"text","id":"cancellationNotes","label":"@lang.['n3','Notes']","type":"textarea","value":"@pageContext.workOrderCancellationNotes","placeHolder":"@lang.['en2','Enter notes']"}],"id":"","label":"@lang.['cd2','Cancellation Details']","type":"section"}],"label":"@lang.['cd2','Cancellation Details']","type":"tab"},{"hidden":"@jslib.isWorkOrderActionAdd","children":[{"children":[{"id":"partsAndMaterials","type":"dataGrid","jsonDef":{"isScrollAble":false,"tableWidth":"100rem","searchAllowed":true,"rowActions":{"children":[{"activeIcon":"@iconlib.ActionsEditPurple","hidden":"@jslib.isWorkOrderActionShowWorkOrder","name":"@lang.['e1','Edit']","icon":"@iconlib.ActionsEditGrey","tooltip":"@lang.['e1','Edit']","actionOnClick":["@actions.setWorkOrderInventoryActionForEdit","@actions.openPartNSP"],"type":"buttonIcon"},{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isWorkOrderActionShowWorkOrder","name":"@lang.['d1','Delete']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.setSubActionForDelete","@actions.fireProcessEventForDelete","@actions.refreshMainDataGrid"],"type":"buttonIcon"}]},"gridRefreshId":"partsAndMaterialsGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['mn','Model Name']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"catalogModelName"},{"name":"@lang.['mn1','Model Number']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"catalogModelNumber"},{"name":"@lang.['t5','Type']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"catalogTypeName"},{"name":"@lang.['lp','List Price']","options":{"flex":1,"sortOrder":"ASC","sortable":false,"showLabel":true},"key":"workOrderInventoryCustomerPrice"},{"name":"@lang.['eq1','Estimated Quantity']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderInventoryEstimatedQty"},{"name":"@lang.['ec5','Estimated Cost']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"estimatedCost"},{"name":"@lang.['ep2','Estimated Price']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"estimatedPrice"},{"name":"@lang.['aq1','Actual Quantity']","options":{"flex":1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderInventoryActualQty"},{"name":"@lang.['ac2','Actual Cost']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"actualCost"},{"name":"@lang.['ap2','Actual Price']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"actualPrice"},{"name":"@lang.['taskId','Task ID']","options":{"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"workOrderTaskId"}],"dataToBeSent":{"filter":"{$workOrderInventory.workOrderId} = {@workOrderId}","models":["workOrderInventory","catalog","stockUnit","manufacturer","catalogType"],"columns":{"workOrderInventoryEstimatedQty":"CONCAT({$workOrderInventory.estimatedQty},' ',{$stockUnit.name})","actualPrice":"IF({$workOrderInventory.actualQty}!=''AND {$workOrderInventory.actualQty} IS NOT NULL,CAST({$workOrderInventory.actualQty} AS DECIMAL(32,2))*CAST({$workOrderInventory.customerPrice} AS DECIMAL(32,2)),0)","workOrderInventoryUnitPrice":"workOrderInventory.unitPrice","manufacturerName":"manufacturer.name","catalogModelNumber":"catalog.modelNumber","workOrderInventoryCustomerPrice":"workOrderInventory.customerPrice","workOrderTaskInitialId":"workOrderInventory.workOrderTaskId","workOrderInventoryActualQty":"workOrderInventory.actualQty","catalogTypeName":"catalogType.name","estimatedCost":"IF({$workOrderInventory.estimatedQty}!=0,CAST({$workOrderInventory.estimatedQty} AS DECIMAL(32,2)) * CAST({$workOrderInventory.unitPrice} AS DECIMAL(32,2)),0)","stockUnitName":"stockUnit.name","catalogName":"catalog.name","workOrderInventoryCatalogId":"workOrderInventory.catalogId","catalogModelName":"catalog.name","catalogManufacturerId":"catalog.manufacturerId","recver":"workOrderInventory.recver","estimatedPrice":"IF({$workOrderInventory.estimatedQty}!=0,CAST({$workOrderInventory.estimatedQty} AS DECIMAL(32,2))*CAST({$workOrderInventory.customerPrice} AS DECIMAL(32,2)),0)","workOrderTaskId":"IF({$workOrderInventory.workOrderTaskId}!='',{$workOrderInventory.workOrderTaskId},'-')","workOrderInventoryEstimatedQuantity":"workOrderInventory.estimatedQty","id":"workOrderInventory.id","stockUnitId":"catalog.stockUnitId","actualCost":"IF({$workOrderInventory.actualQty}!='',CAST({$workOrderInventory.actualQty} AS DECIMAL(32,2))*CAST({$workOrderInventory.unitPrice} AS DECIMAL(32,2)),0)"},"inputs":{"workOrderId":"@pageContext.workOrderId"},"orderBy":"catalogModelName ASC","outerJoinOnModel":"catalog","distinct":true,"links":{"catalogType":"catalog","workOrderInventory":"catalog","manufacturer":"catalog","stockUnit":"catalog"},"translate":true},"dataSourceId":"query/read","jslib":{"isWorkOrderActionShowWorkOrder":"function(pageContext){ return pageContext.workOrderAction=='showWorkOrder'; }"},"rowTextLength":30,"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['pam','Parts and Materials']","children":[{"buttonType":"primary","hidden":"@jslib.isWorkOrderActionShowWorkOrder","actionOnClick":["@actions.setWorkOrderInventoryActionForAdd","@actions.openPartNSP"],"id":"addNew","type":"button","title":"@lang.['addNew','Add New']"}]},"isSelectable":false,"actions":[{"name":"setWorkOrderInventoryActionForEdit","type":"script","actionDef":"function(pageContext){pageContext.workOrderInventoryAction='edit';}"},{"name":"setWorkOrderInventoryActionForAdd","type":"script","actionDef":"function(pageContext){pageContext.workOrderInventoryAction='addInitial';}"},{"name":"setSubActionForDelete","type":"script","actionDef":"function(pageContext){pageContext.subAction='delete';}"},{"name":"openPartNSP","type":"openPanel","pageId":"workOrderInventoryNSP"},{"endPoint":"process/start","name":"fireProcessEventForDelete","type":"api","actionDef":{"data":[{"processId":"workOrderInventoryWF","contextVar":{"jsonArrayToDelete":[{"recver":"@pageContext.recver","id":"@pageContext.id"}],"subAction":"@pageContext.subAction"}}]}},{"name":"refreshMainDataGrid","gridId":["partsAndMaterialsGrid"],"type":"RefreshGridOnSidePanel"}],"searchKeys":["catalogModelName","catalogModelNumber","workOrderTaskInitialId","catalogTypeName"]}}],"id":"partsAndMaterials","label":"@lang.['pam','Parts and Materials']","type":"section","transparent":true}],"label":"@lang.['pr1','Part Requirements']","type":"tab"},{"hidden":"@jslib.isWorkOrderActionAdd","children":[{"children":[{"id":"workOrderLogs","type":"dataGrid","jsonDef":{"isScrollAble":false,"tableWidth":"50rem","searchAllowed":true,"rowActions":{},"gridRefreshId":"workOrderLogsGrid","emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"tableHeader":[{"name":"@lang.['i','id']","options":{"hidden":true,"showLabel":false},"key":"workOrderLogId","primaryKey":true},{"name":"@lang.['t18','Timestamp']","options":{"sortOrder":"DESC","sortable":true,"type":"dateTime","showLabel":true},"key":"workOrderLogLogDate"},{"name":"@lang.['e10','Event']","options":{"flex":0.8,"sortOrder":"DESC","sortable":true,"showLabel":true},"key":"listOptionAnswerText"},{"name":"@lang.['mb1','Modified By']","options":{"sortOrder":"DESC","sortable":true,"showLabel":true},"key":"userName"},{"name":"@lang.['d17','Details']","options":{"showLabel":true},"key":"workOrderLogDetails"}],"dataToBeSent":{"filter":"{$workOrderLog.workOrderId} = {@workOrderId}","models":["workOrderLog","User","listOptionAnswer"],"columns":{"workOrderLogDetails":"IF({$workOrderLog.details} IS NULL,'-',{$workOrderLog.details})","workOrderLogLogDate":"workOrderLog.logDate","workOrderLogId":"workOrderLog.id","workOrderLogEvent":"workOrderLog.event","listOptionAnswerText":"listOptionAnswer.answerOptionText","userName":"User.name","workOrderLogLoggedByUserId":"workOrderLog.loggedByUserId"},"inputs":{"workOrderId":"@pageContext.workOrderId"},"orderBy":"workOrderLogLogDate DESC","outerJoinOnModel":"workOrderLog","links":{"listOptionAnswer":"workOrderLog","User":"workOrderLog"},"translate":true},"dataSourceId":"query/read","jslib":{},"rowTextLength":30,"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['wol','Work Order Logs']"},"isSelectable":false,"actions":[],"searchKeys":["listOptionAnswerText","userName"]}}],"id":"workOrderLogs","label":"","type":"section","transparent":true}],"label":"@lang.['navL','Logs']","type":"tab"}],"id":"taskTab","type":"tab"}]},"actions":[{"endPoint":"process/start","name":"fetchWorkOrderQueryData","outputVarMap":{"data":"@pageContext.queryData"},"type":"api","actionDef":{"data":[{"processId":"workOrderFetchDataWF","contextVar":{"timezoneOffset":"@pageContext.timezoneOffset","subAction":"@pageContext.subAction","workOrderId":"@pageContext.workOrderId"}}]}},{"name":"normalizeWorkflowData","type":"script","actionDef":"function (pageContext) { for (var key in pageContext.queryData[0].outputVar) { if (key === '__status' || key === 'contextType') continue; pageContext[key] = pageContext.queryData[0].outputVar[key]; } if (pageContext.workOrderAction === 'add') { pageContext.workOrderRequestedDate = new Date().toISOString().replace('T', ' ').replace('Z', ''); } else { if (typeof pageContext.contractList !== 'undefined' && pageContext.contractList !== '' && pageContext.contractList.length === 0) { pageContext.calendarAllList = pageContext.queryData[0].outputVar.calendarList }; for (var key in pageContext.workOrderList[0]) { pageContext[key] = pageContext.workOrderList[0][key]; } if (pageContext.workOrderCancelledBy === '' || typeof pageContext.workOrderCancelledBy === 'undefined') { pageContext.workOrderCancelledBy = '@lang.[\"atmn\",\"Automation\"]'; } if (pageContext.queryData[0].outputVar.slaTimeFrameList !== '') { pageContext.workOrderSlaResolutionTime = pageContext.queryData[0].outputVar.slaTimeFrameList[0].workOrderSlaResolutionTime; } else if (typeof pageContext.workOrderSlaResolutionTime === 'undefined' || pageContext.workOrderSlaResolutionTime === '') { pageContext.workOrderSlaResolutionTime = '-'; } pageContext.initialWorkOrderCancellationNotes = pageContext.workOrderCancellationNotes; if (Array.isArray(pageContext.calendarList) && pageContext.calendarList.length > 0) { pageContext.calendarName = pageContext.calendarList[0].calendarName; } else { pageContext.calendarName = '-'; } } }"},{"name":"clearScheduledDate","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskScheduledDateSP = '';}"},{"name":"initialData","type":"script","actionDef":"function (pageContext) { if (pageContext.workOrderAction === 'add') { pageContext.contractContractNumber = ''; pageContext.workOrderTemplateWorkOrderId = ''; pageContext.workOrderId = ''; pageContext.workOrderWorkOrderTypeId = ''; pageContext.workOrderPriorityPriority = ''; pageContext.workOrderCustomerId = ''; pageContext.workOrderContractId = ''; pageContext.workOrderCalendarId = ''; pageContext.workOrderTemplateId = ''; pageContext.workOrderSlaResolutionTime = '-'; pageContext.workOrderDeadline = ''; pageContext.workOrderNotes = ''; } else { if (typeof pageContext.workOrderDeadline === 'undefined' || pageContext.workOrderDeadline === '') { pageContext.workOrderDeadline = '-'; } if (typeof pageContext.contractContractNumber === 'undefined' || pageContext.contractContractNumber === '') { pageContext.contractContractNumber = '-'; } if (typeof pageContext.calendarAllList !== 'undefined' && pageContext.calendarAllList !== '' && pageContext.calendarAllList.length > 0) { pageContext.calendarAllList.forEach(function (element) { if (element.calendarId === pageContext.workOrderCalendarId) { pageContext.workOrderCalendarName = element.calendarName; } }); } pageContext.initialWorkOrderId = pageContext.workOrderId; pageContext.initialWorkOrderRequestedDate = pageContext.workOrderRequestedDate; pageContext.initialWorkOrderWorkOrderTypeId = pageContext.workOrderWorkOrderTypeId; pageContext.initialWorkOrderPriorityPriority = pageContext.workOrderPriorityPriority; pageContext.initialWorkOrderCustomerId = pageContext.workOrderCustomerId; pageContext.initialWorkOrderTemplateId = pageContext.workOrderTemplateId; pageContext.initialWorkOrderContractId = pageContext.workOrderContractId; pageContext.initialWorkOrderCalendarId = pageContext.workOrderCalendarId; pageContext.initialWorkOrderSlaResolutionTime = pageContext.workOrderSlaResolutionTime; pageContext.initialWorkOrderDeadline = pageContext.workOrderDeadline; pageContext.initialWorkOrderNotes = pageContext.workOrderNotes; } }"},{"name":"clearPageContext","type":"clearPageContext"},{"endPoint":"event/start","name":"fireProcessEventForDuplicateTask","outputVarMap":{"data":"@pageContext.responseDataForDuplicateTask"},"type":"api","actionDef":{"data":[{"eventId":"BM58GU7UNT","inputVar":{},"contextVar":{"subAction":"@pageContext.subAction","workOrderTaskId":"@pageContext.workOrderTaskId","customerId":"@pageContext.workOrderCustomerId","workOrderId":"@pageContext.workOrderId"}}]}},{"name":"closePanel","type":"closePanel"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"NCJHIL7VSE","inputVar":{},"contextVar":{"workOrder":[{"notes":"@pageContext.workOrderNotes","cancellationNotes":"@pageContext.workOrderCancellationNotes","slaId":"@pageContext.workOrderSlaId","statusTargetModel":"workOrder","workOrderTypeId":"@pageContext.workOrderWorkOrderTypeId","priorityTargetModel":"workOrder","priorityPriority":"@pageContext.workOrderPriorityPriority","statusId":"@pageContext.workOrderStatusId","calendarId":"@pageContext.workOrderCalendarId","recver":"@pageContext.workOrderRecver","isTemplate":"@pageContext.workOrderIsTemplate","contractId":"@pageContext.workOrderContractId","customerId":"@pageContext.workOrderCustomerId","id":"@pageContext.workOrderId","requestedDate":"@pageContext.workOrderRequestedDate","deadline":"@pageContext.workOrderDeadline"}],"workOrderTemplateId":"@pageContext.workOrderTemplateId","subAction":"@pageContext.subAction"}}]}},{"name":"workOrderTaskDuplicateSuccessMessage","type":"script","actionDef":"function(pageContext){pageContext.bannerType='workOrderDuplicate';}"},{"name":"clearSlaAndContract","type":"script","actionDef":"function(pageContext){if(typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length==0){pageContext.workOrderContractId='';pageContext.workOrderSlaId='';pageContext.workOrderSlaResolutionTime='-';pageContext.workOrderDeadline='';}}"},{"name":"clearSlaAndCalendarData","type":"script","actionDef":"function(pageContext){pageContext.workOrderCalendarId = '';pageContext.workOrderSlaResolutionTime = '-';pageContext.workOrderDeadline = ''; pageContext.workOrderSlaId='';}"},{"name":"processContractData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length === 1) { pageContext.workOrderContractId = pageContext.contractList[0].contractId ;  } }"},{"name":"setWorkOrderId","type":"script","actionDef":"function(pageContext){pageContext.workOrderId=pageContext.responseData[0].data[0].workOrderId;}"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"refreshWorkOrderDataGrid","gridId":["workOrderTaskDataGrid","dependencies"],"type":"RefreshGridOnSidePanel"},{"name":"setCalendarId","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.contractList !== 'undefined' && pageContext.contractList.length > 0) { for (var i = 0; i < pageContext.contractList.length; i++) { if (pageContext.contractList[i].contractId == pageContext.workOrderContractId) { pageContext.workOrderCalendarId = pageContext.contractList[i].contractCalendarId; pageContext.workOrderSlaId = pageContext.contractList[i].contractSlaId; } } } }"},{"name":"clearbannerType","type":"script","actionDef":"function(pageContext){pageContext.bannerType='';}"},{"name":"setSlaResponseTimeAndDeadline","type":"script","actionDef":"function (pageContext) { pageContext.workOrderSlaResolutionTime = '-'; pageContext.workOrderDeadline = ''; if (typeof pageContext.workOrderData !== 'undefined' && pageContext.workOrderData !== '' && pageContext.workOrderData.length > 0) { pageContext.slaAndDeadlineData = pageContext.workOrderData[0].data[0].priorityDeadlineData; } else { pageContext.slaAndDeadlineData = pageContext.queryData[0].outputVar.priorityDeadlineData; } for (var j = 0; j < pageContext.slaAndDeadlineData.length; j++) { if (pageContext.slaAndDeadlineData[j].priority === pageContext.workOrderPriorityPriority) { pageContext.workOrderDeadline = pageContext.slaAndDeadlineData[j].deadline; pageContext.workOrderSlaResolutionTime = (pageContext.slaAndDeadlineData[j].resolutionTime + ' ' + pageContext.slaAndDeadlineData[j].resolutionUnit); } } }"},{"name":"fetchCalendar","outputVarMap":{"data":"@pageContext.calendarList"},"type":"query","actionDef":{"filter":"{$contractId} = {@workOrderContractId}","models":["contract","calendar"],"columns":{"calendarName":"calendar.name","calendarId":"calendar.id","contractId":"contract.id","contractCalendarId":"contract.calendarId"},"inputs":{"workOrderContractId":"@pageContext.workOrderContractId"}}},{"name":"fetchAutoSchedulingTasks","outputVarMap":{"data":"@pageContext.autoSchedulingTasksList","count":"@pageContext.autoSchedulingTasksCount"},"type":"query","actionDef":{"filter":"{$workOrderTaskWorkOrderId} = {@id} && {$workOrderTaskStatusId} = 'workOrderTaskAutoScheduling' ","models":["workOrderTask"],"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","workOrderTaskWorkOrderId":"workOrderTask.workOrderId"},"inputs":{"id":"@pageContext.workOrderId"},"getCount":true}},{"falseStep":["@actions.cancelWorkOrder"],"trueStep":["@actions.cannotCancelWorkOrder"],"name":"popUpDisplayCheck","type":"decision","actionDef":"function(pageContext){return(pageContext.autoSchedulingTasksCount>0);}"},{"name":"fetchAllCalendar","outputVarMap":{"data":"@pageContext.calendarAllList"},"type":"query","actionDef":{"filter":"{$calendarCalendarType}='serviceWindow'","models":["calendar"],"columns":{"calendarName":"calendar.name","calendarId":"calendar.id","calendarCalendarType":"calendar.calendarType"}}},{"endPoint":"event/start","name":"getSlaTimeAndDeadline","outputVarMap":{"data":"@pageContext.workOrderData"},"type":"api","actionDef":{"data":[{"eventId":"B14YXV7KOT","inputVar":{},"contextVar":{"workOrderCalendarId":"@pageContext.workOrderCalendarId","workOrderSlaId":"@pageContext.workOrderSlaId","timezoneOffset":"@pageContext.timezoneOffset","workOrderRequestedDate":"@pageContext.workOrderRequestedDate"}}]}},{"endPoint":"event/start","name":"fireProcessEventToCallCloseoutPackageWF","outputVarMap":{"data":"@pageContext.pdfUrlData"},"type":"api","actionDef":{"data":[{"eventId":"WXOEFH8TW9","inputVar":{},"contextVar":{"workOrderId":"@pageContext.workOrderId"}}]}},{"name":"processCustomerData","type":"script","actionDef":"function(pageContext){if ( typeof pageContext.customerId !== 'undefined' && pageContext.customerId.length > 0 ) {pageContext.workOrderCustomerId = pageContext.customerId[0].value; }}"},{"falseStep":["@actions.clearWorkOrderTemplateData"],"trueStep":["@actions.processWorkOrderTemplateData","@actions.getWorkorderTemplateData","@actions.setWorkOrderTemplateData"],"name":"decisionActionForWorkOrderTemplate","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.templateId !== 'undefined' && pageContext.templateId.length > 0 && pageContext.templateId[0] !== null ){return true;} else{ return false;}}"},{"name":"processWorkOrderTemplateData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.templateId !== 'undefined' && pageContext.templateId.length > 0 && pageContext.templateId[0] !== null) { pageContext.workOrderTemplateId = pageContext.templateId[0].value; } }"},{"name":"fetchContracts","outputVarMap":{"data":"@pageContext.contractList"},"type":"query","actionDef":{"filter":"{$contractCustomerId} = {@workOrderCustomerId} AND {$contractStatusId} != 'contractNotStarted' AND {$contractStatusId} != 'contractExpired' AND {$contractStatusId} != 'contractDeactivated'","models":["contract"],"columns":{"contractCustomerId":"contract.customerId","contractContractNumber":"contract.contractNumber","contractId":"contract.id","contractStatusId":"contract.statusId","contractSlaId":"contract.slaId","contractCalendarId":"contract.calendarId"},"inputs":{"workOrderCustomerId":"@pageContext.workOrderCustomerId"}}},{"name":"openPdfUrl","type":"script","actionDef":"function(pageContext){window.open(pageContext.pdfUrlData[0].data[0].pdfUrl);}"},{"name":"setSubAction","type":"script","actionDef":"function(pageContext){if(pageContext.workOrderAction=='edit'||pageContext.workOrderAction=='add'|| pageContext.workOrderAction=='view' ){pageContext.subAction='upsertWorkOrder';}else if(pageContext.workOrderAction == 'delete'){pageContext.subAction = 'deleteWorkOrder'}}"},{"name":"subActionForWorkOrderEdit","type":"script","actionDef":"function(pageContext){pageContext.subAction='editWorkOrder';}"},{"name":"setActionForButtonHidden","type":"script","actionDef":"function(pageContext){pageContext.workOrderAction='edit';pageContext.workOrderStatusId='workOrderOpen';pageContext.statusNameColor ='#a5a5a5';pageContext.statusName ='Open';}"},{"name":"setWorkOrderStatus","type":"script","actionDef":"function(pageContext){ if (pageContext.workOrderAction == 'add') {pageContext.workOrderStatusId = 'Open';}else if(pageContext.workOrderAction == 'edit'){pageContext.workOrderStatusId = pageContext.workOrderStatusId;}}"},{"name":"setActionForWorkOrderDelete","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteWorkOrder';}"},{"subTitle":"@lang.['aysywtctwoatwtwwbac','Are you sure you want to cancel this Work Order? Note that all tasks will be automatically cancelled.']","name":"cancelWorkOrder","options":[{"buttonType":"secondary","name":"no","actionOnClick":["@actions.closeModal"],"type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal","@actions.openCancelWorkOrderSidepanel"],"type":"button","title":"@lang.['yp','Yes, Proceed']"}],"type":"openModal","title":"@lang.['cwo','Cancel Work Order']"},{"subTitle":"@lang.['twocbcaoomtitwoaciass','The work order cannot be cancelled, as one or more tasks in the work order are currently in Auto Scheduling status.']","name":"cannotCancelWorkOrder","options":[{"buttonType":"primary","name":"ok","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['o1','Ok']"}],"type":"openModal","title":"@lang.['cwo','Cancel Work Order']"},{"subTitle":"@lang.['aysywtdtwoatathwbadaw','Are you sure you want to delete this work order? All tasks and their history will be automatically deleted.']","name":"openWorkOrderCancelDeleteModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.fireProcessEvent","@actions.closeModal","@actions.clearPageContext","@actions.closePanel","@actions.refreshDataGrid"],"type":"button","title":"@lang.['d1','Delete']"}],"type":"openModal","title":"@lang.['dwo','Delete Work Order ']"},{"name":"openTemplateSidepanel","type":"openPanel","pageId":"4VMGQK7VSJ"},{"name":"openCancelWorkOrderSidepanel","type":"openPanel","pageId":"H7K0H2A5LK"},{"name":"closeModal","type":"closeModal"},{"name":"openCloseOutSidepanel","type":"openPanel","pageId":"AHRQV3AKF1"},{"name":"getWorkorderTemplateData","outputVarMap":{"data":"@pageContext.templateData"},"type":"query","actionDef":{"filter":"{$workOrderTemplateV2.id} = {@workOrderTemplateId} ","models":["workOrderTemplateV2","workOrderType"],"columns":{"workOrderTypeId":"workOrderType.id","workOrderTemplateWorkOrderTypeId":"workOrderTemplateV2.workOrderTypeId","workOrderTypeName":"workOrderType.name","workOrderTemplatePriorityPriority":"workOrderTemplateV2.priorityPriority"},"inputs":{"workOrderTemplateId":"@pageContext.workOrderTemplateId"},"links":{"workOrderTemplateV2":"workOrderType"}}},{"name":"setSubActionDeleteTaskDependency","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteTaskDependency';}"},{"name":"getTimeZone","type":"script","actionDef":"function (pageContext) { pageContext.timezoneOffset = (typeof pageContext.workOrderRequestedDate !== 'undefined' && pageContext.workOrderRequestedDate !== '') ? new Date(pageContext.workOrderRequestedDate).getTimezoneOffset() : new Date().getTimezoneOffset(); }"},{"endPoint":"event/start","name":"fireProcessEventToDeleteTaskDependency","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workOrderTaskDependencyProcessEvent","contextVar":{"subAction":"@pageContext.subAction","taskDependency":[{"taskDependencyRecver":"@pageContext.taskDependencyRecver","taskDependencyId":"@pageContext.taskDependencyId"}]}}]}},{"name":"enableRecordGrid","type":"script","actionDef":"function(pageContext){pageContext.enable=true;}"},{"name":"setWorkOrderTemplateData","type":"script","actionDef":"function(pageContext){if(typeof pageContext.templateData != 'undefined' && pageContext.templateData.length > 0){pageContext.workOrderPriorityPriority=pageContext.templateData[0].workOrderTemplatePriorityPriority; pageContext.workOrderWorkOrderTypeId = pageContext.templateData[0].workOrderTemplateWorkOrderTypeId;}}"},{"name":"clearWorkOrderTemplateData","type":"script","actionDef":"function(pageContext){if(typeof pageContext.templateId === 'undefined' || pageContext.templateId.length == 0 || pageContext.templateId[0] === null ){pageContext.workOrderPriorityPriority = ''; pageContext.workOrderWorkOrderTypeId = '';}}"},{"falseStep":["@actions.clearCustomerData"],"trueStep":["@actions.processCustomerData","@actions.fetchContracts","@actions.processContractData","@actions.fetchAllCalendar","@actions.clearSlaAndContract","@actions.fetchCalendar","@actions.setCalendarId","@actions.getSlaTimeAndDeadline","@actions.setSlaResponseTimeAndDeadline"],"name":"decisionActionForCustomerData","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.customerId !=='undefined' && pageContext.customerId !=='' && pageContext.customerId[0] !== null) {return true;} return false;}"},{"name":"clearCustomerData","type":"script","actionDef":"function(pageContext){pageContext.workOrderCalendarId='';pageContext.workOrderCustomerId='';}"}]}