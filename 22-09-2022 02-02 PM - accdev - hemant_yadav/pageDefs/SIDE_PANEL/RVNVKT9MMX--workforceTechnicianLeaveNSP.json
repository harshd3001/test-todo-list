{"pageContext":{},"actionOnLoad":["@actions.initialData","@actions.getListOption"],"localPageContext":true,"jslib":{"isDeleteDisabled":"function(pageContext){return (pageContext.leaveAction === 'add');}","customHours":"function(pageContext){if(pageContext.workforceLeaveHoursType == 'customHours'){return true;}else {return false;}}","fullDay":"function(pageContext){if(pageContext.workforceLeaveHoursType == 'fullDay'){return true;}else {return false;}}","dynamicHeaderText":"function(pageContext){ if(pageContext.leaveAction === 'add'){return '@lang.[\"al1\",\"Add Leave\"]'}else if(pageContext.leaveAction === 'edit'){return '@lang.[\"el2\",\"Edit Leave\"]'}}","isSaveDisabled":"function(pageContext){ return (((pageContext.initialWorkforceLeaveReason == pageContext.workforceLeaveReason) && (pageContext.initialWorkforceLeaveHoursType == pageContext.workforceLeaveHoursType) && (pageContext.initialWorkforceLeaveStartDate == pageContext.workforceLeaveStartDate) && (pageContext.initialWorkforceLeaveEndDate == pageContext.workforceLeaveEndDate) && (pageContext.initialWorkforceLeaveNotes == pageContext.workforceLeaveNotes)) || ((pageContext.workforceLeaveReason === '') || (pageContext.workforceLeaveHoursType === '') || (pageContext.workforceLeaveStartDate === '') || (pageContext.workforceLeaveEndDate === '') || (pageContext.workforceLeaveStartDate === pageContext.workforceLeaveEndDate ))) }"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel","@actions.refreshDataGrid"],"type":"buttonIcon"}]},"children":[{"hidden":"@jslib.isDeleteDisabled","icon":"@iconlib.ActionsBinGrey","actionOnClick":["@actions.setSubActionDelete","@actions.processInitialTechnicianData","@actions.processNotificationData","@actions.fireProcessEvent","@actions.openPreviousPanel","@actions.refreshDataGrid"],"id":"deleteContract","type":"buttonIcon"},{"buttonType":"primary","actionOnClick":["@actions.setSubActionUpsert","@actions.processInitialTechnicianData","@actions.processNotificationData","@actions.fireProcessEvent","@actions.openPreviousPanel","@actions.pushNotificationOnSave","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save ']"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"isRequired":true,"options":"@pageContext.listOption","optTitleKey":"answerOptionText","optValueKey":"listOptionAnswerId","id":"leaveReason","title":"@lang.['r5','Reason']","type":"select","value":"@pageContext.workforceLeaveReason","placeHolder":"@lang.['selectReason','Select reason']"},{"isRequired":true,"actionOnChange":[],"hidden":true,"options":[{"name":"@lang.['fd','Full Day']","id":"fullDay"},{"name":"@lang.['ch','Custom Hours']","id":"customHours"}],"id":"leaveHoursType","optTitleKey":"name","optValueKey":"id","title":"@lang.['lht','Leave Hours Type']","type":"select","value":"@pageContext.workforceLeaveHoursType"},{"actionOnChange":["@actions.checkEndDate","@actions.checkDate"],"minDate":"1970-01-01 00:00","hidden":"@jslib.fullDay","id":"startDateForCustomHours","title":"@lang.['sd','Start Date']","type":"datetime","value":"@pageContext.workforceLeaveStartDate","placeHolder":"@lang.['sd6','Select Date']"},{"actionOnChange":["@actions.checkDate"],"minDate":"@pageContext.workforceLeaveStartDate","hidden":"@jslib.fullDay","id":"endDateForCustomHours","title":"@lang.['ed','End Date']","type":"datetime","value":"@pageContext.workforceLeaveEndDate","placeHolder":"@lang.['sd6','Select Date']"},{"actionOnChange":["@actions.checkEndDate","@actions.checkDate"],"minDate":"1970-01-01 00:00","hidden":"@jslib.customHours","id":"startDateForFullDay","title":"@lang.['sd','Start Date']","type":"date","value":"@pageContext.workforceLeaveStartDate","placeHolder":"@lang.['sd6','Select Date']"},{"actionOnChange":["@actions.checkDate"],"minDate":"@pageContext.workforceLeaveStartDate","hidden":"@jslib.customHours","id":"endDateForFullDay","title":"@lang.['ed','End Date']","type":"date","value":"@pageContext.workforceLeaveEndDate","placeHolder":"@lang.['sd6','Select Date']"},{"inputType":"text","id":"notes","label":"@lang.['n2','Notes (Optional)']","type":"textarea","value":"@pageContext.workforceLeaveNotes","placeHolder":"@lang.['en2','Enter notes']"}],"label":"@lang.['l4','Leave']","id":"leaveSection","type":"section"}]},"actions":[{"parentPanelRefreshRequired":false,"name":"openPreviousPanel","type":"backPanel"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.data"},"type":"api","actionDef":{"data":[{"eventId":"workforceTechnicianLeaveProcessEvent","contextVar":{"subAction":"@pageContext.subAction","notificationEndDate":"@pageContext.notificationEndDate","notificationStartDate":"@pageContext.notificationStartDate","workforceLeave":[{"initialWorkforceLeaveStartDate":"@pageContext.initialWorkforceLeaveStartDate","notes":"@pageContext.workforceLeaveNotes","hoursType":"@pageContext.workforceLeaveHoursType","initialWorkforceLeaveEndDate":"@pageContext.initialWorkforceLeaveEndDate","endDate":"@pageContext.workforceLeaveEndDate","recver":"@pageContext.workforceLeaveRecver","reasonListOptionAnswerId":"@pageContext.workforceLeaveReason","leaveAction":"@pageContext.leaveAction","id":"@pageContext.workforceLeaveId","workforceUserId":"@pageContext.workforceUserId","unassignTasks":"@pageContext.workforeLeaveUnassignTasks","startDate":"@pageContext.workforceLeaveStartDate"}]}}]}},{"name":"initialData","type":"script","actionDef":"function(pageContext){if (pageContext.leaveAction == 'edit') {pageContext.workforceLeaveReason = pageContext.workforceLeaveReasonListOptionAnswerId;pageContext.initialWorkforceLeaveReason = pageContext.workforceLeaveReason;pageContext.initialWorkforceLeaveHoursType = pageContext.workforceLeaveHoursType;pageContext.initialWorkforceLeaveStartDate = pageContext.workforceLeaveStartDate;pageContext.initialWorkforceLeaveEndDate = pageContext.workforceLeaveEndDate;pageContext.initialWorkforceLeaveNotes = pageContext.workforceLeaveNotes;} else if (pageContext.leaveAction == 'add') {pageContext.workforceLeaveReason=''; pageContext.workforceLeaveHoursType = 'customHours';pageContext.workforceLeaveStartDate = '';pageContext.workforceLeaveEndDate = '';pageContext.workforceLeaveNotes = '';pageContext.workforeLeaveUnassignTasks = false; }}"},{"name":"getListOption","outputVarMap":{"data":"@pageContext.listOption"},"type":"query","actionDef":{"filter":"{$listOptionAnswerListOptionId}='leaveReason'","models":["listOptionAnswer"],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerListOptionId":"listOptionAnswer.listOptionId","answerOptionText":"listOptionAnswer.answerOptionText"},"translate":true}},{"name":"processInitialTechnicianData","outputVarMap":{"data":"@pageContext.technicianData"},"type":"query","actionDef":{"filter":"{$id}={@workforceUserId}","models":["User"],"columns":{"timezone":"User.timezone","id":"User.id"},"inputs":{"workforceUserId":"@pageContext.workforceUserId"}}},{"name":"processNotificationData","type":"script","actionDef":"function (pageContext) {  if (typeof pageContext.technicianData[0].timezone === 'undefined' || pageContext.technicianData[0].timezone === '') { pageContext.technicianData[0].timezone = 'UTC'; } pageContext.notificationStartDate = new Date(new Date(pageContext.workforceLeaveStartDate).getTime() - (pageContext.timezoneOffset * 60000)); pageContext.notificationStartDate = pageContext.notificationStartDate.toLocaleString('en-US', { timeZone: pageContext.technicianData[0].timezone }); pageContext.notificationEndDate = new Date(new Date(pageContext.workforceLeaveEndDate).getTime() - (pageContext.timezoneOffset * 60000)); pageContext.notificationEndDate = pageContext.notificationEndDate.toLocaleString('en-US', { timeZone: pageContext.technicianData[0].timezone }); }"},{"name":"setSubActionUpsert","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertWorkforceLeave';}"},{"name":"setSubActionDelete","type":"script","actionDef":"function(pageContext){pageContext.subAction='deleteWorkforceLeave'; pageContext.leaveAction='delete';}"},{"name":"refreshDataGrid","gridId":["workforceLeave"],"type":"RefreshGridOnSidePanel"},{"name":"checkEndDate","type":"script","actionDef":"function(pageContext) {if (typeof pageContext.workforceLeaveStartDate !== 'undefined' && pageContext.workforceLeaveStartDate !== '' && typeof pageContext.workforceLeaveEndDate !== 'undefined' && pageContext.workforceLeaveEndDate !== '' ) { pageContext.leaveStartDate = new Date(pageContext.workforceLeaveStartDate);  pageContext.leaveEndDate = new Date(pageContext.workforceLeaveEndDate); if (pageContext.leaveStartDate > pageContext.leaveEndDate){pageContext.workforceLeaveEndDate='';} } }"},{"name":"checkDate","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.workforceLeaveStartDate !== 'undefined' && pageContext.workforceLeaveStartDate !== '' && typeof pageContext.workforceLeaveEndDate !== 'undefined' && pageContext.workforceLeaveEndDate !== '') { if (pageContext.workforceLeaveStartDate !== pageContext.initialWorkforceLeaveStartDate || pageContext.workforceLeaveEndDate !== pageContext.initialWorkforceLeaveEndDate) { pageContext.workforeLeaveUnassignTasks = true; } } }"}]}