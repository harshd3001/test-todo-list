{"processFilterData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskData"}],"contextChangePermitted":true,"name":"processFilterData","description":"processFilterData","processRule":"{contextVar.currentDate = new Date(); contextVar.currentDate.setMinutes(contextVar.currentDate.getMinutes() - 30); contextVar.currentDate.setSeconds(0, 0); contextVar.currentDate = contextVar.currentDate.toISOString().replace('T', ' ').replace('Z', '');}","nodeType":"PROCESS"},"areMoreBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreTasksData"},{"exitPortType":"FalseStep","nodeId":"callRecommendationWF"}],"name":"areMoreBatchesPresent","description":"areMoreBatchesPresent","processRule":"(contextVar.noOfTasksBatches >= 2 && contextVar.noOfTasksBatches >= contextVar.tasksBatchNumber)","nodeType":"DECISION"},"getMoreTasksData":{"models":["workOrderTask","site","taskScheduleBreakdown","taskType","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTasks"}],"havingClause":"taskScheduleBreakdownCount < 2","columns":{"workOrderTaskDuration":"workOrderTask.estimatedDuration","workOrderTaskDueDate":"workOrderTask.dueDate","workOrderTaskTypeId":"workOrderTask.taskTypeId","workOrderTaskStartDate":"workOrderTask.scheduledDate","taskScheduleBreakdownCount":"COUNT({$taskScheduleBreakdown.id})","workOrderTaskId":"workOrderTask.id","assignee":"workOrderTask.assignedToUserId","workOrderTaskRegionId":"site.regionId","userName":"User.name"},"inputs":{"selectedTaskId":{"filter":"{$workOrderTaskRecommendation.recommendationType} = 'longRunningTask' AND {$workOrderTaskRecommendation.sendFurtherRecommendation} = false","models":["workOrderTaskRecommendation"],"columns":{"id":"workOrderTaskRecommendation.workOrderTaskId"},"groupBy":"id","selectColumns":["id"]}},"outerJoinOnModel":"workOrderTask","description":"getMoreTasksData","inputVarMap":{"customBatchSize":"batchSize","tasksBatchNumber":"batchNumber","currentDate":"currentDate","statusIds":"statusIds"},"groupBy":"workOrderTaskId","nodeType":"QUERY","filter":"{$workOrderTask.statusId} IN {@statusIds} AND {$workOrderTask.dueDate} <= {@currentDate} AND {$taskType.webTask} = false AND {$taskType.crewTask} = false AND ({$workOrderTask.isLongDurationTask} = false OR {$workOrderTask.isLongDurationTask} IS NULL) AND {$workOrderTaskId} NOT IN ({@selectedTaskId})","name":"getMoreTasksData","links":{"workOrderTask":"site","taskType":"workOrderTask","User":"workOrderTask","taskScheduleBreakdown":"workOrderTask"},"outputVarMap":{"data":"moreWorkOrderTaskData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"workflowContext":{"customBatchSize":1000,"noOfTasksBatches":0,"statusIds":["workOrderTaskIncident","workOrderTaskInProgress","workOrderTaskInTransit"]},"appendTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"{ if (Array.isArray(contextVar.moreWorkOrderTaskData)) { contextVar.workOrderTaskData = contextVar.workOrderTaskData.concat(contextVar.moreWorkOrderTaskData); } contextVar.tasksBatchNumber++; }","nodeType":"PROCESS"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{ contextVar.noOfTasksBatches = Math.ceil(contextVar.tasksCount/contextVar.customBatchSize); contextVar.tasksBatchNumber++; }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFilterData"}],"name":"start","description":"start","nodeType":"START"},"fetchTaskData":{"models":["workOrderTask","site","taskScheduleBreakdown","taskType","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"areTasksPresent"}],"havingClause":"taskScheduleBreakdownCount < 2","columns":{"workOrderTaskDuration":"workOrderTask.estimatedDuration","workOrderTaskDueDate":"workOrderTask.dueDate","workOrderTaskTypeId":"workOrderTask.taskTypeId","workOrderTaskStartDate":"workOrderTask.scheduledDate","taskScheduleBreakdownCount":"COUNT({$taskScheduleBreakdown.id})","workOrderTaskId":"workOrderTask.id","assignee":"workOrderTask.assignedToUserId","workOrderTaskRegionId":"site.regionId","userName":"User.name"},"inputs":{"selectedTaskId":{"filter":"{$workOrderTaskRecommendation.recommendationType} = 'longRunningTask' AND {$workOrderTaskRecommendation.sendFurtherRecommendation} = false","models":["workOrderTaskRecommendation"],"columns":{"id":"workOrderTaskRecommendation.workOrderTaskId"},"groupBy":"id","selectColumns":["id"]}},"description":"fetchTaskData","outerJoinOnModel":"workOrderTask","inputVarMap":{"customBatchSize":"batchSize","currentDate":"currentDate","statusIds":"statusIds"},"groupBy":"workOrderTaskId","nodeType":"QUERY","filter":"{$workOrderTask.statusId} IN {@statusIds} AND {$workOrderTask.dueDate} <= {@currentDate} AND {$taskType.webTask} = false AND {$taskType.crewTask} = false AND ({$workOrderTask.isLongDurationTask} = false OR {$workOrderTask.isLongDurationTask} IS NULL) AND {$workOrderTaskId} NOT IN ({@selectedTaskId})","name":"fetchTaskData","links":{"workOrderTask":"site","taskType":"workOrderTask","User":"workOrderTask","taskScheduleBreakdown":"workOrderTask"},"outputVarMap":{"data":"workOrderTaskData","count":"tasksCount","batchNumber":"tasksBatchNumber"},"batchSize":"batchSize","getCount":true},"end":{"name":"end","description":"end","inputVarMap":{"data":"data"},"outputVarMap":{"data":"data"},"nodeType":"END"},"areTasksPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"findNumberOfBatches"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areTasksPresent","description":"areTasksPresent","processRule":"(Array.isArray(contextVar.workOrderTaskData))","nodeType":"DECISION"},"callRecommendationWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"longRunningTaskRecommendationWF","name":"callRecommendationWF","description":"callRecommendationWF","inputVarMap":{"currentDate":"currentDate","statusIds":"statusIds","workOrderTaskData":"workOrderTaskData"},"outputVarMap":{},"nodeType":"WORKFLOW"},"workflowNodes":["start","processFilterData","fetchTaskData","areTasksPresent","findNumberOfBatches","areMoreBatchesPresent","getMoreTasksData","appendTasks","callRecommendationWF","end"]}