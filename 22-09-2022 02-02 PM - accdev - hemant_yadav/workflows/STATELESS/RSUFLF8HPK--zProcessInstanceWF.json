{"processCrewTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callCrewAttendanceModelWfForDelete"}],"contextChangePermitted":true,"name":"processCrewTaskData","description":"processCrewTaskData","processRule":"{ for (var i = 0; i < contextVar.crewTaskData.length; i++) { contextVar.crewTaskData[i].processInstanceId = ''; } }","nodeType":"PROCESS"},"callCrewAttendanceModelWfForCreate":{"eventId":"U2LIPS8A0W","connectors":[{"exitPortType":"NextStep","nodeId":"publishEndOfTaskStateEvent"}],"contextChangePermitted":true,"name":"callCrewAttendanceModelWfForCreate","description":"callCrewAttendanceModelWfForCreate","inputVarMap":{"workforceCrewData":"crewAttendanceData"},"outputVarMap":{},"nodeType":"PUBLISH","captureOutput":true},"processInstanceDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"callDeleteProcessInstanceWF"},{"exitPortType":"FalseStep","nodeId":"createProcessInstanceDecision"}],"name":"processInstanceDecision","description":"processInstanceDecision","processRule":"(typeof contextVar.workOrderTaskProcessInstanceId !== 'undefined' && contextVar.workOrderTaskProcessInstanceId !== '')","nodeType":"DECISION"},"createProcessInstanceDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"callCreateProcessInstanceWF"},{"exitPortType":"FalseStep","nodeId":"updateWorkOrderTask"}],"name":"createProcessInstanceDecision","description":"createProcessInstanceDecision","processRule":"(contextVar.createZProcessInstanceReqd === true)","nodeType":"DECISION"},"processInstanceChangeDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processInstanceDecision"},{"exitPortType":"FalseStep","nodeId":"publishEndOfTaskStateEvent"}],"name":"processInstanceChangeDecision","description":"processInstanceChangeDecision","processRule":"((contextVar.webTask !== true) && (contextVar.deleteZProcessInstanceReqd === true || contextVar.createZProcessInstanceReqd === true))","nodeType":"DECISION"},"callCrewAttendanceModelWfForDelete":{"eventId":"U2LIPS8A0W","connectors":[{"exitPortType":"NextStep","nodeId":"createProcessInstanceForCrewDecision"}],"contextChangePermitted":true,"name":"callCrewAttendanceModelWfForDelete","description":"callCrewAttendanceModelWfForDelete","inputVarMap":{"crewTaskData":"crewAttendanceData"},"outputVarMap":{},"nodeType":"PUBLISH","captureOutput":true},"processCrewAttendanceData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callCrewAttendanceModelWfForCreate"}],"contextChangePermitted":true,"name":"processCrewAttendanceData","description":"processCrewAttendanceData","processRule":"{ for (var i = 0; i < contextVar.crewTaskData.length; i++) { for (var j = 0; j < contextVar.workforceCrewData.length; j++) { if (contextVar.crewTaskData[i].workOrderTaskId === contextVar.workforceCrewData[j].workOrderTaskId && contextVar.crewTaskData[i].workforceUserId === contextVar.workforceCrewData[j].workforceUserId) { contextVar.workforceCrewData[j].workOrderTaskId = contextVar.workOrderTaskId; contextVar.workforceCrewData[j].attendance = contextVar.crewTaskData[i].attendance; } } } if(contextVar.crewTaskData.length===0){ for (var j = 0; j < contextVar.workforceCrewData.length; j++) { contextVar.workforceCrewData[j].workOrderTaskId = contextVar.workOrderTaskId; } } }","nodeType":"PROCESS"},"workflowContext":{"workforceCrewStatusId":"workforceCrewOnCrew","noAccess":"noAccess","partialAccess":"partialAccess","workforceStatusFilter":"workforceActive","defaultProcessId":"","userStatusFilter":"Deactivated","createIndex":0,"deleteIndex":0},"callCreateProcessInstanceWfForCrew":{"connectors":[{"exitPortType":"NextStep","nodeId":"updateWorkforceCrewData"}],"processId":"MWEYC5CDNT","name":"callCreateProcessInstanceWfForCrew","description":"callCreateProcessInstanceWfForCrew","inputVarMap":{"mobileProcessId":"mobileProcessId","userId":"userId"},"outputVarMap":{"zProcessInstanceId":"zProcessInstanceId"},"nodeType":"WORKFLOW"},"publishEndOfTaskStateEvent":{"eventId":"endOfTaskStateEventProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"publishEndOfTaskStateEvent","description":"publishEndOfTaskStateEvent","inputVarMap":{},"nodeType":"PUBLISH","captureOutput":false},"deleteCrewInstanceDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processCrewTaskData"},{"exitPortType":"FalseStep","nodeId":"createProcessInstanceForCrewDecision"}],"name":"deleteCrewInstanceDecision","description":"deleteCrewInstanceDecision","processRule":"(typeof contextVar.crewTaskData !== 'undefined' && contextVar.crewTaskData.length > 0 &&  contextVar.workOrderTaskStatusId !== 'workOrderTaskPendingReview')","nodeType":"DECISION"},"fetchCrewMembers":{"filter":"{$workforceCrew.crewId} = {@crewId} AND {$workforceCrew.statusId} = {@workforceCrewStatusId} AND {$workforce.statusId} = {@workforceStatusFilter} AND {$User.status} != {@userStatusFilter}","models":["workforceCrew","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"crewTaskNoAccessDecision"}],"columns":{"workforceUserId":"workforceCrew.workforceUserId"},"name":"fetchCrewMembers","description":"fetchCrewMembers","inputVarMap":{"workforceCrewStatusId":"workforceCrewStatusId","workforceStatusFilter":"workforceStatusFilter","workOrderTaskAssignedToCrewId":"crewId","userStatusFilter":"userStatusFilter"},"outputVarMap":{"data":"workforceCrewData"},"nodeType":"QUERY"},"callDeleteProcessInstanceWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"processZProcessInstanceId"}],"processId":"MZC06H8KD9","name":"callDeleteProcessInstanceWF","description":"callDeleteProcessInstanceWF","inputVarMap":{},"outputVarMap":{},"nodeType":"WORKFLOW"},"end":{"name":"end","description":"end","inputVarMap":{},"outputVarMap":{},"nodeType":"END"},"crewTaskDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchExistingCrewTaskData"},{"exitPortType":"FalseStep","nodeId":"publishEndOfTaskStateEvent"}],"name":"crewTaskDecision","description":"crewTaskDecision","processRule":"(typeof contextVar.crewTask !== 'undefined' && contextVar.crewTask === true)","nodeType":"DECISION"},"updateWorkforceCrewData":{"connectors":[{"exitPortType":"NextStep","nodeId":"createIndexCheck"}],"contextChangePermitted":true,"name":"updateWorkforceCrewData","description":"updateWorkforceCrewData","processRule":"{ contextVar.workforceCrewData[contextVar.createIndex].workOrderTaskId = contextVar.workOrderTaskId; if (contextVar.userId === contextVar.workOrderTaskAssignedToUserId) { contextVar.zProcessInstanceId = ''; } contextVar.workforceCrewData[contextVar.createIndex].processInstanceId = contextVar.zProcessInstanceId; for (var i = 0; i < contextVar.crewTaskData.length; i++) { if (contextVar.crewTaskData[i].workOrderTaskId === contextVar.workforceCrewData[contextVar.createIndex].workOrderTaskId && contextVar.crewTaskData[i].workforceUserId === contextVar.workforceCrewData[contextVar.createIndex].workforceUserId) { contextVar.workforceCrewData[contextVar.createIndex].attendance = contextVar.crewTaskData[i].attendance; } } contextVar.createIndex++; }","nodeType":"PROCESS"},"crewLeadCheck":{"connectors":[{"exitPortType":"TrueStep","nodeId":"updateWorkforceCrewData"},{"exitPortType":"FalseStep","nodeId":"callCreateProcessInstanceWfForCrew"}],"name":"crewLeadCheck","description":"crewLeadCheck","processRule":"(contextVar.userId === contextVar.workOrderTaskAssignedToUserId)","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processInstanceChangeDecision"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"updateWorkOrderTask":{"eventId":"zprocessInstanceWorkOrderTaskProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"crewTaskDecision"}],"contextChangePermitted":true,"name":"updateWorkOrderTask","description":"updateWorkOrderTask","inputVarMap":{"zProcessInstanceId":"zProcessInstanceId"},"nodeType":"PUBLISH"},"callCreateProcessInstanceWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"updateWorkOrderTask"}],"processId":"MWEYC5CDNT","name":"callCreateProcessInstanceWF","description":"callCreateProcessInstanceWF","inputVarMap":{"workOrderTaskAssignedToUserId":"userId","mobileProcessId":"mobileProcessId"},"outputVarMap":{"zProcessInstanceId":"zProcessInstanceId"},"nodeType":"WORKFLOW"},"crewTaskNoAccessDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processCrewAttendanceData"},{"exitPortType":"FalseStep","nodeId":"processWorkforceCrewData"}],"name":"crewTaskNoAccessDecision","description":"crewTaskNoAccessDecision","processRule":"(typeof contextVar.crewMobileAccess !== 'undefined' && contextVar.crewMobileAccess === contextVar.noAccess)","nodeType":"DECISION"},"workflowNodes":["start","processInstanceChangeDecision","processInstanceDecision","callDeleteProcessInstanceWF","processZProcessInstanceId","createProcessInstanceDecision","callCreateProcessInstanceWF","updateWorkOrderTask","crewTaskDecision","fetchExistingCrewTaskData","crewTaskPartialAccessDecision","deleteCrewInstanceDecision","processCrewTaskData","callCrewAttendanceModelWfForDelete","createProcessInstanceForCrewDecision","fetchCrewMembers","crewTaskNoAccessDecision","processWorkforceCrewData","crewLeadCheck","callCreateProcessInstanceWfForCrew","updateWorkforceCrewData","createIndexCheck","processCrewAttendanceData","callCrewAttendanceModelWfForCreate","publishEndOfTaskStateEvent","end"],"createProcessInstanceForCrewDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCrewMembers"},{"exitPortType":"FalseStep","nodeId":"publishEndOfTaskStateEvent"}],"name":"createProcessInstanceForCrewDecision","description":"createProcessInstanceForCrewDecision","processRule":"(contextVar.createZProcessInstanceReqd === true)","nodeType":"DECISION"},"crewTaskPartialAccessDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"deleteCrewInstanceDecision"},{"exitPortType":"FalseStep","nodeId":"createProcessInstanceForCrewDecision"}],"name":"crewTaskPartialAccessDecision","description":"crewTaskPartialAccessDecision","processRule":"(typeof contextVar.crewMobileAccess !== 'undefined' && contextVar.crewMobileAccess === contextVar.partialAccess)","nodeType":"DECISION"},"createIndexCheck":{"connectors":[{"exitPortType":"TrueStep","nodeId":"callCrewAttendanceModelWfForCreate"},{"exitPortType":"FalseStep","nodeId":"processWorkforceCrewData"}],"name":"createIndexCheck","description":"createIndexCheck","processRule":"(contextVar.createIndex >= contextVar.workforceCrewData.length)","nodeType":"DECISION"},"fetchExistingCrewTaskData":{"filter":"{$workOrderTaskId} = {@workOrderTaskId}","models":["crewAttendance"],"connectors":[{"exitPortType":"NextStep","nodeId":"crewTaskPartialAccessDecision"}],"columns":{"processInstanceId":"crewAttendance.processInstanceId","workOrderTaskId":"crewAttendance.workOrderTaskId","workforceUserId":"crewAttendance.workforceUserId","attendance":"crewAttendance.attendance"},"name":"fetchExistingCrewTaskData","description":"fetchExistingCrewTaskData","inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"crewTaskData"},"nodeType":"QUERY"},"processZProcessInstanceId":{"connectors":[{"exitPortType":"NextStep","nodeId":"createProcessInstanceDecision"}],"contextChangePermitted":true,"name":"processZProcessInstanceId","description":"processZProcessInstanceId","processRule":"{contextVar.zProcessInstanceId = contextVar.defaultProcessId;}","nodeType":"PROCESS"},"processWorkforceCrewData":{"connectors":[{"exitPortType":"NextStep","nodeId":"crewLeadCheck"}],"contextChangePermitted":true,"name":"processWorkforceCrewData","description":"processWorkforceCrewData","processRule":"{ contextVar.userId = contextVar.workforceCrewData[contextVar.createIndex].workforceUserId; contextVar.mobileProcessId = contextVar.crewMobileProcessId; }","nodeType":"PROCESS"}}