{"insertIntoAssetLog":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkOrderTasks"}],"processId":"installedBaseLogModelWF","name":"insertIntoAssetLog","description":"insertIntoAssetLog","inputVarMap":{"installedBaseLog":"installedBaseLog","subAction":"subAction"},"outputVarMap":{},"nodeType":"WORKFLOW"},"fetchLocalizedKeys":{"filter":"{$listOptionAnswer.listOptionId}='assetLogEvents'","models":["listOptionAnswer"],"connectors":[{"exitPortType":"NextStep","nodeId":"processModelData"}],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText"},"name":"fetchLocalizedKeys","description":"fetchLocalizedKeys","outputVarMap":{"data":"localizedData"},"nodeType":"QUERY"},"upsertWorkOrderTask":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"QIFGIU7FDJ","name":"upsertWorkOrderTask","description":"upsertWorkOrderTask","inputVarMap":{"workOrderTask":"data","subActionForWOT":"subAction"},"outputVarMap":{},"nodeType":"WORKFLOW"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"name":"start","description":"Start","nodeType":"START"},"workflowNodes":["start","processData","decisionNode","fetchInstalledBaseData","fetchLocalizedKeys","processModelData","insertIntoAssetLog","fetchWorkOrderTasks","checkIfTaskPresent","fetchCurrentUser","processWorkOrderTaskData","upsertWorkOrderTask","end"],"fetchCurrentUser":{"filter":"{$userId}={@userId}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processWorkOrderTaskData"}],"columns":{"userName":"User.name","userId":"User.id"},"name":"fetchCurrentUser","description":"fetchCurrentUser","inputVarMap":{"{@userId}":"userId"},"outputVarMap":{"data":"currentUserDetail"},"nodeType":"QUERY"},"fetchWorkOrderTasks":{"filter":"{$assetMaintenanceSchedule.assetMaintenancePlanId}={@planId} AND {$workOrderTask.statusId} = 'workOrderTaskOpen'","models":["assetMaintenanceSchedule","workOrder","workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfTaskPresent"}],"columns":{"id":"workOrderTask.id"},"name":"fetchWorkOrderTasks","description":"fetchWorkOrderTasks","links":{"workOrderTask":"workOrder","assetMaintenanceSchedule":"workOrder"},"inputVarMap":{"planId":"planId"},"outputVarMap":{"data":"workOrderTaskData"},"nodeType":"QUERY"},"fetchInstalledBaseData":{"filter":"{$assetMaintenancePlanInstalledBase.assetMaintenancePlanId}={@planId}","models":["assetMaintenancePlanInstalledBase"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchLocalizedKeys"}],"columns":{"installedBaseId":"assetMaintenancePlanInstalledBase.installedBaseId"},"name":"fetchInstalledBaseData","description":"fetchInstalledBaseData","inputVarMap":{"planId":"planId"},"outputVarMap":{"data":"installedBaseData"},"nodeType":"QUERY"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionNode"}],"contextChangePermitted":true,"name":"processData ","description":"process data for scheduling","processRule":"contextVar.planId = contextVar.data.id;contextVar.statusId = contextVar.data.statusId;","nodeType":"PROCESS","jsEngine":"es6"},"workflowContext":{"cancellationReason":"@lang.['maintenancePlanExpired','Maintenance Plan Expired']","subActionForWOT":"upsertWorkOrderTask"},"decisionNode":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchInstalledBaseData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"decisionNode","description":"decisionNode","processRule":"{typeof contextVar.statusId !=='undefined' && contextVar.statusId !=='' && contextVar.statusId ==='assetMaintenancePlanExpired' }","nodeType":"DECISION"},"checkIfTaskPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCurrentUser"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkIfTaskPresent","description":"checkIfTaskPresent","processRule":"(typeof contextVar.workOrderTaskData !='undefined' && contextVar.workOrderTaskData !='' && contextVar.workOrderTaskData.length > 0)","nodeType":"DECISION"},"processWorkOrderTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertWorkOrderTask"}],"contextChangePermitted":true,"name":"processWorkOrderTaskData","description":"processWorkOrderTaskData","processRule":"{ contextVar.workOrderTask = []; if (typeof contextVar.currentUserDetail != 'undefined' && contextVar.currentUserDetail != '' && contextVar.currentUserDetail.length > 0) { contextVar.userId = contextVar.currentUserDetail[0].userId; } else { contextVar.userId = ''; } contextVar.today = new Date().toISOString().replace('T', ' ').replace('Z', ''); contextVar.workOrderTaskData.forEach(element => { contextVar.workOrderTask.push({ id: element.id, cancelledBy: contextVar.userId, cancelledDate: contextVar.today, cancellationNotes: '', cancellationReason: contextVar.cancellationReason, statusId: 'workOrderTaskCancelled', eventType: 'workOrderTaskCancelled' }); }); }","nodeType":"PROCESS","jsEngine":"es6"},"end":{"name":"end","description":"End","inputVarMap":{},"outputVarMap":{},"nodeType":"END"},"processModelData":{"connectors":[{"exitPortType":"NextStep","nodeId":"insertIntoAssetLog"}],"contextChangePermitted":true,"name":"processModelData","description":"processModelData","processRule":"{for (const key in contextVar.data) { contextVar[key] = contextVar.data[key]; } var localizedKeys = {}; if (typeof contextVar.localizedData !== 'undefined' && contextVar.localizedData !== '') { contextVar.localizedData.forEach(function (element) { localizedKeys[element.listOptionAnswerId] = element.listOptionAnswerAnswerOptionText; }); } contextVar.installedBaseLog = []; contextVar.installedBaseData.forEach(ele => { var obj = { loggedByUserId: contextVar.modifiedByUser, logDate: contextVar.modifiedDate, installedBaseId: ele.installedBaseId, taskTypeId: '-', workOrderId: '-', workOrderTaskId: '-' }; obj['eventType'] = 'maintenancePlanExpired'; obj['event'] = localizedKeys['maintenancePlanExpired']; contextVar.installedBaseLog.push(obj); }); contextVar.subAction = 'upsertInstalledBaseLog';}","nodeType":"PROCESS","jsEngine":"es6"}}