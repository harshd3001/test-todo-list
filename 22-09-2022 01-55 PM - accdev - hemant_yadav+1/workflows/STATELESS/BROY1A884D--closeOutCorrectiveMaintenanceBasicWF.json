{"isURlExist":{"connectors":[{"exitPortType":"TrueStep","nodeId":"setZipUrl"},{"exitPortType":"FalseStep","nodeId":"callTranslationWF"}],"name":"isURlExist","description":"isURlExist","processRule":"(typeof contextVar.urlExist != 'undefined' && contextVar.urlExist != '')","nodeType":"DECISION"},"processCloseOutResult":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertCloseOutResult"}],"contextChangePermitted":true,"name":"processCloseOutResult","description":"processCloseOutResult","processRule":"contextVar.closeoutFinal = []; var addWorkOrderId = {}; addWorkOrderId['closeOutPackage'] = contextVar.finalDataCloseOut; addWorkOrderId['id'] = contextVar.workOrderId; contextVar.closeoutFinal.push(addWorkOrderId);","id":"processCloseOutResult","nodeType":"PROCESS"},"callGetUpdatedSiteDetailsWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"processSiteDetails"}],"processId":"getUpdatedSiteDetailsWF","name":"callGetUpdatedSiteDetailsWF","description":"callGetUpdatedSiteDetailsWF","inputVarMap":{"currentTaskId":"workOrderTaskId"},"nodeType":"WORKFLOW"},"processDuplicateData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callGetUpdatedSiteDetailsWF"}],"contextChangePermitted":true,"name":"processDuplicateData","description":"combine all tasks data together","processRule":"function arrayCheck(a) { return (typeof a !== 'undefined' && Array.isArray(a) && a.length > 0); } function checkForData(a) { return (typeof a !== 'undefined' && a !== ''); } contextVar.currentTaskId = contextVar.loopThroughTasksList_currentElement.taskId; if (typeof contextVar.loopThroughTasksList_currentElement.workOrderTaskResult != 'undefined' && contextVar.loopThroughTasksList_currentElement.workOrderTaskResult != '' && Array.isArray(contextVar.loopThroughTasksList_currentElement.workOrderTaskResult)) { var mainArray = []; contextVar.loopThroughTasksList_currentElement.workOrderTaskResult.forEach(function(element, index) { var initialEvidenceArray = []; var finalEvidenceArray = []; var progressEvidenceArray = []; var servicesArray = []; var materialsDataGrid = []; var manufacturerName = '', modelName = '', modelNumber = '', quantityUsed = '', materialsPhotosDataGrid = [], materialNotes = ''; var resultArr = JSON.stringify(mainArray); if (index != 0) { if (element.initialEvidenceDataGrid) { for (var i = 0; i < element.initialEvidenceDataGrid.length; i++) { if (resultArr.includes(element.initialEvidenceDataGrid[i].initialEvidence)) { continue; } if (element.initialEvidenceDataGrid && element.initialEvidenceDataGrid.length > 0) { initialEvidenceArray.push(element.initialEvidenceDataGrid[i]); } } element.initialEvidenceDataGrid = initialEvidenceArray; } if (element.submitProgressEvidenceDataGrid) { for (var i = 0; i < element.submitProgressEvidenceDataGrid.length; i++) { if (resultArr.includes(element.submitProgressEvidenceDataGrid[i].finalEvidence)) { continue; } if (element.submitProgressEvidenceDataGrid && element.submitProgressEvidenceDataGrid.length > 0) { progressEvidenceArray.push(element.submitProgressEvidenceDataGrid[i]); } } element.submitProgressEvidenceDataGrid = progressEvidenceArray; } if (element.finalEvidenceDataGrid) { for (var i = 0; i < element.finalEvidenceDataGrid.length; i++) { if (resultArr.includes(element.finalEvidenceDataGrid[i].finalEvidence)) { continue; } if (element.finalEvidenceDataGrid && element.finalEvidenceDataGrid.length > 0) { finalEvidenceArray.push(element.finalEvidenceDataGrid[i]); } } element.finalEvidenceDataGrid = finalEvidenceArray; } if (element.servicesDataGrid) { for (var i = 0; i < element.servicesDataGrid.length; i++) { if (resultArr.includes(element.servicesDataGrid[i].addServicesTime)) { continue; } if (element.servicesDataGrid && element.servicesDataGrid.length > 0) { if (arrayCheck(element.servicesDataGrid[i].addServicePhotosDataGrid)) { var servicePhotosArray = []; for (var k = 0; k < element.servicesDataGrid[i].addServicePhotosDataGrid.length; k++) { if (resultArr.includes(element.servicesDataGrid[i].addServicePhotosDataGrid[k].servicePhotos.media)) { continue } else { servicePhotosArray.push(element.servicesDataGrid[i].addServicePhotosDataGrid[k]); } } element.servicesDataGrid[i].addServicePhotosDataGrid = servicePhotosArray; } } servicesArray.push(element.servicesDataGrid[i]); } element.servicesDataGrid = servicesArray; } if (Array.isArray(element.additionalMaterials)) { element.additionalMaterials.some((addObj, j) => { if (checkForData(addObj.quantity)) { manufacturerName = addObj.material[0].manufacturerName; modelName = addObj.material[0].catalogName; modelNumber = addObj.material[0].catalogModelNumber; quantityUsed = addObj.quantity + ' ' + addObj.material[0].stockUnitName; materialsPhotosDataGrid = arrayCheck(addObj.addMaterialsPhotosDataGrid) ? addObj.addMaterialsPhotosDataGrid : []; materialNotes = addObj.materialNotes; materialsObj = { 'manufacturerName': manufacturerName, 'modelName': modelName, 'modelNumber': modelNumber, 'quantityUsed': quantityUsed, 'materialsPhotosDataGrid': materialsPhotosDataGrid, 'materialNotes': materialNotes }; materialsDataGrid.push(materialsObj); } }); } if (Array.isArray(element.suggestedMaterials)) { element.suggestedMaterials.some((sugObj, j) => { if (checkForData(sugObj.actualQuantity)) { manufacturerName = sugObj.manufacturerName; modelName = sugObj.catalogName; modelNumber = sugObj.catalogModelNumber; quantityUsed = sugObj.actualQuantity + ' ' + sugObj.stockUnitName; materialsPhotosDataGrid = arrayCheck(sugObj.suggestedMaterialsPhotosDataGrid) ? sugObj.suggestedMaterialsPhotosDataGrid : []; materialNotes = sugObj.materialNotes; materialsObj = { 'manufacturerName': manufacturerName, 'modelName': modelName, 'modelNumber': modelNumber, 'quantityUsed': quantityUsed, 'materialsPhotosDataGrid': materialsPhotosDataGrid, 'materialNotes': materialNotes }; materialsDataGrid.push(materialsObj); } }); } element = { ...element, materialsDataGrid }; mainArray.push(element); } else { if (Array.isArray(element.additionalMaterials)) { element.additionalMaterials.some((addObj, j) => { if (checkForData(addObj.quantity)) { manufacturerName = addObj.material[0].manufacturerName; modelName = addObj.material[0].catalogName; modelNumber = addObj.material[0].catalogModelNumber; quantityUsed = addObj.quantity + ' ' + addObj.material[0].stockUnitName; materialsPhotosDataGrid = arrayCheck(addObj.addMaterialsPhotosDataGrid) ? addObj.addMaterialsPhotosDataGrid : []; materialNotes = addObj.materialNotes; materialsObj = { 'manufacturerName': manufacturerName, 'modelName': modelName, 'modelNumber': modelNumber, 'quantityUsed': quantityUsed, 'materialsPhotosDataGrid': materialsPhotosDataGrid, 'materialNotes': materialNotes }; materialsDataGrid.push(materialsObj); } }); } if (Array.isArray(element.suggestedMaterials)) { element.suggestedMaterials.some((sugObj, j) => { if (checkForData(sugObj.actualQuantity)) { manufacturerName = sugObj.manufacturerName; modelName = sugObj.catalogName; modelNumber = sugObj.catalogModelNumber; quantityUsed = sugObj.actualQuantity + ' ' + sugObj.stockUnitName; materialsPhotosDataGrid = arrayCheck(sugObj.suggestedMaterialsPhotosDataGrid) ? sugObj.suggestedMaterialsPhotosDataGrid : []; materialNotes = sugObj.materialNotes; materialsObj = { 'manufacturerName': manufacturerName, 'modelName': modelName, 'modelNumber': modelNumber, 'quantityUsed': quantityUsed, 'materialsPhotosDataGrid': materialsPhotosDataGrid, 'materialNotes': materialNotes }; materialsDataGrid.push(materialsObj); } }); } element = { ...element, materialsDataGrid }; mainArray.push(element); } }); contextVar.loopThroughTasksList_currentElement.workOrderTaskResult = mainArray; }","id":"processDuplicateData","nodeType":"PROCESS","jsEngine":"es6"},"checkPDForPhotos":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processCloseOutData"},{"exitPortType":"FalseStep","nodeId":"zipFiles"}],"name":"checkPDForPhotos","description":"checkPDForPhotos","processRule":"(contextVar.fileType == 'Closeout Package PDF')","nodeType":"DECISION"},"callTranslationWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"processTasks"}],"processId":"fetchResourcesForLocale","name":"callTranslationWF","description":"callTranslationWF","inputVarMap":{"defaultLocale":"defaultLocale","resourceIdList":"resourceIdList","locale":"userLocale"},"nodeType":"WORKFLOW"},"upsertCloseOutResult":{"modelName":"workOrder","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"multirecord":true,"name":"upsertCloseOutResult","description":"upsertCloseOutResult","inputVarMap":{"closeoutFinal":"data"},"outputVarMap":{"data":"data"},"nodeType":"MODEL","operation":4},"closeoutPackageZrule":{"connectors":[{"exitPortType":"NextStep","nodeId":"processAllData"}],"contextChangePermitted":true,"name":"closeoutPackageZrule","description":"closeoutPackageZrule","processRule":"@3GMCEGF4QZ","nodeType":"PROCESS","jsEngine":"es6"},"loopThroughTasksList":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processDuplicateData"},{"exitPortType":"FalseStep","nodeId":"processTranslation"}],"data":"workOrderData","name":"loopThroughTasksList","description":"loopThroughTasksList","inputVarMap":{},"outputVarMap":{},"nodeType":"FOREACHLOOP"},"workflowContext":{"materialsOverviewTableFooter":"<\/tr> <\/table> <\/div> <\/td> <\/tr>","initialEvidenceString":"<tr> <td class='left-information-photo'><img src='INITIALEVIDENCEPHOTO' alt='No image available' class='photos'><\/td> <td class='right-information'> <h3>#Localized-co2#<\/h3> <p>CAPTUREDON<\/p> <h3 >#Localized-pt2#<\/h3> <p >PHOTOTYPE<\/p> <h3>#Localized-a4#<\/h3> <p>ASSIGNEE<\/p> <h3>#Localized-comments#<\/h3> <p>INITIALPHOTOCOMMENTS<\/p> <\/td> <\/tr>","customerSignatureTemplate":"<tr> <td><span class='block-titles'><b>#Localized-customerSignature#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr><table> <tr> <td> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td  class='signature-box'><img src='CUSTOMERSIGNATURE' class='signaturePhotos' alt='No image available' > <\/td> <\/tbody> <\/table> <\/div> <\/td> <\/tr> <\/table> <table> <tr> <td style='padding-right: 90px'>#Localized-approvedBy#<\/td> <td>#Localized-so2#<\/td> <\/tr> <tr> <td>APPROVEDBY<\/td> <td>SIGNEDON<\/td> <\/tr> <\/table>","zTableHeaderWithLogo":"<table id='main-table' class='main-table'> <tbody> <tr> <td class='logo-left-information'><img src='https://mms.businesswire.com/media/20191118005157/en/757060/5/Zinier_Identity_Horizontal_Lockup.jpg' alt='some' class='logo-class'><\/td> <td class='logo-right-information'> Zinier Inc. <\/td> <\/tr> <tr> <td colspan='2'> <hr class='seperator'> <\/td> <\/tr> <\/tbody> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/table>","resourceIdList":["wod","copyright","WorkOrderId","wot1","ca1","wod1","customer","rdt","cdt","atd2","taskDetails","taskType","a10","sdt","edt","cs","ca1","ua","n3","so1","a4","pr","sd12","ie","fe","co2","pt2","comments","navS3","co3","serviceType","an1","asn","a4","on","customerSignature","approvedBy","taskId","so2","tro","so3","s21","action","sb","timeStamp","mo","m","mn","mn1","quantityUsed","m9","se2","cb2","tn2","tos","cb3","assetInstallation","assetOthers","assetRemoval","assetRemovalFaulty","assetRemovalOthers","assetReplacement","assetServicing","r5","ia1","ra","sa3","c33","sn"],"assetRemovalService":"<table id='main-table' class='main-table'> <tbody> <tr> <td><span class='block-titles'><b>#Localized-ra#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td class='left-info-color'>#Localized-m#<\/td> <td class='right-information'>MANUFACTURER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn#<\/td> <td class='right-information'>MODELNAME<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn1#<\/td> <td class='right-information'>MODELNUMBER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-c33#<\/td> <td class='right-information'>CATEGORY<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-sn#<\/td> <td class='right-information'>SERIALNUMBER<\/td> <\/tr> <\/tbody> <\/table> <\/div> <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","materialsOverviewTableContents":"<tr> <td class='left-information'>MANUFACTURER<\/a><\/td> <td class='left-information'>MODELNAME<\/td> <td class='left-information'>MODELNUMBER<\/td> <td class='left-information'>QUANTITYUSED<\/td> <\/tr>","blankSeparatorTableString":" <table id='main-table' class='main-table'> <tbody> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","materialDetailsTemplate":" <table id='main-table' class='main-table'> <tbody> <tr> <td><span class='block-titles'><b>#Localized-m9# : MODELNAME<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td class='left-info-color'>#Localized-m#<\/td> <td class='right-information'>MANUFACTURER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn1#<\/td> <td class='right-information'>MODELNUMBER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-quantityUsed#<\/td> <td class='right-information'>QUANTITYUSED<\/td> <\/tr>  <\/tbody> <\/table> <\/div> <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","progressEvidenceString":"<tr> <td class='left-information-photo'><img src='PROGRESSEVIDENCEPHOTO' alt='No image available' class='photos'><\/td> <td class='right-information'> <h3>#Localized-co2#<\/h3> <p>CAPTUREDON<\/p> <h3>#Localized-pt2#<\/h3> <p>PHOTOTYPE<\/p> <h3>#Localized-a4#<\/h3> <p>ASSIGNEE<\/p> <h3>#Localized-comments#<\/h3> <p>PROGRESSPHOTOCOMMENTS<\/p> <\/td> <\/tr>","initialEvidenceHeaderText":"<tr> <td><span class='block-titles'><b>#Localized-ie#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <br>","servicePhotosHeader":"<tr> <td colspan='2'> <div class='outer-border article'> <table class='n-bordered'> <tbody><tr>","taskTableHeader":"<tr> <td><span class='block-titles'><b>#Localized-tro#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr><tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <thead> <tr> <th class='left-info-color-tab-header'>#Localized-so1#<\/th> <th class='left-info-color-tab-header'>#Localized-a4#<\/th> <th class='left-info-color-tab-header'>#Localized-pr#<\/th> <th class='left-info-color-tab-header'>#Localized-sd12#<\/th> <th class='left-info-color-tab-header'>#Localized-ie#<\/th> <th class='left-info-color-tab-header'>#Localized-fe#<\/th> <\/tr> <\/thead>","taskString":"<tr> <td class='left-information'>TASKIDREPLACE<\/a><\/td> <td class='left-information'>TASKTYPEREPLACE<\/td> <td class='left-information'>SCHEDULEDDATEREPLACE<\/td> <td class='left-information'>ENDDATEREPALCE<\/td> <\/tr>","blankString":"<tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr>","photosArray":[],"servicesOverviewTableHeader":"<tr> <td><span class='block-titles'><b>#Localized-so3#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr><tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <thead> <tr> <th class='left-info-color-tab-header'>#Localized-s21#<\/th> <th class='left-info-color-tab-header'>#Localized-action#<\/th> <th class='left-info-color-tab-header'>#Localized-sb#<\/th> <th class='left-info-color-tab-header'>#Localized-timeStamp#<\/th> <\/tr> <\/thead>","materialsOverviewTableHeader":"<tr> <td><span class='block-titles'><b>#Localized-mo#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr><tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <thead> <tr> <th class='left-info-color-tab-header'>#Localized-m#<\/th> <th class='left-info-color-tab-header'>#Localized-mn#<\/th> <th class='left-info-color-tab-header'>#Localized-mn1#<\/th> <th class='left-info-color-tab-header'>#Localized-quantityUsed#<\/th> <\/tr> <\/thead>","LocalizedWorkOrderId":"","finalEvidenceString":"<tr> <td class='left-information-photo'><img src='FINALEVIDENCEPHOTO' alt='No image available' class='photos'><\/td> <td class='right-information'> <h3>#Localized-co2#<\/h3> <p>CAPTUREDON<\/p> <h3>#Localized-pt2#<\/h3> <p>PHOTOTYPE<\/p> <h3>#Localized-a4#<\/h3> <p>ASSIGNEE<\/p> <h3>#Localized-comments#<\/h3> <p>FINALPHOTOCOMMENTS<\/p> <\/td> <\/tr>","fileNameArray":[""],"serviceOverviewTableFooter":"<\/tr> <\/table> <\/div> <\/td> <\/tr>","defaultLocale":"en-us","Localizedatd2":"","allTasksData":"","finalDataCloseOut":[],"serviceDetailsTableFooter":"<\/tbody> <\/table> <\/div> <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","Localizedwod1":"","servicesPhotosString":" <td class='left-information-photo'><img src='SERVICEPHOTOS' alt='No image available' class='photos'><p>SERVICEPHOTOCOMMENTS<\/p><\/td> ","finalEvidenceHeaderText":"<tr> <td><span class='block-titles'><b>#Localized-fe#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <br>","pageBreakFooter":"<div class='div-footer'> <table class='table-footer'> <tr> <td> <\/td> <td> <\/td> <\/tr> <\/table> <\/div>","servicesEvidenceHeaderText":"<tr> <td><span class='block-titles'><b>#Localized-navS3#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <br>","inputHTMLElement":"","Localizedcustomer":"","taskDetailsTemplate":"<table id='main-table' class='main-table'> <tbody> <tr> <td class='logo-left-information'><img src='https://mms.businesswire.com/media/20191118005157/en/757060/5/Zinier_Identity_Horizontal_Lockup.jpg' alt='some' class='logo-class'><\/td> <td class='logo-right-information'> Zinier Inc. <\/td> <\/tr> <tr> <td colspan='2'> <hr class='seperator'> <\/td> <\/tr> <\/tbody> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/table> <table id='main-table' class='main-table'> <tbody> <tr> <td><span class='block-titles'><b>#Localized-taskDetails# - TASKID<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td class='left-info-color'>#Localized-taskType#<\/td> <td class='right-information'>TASKTYPE<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-a10#<\/td> <td class='right-information'>ASSIGNEE<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-sdt#<\/td> <td class='right-information'>STARTDATE<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-edt#<\/td> <td class='right-information'>ENDDATE<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-cs#<\/td> <td class='right-information'>CUSTOMERSITE<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-ca1#<\/td> <td class='right-information'>CUSTOMERADDRESS<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-ua#<\/td> <td class='right-information'>UPDATEDADDRESS<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-n3#<\/td> <td class='right-information'>NOTES<\/td> <\/tr> <\/tbody> <\/table> <\/div> <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","Localizedwot1":"","Localizedwod":"","submittedEvidenceHeader":"<tr> <td><span class='block-titles'><b>#Localized-se2#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr>","assetInstallationService":"<table id='main-table' class='main-table'> <tbody> <tr> <td><span class='block-titles'><b>#Localized-ia1#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td class='left-info-color'>#Localized-m#<\/td> <td class='right-information'>MANUFACTURER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn#<\/td> <td class='right-information'>MODELNAME<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn1#<\/td> <td class='right-information'>MODELNUMBER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-c33#<\/td> <td class='right-information'>CATEGORY<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-sn#<\/td> <td class='right-information'>SERIALNUMBER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-sn#<\/td> <td class='left-information-photo'><img src='SERIALNUMBERPHOTO' alt='No image available' class='photos'><\/td> <\/tr> <\/tbody> <\/table> <\/div> <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","serviceDetailsTableHeader":" <table id='main-table' class='main-table'> <tbody> <tr> <td><span class='block-titles'><b>#Localized-s21# : SERVICETYPE<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td class='left-info-color'>#Localized-action#<\/td> <td class='right-information'>#Localized-SERVICEMODE#<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-cb3#<\/td> <td class='right-information'>ADDEDBY<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-tos#<\/td> <td class='right-information'>ADDEDON<\/td> <\/tr>","Localizedca1":"","assetServicedService":"<table id='main-table' class='main-table'> <tbody> <tr> <td><span class='block-titles'><b>#Localized-sa3#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <tbody> <tr> <td class='left-info-color'>#Localized-m#<\/td> <td class='right-information'>MANUFACTURER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn#<\/td> <td class='right-information'>MODELNAME<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-mn1#<\/td> <td class='right-information'>MODELNUMBER<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-c33#<\/td> <td class='right-information'>CATEGORY<\/td> <\/tr> <tr> <td class='left-info-color'>#Localized-sn#<\/td> <td class='right-information'>SERIALNUMBER<\/td> <\/tr> <\/tbody> <\/table> <\/div> <\/td> <\/tr> <tr> <td colspan='2'> &nbsp; <\/td> <\/tr> <\/tbody> <\/table>","Localizedrdt":"","initialEvidenceCommentsString":" <tr> <td class='left-info-color'>#Localized-on#<\/td> <td class='right-information'>OVERALLCOMMENTS<\/td> <\/tr>","submittedEvidenceComments":" <tr> <td class='left-info-color'>#Localized-on#<\/td> <td class='right-information'>OVERALLCOMMENTS<\/td> <\/tr>","workOrderFooterString":"<\/table> <\/div> <\/td> <\/tr>","servicePhotosFooter":" <\/tbody> <\/table> <\/div> <\/td> <\/tr><br>","finalEvidenceCommentsString":" <tr> <td class='left-info-color'>#Localized-on#<\/td> <td class='right-information'>OVERALLCOMMENTS<\/td> <\/tr>","submittedEvidenceBody":"<tr> <td class='left-information-photo'><img src='MATERIALPHOTO' alt='No image available' class='photos'><\/td> <td class='right-information'> <h3>#Localized-co2#<\/h3> <p>CAPTUREDON<\/p> <h3>#Localized-cb2#<\/h3> <p>ASSIGNEE<\/p> <h3>#Localized-tn2#<\/h3> <p>TECHNICIANNOTES<\/p> <\/td> <\/tr>","Localizedcopyright":"","dateString":"<tr> <td><span class='block-titles'><b>DATE<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr>","footerForPhotos":"<\/tbody> <\/table> <\/div> <\/td> <\/tr>","materialDetailsHeaderText":"<tr> <td><span class='block-titles'><b>#Localized-ie#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <br>","serviceTableContents":"<tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <thead> <tr> <th class='left-info-color-tab-header'>#Localized-co3#<\/th> <th class='left-info-color-tab-header'>#Localized-serviceType#<\/th> <th class='left-info-color-tab-header'>#Localized-an1#<\/th> <th class='left-info-color-tab-header'>#Localized-asn#<\/th> <\/tr> <\/thead><tr> <td class='left-information'>COMPLETEDON<\/a><\/td> <td class='left-information'>SERVICETYPE<\/td> <td class='left-information'>ASSET<\/td> <td class='left-information'>ASSETNO<\/td> <\/tr><\/table> <\/div> <\/td><td>&nbsp;<\/td> <\/tr>","Localizedcdt":"","serviceDetailsRemovalReason":"<tr> <td class='left-info-color'>#Localized-r5#<\/td> <td class='right-information'>#Localized-REMOVALREASON#<\/td> <\/tr>","footerString":"<div class='div-footer'> <table class='table-footer'> <tr> <td>#Localized-copyright#<\/td> <td>www.zinier.com<\/td> <\/tr> <\/table> <\/div>","headerForPhotos":"<tr> <td colspan='2'> <div class='outer-border article'> <table class='n-bordered'> <tbody>","progressEvidenceHeaderText":"<tr> <td><span class='block-titles'><b>#Localized-pr#<\/b><\/span><\/td> <td>&nbsp;<\/td> <\/tr> <br>","headerString":"<tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <thead> <tr> <th class='left-info-color-tab-header'>#Localized-taskId#<\/th> <th class='left-info-color-tab-header'>#Localized-taskType#<\/th> <th class='left-info-color-tab-header'>#Localized-sdt#<\/th> <th class='left-info-color-tab-header'>#Localized-edt#<\/th> <\/tr> <\/thead>","progressEvidenceCommentsString":"<tr> <td class='left-info-color'>#Localized-on#<\/td> <td class='right-information'>OVERALLCOMMENTS<\/td> <\/tr>","serviceCommentsTable":"<tr> <td colspan='2'> <div class='outer-border'> <table class='n-bordered'> <thead> <tr> <th class='left-info-color-tab-header'>#Localized-a4#<\/th> <th class='left-info-color-tab-header'>#Localized-on#<\/th> <\/tr> <\/thead> <tr> <td class='left-information'>ASSIGNEE<\/a><\/td> <td class='left-information'>OVERALLNOTES<\/td> <\/tr> <\/table> <\/div> <\/td>  <td>&nbsp;<\/td><\/tr>","urlExist":"","serviceOverviewTableContents":"<tr> <td class='left-information'>SERVICETYPE<\/a><\/td> <td class='left-information'>#Localized-SERVICEMODE#<\/td> <td class='left-information'>SUBMITTEDBY<\/td> <td class='left-information'>COMPLETEDON<\/td> <\/tr>","taskResultsTable":"<tr> <td class='left-information'>SUBMITTEDON<\/a><\/td> <td class='left-information'>ASSIGNEE<\/td> <td class='left-information'>PROGRESSREPORTS<\/td> <td class='left-information'>SERVICESDELIVERED<\/td> <td class='left-information'>INITIALEVIDENCE<\/td> <td class='left-information'>FINALEVIDENCE<\/td> <\/tr>","taskTableFooter":"<\/tr> <\/table> <\/div> <\/td> <\/tr>"},"end":{"name":"end","description":"end","inputVarMap":{"zipUrl":"zipUrl"},"outputVarMap":{"zipUrl":"zipUrl"},"id":"end","nodeType":"END"},"processFileType":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkPDForPhotos"}],"contextChangePermitted":true,"name":"processFileType","description":"Process file type","processRule":"{ contextVar.fileList = []; contextVar.fileNameMap = {}; if (contextVar.fileType == 'Closeout Package PDF') { contextVar.zipUrl = contextVar.pdfUrl; } else { contextVar.fileList = contextVar.fileList.concat(contextVar.photosArray); if (Array.isArray(contextVar.fileNameArray) && contextVar.fileNameArray.length > 1) { contextVar.fileNameMap = { ...contextVar.fileNameArray }; delete contextVar.fileNameMap['0']; } } contextVar.zipFileName = contextVar.workOrderData[0].workOrderId + '-'; }","id":"processFileType","nodeType":"PROCESS","jsEngine":"es6"},"isResultAvailableForOldTask":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processData"},{"exitPortType":"FalseStep","nodeId":"loopThroughTasksList"}],"name":"isResultAvailableForOldTask","description":"isResultAvailableForOldTask","processRule":"(contextVar.resultFlag)","nodeType":"DECISION"},"processSiteDetails":{"connectors":[{"exitPortType":"NextStep","nodeId":"closeoutPackageZrule"}],"contextChangePermitted":true,"name":"processSiteDetails","description":"processSiteDetails","processRule":"if(contextVar.updatedSiteDetails){contextVar.loopThroughTasksList_currentElement['siteDetails'] =  contextVar.updatedSiteDetails}","id":"processSiteDetails","nodeType":"PROCESS","jsEngine":"es6"},"setZipUrl":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"setZipUrl","description":"setZipUrl","processRule":"contextVar.zipUrl = contextVar.urlExist","id":"setZipUrl","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryTasks"}],"name":"start","description":"Start","id":"start","nodeType":"START"},"processTranslation":{"connectors":[{"exitPortType":"NextStep","nodeId":"createPdf"}],"contextChangePermitted":true,"name":"processTranslation","description":"processTranslation","processRule":"function processLocale(responseData, userLocale, defaultLocale, resourceIdList) { if (responseData && responseData[userLocale] && responseData[userLocale][resourceIdList]) { return responseData[userLocale][resourceIdList]; } else { return responseData[defaultLocale][resourceIdList]; } } contextVar.pdfName = contextVar.workOrderData[0].workOrderId; if (contextVar.allTasksData && contextVar.inputHTMLElement) { for (let i = 0; i < contextVar.resourceIdList.length; i++) { var localzedText = '#Localized-' + contextVar.resourceIdList[i] + '#'; var newRegex = new RegExp(localzedText, 'g'); if (contextVar.resourceIdList[i].includes('copyright')) { contextVar.Localizedcopyright = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.inputHTMLElement.includes(localzedText)) { contextVar.inputHTMLElement = contextVar.inputHTMLElement.replace(newRegex, processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i])); } if (contextVar.allTasksData.includes(localzedText)) { contextVar.allTasksData = contextVar.allTasksData.replace(newRegex, processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i])); } else { if (contextVar.resourceIdList[i] === 'wod') { contextVar.Localizedwod = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('WorkOrderId')) { contextVar.LocalizedWorkOrderId = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('wot1')) { contextVar.Localizedwot1 = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('wod1')) { contextVar.Localizedwod1 = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('customer')) { contextVar.Localizedcustomer = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('rdt')) { contextVar.Localizedrdt = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('cdt')) { contextVar.Localizedcdt = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('atd2')) { contextVar.Localizedatd2 = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } if (contextVar.resourceIdList[i].includes('ca1')) { contextVar.Localizedca1 = processLocale(contextVar.responseData, contextVar.userLocale, contextVar.defaultLocale, contextVar.resourceIdList[i]); } } } }","id":"processTranslation","nodeType":"PROCESS","jsEngine":"es6"},"workflowNodes":["start","callTranslationWF","queryTasks","processExistingURL","isURlExist","processTasks","processCheckResult","isResultAvailableForOldTask","processData","loopThroughTasksList","processDuplicateData","callGetUpdatedSiteDetailsWF","processSiteDetails","closeoutPackageZrule","processAllData","processTranslation","createPdf","processFileType","checkPDForPhotos","zipFiles","processCloseOutData","processCloseOutResult","upsertCloseOutResult","setZipUrl","end"],"queryTasks":{"models":["workOrderType","workOrder","taskType","workOrderTask","customer","site","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processExistingURL"}],"columns":{"endDate":"IFNULL({$workOrderTask.completedDate},'')","cop":"workOrder.cop","customerSignature":"IFNULL({$workOrderTask.customerSignature},'')","scheduledDate":"IFNULL({$workOrderTask.actualStartTime},'')","workOrderCompletedDate":"workOrder.completedDate","taskType":"taskType.name","customerId":"customer.id","workOrderCloseOutPackage":"workOrder.closeOutPackage","workOrderTaskResult":"workOrderTask.result","address":"IFNULL({$customer.billingAddress},'')","workOrderTaskStatusId":"workOrderTask.statusId","taskTypeWebTask":"taskType.webTask","contactEmail":"IFNULL({$customer.contactEmail},'')","workOrderDeadline":"workOrder.deadline","technicianName":"User.name","siteAddress":"IFNULL({$site.address},'')","customerName":"customer.companyName","site":"site.customerId","workOrderTaskNotes":"workOrderTask.notes","siteId":"site.name","workOrderId":"workOrder.id","workOrderTypeName":"workOrderType.name","workOrderRequestedDate":"workOrder.requestedDate","contactPhone":"IFNULL({$customer.contactPhone},'')","taskId":"workOrderTask.id"},"description":"Query Tasks","inputVarMap":{"workOrderId":"wId"},"nodeType":"QUERY","filter":"{$workOrderId} = {@wId} AND {$workOrderTaskStatusId} != 'workOrderTaskCancelled' AND {$taskTypeWebTask} = false","distict":true,"name":"queryTasks","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrderTask","User":"workOrderTask","workOrderType":"workOrder","customer":"workOrder"},"id":"queryTasks","outputVarMap":{"data":"workOrderData"},"getCount":true},"processTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"processCheckResult"}],"contextChangePermitted":true,"name":"processTasks","description":"processTasks","processRule":"function formatDate(date) { if (date) { var d = new Date(new Date(date + ' UTC').toLocaleString('en-us', { timeZone: contextVar.timeZone })), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear(); var hours = d.getHours().toString(); var minutes = d.getMinutes().toString(); var seconds = d.getSeconds().toString(); var timeZone = new Date().toString().split(' ')[5]; if (minutes.length < 2) minutes = '0' + minutes; if (hours.length < 2) hours = '0' + hours; if (seconds.length < 2) seconds = '0' + seconds; time = hours + ':' + minutes + ':' + seconds; if (month.length < 2) month = '0' + month; if (day.length < 2) day = '0' + day; return ([year, month, day].join('-') + ' ' + time + ' (' + contextVar.gmtTimeZone + ')'); } else { return '-'; } } contextVar.address = contextVar.workOrderData[0].address; contextVar.workOrderCompletedDate = formatDate(contextVar.workOrderData[0].workOrderCompletedDate); contextVar.workOrderRequestedDate = formatDate(contextVar.workOrderData[0].workOrderRequestedDate); contextVar.workOrderDeadline = formatDate(contextVar.workOrderData[0].workOrderDeadline); contextVar.workOrderId = contextVar.workOrderData[0].workOrderId; contextVar.customerName = contextVar.workOrderData[0].customerName; contextVar.workOrderTypeName = contextVar.workOrderData[0].workOrderTypeName; contextVar.inputHTMLElement = contextVar.inputHTMLElement + new String(contextVar.headerString); contextVar.workOrderData.forEach(function (obj) { var appendString = new String(contextVar.taskString); appendString = appendString.replace('TASKIDREPLACE', obj.taskId); appendString = appendString.replace('TASKTYPEREPLACE', obj.taskType); appendString = appendString.replace('SCHEDULEDDATEREPLACE', formatDate(obj.scheduledDate)); appendString = appendString.replace('ENDDATEREPALCE', formatDate(obj.endDate)); contextVar.inputHTMLElement = contextVar.inputHTMLElement + appendString; }); contextVar.inputHTMLElement = contextVar.inputHTMLElement + new String(contextVar.workOrderFooterString);","id":"processTasks","nodeType":"PROCESS","jsEngine":"es6"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"loopThroughTasksList"}],"contextChangePermitted":true,"name":"processData","description":"Process data","processRule":"if (typeof contextVar.workOrderData != 'undefined' && contextVar.workOrderData[0].workOrderTaskResult) { contextVar.initialEvidenceDataGridArray = []; if (contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidence) { var initialEvidenceObj = {}; initialEvidenceObj['initialEvidenceNotes'] = contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidence.comment; initialEvidenceObj['initialEvidence'] = contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidence.media; contextVar.initialEvidenceDataGridArray.push(initialEvidenceObj); } if (contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidenceOptionalFirst) { var initialEvidenceObj = {}; initialEvidenceObj['initialEvidenceNotes'] = contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidenceOptionalFirst.comment; initialEvidenceObj['initialEvidence'] = contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidenceOptionalFirst.media; contextVar.initialEvidenceDataGridArray.push(initialEvidenceObj); } if (contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidenceOptionalSecond) { var initialEvidenceObj = {}; initialEvidenceObj['initialEvidenceNotes'] = contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidenceOptionalSecond.comment; initialEvidenceObj['initialEvidence'] = contextVar.workOrderData[0].workOrderTaskResult[0].beforeCaptureEvidenceOptionalSecond.media; contextVar.initialEvidenceDataGridArray.push(initialEvidenceObj); } if (contextVar.workOrderData[0].workOrderTaskResult[0].beforeComments) { contextVar.initialCommentsSection = contextVar.workOrderData[0].workOrderTaskResult[0].beforeComments; } if (contextVar.workOrderData[0].workOrderTaskResult[0].afterComments) { contextVar.finalCommentsSection = contextVar.workOrderData[0].workOrderTaskResult[0].afterComments; } contextVar.finalEvidenceDataGridArray = []; if (contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidence) { var finalEvidenceObj = {}; finalEvidenceObj['finalEvidenceNotes'] = contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidence.comment; finalEvidenceObj['finalEvidence'] = contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidence.media; contextVar.finalEvidenceDataGridArray.push(finalEvidenceObj); } if (contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidenceOptionalFirst) { var finalEvidenceObj = {}; finalEvidenceObj['finalEvidenceNotes'] = contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidenceOptionalFirst.comment; finalEvidenceObj['finalEvidence'] = contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidenceOptionalFirst.media; contextVar.finalEvidenceDataGridArray.push(finalEvidenceObj); } if (contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidenceOptionalSecond) { var finalEvidenceObj = {}; finalEvidenceObj['finalEvidenceNotes'] = contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidenceOptionalSecond.comment; finalEvidenceObj['finalEvidence'] = contextVar.workOrderData[0].workOrderTaskResult[0].afterCaptureEvidenceOptionalSecond.media; contextVar.finalEvidenceDataGridArray.push(finalEvidenceObj); } if (contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid) { contextVar.serviceArray = []; contextVar.serviceArrayObj = {}; if (contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].taskActivity) { contextVar.serviceArrayObj['selectedService'] = contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].taskActivity; } if (contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].photo1) { contextVar.serviceArrayObj['servicePhotos'] = contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].photo1; } if (contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].assets) { contextVar.serviceArrayObj['assets'] = contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].assets; } if (contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].barcode) { contextVar.serviceArrayObj['barcode'] = contextVar.workOrderData[0].workOrderTaskResult[0].activityDataGrid[0].barcode; } contextVar.serviceArray.push(contextVar.serviceArrayObj); } contextVar.initialEvidenceDataGrid = contextVar.initialEvidenceDataGridArray; contextVar.initialComments = contextVar.initialCommentsSection; if (contextVar.finalEvidenceDataGridArray) { contextVar.finalEvidenceDataGrid = contextVar.finalEvidenceDataGridArray; } if (contextVar.finalCommentsSection) { contextVar.finalComments = contextVar.finalCommentsSection; } contextVar.servicesDataGrid = contextVar.serviceArray; contextVar.submitType = 'endTask'; } contextVar.result = []; var resultObj = {}; resultObj['initialComments'] = contextVar.initialComments; resultObj['initialEvidenceDataGrid'] = contextVar.initialEvidenceDataGrid; resultObj['serviceGridWrapper'] = contextVar.serviceGridWrapper; resultObj['servicesDataGrid'] = contextVar.servicesDataGrid; resultObj['finalComments'] = contextVar.finalComments; resultObj['finalEvidenceDataGrid'] = contextVar.finalEvidenceDataGrid; contextVar.result.push(resultObj);contextVar.workOrderData[0].workOrderTaskResult = contextVar.result;","id":"processData","nodeType":"PROCESS"},"processCloseOutData":{"connectors":[{"exitPortType":"NextStep","nodeId":"processCloseOutResult"}],"contextChangePermitted":true,"name":"processCloseOutData","description":"processCloseOutData","processRule":"var optionsAndURL = {}; optionsAndURL['options'] = contextVar.packageData; optionsAndURL['url'] = contextVar.zipUrl; var closeOutAndPhotos = []; var closeOutAndPhotosObj = {}; if (contextVar.workOrderData[0].workOrderCloseOutPackage && contextVar.workOrderData[0].workOrderCloseOutPackage.length > 0) { if (contextVar.fileType == 'Closeout Package PDF') { var checkCloseout; if (contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone] && contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale]) { checkCloseout = 'closeout' in contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale][0]; } else { checkCloseout = false; } if (checkCloseout) { contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale][0].closeout.push(optionsAndURL); } else { closeOutAndPhotos.push(optionsAndURL); closeOutAndPhotosObj['closeout'] = closeOutAndPhotos; if(contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone] && contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale]) { contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale][0]['closeout'] = closeOutAndPhotos; } } } else { var checkCloseout; if (contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone] && contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale]) { checkCloseout = 'photos' in contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale][0]; } else { checkCloseout = false; } if (checkCloseout) { contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale][0].photos.push(optionsAndURL); } else { closeOutAndPhotos.push(optionsAndURL); closeOutAndPhotosObj['photos'] = closeOutAndPhotos; if (contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone] && contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale]) { contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale][0]['photos'] = closeOutAndPhotos; } } } var isTimeZoneExist; var isLocaleExist; if (contextVar.workOrderData[0].workOrderCloseOutPackage[0]) { isTimeZoneExist = contextVar.timeZone in contextVar.workOrderData[0].workOrderCloseOutPackage[0]; if (contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone]) { isLocaleExist = contextVar.locale in contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone]; } } if (isTimeZoneExist) { if (isLocaleExist) { contextVar.finalDataCloseOut.push(contextVar.workOrderData[0].workOrderCloseOutPackage[0]); } else { contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale] = localArrayCreation(); contextVar.finalDataCloseOut.push(contextVar.workOrderData[0].workOrderCloseOutPackage[0]); } } else { contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone] = {}; var timeZoneLocale = localArrayCreation(); contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale] = timeZoneLocale; contextVar.finalDataCloseOut = contextVar.workOrderData[0].workOrderCloseOutPackage; } } else { contextVar.finalDataCloseOut = []; var timeZoneObj = {}; timeZoneObj[contextVar.timeZone] = {}; var localArray = []; if (contextVar.fileType == 'Closeout Package PDF') { closeOutAndPhotos.push(optionsAndURL); closeOutAndPhotosObj['closeout'] = closeOutAndPhotos; } else { closeOutAndPhotos.push(optionsAndURL); closeOutAndPhotosObj['photos'] = closeOutAndPhotos; } localArray.push(closeOutAndPhotosObj); timeZoneObj[contextVar.timeZone][contextVar.locale] = localArray; contextVar.finalDataCloseOut.push(timeZoneObj); } function localArrayCreation() { var localArray = []; localArray.push(closeOutAndPhotosObj); return localArray; }","id":"processCloseOutData","nodeType":"PROCESS"},"processAllData":{"connectors":[{"exitPortType":"NextStep","nodeId":"loopThroughTasksList"}],"contextChangePermitted":true,"name":"processAllData","description":"combine all tasks data together","processRule":"contextVar.allTasksData = contextVar.allTasksData + contextVar.allString;","id":"processAllData","nodeType":"PROCESS"},"processExistingURL":{"connectors":[{"exitPortType":"NextStep","nodeId":"isURlExist"}],"contextChangePermitted":true,"name":"processExistingURL","description":"processExistingURL","processRule":"if (typeof contextVar.workOrderData != 'undefined' && contextVar.workOrderData[0].workOrderCloseOutPackage) { var isTimeZoneExist; var isLocaleExist; if(contextVar.workOrderData[0].workOrderCloseOutPackage[0]) { isTimeZoneExist = contextVar.timeZone in contextVar.workOrderData[0].workOrderCloseOutPackage[0]; } if (isTimeZoneExist) { if(contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone]) { isLocaleExist = contextVar.locale in contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone]; } if (isLocaleExist) { var elementCloseout = contextVar.workOrderData[0].workOrderCloseOutPackage[0][contextVar.timeZone][contextVar.locale]; for (var j = 0; j < elementCloseout.length; j++) { if (contextVar.fileType === 'Closeout Package PDF' && ('closeout' in elementCloseout[j])) { for (var i = 0; i < elementCloseout[j].closeout.length; i++) { var pdfExist = arrayCheckGenericFunction(contextVar.packageData, elementCloseout[j].closeout[i].options); if (pdfExist.length == 0) { contextVar.urlExist = elementCloseout[j].closeout[i].url; break; } } } else if (contextVar.fileType === 'Photos Only (Zip Folder)' && ('photos' in elementCloseout[j])) { for (var i = 0; i < elementCloseout[j].photos.length; i++) { var pdfExist = arrayCheckGenericFunction(contextVar.packageData, elementCloseout[j].photos[i].options); if (pdfExist.length == 0) { contextVar.urlExist = elementCloseout[j].photos[i].url; break; } } } if (contextVar.urlExist) { break; } } } else { contextVar.urlExist = ''; } } else { contextVar.urlExist = ''; } } function comparer(otherArray) { return function (current) { return otherArray.filter(function (other) { return other.name == current.name }).length == 0; } } function arrayCheckGenericFunction(firstArray, secondArray) { var onlyInA = firstArray.filter(comparer(secondArray)); var onlyInB = secondArray.filter(comparer(firstArray)); var result = onlyInA.concat(onlyInB); return result; }","id":"processExistingURL","nodeType":"PROCESS","jsEngine":"es6"},"processCheckResult":{"connectors":[{"exitPortType":"NextStep","nodeId":"isResultAvailableForOldTask"}],"contextChangePermitted":true,"name":"processCheckResult","description":"processCheckResult","processRule":"contextVar.resultFlag = ''; if (contextVar.workOrderData[0].workOrderTaskResult) { contextVar.workOrderData[0].workOrderTaskResult.forEach(function (element) { if (typeof element.beforeCaptureEvidence != 'undefined') { contextVar.resultFlag = true; } else { contextVar.resultFlag = false; } }); } else { contextVar.resultFlag = false; }","id":"processCheckResult","nodeType":"PROCESS"},"createPdf":{"async":false,"connectors":[{"exitPortType":"NextStep","nodeId":"processFileType"}],"name":"createPdf","publicFile":true,"description":"CloseOut package","language":"japanese","inputVarMap":{"contactEmail":"contactEmail","Localizedwot1":"Localizedwot1","Localizedcopyright":"Localizedcopyright","customerSignature":"customerSignature","Localizedwod":"Localizedwod","LocalizedWorkOrderId":"LocalizedWorkOrderId","customerName":"customerName","Localizedcdt":"Localizedcdt","Localizedca1":"Localizedca1","addressCustomer":"addressCustomer","Localizedatd2":"Localizedatd2","Localizedrdt":"Localizedrdt","allTasksData":"allTasksData","Localizedwod1":"Localizedwod1","workOrderId":"workOrderId","workOrderTypeName":"workOrderTypeName","contactPhone":"contactPhone","inputHTMLElement":"inputHTMLElement","pdfName":"pdfName","Localizedcustomer":"Localizedcustomer"},"id":"createPdf","outputVarMap":{"pdfFile":"pdfUrl"},"nodeType":"PDF","templateId":"UIR6AA8F6"},"zipFiles":{"connectors":[{"exitPortType":"NextStep","nodeId":"processCloseOutData"}],"zipUrl":"zipUrl","zipFileName":"zipFileName","fileUrlList":"fileList","name":"zipFiles","publicFile":true,"description":"zipFiles","fileNameMap":"fileNameMap","inputVarMap":{"zipFileName":"zipFileName","fileNameMap":"fileNameMap","fileList":"fileList"},"outputVarMap":{"zipUrl":"zipUrl","zipFileName":"zipFileName"},"nodeType":"ZIP"}}