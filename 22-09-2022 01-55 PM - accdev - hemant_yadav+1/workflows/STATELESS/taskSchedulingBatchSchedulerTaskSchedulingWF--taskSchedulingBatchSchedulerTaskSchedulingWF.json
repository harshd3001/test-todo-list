{"fetchWorkOrderTaskData":{"filter":"{$id}= {@taskId}","models":["workOrderTask","taskType","ZStatus","site","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processDataForSchedulerLog"}],"columns":{"taskTypeId":"workOrderTask.taskTypeId","assignedToUserId":"workOrderTask.assignedToUserId","statusId":"workOrderTask.statusId","statusName":"ZStatus.name","siteId":"workOrderTask.siteId","siteName":"site.name","scheduledDate":"workOrderTask.scheduledDate","id":"workOrderTask.id","taskTypeName":"taskType.name","userName":"User.name","statusNameColor":"ZStatus.colorCode"},"name":"fetchWorkOrderTaskData","description":"fetchWorkOrderTaskData","links":{"taskType":"workOrderTask","site":"workOrderTask","User":"workOrderTask","ZStatus":"workOrderTask"},"inputVarMap":{"taskId":"taskId"},"outputVarMap":{"data":"workOrderTaskData"},"nodeType":"QUERY"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"logContextVar"}],"name":"start","description":"Start","nodeType":"START"},"logContextVar":{"connectors":[{"exitPortType":"NextStep","nodeId":"processInitialData"}],"processId":"featureLoggerWF","name":"logContextVar","description":"logContextVar","inputVarMap":{"featureName":"featureName","extraMsg":"extraMsg"},"id":"logContextVar","outputVarMap":{},"nodeType":"WORKFLOW"},"callSchedulerUpsertWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"schedulerLogModelWF","name":"callSchedulerUpsertWF","description":"callSchedulerUpsertWF","inputVarMap":{"schedulerLogData":"schedulerLog","schedulerSubAction":"subAction"},"nodeType":"WORKFLOW"},"workflowNodes":["start","logContextVar","processInitialData","isSchedulerCurrentStatusFailed","callBreakdownWF","callWorkOrderTaskModelWF","fetchWorkOrderTaskData","fetchSchedulerLogData","processDataForSchedulerLog","callSchedulerUpsertWF","end"],"isSchedulerCurrentStatusFailed":{"connectors":[{"exitPortType":"TrueStep","nodeId":"end"},{"exitPortType":"FalseStep","nodeId":"callBreakdownWF"}],"name":"isSchedulerCurrentStatusFailed","description":"isSchedulerCurrentStatusFailed","processRule":"{ !Array.isArray(contextVar.schedulerLogData) || contextVar.schedulerLogData[0].status === 'schedulerLogFailed'}","nodeType":"DECISION"},"workflowContext":{"featureName":"batchScheduler","extraMsg":"TASK SCHEDULING: taskSchedulingBatchSchedulerTaskSchedulingWF call"},"callBreakdownWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"callWorkOrderTaskModelWF"}],"processId":"taskScheduleBreakdownModelWF","name":"callBreakdownWF","description":"callBreakdownWF","inputVarMap":{"taskId":"workOrderTaskId","breakdownData":"taskScheduleBreakdown"},"outputVarMap":{},"nodeType":"WORKFLOW"},"fetchSchedulerLogData":{"filter":"{$schedulerLog.id} = {@currentSchedulerLogId}","models":["schedulerLog"],"connectors":[{"exitPortType":"NextStep","nodeId":"isSchedulerCurrentStatusFailed"}],"columns":{"result":"schedulerLog.result","id":"schedulerLog.id","status":"schedulerLog.status"},"name":"fetchSchedulerLogData","description":"fetchSchedulerLogData","inputVarMap":{"currentSchedulerLogId":"currentSchedulerLogId"},"outputVarMap":{"data":"schedulerLogData"},"nodeType":"QUERY"},"end":{"name":"end","description":"end","nodeType":"END"},"processDataForSchedulerLog":{"connectors":[{"exitPortType":"NextStep","nodeId":"callSchedulerUpsertWF"}],"contextChangePermitted":true,"name":"processDataForSchedulerLog ","description":"processDataForSchedulerLog","processRule":"{ contextVar.schedulerSubAction = 'upsertSchedulerLog'; if (typeof contextVar.schedulerLogData[0].result === 'undefined' || contextVar.schedulerLogData[0].result === '') { contextVar.schedulerLogData[0].result = []; } contextVar.schedulerLogData[0].result.push(contextVar.workOrderTaskData[0]); }","nodeType":"PROCESS"},"processInitialData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchSchedulerLogData"}],"contextChangePermitted":true,"name":"processInitialData","description":"processInitialData","processRule":"{ if (typeof contextVar.defaultInputContext !== 'undefined') { for (const key in contextVar.defaultInputContext) { contextVar[key] = contextVar.defaultInputContext[key]; } } contextVar.taskData = []; contextVar.breakdownData = []; var dueDate = new Date(contextVar.data.actualStartTime); dueDate.setMinutes(dueDate.getMinutes() + contextVar.data.estimatedTaskDuration); contextVar.dueDate = dueDate.toISOString().replace('T', ' ').replace('Z', ''); contextVar.taskId = contextVar.data.id; contextVar.recommendedTechId = contextVar.data.assignedToUserId; contextVar.scheduledDate = contextVar.data.actualStartTime; contextVar.statusId = 'workOrderTaskScheduled'; contextVar.duration = contextVar.data.estimatedTaskDuration; contextVar.workOrderTaskSubAction = 'upsertWorkOrderTask'; contextVar.taskData.push({ 'scheduledDate': contextVar.scheduledDate, 'statusId': contextVar.statusId, 'eventType': 'workOrderTaskScheduled', 'dueDate': contextVar.dueDate, 'assignedToUserId': contextVar.recommendedTechId, 'id': contextVar.taskId }); contextVar.breakdownData.push({ 'startDate': contextVar.scheduledDate, 'endDate': contextVar.dueDate, 'workOrderTaskId': contextVar.taskId, 'duration': contextVar.duration, 'id': '' }); }","nodeType":"PROCESS","jsEngine":"es6"},"callWorkOrderTaskModelWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkOrderTaskData"}],"processId":"workOrderTaskModelWF","name":"callWorkOrderTaskModelWF","description":"callWorkOrderTaskModelWF","inputVarMap":{"taskData":"workOrderTask","workOrderTaskSubAction":"subAction"},"outputVarMap":{},"nodeType":"WORKFLOW"}}