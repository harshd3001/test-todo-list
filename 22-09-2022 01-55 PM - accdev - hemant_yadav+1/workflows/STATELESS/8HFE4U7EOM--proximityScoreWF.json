{"googleDistanceAPI":{"connectors":[{"exitPortType":"NextStep","nodeId":"processDistance"}],"name":"googleDistanceAPI","description":"googleDistanceAPI","networkId":"googleDistanceMatrixAPI","inputVarMap":{"destinations":"destinations","origins":"origins"},"outputVarMap":{"data":"distanceData"},"nodeType":"NETWORK"},"fetchTaskDetails":{"filter":"{$taskId}={@idFilter}","models":["taskType","workOrderTask","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"isTaskPresent"}],"columns":{"estimatedTaskDuration":"workOrderTask.estimatedDuration","latitude":"site.latitude","destinations":"CONCAT({$site.latitude},',',{$site.longitude},'|')","taskStartTime":"workOrderTask.scheduledDate","taskTypeId":"workOrderTask.taskTypeId","taskType":"taskType.name","site":"site.name","modifiedDate":"workOrderTask.modifiedDate","siteId":"site.id","id":"workOrderTask.id","taskId":"workOrderTask.id","status":"workOrderTask.statusId","longitude":"site.longitude","taskEndTime":"DATE_ADD({$workOrderTask.scheduledDate}, INTERVAL CAST({$workOrderTask.estimatedDuration} AS UNSIGNED) MINUTE)"},"name":"fetchTaskDetails","description":"fetchWorkOrderTaskData","inputVarMap":{"workOrderTaskId":"idFilter"},"outputVarMap":{"data":"taskData"},"nodeType":"QUERY"},"processDistance":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processDistance","description":"processDistance","processRule":"{var  distance = contextVar.distanceData != '' && contextVar.distanceData.length > 0  ? contextVar.distanceData[0] : {}; var index = -1; if( typeof distance.rows !== 'undefined' ){ distance.rows.forEach(function(row) { index = distance.rows.indexOf(row); if (row.elements[0].status == 'OK') { contextVar.validTechList[index].duration = row.elements[0].duration.value; contextVar.validTechList[index].distance = row.elements[0].distance.value; } }); } var low, high, techValue; var validTechListData = contextVar.validTechList; var validTechListArr = []; if(contextVar.validTechList != '' && typeof contextVar.validTechList != undefined) { for(var i = 0; i < validTechListData.length; i++) { validTechListArr.push(parseInt(validTechListData[i].duration)); if(contextVar.techId == validTechListData[i].id) { techValue = parseInt(validTechListData[i].duration); } } validTechListArr.sort(function(a, b) { return a - b; }); if (validTechListArr.length > 1) { low = validTechListArr[0]; high = validTechListArr[validTechListArr.length - 1]; contextVar.featureValue = typeof techValue != 'undefined' ? (5 - (5 * (techValue - low) / (high - low))) : 0; } }}","nodeType":"PROCESS"},"workflowContext":{"validTechList":[],"featureValue":0,"origins":""},"processTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTechnicianData"}],"contextChangePermitted":true,"name":"processTaskData","description":"processTaskData","processRule":"{contextVar.destinations=contextVar.taskData[0].destinations;contextVar.taskType=contextVar.taskData[0].taskType;contextVar.taskTypeId=contextVar.taskData[0].taskTypeId;contextVar.taskStartTime = contextVar.taskData[0].taskStartTime;contextVar.taskEndTime = contextVar.taskData[0].taskEndTime;contextVar.latitude=contextVar.taskData[0].latitude;contextVar.longtitude=contextVar.taskData[0].longtitude;}","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskDetails"}],"name":"start","description":"Start","nodeType":"START"},"fetchTechnicianData":{"filter":"{$status} = 'Active'","models":["User","workforce"],"connectors":[{"exitPortType":"NextStep","nodeId":"areTechniciansPresent"}],"columns":{"latitude":"IF({$User.latitude} = 0 AND {$User.longitude} = 0,{$workforce.latitude}, {$User.latitude})","id":"User.id","userName":"User.name","longitude":"IF({$User.latitude} = 0 AND {$User.longitude} = 0,{$workforce.longitude}, {$User.longitude})","status":"User.status"},"name":"fetchTechniciansData","outerJoinOnModel":"User","distinct":true,"outputVarMap":{"data":"technicianData"},"nodeType":"QUERY"},"isTaskPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processTaskData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isTaskPresent","description":"isTaskPresent","processRule":"(contextVar.taskData != '' && contextVar.taskData.length == 1)","nodeType":"DECISION"},"end":{"name":"End","description":"end","processRule":"","inputVarMap":{"featureValue":"featureValue"},"outputVarMap":{"featureValue":"featureValue"},"nodeType":"END"},"areTechniciansPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processTechnicians"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areTechniciansPresent","description":"areTechniciansPresent","processRule":"(contextVar.technicianData != '' && contextVar.technicianData.length > 0)","nodeType":"DECISION"},"workflowNodes":["start","fetchTaskDetails","isTaskPresent","processTaskData","fetchTechnicianData","areTechniciansPresent","processTechnicians","googleDistanceAPI","processDistance","end"],"processTechnicians":{"connectors":[{"exitPortType":"NextStep","nodeId":"googleDistanceAPI"}],"contextChangePermitted":true,"name":"processTaskData","description":"processTaskData","processRule":"{var techData = contextVar.technicianData; techData.forEach( function(tech){ if(!(tech.latitude == 0 && tech.longitude == 0)){ contextVar.origins += tech.latitude + ',' + tech.longitude + '|'; contextVar.validTechList.push(tech); } } );}","nodeType":"PROCESS"}}