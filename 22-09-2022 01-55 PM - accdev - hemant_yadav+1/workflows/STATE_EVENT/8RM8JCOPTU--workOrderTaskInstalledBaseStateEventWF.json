{"fetchWorkOrderTaskDetails":{"filter":"{$workOrderTask.id}={@workOrderTaskId}","models":["workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchLastVisitedDate"}],"columns":{"workOrderTaskAssignedToUserId":"workOrderTask.assignedToUserId","workOrderTaskWorkOrderId":"workOrderTask.workOrderId","workOrderTaskTaskTypeId":"workOrderTask.taskTypeId"},"name":"fetchWorkOrderTaskDetails","description":"fetchWorkOrderTaskDetails","inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"workOrderIdData"},"nodeType":"QUERY"},"workflowContext":{"insertForEventType":["serviceRequested","assetServiced"]},"fetchInputData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkOrderTaskDetails"}],"contextChangePermitted":true,"name":"fetchInputData","description":"fetchInputData","processRule":"{for (var key in contextVar.data) {contextVar[key] = contextVar.data[key];}}","nodeType":"PROCESS"},"isUpdateOrInsertAssetLogs":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchLocalizedKeys"},{"exitPortType":"FalseStep","nodeId":"fetchLatestInstalledBaseLog"}],"name":"isUpdateOrInsertAssetLogs","description":"isUpdateOrInsertAssetLogs","processRule":"(contextVar.insertForEventType.indexOf(contextVar.eventType) > -1)","nodeType":"DECISION"},"insertIntoAssetLog":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"installedBaseLogModelWF","name":"insertIntoAssetLog","description":"insertIntoAssetLog","inputVarMap":{"installedBaseLog":"installedBaseLog","subAction":"subAction"},"outputVarMap":{},"nodeType":"WORKFLOW"},"fetchLocalizedKeys":{"filter":"{$listOptionAnswer.listOptionId}='assetLogEvents' AND {$listOptionAnswerId}={@eventType}","models":["listOptionAnswer"],"connectors":[{"exitPortType":"NextStep","nodeId":"processInstalledBaseLogData"}],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText"},"name":"fetchLocalizedKeys","description":"fetchLocalizedKeys","inputVarMap":{"insertForEventType":"insertForEventType","eventType":"eventType"},"outputVarMap":{"data":"localizedData"},"nodeType":"QUERY"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchInputData"}],"name":"Start","description":"Start","nodeType":"START"},"end":{"name":"end","description":"End","inputVarMap":{},"outputVarMap":{},"nodeType":"END"},"fetchLastVisitedDate":{"filter":"{$installedBase.id}={@installedBaseId}","models":["installedBase"],"connectors":[{"exitPortType":"NextStep","nodeId":"isUpdateOrInsertAssetLogs"}],"columns":{"decommDate":"installedBase.decommDate","installedDate":"installedBase.installedDate","lastVisitedDate":"installedBase.lastVisitedDate"},"name":"fetchLastVisitedDate","description":"fetchLastVisitedDate","inputVarMap":{"installedBaseId":"installedBaseId"},"outputVarMap":{"data":"installedBaseData"},"nodeType":"QUERY"},"fetchLatestInstalledBaseLog":{"filter":"{$installedBaseLog.installedBaseId}={@installedBaseId} AND {$installedBaseLog.eventType}={@eventType}","models":["installedBaseLog"],"connectors":[{"exitPortType":"NextStep","nodeId":"processInstalledBaseLogData"}],"columns":{"createdDate":"installedBaseLog.createdDate","id":"installedBaseLog.id"},"name":"fetchLatestInstalledBaseLog","description":"fetchLatestInstalledBaseLog","orderBy":"createdDate desc","inputVarMap":{"eventType":"eventType","installedBaseId":"installedBaseId"},"outputVarMap":{"data":"installedBaseLog"},"nodeType":"QUERY"},"workflowNodes":["start","fetchInputData","fetchWorkOrderTaskDetails","isUpdateOrInsertAssetLogs","fetchLocalizedKeys","fetchLastVisitedDate","fetchLatestInstalledBaseLog","processInstalledBaseLogData","insertIntoAssetLog","end"],"processInstalledBaseLogData":{"connectors":[{"exitPortType":"NextStep","nodeId":"insertIntoAssetLog"}],"contextChangePermitted":true,"name":"processInstalledBaseLogData","description":"processInstalledBaseLogData","processRule":"{ contextVar.subAction = 'upsertInstalledBaseLog'; if (contextVar.insertForEventType.indexOf(contextVar.eventType) > -1) { contextVar.installedBaseLog = [{ 'loggedByUserId': (contextVar.eventType === 'serviceRequested') ? contextVar.modifiedByUser : contextVar.workOrderIdData[0].workOrderTaskAssignedToUserId, 'logDate': (contextVar.eventType === 'serviceRequested') ? contextVar.modifiedDate : contextVar.installedBaseData[0].lastVisitedDate, 'installedBaseId': contextVar.installedBaseId, 'workOrderTaskId': contextVar.workOrderTaskId, 'workOrderId': contextVar.workOrderIdData[0].workOrderTaskWorkOrderId, 'eventType': contextVar.eventType, 'event': contextVar.localizedData[0].listOptionAnswerAnswerOptionText, 'taskTypeId': contextVar.workOrderIdData[0].workOrderTaskTaskTypeId }]; } else { contextVar.installedBaseLog[0].workOrderId = contextVar.workOrderIdData[0].workOrderTaskWorkOrderId; contextVar.installedBaseLog[0].workOrderTaskId = contextVar.workOrderTaskId; contextVar.installedBaseLog[0].taskTypeId = contextVar.workOrderIdData[0].workOrderTaskTaskTypeId; contextVar.installedBaseLog[0].loggedByUserId = contextVar.workOrderIdData[0].workOrderTaskAssignedToUserId; contextVar.installedBaseLog[0].logDate = (contextVar.eventType === 'assetDecommissioned') ? contextVar.installedBaseData[0].decommDate:contextVar.installedBaseData[0].lastVisitedDate; delete contextVar.installedBaseLog[0].createdDate; } }","nodeType":"PROCESS","jsEngine":"es6"}}