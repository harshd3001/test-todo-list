{"pageContext":{},"actionOnLoad":["@actions.setInitialData","@actions.getOverrideTaskDependencyData"],"localPageContext":true,"jslib":{"buttonText":"function(pageContext) { if (pageContext.dependencyOverrideSource !== 'dispatch') { return '@lang.[\"s20\",\"Submit\"]' } else { return '@lang.[\"d26\",\"Dispatch\"]' } }","isDispatchHidden":"function (pageContext) { return (pageContext.dependencyOverrideSource === 'review') }","isSubmitHidden":"function (pageContext) { return (pageContext.dependencyOverrideSource === 'dispatch') }","isDirectDispatchTrue":"function (pageContext) { return (pageContext.directDispatch === true) }","isButtonDisabled":"function(pageContext){ return ( (typeof pageContext.workOrderTaskOverrideReason === 'undefined') || (pageContext.workOrderTaskOverrideReason === ''))}","isDirectDispatchFalse":"function (pageContext) { return (pageContext.directDispatch !== true) }"},"header":{"leftData":{"children":[{"hidden":"@jslib.isDirectDispatchTrue","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openPreviousPanel"],"id":"back","type":"buttonIcon"}]},"children":[{"buttonType":"primary","actionOnClick":["@actions.setEventType","@actions.overrideReasonDecisionAction","@actions.closePanel","@actions.refreshDataGrid"],"disabled":"@jslib.isButtonDisabled","id":"submit","type":"button","title":"@jslib.buttonText"},{"hidden":"@jslib.isDirectDispatchFalse","icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext"],"id":"close","type":"buttonIcon"}],"title":"@lang.['od','Override Dependency']"},"body":{"children":[{"children":[{"options":"@pageContext.overrideTaskDependencyData","id":"workOrderTaskOverrideReason","optTitleKey":"listOptionAnswerAnswerOptionText","optValueKey":"listOptionAnswerId","label":"@lang.['r5','Reason']","type":"select","title":"@lang.['rfopd','Reason for overriding pending dependency']","value":"@pageContext.workOrderTaskOverrideReason","placeHolder":"@lang.['sr3','Select Reason']"},{"id":"workOrderTaskOverrideComment","label":"@lang.['c5','Comments (Optional)']","type":"textarea","value":"@pageContext.workOrderTaskOverrideComment","placeHolder":"@lang.['aac','Add additional comments']"}],"label":"","id":"workOrderTaskOverrideReason","type":"section"}]},"actions":[{"name":"getOverrideTaskDependencyData","outputVarMap":{"data":"@pageContext.overrideTaskDependencyData"},"type":"query","actionDef":{"filter":"{$listOptionAnswer.listOptionId} = 'overrideReason'","models":["listOptionAnswer"],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText"},"inputs":{},"translate":true}},{"endPoint":"batch/apis","name":"fireProcessEvent","type":"api","actionDef":{"data":[{"workOrderTaskWF":{"data":[{"processId":"QIFGIU7FDJ","contextVar":{"workOrderTask":{"result":"@pageContext.workOrderTaskresult","statusId":"@pageContext.statusId","eventType":"@pageContext.eventType","id":"@pageContext.workOrderTaskId","reopenCount":"@pageContext.workOrderTaskReOpenCount"},"subAction":"upsertWorkOrderTask"}}],"actionUrl":"process/start"},"taskReviewLogWF":{"data":[{"processId":"V4NYJ58HL1","contextVar":{"listOptionAnswerId":"@pageContext.listOptionAnswerId","statusId":"@pageContext.statusId","subAction":"@pageContext.taskReviewResult","workOrderTaskId":"@pageContext.workOrderTaskId","taskReviewLogAction":"@pageContext.taskReviewLogAction","taskReviewLogReviewNotes":"@pageContext.taskReviewLogReviewNotes"}}],"actionUrl":"process/start"}}]}},{"endPoint":"event/start","name":"fireProcessEventForWorkOrderTask","type":"api","actionDef":{"data":[{"eventId":"BM58GU7UNT","contextVar":{"workOrderTask":{"result":"@pageContext.workOrderTaskresult","assignedToUserId":"@pageContext.workOrderTaskAssignedToUserId","notes":"@pageContext.workOrderTaskNotes","statusId":"@pageContext.workOrderTaskStatusId","dueDate":"@pageContext.workOrderTaskDueDate","scheduledDate":"@pageContext.workOrderTaskScheduledDate","eventType":"@pageContext.eventType","id":"@pageContext.workOrderTaskId","assignedToCrewId":"@pageContext.workOrderTaskAssignedToCrewId","estimatedDuration":"@pageContext.workOrderTaskEstimatedDurationMinutes"},"taskScheduleBreakdown":"@pageContext.workOrderTaskScheduleBreakdown","subAction":"@pageContext.subAction","workOrderTaskAction":"@pageContext.workOrderTaskAction"}}]}},{"name":"clearPageContext","type":"clearPageContext"},{"falseStep":["@actions.fireProcessEventForWorkOrderTask"],"trueStep":["@actions.fireProcessEvent"],"name":"overrideReasonDecisionAction","type":"decision","actionDef":"function(pageContext){ return pageContext.workOrderTaskStatusId !== 'workOrderTaskDispatched'; }"},{"name":"setEventType","type":"script","actionDef":"function (pageContext) { if (pageContext.dependencyOverrideSource === 'review') { pageContext.subAction = pageContext.taskReviewResult; pageContext.eventType = 'workOrderTaskCompleted'; pageContext.overrideReason = { 'reason': pageContext.workOrderTaskOverrideReason, 'comment': pageContext.workOrderTaskOverrideComment, 'userName':ZNFS.session.name, 'userId':ZNFS.session.userId, 'timeStamp': new Date().toISOString().replace(/T/, ' ').replace(/\\..+/, '').replace(/Z/, '') }; if (typeof pageContext.workOrderTaskresult !== 'undefined' && pageContext.workOrderTaskresult !== '' && pageContext.workOrderTaskresult.length > 0) { pageContext.workOrderTaskresult[0].overrideReason = pageContext.overrideReason; } else { pageContext.resultReviewObj = { 'overrideReason': pageContext.overrideReason }; pageContext.workOrderTaskresult = []; pageContext.workOrderTaskresult.push(pageContext.resultReviewObj); } } else if (pageContext.dependencyOverrideSource === 'dispatch') { pageContext.subAction = 'upsertWorkOrderTask'; pageContext.eventType = 'workOrderTaskDispatched'; pageContext.overrideReason = { 'reason': pageContext.workOrderTaskOverrideReason, 'comment': pageContext.workOrderTaskOverrideComment, 'userName':ZNFS.session.name, 'userId':ZNFS.session.userId, 'timeStamp': new Date().toISOString().replace(/T/, ' ').replace(/\\..+/, '').replace(/Z/, '') }; if (typeof pageContext.workOrderTaskresult !== 'undefined' && pageContext.workOrderTaskresult !== '' && pageContext.workOrderTaskresult.length > 0) { pageContext.workOrderTaskresult[0].overrideReason = pageContext.overrideReason; } else { pageContext.resultDispatchObj = { 'overrideReason': pageContext.overrideReason }; pageContext.workOrderTaskresult = []; pageContext.workOrderTaskresult.push(pageContext.resultDispatchObj); } } }"},{"name":"setInitialData","type":"script","actionDef":"function(pageContext){pageContext.workOrderTaskOverrideReason ='';pageContext.workOrderTaskOverrideComment='';}"},{"name":"closePanel","type":"closePanel"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"parentPanelRefreshRequired":false,"name":"openPreviousPanel","type":"backPanel"}]}