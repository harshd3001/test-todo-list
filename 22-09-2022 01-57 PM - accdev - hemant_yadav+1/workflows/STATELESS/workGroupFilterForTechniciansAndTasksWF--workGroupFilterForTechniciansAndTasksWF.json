{"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{contextVar.noOfAllTechniciansBatches = Math.ceil(contextVar.allTechniciansDataCount / contextVar.allTechBatchSize);contextVar.allTechniciansBatchNumber=contextVar.allTechniciansBatchNumber+1;}","id":"findNumberOfBatches","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreAllTechnicianData"},{"exitPortType":"FalseStep","nodeId":"processPublishEventData"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"contextVar.noOfAllTechniciansBatches >= 2 && contextVar.noOfAllTechniciansBatches >= contextVar.allTechniciansBatchNumber","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"workFlowApproachDecision"}],"name":"start","description":"Start","nodeType":"START"},"getUserWorkGroupFilters":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfMoreRecordsToLoop"}],"processId":"userWorkGroupFilterWF","name":"getUserWorkGroupFilters","description":"getUserWorkGroupFilters","inputVarMap":{"userList":"userList","workOrderTaskIdList":"workOrderTaskIdList"},"outputVarMap":{"finalFilteredData":"finalFilteredData","filterMethods":"filterMethods"},"nodeType":"WORKFLOW"},"setCurrentRecordsData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isAllFilterMethodApplied"}],"contextChangePermitted":true,"name":"setCurrentRecordsData","description":"set the current record to be looped","processRule":"{ if (typeof contextVar.userList !== 'undefined' && contextVar.userList.length > 0) { contextVar.workGroupDataObject = contextVar.finalFilteredData[contextVar.userList[contextVar.currentRecordsIndex]]; contextVar.currentRecordsId = contextVar.userList[contextVar.currentRecordsIndex]; } else { contextVar.workGroupDataObject = contextVar.finalFilteredData[contextVar.workOrderTaskIdList[contextVar.currentRecordsIndex]]; contextVar.currentRecordsId = contextVar.workOrderTaskIdList[contextVar.currentRecordsIndex]; } contextVar.currentRecordsIsAllFilterApplied = contextVar.workGroupDataObject.isAllFilterApplied; contextVar.currentRecordsIndex++; }","nodeType":"PROCESS"},"checkIfAllTechsDataAlreadyPresent":{"connectors":[{"exitPortType":"FalseStep","nodeId":"fetchAllTechnicianData"},{"exitPortType":"TrueStep","nodeId":"processPublishEventData"}],"name":"checkIfAllTechsDataAlreadyPresent","description":"checkIfAllTechsDataAlreadyPresent","processRule":"(Array.isArray(contextVar.allTechniciansData) && contextVar.allTechniciansData.length>0)","nodeType":"DECISION"},"workflowNodes":["start","workFlowApproachDecision","processUserIdOrWorkOrderTaskId","getUserWorkGroupFilters","checkIfMoreRecordsToLoop","setCurrentRecordsData","isAllFilterMethodApplied","publishEvent","checkIfAllTechsDataAlreadyPresent","fetchAllTechnicianData","findNumberOfBatches","areMoreTechsPresent","fetchMoreAllTechnicianData","appendTechs","processPublishEventData","end"],"workFlowApproachDecision":{"connectors":[{"exitPortType":"FalseStep","nodeId":"processUserIdOrWorkOrderTaskId"},{"exitPortType":"TrueStep","nodeId":"publishEvent"}],"name":"workflowApproachDecision","description":"workflowApproachDecision","processRule":"{typeof contextVar.workGroupDataObject !== 'undefined' && contextVar.workGroupDataObject !== ''}","nodeType":"DECISION"},"fetchAllTechnicianData":{"models":["workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"workforceUserId":"workforce.userId"},"distinct":true,"outerJoinOnModel":"workforce","description":"fetchAllTechnicianData","inputVarMap":{"workforceStatusFilter":"workforceStatusFilter","workforceType":"workforceType","allTechBatchSize":"batchSize","userStatusFilter":"userStatusFilter"},"nodeType":"QUERY","filter":"({$workforce.statusId} = {@workforceStatusFilter}) AND ({$User.status}!= {@userStatusFilter}) AND ({$workforce.workforceType} IS NULL OR {$workforce.workforceType} !={@workforceType})","name":"fetchAllTechnicianData","links":{"workforce":"User"},"outputVarMap":{"data":"allTechniciansData","count":"allTechniciansDataCount","batchNumber":"allTechniciansBatchNumber"},"batchSize":"batchSize","getCount":true},"appendTechs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTechs","description":"appendTechs","processRule":"if (Array.isArray(contextVar.appendAllTechniciansData)) { contextVar.allTechniciansData = contextVar.allTechniciansData.concat(contextVar.appendAllTechniciansData) } contextVar.allTechniciansBatchNumber++;","nodeType":"PROCESS"},"workflowContext":{"noOfAllTechniciansBatches":0,"workGroupIdsInput":{},"filterIdsInput":{},"workforceStatusFilter":"workforceActive","allTechBatchSize":1000,"workforceType":"webUser","finalFilteredUserIdList":{},"currentRecordsIndex":0,"userStatusFilter":"Deactivated","allTechniciansIds":[],"workOrderTaskWorkGroupFilter":""},"isAllFilterMethodApplied":{"connectors":[{"exitPortType":"FalseStep","nodeId":"publishEvent"},{"exitPortType":"TrueStep","nodeId":"checkIfAllTechsDataAlreadyPresent"}],"name":"isAllFilterMethodApplied","description":"isAllFilterMethodApplied","processRule":"(contextVar.currentRecordsIsAllFilterApplied === true)","nodeType":"DECISION"},"publishEvent":{"eventId":"taskSchedulingCalendarFilterFetchTechProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"processPublishEventData"}],"contextChangePermitted":true,"name":"publishEvent","description":"publishEvent","inputVarMap":{"workGroupDataObject":"workGroupDataObject"},"outputVarMap":{"data":"workGroupData"},"nodeType":"PUBLISH","captureOutput":true},"processPublishEventData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfMoreRecordsToLoop"}],"contextChangePermitted":true,"name":"processPublishEventData","description":"processPublishEventData","processRule":"{ if (contextVar.currentRecordsIsAllFilterApplied) { if (typeof contextVar.allTechniciansData !== 'undefined' && contextVar.allTechniciansData.length > 0) { if (typeof contextVar.allTechniciansIds === 'undefined' || contextVar.allTechniciansIds.length === 0) { contextVar.allTechniciansIds = contextVar.allTechniciansData.map(function (element) { return element.workforceUserId; }); } contextVar.finalFilteredUserIdList[contextVar.currentRecordsId] = JSON.parse(JSON.stringify(contextVar.allTechniciansIds)); } } else { if (typeof contextVar.workGroupData !== 'undefined' && contextVar.workGroupData.length > 0) { var finalIdsList = ''; var finalAllIdsList = []; contextVar.workGroupData.forEach(function (element) { if (typeof element.eligibleTechsIds !== 'undefined') { finalIdsList = (finalIdsList === '') ? element.eligibleTechsIds : finalIdsList.filter(x => element.eligibleTechsIds.includes(x)); finalAllIdsList = finalAllIdsList.concat(element.eligibleTechsIds); } }); if (typeof contextVar.currentRecordsId === 'undefined') { contextVar.currentRecordsId = 'generic'; contextVar.finalFilteredUserIdList['genericAll'] = Array.from(new Set(finalAllIdsList)); }; contextVar.finalFilteredUserIdList[contextVar.currentRecordsId] = Array.from(new Set(finalIdsList)); } } }","nodeType":"PROCESS","jsEngine":"es6"},"end":{"name":"end","description":"End","inputVarMap":{"finalFilteredUserIdList":"finalFilteredUserIdList"},"outputVarMap":{"finalFilteredUserIdList":"finalFilteredUserIdList"},"nodeType":"END"},"processUserIdOrWorkOrderTaskId":{"connectors":[{"exitPortType":"NextStep","nodeId":"getUserWorkGroupFilters"}],"contextChangePermitted":true,"name":"processUserIdOrWorkOrderTaskId","description":"processUserIdOrWorkOrderTaskId","processRule":"{ if (typeof contextVar.userList !== 'undefined' && contextVar.userList.length > 0) { contextVar.totalRecordsToBeLooped = contextVar.userList.length; } else { contextVar.totalRecordsToBeLooped = contextVar.workOrderTaskIdList.length; } }","nodeType":"PROCESS"},"checkIfMoreRecordsToLoop":{"connectors":[{"exitPortType":"TrueStep","nodeId":"setCurrentRecordsData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkIfMoreRecordsToLoop","description":"Check if more records are to be looped","processRule":"(contextVar.currentRecordsIndex < contextVar.totalRecordsToBeLooped)","nodeType":"DECISION"},"fetchMoreAllTechnicianData":{"models":["workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTechs"}],"columns":{"workforceUserId":"workforce.userId"},"distinct":true,"outerJoinOnModel":"workforce","description":"fetchMoreAllTechnicianData","inputVarMap":{"allTechniciansBatchNumber":"batchNumber","workforceStatusFilter":"workforceStatusFilter","workforceType":"workforceType","allTechBatchSize":"batchSize","userStatusFilter":"userStatusFilter"},"nodeType":"QUERY","filter":"({$workforce.statusId} = {@workforceStatusFilter}) AND ({$User.status}!= {@userStatusFilter}) AND ({$workforce.workforceType} IS NULL OR {$workforce.workforceType} !={@workforceType})","name":"fetchMoreAllTechnicianData","links":{"workforce":"User"},"outputVarMap":{"data":"appendAllTechniciansData"},"batchSize":"batchSize","getCount":true}}