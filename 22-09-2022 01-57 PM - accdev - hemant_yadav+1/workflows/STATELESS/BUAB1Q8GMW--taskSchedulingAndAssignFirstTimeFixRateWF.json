{"calculateFirstTimeFixRate":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"calculateFirstTimeFixRate","description":"Process average time to provide feature value","processRule":"{ contextVar.firstTimeFixRateFinalData = {}; if (typeof contextVar.firstTimeFixRateData != 'undefined' && contextVar.firstTimeFixRateData != '' && contextVar.firstTimeFixRateData.length > 0) { var sortable = []; var high; contextVar.firstTimeFixRateData.forEach(function (element) { if (typeof element.assignToUserId !== 'undefined' && element.assignToUserId !== '' && typeof element.ftfr !== 'undefined' && element.ftfr !== '') { sortable.push([element.assignToUserId, element.ftfr]); } }); if (sortable.length > 0) { sortable.sort(function (a, b) { return b[1] - a[1]; }); high = sortable[0][1]; sortable.forEach(function (element) { if (element[1] == high) { contextVar.firstTimeFixRateFinalData[element[0]] = (element[1] === 0) ? 0 : 100; } else { contextVar.firstTimeFixRateFinalData[element[0]] = Math.ceil((element[1]) / high * 100); } }); } } }","id":"calculateFirstTimeFixRate","nodeType":"PROCESS"},"workflowContext":{"customBatchSize":1000,"workOrderTaskCompleted":"workOrderTaskCompleted","firstTimeFixRateTechnicianBatches":0,"firstTimeFixRateData":[]},"appendTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"{ if (Array.isArray(contextVar.firstTimeFixRateTaskDataToAppend)) { contextVar.firstTimeFixRateData = contextVar.firstTimeFixRateData.concat(contextVar.firstTimeFixRateTaskDataToAppend); } }","id":"appendTasks","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"technicianProcessData"},{"exitPortType":"FalseStep","nodeId":"calculateFirstTimeFixRate"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"typeof contextVar.firstTimeFixRateTechnicianIds !== 'undefined' && contextVar.firstTimeFixRateTechnicianIds.length > 0","id":"areMoreTechsPresent","nodeType":"DECISION"},"technicianProcessData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTechsTaskData"}],"contextChangePermitted":true,"name":"technicianProcessData","description":"technicianProcessData","processRule":"{ contextVar.loopArray = []; contextVar.loopArray = contextVar.firstTimeFixRateTechnicianIds.splice(0, contextVar.customBatchSize); contextVar.firstTimeFixRateFilter = '{$status} = {@workOrderTaskCompleted} AND {$assignToUserId} IN {@loopArray}'; }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatchesOfTechnician"}],"name":"start","description":"Start","nodeType":"START"},"end":{"name":"End","description":"end","inputVarMap":{"firstTimeFixRateFinalData":"firstTimeFixRateFinalData"},"outputVarMap":{"firstTimeFixRateFinalData":"firstTimeFixRateFinalData"},"nodeType":"END"},"findNumberOfBatchesOfTechnician":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatchesOfTechnician","description":"findNumberOfBatchesOfTechnician","processRule":"{contextVar.firstTimeFixRateTechnicianBatches = Math.ceil(contextVar.techArray.length / contextVar.customBatchSize);contextVar.firstTimeFixRateTechnicianIds = JSON.parse(JSON.stringify(contextVar.techArray)); }","nodeType":"PROCESS"},"getTechsTaskData":{"models":["workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTasks"}],"columns":{"workOrderTaskSiteId":"workOrderTask.siteId","ftfr":"( count({$workOrderTask.id})  - SUM({$workOrderTask.reopenCount})) / count({$workOrderTask.id})","assignToUserId":"workOrderTask.assignedToUserId","status":"workOrderTask.statusId"},"description":"Fetch Task Details","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","workOrderTaskCompleted":"workOrderTaskCompleted","loopArray":"loopArray","firstTimeFixRateFilter":"filter"},"groupBy":"assignToUserId","nodeType":"QUERY","filter":"filter","name":"getTechsTaskData","id":"getTechsTaskData","outputVarMap":{"data":"firstTimeFixRateTaskDataToAppend"},"batchSize":"batchSize","getCount":true},"workflowNodes":["start","findNumberOfBatchesOfTechnician","areMoreTechsPresent","technicianProcessData","getTechsTaskData","appendTasks","calculateFirstTimeFixRate","end"]}