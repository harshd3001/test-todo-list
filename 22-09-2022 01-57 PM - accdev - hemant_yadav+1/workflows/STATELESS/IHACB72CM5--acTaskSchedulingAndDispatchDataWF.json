{"getSiteIds":{"filter":"filter","models":["customer","site","region"],"connectors":[{"exitPortType":"NextStep","nodeId":"decisionIfWOTypeIdsPresent"}],"columns":{"customerCompanyName":"customer.companyName","regionName":"region.name","siteName":"site.name","siteId":"site.id"},"name":"getSiteIds","description":"fetch site ids for given regions ids and customer ids","inputVarMap":{"maxBatchSize":"batchSize","siteQueryFilter":"filter","region":"region","customer":"customer"},"links":{"site":"customer","region":"site"},"outputVarMap":{"data":"siteIds"},"batchSize":"batchSize","nodeType":"QUERY"},"processTaskData":{"connectors":[{"exitPortType":"NextStep","nodeId":"emptyResult"}],"contextChangePermitted":true,"name":"processTaskData","description":"Process task data","processRule":"{ function checkForData(a) { return (typeof a !== 'undefined' && a !== ''); } var taskCustRegion = {}; if (Array.isArray(contextVar.customerRegionData)) { contextVar.customerRegionData.forEach(function(obj) { taskCustRegion[obj.workOrderTaskId] = { 'customer': obj.customerCompanyName, 'region': obj.regionName }; }); var priorityColorMap = {}; var priorityTextMap = {}; if (checkForData(contextVar.priorityData)) { contextVar.priorityData.forEach(function(element) { priorityColorMap[element.priority] = element.colorCode; priorityTextMap[element.priority] = element.name; }); } contextVar.schedulingAndDispatchData.forEach(function(obj) { obj.customerCompanyName = taskCustRegion[obj.workOrderTaskId] ? taskCustRegion[obj.workOrderTaskId]['customer'] : ''; obj.regionName = taskCustRegion[obj.workOrderTaskId] ? taskCustRegion[obj.workOrderTaskId]['region'] : ''; obj.priorityColor = priorityColorMap[obj.workOrderPriority]; obj.priorityName = priorityTextMap[obj.workOrderPriority]; var taskScheduledTime = { 'start': checkForData(obj.workOrderTaskScheduledDate) ? obj.workOrderTaskScheduledDate : '', 'end': checkForData(obj.workOrderTaskDueDate) ? obj.workOrderTaskDueDate : '', }; obj.workOrderTaskScheduledTime = checkForData(obj.workOrderTaskScheduledDate) && checkForData(obj.workOrderTaskDueDate) ? [taskScheduledTime] : ''; }); } }","id":"processTaskData","nodeType":"PROCESS"},"getWorkforceWorkGroupDataForLoggedInUser":{"filter":"{$workforceWorkGroupWorkforceUserId}={@userId}","models":["workforceWorkGroup","workGroupFilter","workGroup"],"connectors":[{"exitPortType":"NextStep","nodeId":"decisionIfWorkforceWorkGroupDataPresent"}],"columns":{"workforceWorkGroupWorkforceUserId":"workforceWorkGroup.workforceUserId","workGroupFilterFilterId":"workGroupFilter.filterId","workGroupFilterId":"workGroupFilter.id","workforceWorkGroupWorkGroupId":"workforceWorkGroup.workGroupId","workGroupId":"workGroup.id","workGroupFilterMethod":"workGroup.filterMethod"},"name":"getWorkforceWorkGroupDataForLoggedInUser","outerJoinOnModel":"workGroup","distinct":true,"description":"fetch work group data for logged in user (dispatcher)","links":{"workforceWorkGroup":"workGroup","workGroup":"workGroupFilter"},"inputVarMap":{"{@userId}":"userId"},"outputVarMap":{"data":"workforceWorkGroupData"},"nodeType":"QUERY"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getWorkforceWorkGroupDataForLoggedInUser"}],"name":"start","description":"start","id":"start","nodeType":"START"},"processWorkforceWorkGroupData":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionIfAllGroupApplied"}],"contextChangePermitted":true,"name":"processWorkforceWorkGroupData","description":"process work group data","processRule":"contextVar.isAllFilterApplied = false; var filters = []; if (typeof contextVar.workforceWorkGroupData != 'undefined' && contextVar.workforceWorkGroupData.length > 0) { if (contextVar.isAllFilterApplied != true) { contextVar.workforceWorkGroupData.forEach(function (element) { if (typeof contextVar[element.workGroupFilterMethod] === 'undefined') { if (element.workGroupFilterMethod === 'all') { contextVar.isAllFilterApplied = true; } contextVar[element.workGroupFilterMethod] = []; filters.push(element.workGroupFilterMethod); } if(contextVar[element.workGroupFilterMethod].indexOf(element.workGroupFilterFilterId) == -1) { contextVar[element.workGroupFilterMethod].push(element.workGroupFilterFilterId); } });} }","id":"processWorkforceWorkGroupData","nodeType":"PROCESS"},"processFilterForSiteQuery":{"connectors":[{"exitPortType":"NextStep","nodeId":"getSiteIds"}],"contextChangePermitted":true,"name":"processFilterForSiteQuery","description":"create a filter for fetching site ids","processRule":"contextVar.siteQueryFilter = ' '; if (typeof contextVar.region != 'undefined' && contextVar.region.length > 0) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + '({$site.regionId} IN {@region})'; if (typeof contextVar.customer != 'undefined' && contextVar.customer.length > 0) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + ' AND ({$site.customerId} IN {@customer})'; } } else if (typeof contextVar.customer != 'undefined' && contextVar.customer.length > 0) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + '({$site.customerId} IN {@customer})'; }","nodeType":"PROCESS"},"processSiteIdsAndWorkOrderIds":{"connectors":[{"exitPortType":"NextStep","nodeId":"processZRule"}],"contextChangePermitted":true,"name":"processSiteIdsAndWorkOrderIds","description":"process fetched site ids and workOrder ids","processRule":"contextVar.siteIdsToFilterWith = []; contextVar.WorkOrderIdsToFilterWith = []; if(typeof contextVar.siteIds != 'undefined' && contextVar.siteIds.length > 0) { contextVar.siteIds.forEach(function (element) { contextVar.siteIdsToFilterWith.push(element.siteId); }); } if(typeof contextVar.workOrderIds != 'undefined' && contextVar.workOrderIds.length > 0) { contextVar.workOrderIds.forEach(function (ele) { contextVar.WorkOrderIdsToFilterWith.push(ele.workOrderId); }); }","id":"initializeParams","nodeType":"PROCESS"},"addTasksIntoArray":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryCustomerRegion"}],"contextChangePermitted":true,"name":"addTasksIntoArray","description":"Add tasks into array","processRule":"{ contextVar.schedulingAndDispatchData.forEach(function (obj) { contextVar.taskData.push(obj.workOrderTaskId); }); }","id":"addTasksIntoArray","nodeType":"PROCESS"},"areTasksPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"addTasksIntoArray"},{"exitPortType":"FalseStep","nodeId":"emptyResult"}],"name":"areTasksPresent","description":"check if tasks exist","processRule":"(typeof contextVar.schedulingAndDispatchData != 'undefined' && contextVar.schedulingAndDispatchData != '' && contextVar.schedulingAndDispatchData.length>0)","id":"areTasksPresent","nodeType":"DECISION"},"queryCustomerRegion":{"models":["customer","workOrderTask","site","region"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkOrderPriority"}],"columns":{"customerCompanyName":"customer.companyName","regionId":"site.regionId","regionName":"region.name","customerId":"site.customerId","workOrderTaskId":"workOrderTask.id","siteName":"site.name"},"description":"Query customer and region data","outerJoinOnModel":"site","inputVarMap":{"maxBatchSize":"batchSize","taskData":"taskData"},"nodeType":"QUERY","filter":"{$workOrderTaskId} in {@taskData}","name":"queryCustomerRegion","links":{"workOrderTask":"site","site":"customer","region":"site"},"id":"queryCustomerRegion","outputVarMap":{"data":"customerRegionData"},"batchSize":"batchSize","getCount":true},"fetchSchedulingData":{"models":["workOrder","workOrderTask","workOrderTaskAppointmentWindow","workforce","ZStatus","taskType","User","site","crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"areTasksPresent"}],"columns":{"processStatus":"workOrderTask.acProcessStatus","rural":"workOrder.acTagRural","userPhoneNumber":"User.phoneNumber","historical":"workOrder.acTagHistorical","workOrderTaskAssignedToCrewId":"workOrderTask.assignedToCrewId","type":"IF({$workOrderTask.id} IS NULL,'','Task')","siteTimezoneOffset":"site.timezoneOffset","reportType":"workOrder.acReportType","contractValue":"workOrder.acContractValue","complex":"workOrder.acTagComplex","workOrderTaskId":"workOrderTask.id","taskIdTaskTypeName":"CONCAT({$workOrderTask.id},' - ',{$taskType.name})","workOrderTaskModifiedDate":"workOrderTask.modifiedDate","gla":"workOrder.acTagGla","workOrderTaskEstimatedDurationMinutes":"workOrderTask.estimatedDuration","workOrderTaskCompletedDate":"workOrderTask.completedDate","longitude":"site.longitude","workOrderTaskLongDurationFlag":"workOrderTask.isLongDurationTask","contactName":"site.contactPerson","resultWebPageId":"taskType.resultWebPageId","crewName":"crew.name","taskTypeCrewTask":"taskType.crewTask","tags":"workOrder.acTags","anowStatus":"workOrderTask.acProcessStatus","workOrderTaskTypeId":"workOrderTask.taskTypeId","incidentDetails":"workOrderTask.incidentDetails","modifiedDate":"workOrderTask.modifiedDate","workOrderId":"workOrder.id","assignee":"IF({$taskType.crewTask}=true,{$crew.name},{$User.name})","workOrderTaskScheduledDateMapView":"IF({$workOrderTask.scheduledDate} IS NULL,'-',{$workOrderTask.scheduledDate})","status":"workOrderTask.statusId","viewTravelStatus":"taskType.viewTravelStatus","workOrderTaskAppointmentWindowStartDate":"workOrderTaskAppointmentWindow.startDate","loanType":"workOrder.acLoanType","latitude":"site.latitude","icon":"IF({$workOrderTask.statusId} = 'workOrderTaskOpen',{@openIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskScheduled',{@scheduledIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskDispatched',{@dispatchedIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskInProgress',{@inProgressIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskIncident',{@incidentIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskInTransit',{@inTransitIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskDelayed',{@delayedIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskDiscontinued',{@discontinuedIcon}, (IF({$workOrderTask.statusId} = 'workOrderTaskPendingReview',{@pendingReviewIcon}, (IF({$workOrderTask.statusId} = 'workOrderTaskCompleted',{@completedIcon},(IF({$workOrderTask.statusId} = 'workOrderTaskCancelled',{@cancelledIcon},'' ) ) ) )) )) ) ) ) ) ) ) ) ) ) ) ) ) ) )","siteName":"site.name","taskTypeName":"taskType.name","workOrderPriority":"workOrder.priorityPriority","workOrderPrimaryAppraiser":"workOrder.acPrimaryAppraiserId","customerId":"site.customerId","statusName":"ZStatus.name","workOrderTaskEstimatedDuration":"Round(({$workOrderTask.estimatedDuration})/60,2)","workOrderTaskResult":"workOrderTask.result","workOrderTaskAppointmentWindowEndDate":"workOrderTaskAppointmentWindow.endDate","workOrderTaskAppointmentBasedFlag":"workOrderTask.isAppointmentBasedTask","address":"site.address","workOrderDeadline":"workOrder.deadline","workOrderTaskAppointmentWindow":"workOrderTaskAppointmentWindow.startEndJson","workOrderTaskAppointmentWindowId":"workOrderTaskAppointmentWindow.appointmentWindowId","primaryApprasier":"workOrder.acPrimaryAppraiserId","userName":"User.name","statusNameColor":"ZStatus.colorCode","workOrderTaskDueDate":"workOrderTask.dueDate","contactInformation":"site.contactPhone","createdDate":"workOrderTask.createdDate","regionId":"site.regionId","workOrderTaskScheduleBreakdown":"[taskScheduleBreakdown](workOrderTaskId,id,startDate,endDate,duration)","workOrderTaskScheduledDate":"workOrderTask.scheduledDate"},"inputs":{"regionNames":{"filter":"{$regionName} like {@regionFilterString}","models":["region"],"columns":{"regionId":"region.id","regionName":"region.name"},"selectColumns":["regionId"]},"customerCompanyNames":{"filter":"{$customerCompanyName} like {@customerFilterString}","models":["customer"],"columns":{"customerCompanyName":"customer.companyName","customerId":"customer.id"},"selectColumns":["customerId"]}},"description":"Fetch Task Details","outerJoinOnModel":"workOrderTask","orderBy":"orderBy","distinct":true,"inputVarMap":{"statusFilter":"statusFilter","openIcon":"openIcon","orderBy":"orderBy","cancelledIcon":"cancelledIcon","regionFilterString":"regionFilterString","discontinuedIcon":"discontinuedIcon","customerFilter":"customerFilter","pendingReviewIcon":"pendingReviewIcon","filter":"filter","scheduledIcon":"scheduledIcon","delayedIcon":"delayedIcon","incidentIcon":"incidentIcon","customerFilterString":"customerFilterString","inTransitIcon":"inTransitIcon","taskFilter":"taskFilter","dispatchedIcon":"dispatchedIcon","workOrderFilter":"workOrderFilter","inProgressIcon":"inProgressIcon","region":"region","batchSize":"batchSize","completedIcon":"completedIcon","batchNumber":"batchNumber"},"nodeType":"QUERY","filter":"filter","name":"fetchSchedulingData","id":"fetchSchedulingData","outputVarMap":{"data":"schedulingAndDispatchData","count":"count","batchNumber":"batchNumber"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"workflowNodes":["start","getWorkforceWorkGroupDataForLoggedInUser","decisionIfWorkforceWorkGroupDataPresent","processWorkforceWorkGroupData","decisionIfAllGroupApplied","decisionIfRegionIdsOrCustomerIdsPresent","processFilterForSiteQuery","getSiteIds","decisionIfWOTypeIdsPresent","getWorkOrderIds","processSiteIdsAndWorkOrderIds","processZRule","fetchSchedulingData","areTasksPresent","addTasksIntoArray","queryCustomerRegion","fetchWorkOrderPriority","processTaskData","emptyResult","end"],"decisionIfWOTypeIdsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getWorkOrderIds"},{"exitPortType":"FalseStep","nodeId":"processSiteIdsAndWorkOrderIds"}],"name":"decisionIfWOTypeIdsPresent","description":"decisionIfWOTypeIdsPresent","processRule":"(typeof contextVar.workOrderType !== 'undefined' && contextVar.workOrderType !== '' && contextVar.workOrderType.length > 0 )","id":"decisionIfWOTypeIdsPresent","nodeType":"DECISION"},"decisionIfAllGroupApplied":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processZRule"},{"exitPortType":"FalseStep","nodeId":"decisionIfRegionIdsOrCustomerIdsPresent"}],"name":"decisionIfAllGroupApplied","description":"decides if ALL group filter added","processRule":"(typeof contextVar.isAllFilterApplied !== 'undefined' && contextVar.isAllFilterApplied ===true)","id":"decisionIfAllGroupApplied","nodeType":"DECISION"},"fetchWorkOrderPriority":{"filter":"{$ZPriority.targetModel} = 'workOrder'","models":["ZPriority"],"connectors":[{"exitPortType":"NextStep","nodeId":"processTaskData"}],"columns":{"name":"ZPriority.name","colorCode":"ZPriority.colorCode","priority":"ZPriority.priority"},"name":"fetchWorkOrderPriority","description":"Query customer and region data","inputVarMap":{},"id":"fetchWorkOrderPriority","outputVarMap":{"data":"priorityData"},"nodeType":"QUERY","getCount":true},"workflowContext":{"openIcon":"https://d122pusslfmuhu.cloudfront.net/Open+%26+Draft+%26+Reopend+-+Task+Status.svg","maxBatchSize":1000,"count":0,"taskData":[],"cancelledIcon":"https://d122pusslfmuhu.cloudfront.net/Cancelled+-+Task+Status.svg","regionFilterString":"","discontinuedIcon":"https://d122pusslfmuhu.cloudfront.net/Discontinued+-+Task+Status.svg","pendingReviewIcon":"https://d122pusslfmuhu.cloudfront.net/Pending+Review+-+Task+Status.svg","scheduledIcon":"https://d122pusslfmuhu.cloudfront.net/Scheduled+-+Task+Status.svg","delayedIcon":"https://d122pusslfmuhu.cloudfront.net/Delayed+-+Task+Status.svg","incidentIcon":"https://d122pusslfmuhu.cloudfront.net/Incident+-+Task+Status.svg","customerFilterString":"","inTransitIcon":"https://d122pusslfmuhu.cloudfront.net/In+Transit+-+Task+Status.svg","dispatchedIcon":"https://d122pusslfmuhu.cloudfront.net/Dispatched+-+Task+Status.svg","inProgressIcon":"https://d122pusslfmuhu.cloudfront.net/In+Progress+-+Task+Status.svg","completedIcon":"https://d122pusslfmuhu.cloudfront.net/Completed+-+Task+Status.svg"},"emptyResult":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"emptyResult","description":"emptyResult","processRule":"if (contextVar.schedulingAndDispatchData == '') {contextVar.schedulingAndDispatchData = []}","id":"emptyResult","nodeType":"PROCESS"},"decisionIfWorkforceWorkGroupDataPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processWorkforceWorkGroupData"},{"exitPortType":"FalseStep","nodeId":"processZRule"}],"name":"decisionIfWorkforceWorkGroupDataPresent","description":"check if work group data exists","processRule":"(typeof contextVar.workforceWorkGroupData !== 'undefined' && contextVar.workforceWorkGroupData !== '' && contextVar.workforceWorkGroupData.length > 0)","id":"decisionIfAllGroupApplied","nodeType":"DECISION"},"end":{"name":"end","description":"end","inputVarMap":{"count":"count","schedulingAndDispatchData":"schedulingAndDispatchData","batchNumber":"batchNumber"},"outputVarMap":{"count":"count","schedulingAndDispatchData":"schedulingAndDispatchData","batchNumber":"batchNumber"},"id":"end","nodeType":"END"},"decisionIfRegionIdsOrCustomerIdsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processFilterForSiteQuery"},{"exitPortType":"FalseStep","nodeId":"decisionIfWOTypeIdsPresent"}],"name":"decisionIfRegionIdsOrCustomerIdsPresent","description":"check if region ids or customer ids exist","processRule":"((typeof contextVar.region !== 'undefined' && contextVar.region !== '' && contextVar.region.length > 0 )|| (typeof contextVar.customer !== 'undefined' && contextVar.customer !== '' && contextVar.customer.length > 0))","id":"decisionIfRegionIdsOrCustomerIdsPresent","nodeType":"DECISION"},"getWorkOrderIds":{"filter":"{$workOrderWorkOrderTypeId} IN {@workOrderType}","models":["workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"processSiteIdsAndWorkOrderIds"}],"columns":{"workOrderWorkOrderTypeId":"workOrder.workOrderTypeId","workOrderId":"workOrder.id"},"name":"getWorkOrderIds","description":"fetch workOrder ids for given workOrderType ids","inputVarMap":{"workOrderType":"workOrderType","maxBatchSize":"batchSize"},"outputVarMap":{"data":"workOrderIds"},"batchSize":"batchSize","nodeType":"QUERY"},"processZRule":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchSchedulingData"}],"contextChangePermitted":true,"name":"processZRule","description":"ZRule to create dynamic filter","processRule":"@PUQ89KC4I4","nodeType":"PROCESS","jsEngine":"es6"}}