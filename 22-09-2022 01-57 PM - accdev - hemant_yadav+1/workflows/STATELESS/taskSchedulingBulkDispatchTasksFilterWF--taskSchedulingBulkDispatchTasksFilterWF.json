{"isArrayOfTasksEmpty":{"connectors":[{"exitPortType":"FalseStep","nodeId":"end"},{"exitPortType":"TrueStep","nodeId":"callBulkDispatchExecutionWF"}],"name":"isArrayOfTasksEmpty","description":"isArrayOfTasksEmpty","processRule":"(contextVar.tasksDispatchData.length > 0)","nodeType":"DECISION"},"areMoreTasksPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchNextTasksData"},{"exitPortType":"FalseStep","nodeId":"getArrayOfTasks"}],"name":"areMoreTasksPresent","description":"areMoreTasksPresent","processRule":"contextVar.noOfTasksBatches >= 2 && contextVar.noOfTasksBatches >= contextVar.tasksBatchNumber","nodeType":"DECISION"},"getArrayOfTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"isArrayOfTasksEmpty"}],"contextChangePermitted":true,"name":"getArrayOfTasks","description":"getArrayOfTasks","processRule":"{if (Array.isArray(contextVar.tasksData) && contextVar.tasksData.length > 0) { for (var index in contextVar.tasksData) {contextVar.tasksDispatchData.push(contextVar.tasksData[index].workOrderTaskId); } }}","nodeType":"PROCESS","jsEngine":"es6"},"processFilterForSiteQuery":{"connectors":[{"exitPortType":"NextStep","nodeId":"getSiteData"}],"contextChangePermitted":true,"name":"processFilterForSiteQuery","description":"processFilterForSiteQuery","processRule":"{ contextVar.siteQueryFilter = ''; if (Array.isArray(contextVar.regionIdList)) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + '({$site.regionId} IN {@regionIdList})'; if (Array.isArray(contextVar.customerIdList)) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + ' AND ({$site.customerId} IN {@customerIdList})'; } } if (Array.isArray(contextVar.customerIdList)) { contextVar.siteQueryFilter = contextVar.siteQueryFilter + ' ({$site.customerId} IN {@customerIdList})'; } }","nodeType":"PROCESS"},"initializeParams":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchTaskData"}],"contextChangePermitted":true,"name":"initializeParams","description":"Initialize params for workflow ","processRule":"@UVS8V3KGW5","id":"initializeParams","nodeType":"PROCESS","jsEngine":"es6"},"processSiteIdListAndWorkOrderIdList":{"connectors":[{"exitPortType":"NextStep","nodeId":"initializeParams"}],"contextChangePermitted":true,"name":"processSiteIdListAndWorkOrderIdList","description":"processSiteIdListAndWorkOrderIdList","processRule":"{ contextVar.siteIdList = []; contextVar.workOrderIdList = []; if (Array.isArray(contextVar.siteData) && contextVar.siteData.length > 0) { for(let element in contextVar.siteData) { contextVar.siteIdList.push(contextVar.siteData[element].siteId); } } if (Array.isArray(contextVar.workOrderData) && contextVar.workOrderData.length > 0) { for(let element in contextVar.workOrderData) { contextVar.workOrderIdList.push(contextVar.workOrderData[element].workOrderId); } } }","nodeType":"PROCESS","jsEngine":"es6"},"getLoggedInUserWorkGroupFilters":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFinalFilteredData"}],"processId":"userWorkGroupFilterWF","name":"getLoggedInUserWorkGroupFilters","description":"getLoggedInUserWorkGroupFilters","inputVarMap":{"userList":"userList"},"outputVarMap":{"finalFilteredData":"finalFilteredData"},"nodeType":"WORKFLOW"},"workflowContext":{"customBatchSize":1000,"tasksData":[],"tasksDispatchData":[],"noOfTasksBatches":0,"count":0},"getSiteData":{"filter":"filter","models":["customer","site","region"],"connectors":[{"exitPortType":"NextStep","nodeId":"isWorkOrderTypeIdListPresent"}],"columns":{"siteId":"site.id"},"name":"getSiteData","description":"getSiteData","inputVarMap":{"customerIdList":"customerIdList","regionIdList":"regionIdList","siteQueryFilter":"filter"},"links":{"site":"customer","region":"site"},"outputVarMap":{"data":"siteData"},"nodeType":"QUERY"},"callBulkDispatchExecutionWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchLocalizedKeys"}],"processId":"taskSchedulingBulkDispatchExecutionWF","name":"callBulkDispatchExecutionWF","description":"callBulkDispatchExecutionWF","inputVarMap":{"tasksDispatchData":"tasksDispatchData"},"outputVarMap":{},"nodeType":"WORKFLOW"},"getLoggedInUser":{"filter":"{$userId}={@userId}","models":["User"],"connectors":[{"exitPortType":"NextStep","nodeId":"processUserId"}],"columns":{"userName":"User.name","userId":"User.id"},"name":"getLoggedInUser","description":"getLoggedInUser","inputVarMap":{"{@userId}":"userId"},"outputVarMap":{"data":"currentUserDetail"},"nodeType":"QUERY"},"end":{"name":"end","description":"end","inputVarMap":{"tasksData":"tasksData"},"outputVarMap":{"tasksData":"tasksData"},"id":"end","nodeType":"END"},"isRegionIdListOrCustomerIdListPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processFilterForSiteQuery"},{"exitPortType":"FalseStep","nodeId":"isWorkOrderTypeIdListPresent"}],"name":"isRegionIdListOrCustomerIdListPresent","description":"isRegionIdListOrCustomerIdListPresent","processRule":"(Array.isArray(contextVar.regionIdList) || Array.isArray(contextVar.customerIdList))","nodeType":"DECISION"},"notifyInitiatorNode":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"name":"notifyInitiatorNode","description":"notifyInitiatorNode","inputVarMap":{"currentUserId":"userId","longText":"longText","shortText":"shortText"},"targetType":"user","outputVarMap":{},"notificationType":"web","templateId":"TLRB2KJVXG","nodeType":"NOTIFY"},"processFinalFilteredData":{"connectors":[{"exitPortType":"NextStep","nodeId":"isAllFilterApplied"}],"contextChangePermitted":true,"name":"processFinalFilteredData","description":"processFinalFilteredData","processRule":"{if (typeof contextVar.userList !== 'undefined' && contextVar.userList.length > 0) { userId = contextVar.userList[0]; if (typeof contextVar.finalFilteredData !== 'undefined' &&  contextVar.finalFilteredData !== '' && typeof contextVar.finalFilteredData[userId] !== 'undefined' && contextVar.finalFilteredData[userId] !== '') { contextVar.isAllFilterApplied = contextVar.finalFilteredData[userId].isAllFilterApplied; if (typeof contextVar.finalFilteredData[userId].workOrderType !== 'undefined' && contextVar.finalFilteredData[userId].workOrderType !== '' && typeof contextVar.finalFilteredData[userId].workOrderType.filterIdList !== 'undefined') { contextVar.workOrderTypeIdList = contextVar.finalFilteredData[userId].workOrderType.filterIdList; } if (typeof contextVar.finalFilteredData[userId].taskType !== 'undefined' && contextVar.finalFilteredData[userId].taskType !== '' && typeof contextVar.finalFilteredData[userId].taskType.filterIdList!=='undefined') { contextVar.taskTypeIdList = contextVar.finalFilteredData[userId].taskType.filterIdList; } if (typeof contextVar.finalFilteredData[userId].region !== 'undefined' && contextVar.finalFilteredData[userId].region !== '' && typeof contextVar.finalFilteredData[userId].region.filterIdList!=='undefined') { contextVar.regionIdList = contextVar.finalFilteredData[userId].region.filterIdList; } if (typeof contextVar.finalFilteredData[userId].customer !== 'undefined' && contextVar.finalFilteredData[userId].customer !== '' && typeof contextVar.finalFilteredData[userId].customer.filterIdList!=='undefined') { contextVar.customerIdList = contextVar.finalFilteredData[userId].customer.filterIdList; } } }}","nodeType":"PROCESS"},"appendTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTasksPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"if (Array.isArray(contextVar.nextTasksData)) { contextVar.tasksData = contextVar.tasksData.concat(contextVar.nextTasksData) } contextVar.tasksBatchNumber = contextVar.tasksBatchNumber + 1;","nodeType":"PROCESS"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTasksPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{contextVar.noOfTasksBatches = Math.ceil(contextVar.tasksCount / contextVar.customBatchSize);contextVar.tasksBatchNumber = contextVar.tasksBatchNumber + 1;}","id":"findNumberOfBatches","nodeType":"PROCESS"},"fetchNextTasksData":{"models":["workOrderTask","workOrder","site","region","taskType","ZStatus","customer"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTasks"}],"columns":{"customerSiteName":"site.name","workOrderTaskTypeId":"workOrderTask.taskTypeId","workOrderTaskStatusId":"workOrderTask.statusId","workOrderDeadline":"workOrder.deadline","customerCompanyName":"customer.companyName","workOrderTaskId":"workOrderTask.id","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id","taskTypeName":"taskType.name"},"distinct":true,"description":"fetchNextTasksData","inputVarMap":{"filter":"filter","customBatchSize":"batchSize","tasksBatchNumber":"batchNumber","taskTypeIdList":"taskTypeIdList","siteIdList":"siteIdList","endDate":"endDate","regionIdList":"regionIdList","orderBy":"orderBy","startDate":"startDate","workOrderIdList":"workOrderIdList"},"groupBy":"workOrderTaskId","nodeType":"QUERY","filter":"filter","name":"fetchNextTasksData","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrdertask","region":"site","customer":"workOrder","ZStatus":"workOrderTask"},"outputVarMap":{"data":"nextTasksData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"fetchLocalizedKeys":{"filter":"{$listOptionAnswer.listOptionId}='bulkDispatchNotification'","models":["listOptionAnswer"],"connectors":[{"exitPortType":"NextStep","nodeId":"processingNotificationData"}],"columns":{"listOptionAnswerId":"listOptionAnswer.id","listOptionAnswerAnswerOptionText":"listOptionAnswer.answerOptionText"},"name":"fetchLocalizedKeys","description":"fetchLocalizedKeys","outputVarMap":{"data":"localizedData"},"nodeType":"QUERY","translate":true},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getLoggedInUser"}],"name":"start","description":"start","id":"start","nodeType":"START"},"fetchTaskData":{"models":["workOrderTask","workOrder","site","region","taskType","customer"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"customerSiteName":"site.name","workOrderTaskTypeId":"workOrderTask.taskTypeId","workOrderTaskStatusId":"workOrderTask.statusId","workOrderDeadline":"workOrder.deadline","customerCompanyName":"customer.companyName","workOrderTaskId":"workOrderTask.id","workOrderTaskScheduledDate":"workOrderTask.scheduledDate","workOrderId":"workOrder.id","taskTypeName":"taskType.name"},"description":"fetchTaskData","inputVarMap":{"filter":"filter","customBatchSize":"batchSize","taskTypeIdList":"taskTypeIdList","siteIdList":"siteIdList","endDate":"endDate","orderBy":"orderBy","startDate":"startDate","workOrderIdList":"workOrderIdList"},"groupBy":"workOrderTaskId","nodeType":"QUERY","filter":"filter","name":"fetchTaskData","links":{"workOrder":"workOrderTask","taskType":"workOrderTask","site":"workOrdertask","region":"site","customer":"workOrder"},"id":"fetchTaskData","outputVarMap":{"data":"tasksData","count":"tasksCount","batchNumber":"tasksBatchNumber"},"batchSize":"batchSize","getCount":true},"workflowNodes":["start","getLoggedInUser","processUserId","getLoggedInUserWorkGroupFilters","processFinalFilteredData","isAllFilterApplied","isRegionIdListOrCustomerIdListPresent","processFilterForSiteQuery","getSiteData","isWorkOrderTypeIdListPresent","getWorkOrderData","processSiteIdListAndWorkOrderIdList","initializeParams","fetchTaskData","findNumberOfBatches","areMoreTasksPresent","fetchNextTasksData","appendTasks","getArrayOfTasks","isArrayOfTasksEmpty","callBulkDispatchExecutionWF","fetchLocalizedKeys","processingNotificationData","notifyInitiatorNode","end"],"processUserId":{"connectors":[{"exitPortType":"NextStep","nodeId":"getLoggedInUserWorkGroupFilters"}],"contextChangePermitted":true,"name":"processUserId","description":"processUserId","processRule":"if (typeof contextVar.currentUserDetail !=='undefined') { contextVar.userList=[];contextVar.userList.push(contextVar.currentUserDetail[0].userId)};","nodeType":"PROCESS"},"isAllFilterApplied":{"connectors":[{"exitPortType":"FalseStep","nodeId":"isRegionIdListOrCustomerIdListPresent"},{"exitPortType":"TrueStep","nodeId":"initializeParams"}],"name":"isAllFilterApplied","description":"isAllFilterApplied","processRule":"(contextVar.isAllFilterApplied===true)","nodeType":"DECISION"},"isWorkOrderTypeIdListPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getWorkOrderData"},{"exitPortType":"FalseStep","nodeId":"processSiteIdListAndWorkOrderIdList"}],"name":"isWorkOrderTypeIdListPresent","description":"isWorkOrderTypeIdListPresent","processRule":"(Array.isArray(contextVar.workOrderTypeIdList))","nodeType":"DECISION"},"processingNotificationData":{"connectors":[{"exitPortType":"NextStep","nodeId":"notifyInitiatorNode"}],"contextChangePermitted":true,"name":"processingNotificationData","description":"processingNotificationData","processRule":"{for(var index in contextVar.localizedData){ if(contextVar.localizedData[index].listOptionAnswerId === 'dispatchNotificationHeader'){ contextVar.shortText = contextVar.localizedData[index].listOptionAnswerAnswerOptionText; }else { contextVar.longText = contextVar.localizedData[index].listOptionAnswerAnswerOptionText; } };contextVar.currentUserId=contextVar.userList[0];}","nodeType":"PROCESS"},"getWorkOrderData":{"filter":"{$workOrder.workOrderTypeId} IN {@workOrderTypeIdList}","models":["workOrder"],"connectors":[{"exitPortType":"NextStep","nodeId":"processSiteIdListAndWorkOrderIdList"}],"columns":{"workOrderId":"workOrder.id"},"name":"getWorkOrderData","description":"getWorkOrderData","inputVarMap":{"workOrderTypeIdList":"workOrderTypeIdList"},"outputVarMap":{"data":"workOrderData"},"nodeType":"QUERY"}}