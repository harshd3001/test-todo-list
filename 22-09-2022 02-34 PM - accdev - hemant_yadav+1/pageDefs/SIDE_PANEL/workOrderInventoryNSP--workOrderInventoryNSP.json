{"pageContext":{},"actionOnLoad":["@actions.decisionActionOnLoad","@actions.setInitialData"],"localPageContext":true,"jslib":{"isAddPartsDisabled":"function(pageContext) { return !((typeof pageContext.workOrderInventoryEstimatedQuantity !== 'undefined' && pageContext.workOrderInventoryEstimatedQuantity !== '' && typeof pageContext.catalog !== 'undefined' && pageContext.catalog !== '') && (Number(pageContext.workOrderInventoryEstimatedQuantity) > 0) && (Number(pageContext.workOrderInventoryEstimatedQuantity) % 1 === 0) && (typeof pageContext.workOrderInventoryUnitPrice !== 'undefined' && pageContext.workOrderInventoryUnitPrice !== '' && pageContext.workOrderInventoryUnitPrice !== '-') && (typeof pageContext.workOrderInventoryCustomerPrice !== 'undefined' && pageContext.workOrderInventoryCustomerPrice !== '' && pageContext.workOrderInventoryCustomerPrice !== '-') && (typeof pageContext.taskId !== 'undefined' && pageContext.taskId !== '' && pageContext.taskId !== '-')); }","validateActualQuantity":"function (pageContext) { return ((Number(pageContext.workOrderInventoryActualQty) < 0) || (Number(pageContext.workOrderInventoryActualQty) % 1 !== 0)); }","validateEstimatedQuantity":"function(pageContext) { return ((Number(pageContext.workOrderInventoryEstimatedQuantity) < 0) || (Number(pageContext.workOrderInventoryEstimatedQuantity) % 1 !== 0));}","dynamicHeaderText":"function(pageContext){ if(pageContext.workOrderInventoryAction === 'addInitial'||pageContext.workOrderInventoryAction === 'add'){return '@lang.[\"apam\",\"Add Parts and Materials\"] ';}else if(pageContext.workOrderInventoryAction === 'edit'){return '@lang.[\"edit\",\"Edit\"] '+pageContext.catalogName+' - '+pageContext.catalogModelNumber;}}","isSaveDisabled":"function(pageContext) { return !((typeof pageContext.workOrderInventoryDataGrid !== 'undefined' && pageContext.workOrderInventoryDataGrid.length > 0) || (pageContext.workOrderInventoryAction === 'edit' && (((typeof pageContext.workOrderInventoryUnitPrice !== 'undefined' && pageContext.initialCost !== Number(pageContext.workOrderInventoryUnitPrice)) || (typeof pageContext.workOrderInventoryCustomerPrice !== 'undefined' && pageContext.initialListPrice !== Number(pageContext.workOrderInventoryCustomerPrice)) || (typeof pageContext.workOrderInventoryActualQty !== 'undefined' && pageContext.initialActualQuantity !== Number(pageContext.workOrderInventoryActualQty)) || (typeof pageContext.workOrderInventoryEstimatedQuantity !== 'undefined' && pageContext.initialEstimatedQuantity !== Number(pageContext.workOrderInventoryEstimatedQuantity)) || (typeof pageContext.taskId != 'undefined' && pageContext.taskId != '' && pageContext.initialTaskId !== pageContext.taskId)) && (Number(pageContext.workOrderInventoryEstimatedQuantity) > 0) && (Number(pageContext.workOrderInventoryActualQty) >= 0) && (Number(pageContext.workOrderInventoryEstimatedQuantity) % 1 === 0) && (Number(pageContext.workOrderInventoryActualQty) % 1 === 0)) && ((pageContext.workOrderInventoryUnitPrice !== '' && pageContext.workOrderInventoryUnitPrice !== '-') && (pageContext.workOrderInventoryCustomerPrice !== '' && pageContext.workOrderInventoryCustomerPrice !== '-')))); }","isActionEdit":"function (pageContext){return (pageContext.workOrderInventoryAction === 'edit')}","isActionAdd":"function (pageContext){return (pageContext.workOrderInventoryAction === 'add')}"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.clearFieldValues","@actions.openPreviousPanel"],"type":"buttonIcon"}]},"children":[{"buttonType":"primary","actionOnClick":["@actions.setPriceAndCost","@actions.setUpsertData","@actions.fireProcessEvent","@actions.openPreviousPanel","@actions.refreshPartsAndMaterialsGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"actionOnChange":["@actions.setWorkOrderTaskId"],"isMultiSelect":false,"searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$workOrderTask.workOrderId} = {@workOrderId} AND {$taskType.webTask}=false","models":["workOrderTask","taskType"],"columns":{"selectTaskId":"CONCAT({$workOrderTask.id},' - ',{$taskType.name})","id":"workOrderTask.id"},"inputs":{"workOrderId":"@pageContext.workOrderId"},"links":{"workOrderTask":"taskType"}}},"optLabelMap":"selectTaskId","optValueMap":"id","id":"workOrderTaskIdObj","placeholder":"@lang.['st11','Select task']","label":"@lang.['st15','Select Task']","type":"selectDropdown","value":"@pageContext.workOrderTaskObj"},{"actionOnChange":["@actions.decisionActionForCatalogData"],"isMultiSelect":false,"optLabelMap":"modelName","optValueMap":"catalogId","searchByOptions":{"dataSourceId":"query/read","sourceType":"query","dataToBeSent":{"filter":"{$modelName} like {@filter} AND {$catalog.catalogTypeId} IN ('partAndAsset','material')","models":["catalog","manufacturer","stockUnit","catalogType"],"columns":{"modelName":"catalog.name","catalogId":"catalog.id","cost":"catalog.unitPrice","catalogType":"catalogType.name","modelNumber":"catalog.modelNumber","listPrice":"catalog.customerPrice","stockUnitName":"IF({$stockUnit.name}!='',{$stockUnit.name},'-')","manufacturer":"manufacturer.name"},"outerJoinOnModel":"catalog","orderBy":"modelName ASC","distinct":true,"links":{"catalogType":"catalog","catalog":"manufacturer","stockUnit":"catalog"},"translate":true}},"isMainPage":false,"isAdvanceSearch":{"rowsToSelect":{"filter":" {$catalogId} = {@selectedCatalogId} AND {$catalog.catalogTypeId} IN ('partAndAsset','material')","models":["catalog","manufacturer","stockUnit","catalogType"],"columns":{"modelName":"catalog.name","catalogId":"catalog.id","cost":"catalog.unitPrice","catalogType":"catalogType.name","modelNumber":"catalog.modelNumber","listPrice":"catalog.customerPrice","stockUnitName":"IF({$stockUnit.name}!='',{$stockUnit.name},'-')","manufacturer":"manufacturer.name"},"inputs":{"selectedCatalogId":"@pageContext.selectedId"},"outerJoinOnModel":"catalog","links":{"catalogType":"catalog","catalog":"manufacturer","stockUnit":"catalog"},"translate":true},"columnsToBeHidden":["catalogId"],"selectedRowAdvanceGrid":"AdvancedGridCatalog","rowsToBeSelect":"selectedId","sourceType":"query","sidePanelTitle":"@lang.['sc7','Select Catalog']","gridHeaderText":"@lang.['pc2','Parts Catalog']","searchKeys":["modelName","modelNumber","manufacturer"]},"readOnly":"@jslib.isActionEdit","label":"@lang.['mn','Model Name']","id":"catalog","type":"selectDropdown","value":"@pageContext.catalog"},{"readOnly":true,"id":"modelNumber","label":"@lang.['mn1','Model Number']","type":"input","value":"@pageContext.catalogModelNumber"},{"readOnly":true,"id":"manufacturer","label":"@lang.['m','Manufacturer']","type":"input","value":"@pageContext.manufacturerName"},{"readOnly":true,"id":"type","label":"@lang.['t5','Type']","type":"input","value":"@pageContext.catalogTypeName"},{"readOnly":true,"id":"stockUnit","label":"@lang.['su1','Stock Unit']","type":"input","value":"@pageContext.stockUnitName"},{"inputType":"number","id":"cost","label":"@lang.['c31','Cost']","placeholder":"@lang.['abosmn','Autofilled based on selected model name']","type":"input","value":"@pageContext.workOrderInventoryUnitPrice"},{"inputType":"number","id":"listPrice","label":"@lang.['lp','List Price']","placeholder":"@lang.['abosmn','Autofilled based on selected model name']","type":"input","value":"@pageContext.workOrderInventoryCustomerPrice"},{"errorText":"@lang.['pevq','Please Enter valid quantity']","hidden":"@jslib.isActionAdd","validator":"@jslib.validateActualQuantity","inputType":"number","id":"actualQuantity","label":"@lang.['aq1','Actual Quantity']","type":"input","value":"@pageContext.workOrderInventoryActualQty"},{"isRequired":true,"errorText":"@lang.['pevq','Please Enter valid quantity']","validator":"@jslib.validateEstimatedQuantity","inputType":"number","id":"estimatedQuantity","label":"@lang.['eq1','Estimated Quantity']","type":"input","value":"@pageContext.workOrderInventoryEstimatedQuantity"},{"children":[{"children":[{"buttonType":"primary","hidden":"@jslib.isActionEdit","actionOnClick":["@actions.updateWorkOrderInventoryGrid","@actions.clearFieldOnAddParts","@actions.refreshWorkOrderInventoryDataGrid"],"disabled":"@jslib.isAddPartsDisabled","id":"addPart","type":"button","title":"@lang.['ap1','Add Part']"}],"flex":"1","type":"column"},{"flex":"2","id":"","type":"column"}],"id":"addPartsMaterials","type":"row"}],"label":"","id":"partsAndMaterials","type":"section"},{"hidden":"@jslib.isActionEdit","children":[{"label":"@lang.['pam','Parts and Materials']","id":"workOrderInventoryGrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":true,"tableData":{"source":"@pageContext.workOrderInventoryDataGrid"}},"isScrollAble":true,"searchAllowed":true,"tableWidth":"100rem","searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY']","type":"noData"},"rowActions":{},"orderBy":"workOrderTaskId DESC","distinct":true,"gridRefreshId":"workOrderInventoryDataGrid","emptyScreen":{"image":"@iconlib.ActionsSearchGrey","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['taskId','Task ID']","options":{"flex":1,"showLabel":true},"key":"workOrderTaskId"},{"name":"@lang.['mn','Model Name']","options":{"flex":1,"showLabel":true},"key":"modelName"},{"name":"@lang.['mn1','Model Number']","options":{"flex":1,"showLabel":true},"key":"modelNumber"},{"name":"@lang.['m','Manufacturer']","options":{"flex":1,"showLabel":true},"key":"manufacturerName"},{"name":"@lang.['t5','Type']","options":{"flex":1,"showLabel":true},"key":"catalogType"},{"name":"@lang.['c31','Cost']","options":{"flex":0.6,"showLabel":true},"key":"unitPrice"},{"name":"@lang.['lp','List Price']","options":{"flex":0.6,"showLabel":true},"key":"customerPrice"},{"name":"@lang.['eq1','Estimated Quantity']","options":{"flex":0.6,"showLabel":true},"key":"estimatedQty"}],"jslib":{},"rowTextLength":25,"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['pam','Parts and Materials']"},"isSelectable":false,"updateAllowed":true,"actions":[],"searchKeys":["workOrderTaskId","modelName"]}}],"id":"workOrderPartsMaterialData","type":"section","transparent":true}]},"actions":[{"endPoint":"process/start","name":"fireProcessEvent","outputVarMap":{},"type":"api","actionDef":{"data":[{"processId":"workOrderInventoryWF","contextVar":{"subAction":"@pageContext.workOrderInventoryAction","workOrderId":"@pageContext.workOrderId","workOrderInventory":"@pageContext.workOrderInventoryDataGrid"}}]}},{"name":"setUpsertData","type":"script","actionDef":"function (pageContext) { if (typeof pageContext.workOrderInventoryUnitPrice != 'undefined' && pageContext.workOrderInventoryUnitPrice != '' && typeof pageContext.workOrderInventoryCustomerPrice !== 'undefined' && pageContext.workOrderInventoryCustomerPrice !== '' && typeof pageContext.catalog !== 'undefined' && pageContext.catalog.length > 0) { pageContext.workOrderInventoryUnitPrice = Number(pageContext.workOrderInventoryUnitPrice).toFixed(2); pageContext.workOrderInventoryCustomerPrice = Number(pageContext.workOrderInventoryCustomerPrice).toFixed(2); pageContext.catalogName = pageContext.catalog[0].label; } if (pageContext.workOrderInventoryAction == 'edit') { var partsMaterial = {}; partsMaterial = { 'workOrderId': pageContext.workOrderId, 'workOrderTaskId': pageContext.taskId, 'customerPrice': pageContext.workOrderInventoryCustomerPrice, 'modelNumber': pageContext.catalogModelNumber, 'modelName': pageContext.catalogName, 'manufacturerName': pageContext.manufacturerName, 'unitPrice': pageContext.workOrderInventoryUnitPrice, 'catalogType': pageContext.catalogTypeName, 'catalogId': pageContext.workOrderInventoryCatalogId, 'id': pageContext.id, 'recver': pageContext.recver, 'estimatedQty': pageContext.workOrderInventoryEstimatedQuantity, 'actualQty': pageContext.workOrderInventoryActualQty }; pageContext.workOrderInventoryDataGrid.push(partsMaterial); } }"},{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { pageContext.enable = true; if (typeof pageContext.workOrderInventoryDataGrid === 'undefined' || pageContext.workOrderInventoryDataGrid === '' || pageContext.workOrderInventoryDataGrid.length == 0) { pageContext.workOrderInventoryDataGrid = []; } if (pageContext.workOrderInventoryAction === 'edit') { pageContext.catalog = []; var catalogObj = { 'label': pageContext.catalogName, 'value': pageContext.workOrderInventoryCatalogId }; if(typeof pageContext.taskId==='undefined'){ pageContext.taskId=''; } pageContext.catalog.push(catalogObj); pageContext.initialCost = pageContext.workOrderInventoryUnitPrice; pageContext.initialListPrice = pageContext.workOrderInventoryCustomerPrice; pageContext.initialActualQuantity = pageContext.workOrderInventoryActualQty; pageContext.initialEstimatedQuantity = pageContext.workOrderInventoryEstimatedQuantity; if (typeof pageContext.workOrderTaskId !== 'undefined' && pageContext.workOrderTaskId !== '-') { pageContext.initialTaskId = pageContext.workOrderTaskId; } else { pageContext.initialTaskId = ''; } } }"},{"name":"clearFieldValues","type":"script","actionDef":"function (pageContext) { if (pageContext.workOrderInventoryAction === 'edit' || pageContext.workOrderInventoryAction === 'addInitial') {  pageContext.workOrderTaskObj = []; pageContext.catalog = ''; pageContext.workOrderTaskId = ''; pageContext.taskId = ''; pageContext.workOrderInventoryUnitPrice = ''; pageContext.workOrderInventoryCustomerPrice = ''; pageContext.workOrderInventoryCatalogId = ''; pageContext.catalogModelNumber = '-'; pageContext.manufacturerName = '-'; pageContext.catalogName='';pageContext.catalogTypeName = '-'; pageContext.stockUnitName = '-'; pageContext.workOrderInventoryEstimatedQuantity = 0; } if (pageContext.workOrderInventoryAction === 'addInitial') { pageContext.workOrderInventoryAction = 'add'; } }"},{"name":"clearFieldOnAddParts","type":"script","actionDef":"function (pageContext) { pageContext.workOrderTaskObj =[]; pageContext.taskId = ''; pageContext.catalog = ''; pageContext.workOrderTaskId = '';pageContext.workOrderInventoryUnitPrice = ''; pageContext.workOrderInventoryCustomerPrice = ''; pageContext.workOrderInventoryCatalogId = '';pageContext.catalogName=''; pageContext.catalogModelNumber = '-'; pageContext.manufacturerName = '-'; pageContext.catalogTypeName = '-'; pageContext.stockUnitName = '-'; pageContext.workOrderInventoryEstimatedQuantity = 0; }"},{"falseStep":["@actions.fetchTaskID","@actions.setWorkOrderTaskId"],"trueStep":["@actions.clearFieldValues"],"name":"decisionActionOnLoad","type":"decision","actionDef":"function(pageContext){if(pageContext.workOrderInventoryAction === 'addInitial'||pageContext.workOrderInventoryAction === 'add'){return true;}}"},{"name":"refreshPartsAndMaterialsGrid","gridId":["partsAndMaterialsGrid"],"type":"RefreshGridOnSidePanel"},{"name":"setWorkOrderTaskId","type":"script","actionDef":"function (pageContext) { if (pageContext.workOrderTaskObj[0] === null || typeof pageContext.workOrderTaskObj === 'undefined' || pageContext.workOrderTaskObj === '' || typeof pageContext.workOrderTaskObj[0].value === 'undefined' || pageContext.workOrderTaskObj[0].value === '') { pageContext.taskId = ''; } else { pageContext.taskId = pageContext.workOrderTaskObj[0].value; } }"},{"name":"refreshWorkOrderInventoryDataGrid","gridId":["workOrderInventoryDataGrid"],"type":"RefreshGridOnSidePanel"},{"name":"openPreviousPanel","type":"backPanel"},{"name":"fetchTaskID","outputVarMap":{"data":"@pageContext.workOrderTaskObj"},"type":"query","actionDef":{"filter":"{$value}={@value}","models":["workOrderTask","taskType"],"columns":{"label":"CONCAT({$workOrderTask.id},' - ',{$taskType.name})","value":"workOrderTask.id"},"inputs":{"value":"@pageContext.workOrderTaskId"},"links":{"workOrderTask":"taskType"}}},{"falseStep":["@actions.clearCatalogData"],"trueStep":["@actions.setCatalogId","@actions.getSelectedCatalogData","@actions.setSelectedCatalogData"],"name":"decisionActionForCatalogData","type":"decision","actionDef":"function(pageContext){if(typeof pageContext.catalog !=='undefined' && pageContext.catalog !=='' && pageContext.catalog[0] !== null) {return true;} return false;}"},{"name":"clearCatalogData","type":"script","actionDef":"function (pageContext) { pageContext.catalog='';pageContext.workOrderInventoryUnitPrice='-';pageContext.workOrderInventoryCustomerPrice='-';pageContext.workOrderInventoryCatalogId=''; pageContext.catalogModelNumber='-';pageContext.manufacturerName='-';pageContext.catalogTypeName='-';pageContext.stockUnitName='-';pageContext.workOrderInventoryEstimatedQuantity=0;}"},{"name":"setCatalogId","type":"script","actionDef":"function (pageContext) {pageContext.workOrderInventoryCatalogId=pageContext.catalog[0].value;}"},{"name":"updateWorkOrderInventoryGrid","type":"script","actionDef":"function (pageContext) { var partsMaterial = {}; partsMaterial = { 'workOrderId': pageContext.workOrderId, 'workOrderTaskId': pageContext.taskId ? pageContext.taskId : '-', 'customerPrice': Number(pageContext.workOrderInventoryCustomerPrice).toFixed(2), 'id': '', 'modelNumber': pageContext.catalogModelNumber, 'modelName': pageContext.catalogName, 'manufacturerName': pageContext.manufacturerName, 'unitPrice': Number(pageContext.workOrderInventoryUnitPrice).toFixed(2), 'catalogType': pageContext.catalogTypeName, 'catalogId': pageContext.workOrderInventoryCatalogId, 'estimatedQty': pageContext.workOrderInventoryEstimatedQuantity }; if (typeof pageContext.workOrderInventoryDataGrid !== 'undefined' && pageContext.workOrderInventoryDataGrid.length > 0) { var index = _.findLastIndex(pageContext.workOrderInventoryDataGrid, function (element) { return (((typeof partsMaterial.workOrderTaskId !== 'undefined' && partsMaterial.workOrderTaskId !== '' && element.workOrderTaskId == partsMaterial.workOrderTaskId) || (typeof partsMaterial.workOrderTaskId === 'undefined' || partsMaterial.workOrderTaskId === '') && (typeof element.workOrderTaskId === 'undefined' || element.workOrderTaskId === '')) && element.catalogId == partsMaterial.catalogId && element.unitPrice == partsMaterial.unitPrice && element.customerPrice == partsMaterial.customerPrice); }); if (index >= 0) { pageContext.workOrderInventoryDataGrid[index].estimatedQty = Number(partsMaterial.estimatedQty) + Number(pageContext.workOrderInventoryDataGrid[index].estimatedQty) } else { pageContext.workOrderInventoryDataGrid.push(partsMaterial); } } else { pageContext.workOrderInventoryDataGrid.push(partsMaterial); } }"},{"name":"getSelectedCatalogData","outputVarMap":{"data":"@pageContext.catalogData"},"type":"query","actionDef":{"filter":"{$catalogId} = {@catalogId}","models":["catalog","manufacturer","stockUnit","catalogType"],"inputs":{"catalogId":"@pageContext.workOrderInventoryCatalogId"},"columns":{"catalogName":"catalog.name","catalogId":"catalog.id","cost":"catalog.unitPrice","catalogType":"catalogType.name","manufacturerName":"IF({$manufacturer.name}!='',{$manufacturer.name},'-')","modelNumber":"catalog.modelNumber","listPrice":"catalog.customerPrice","stockUnitName":"stockUnit.name"},"outerJoinOnModel":"catalog","links":{"catalogType":"catalog","catalog":"manufacturer","stockUnit":"catalog"},"translate":true}},{"name":"setSelectedCatalogData","type":"script","actionDef":"function (pageContext) { pageContext.installedBaseCatalogId = pageContext.catalog[0].value; if (pageContext.catalogData) { pageContext.manufacturerName = pageContext.catalogData[0].manufacturerName; pageContext.catalogModelNumber = pageContext.catalogData[0].modelNumber,pageContext.catalogName=pageContext.catalogData[0].catalogName; pageContext.catalogTypeName = pageContext.catalogData[0].catalogType; pageContext.stockUnitName = pageContext.catalogData[0].stockUnitName; pageContext.workOrderInventoryCatalogId = pageContext.catalogData[0].catalogId; pageContext.workOrderInventoryUnitPrice=pageContext.catalogData[0].cost; pageContext.workOrderInventoryCustomerPrice=pageContext.catalogData[0].listPrice; }; if (!pageContext.catalog || !pageContext.catalog[0]) { pageContext.manufacturerName = ''; pageContext.catalogModelNumber = ''; pageContext.catalogTypeName = ''; pageContext.stockUnitName = ''; pageContext.workOrderInventoryCatalogId = ''; } }"},{"name":"setPriceAndCost","type":"script","continueOnError":true,"actionDef":"function(pageContext) {var roundoff=pageContext.workOrderInventoryUnitPrice;roundoff=roundoff.toFixed(2);pageContext.workOrderInventoryUnitPrice=roundoff;var ToFixed=pageContext.workOrderInventoryCustomerPrice;ToFixed=ToFixed.toFixed(2);pageContext.workOrderInventoryCustomerPrice=ToFixed;}"}]}