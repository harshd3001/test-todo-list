{"pageContext":{},"actionOnLoad":["@actions.setInitialData"],"localPageContext":true,"jslib":{"contractNotSelected":"function (pageContext){ return!(Array.isArray(pageContext.contract) && pageContext.contract.length > 0)}","isGreaterThanContract":"function (pageContext) { if (typeof pageContext.contractEndDate !== 'undefined' && pageContext.contractEndDate !== '' && pageContext.contractEndDate !== '-') { if (pageContext.contractEndDate < pageContext.deadline) { pageContext.error = true; return true; } else { pageContext.error = false; return false; } } }","isContractSelected":"function (pageContext){ return(Array.isArray(pageContext.contract) && pageContext.contract.length > 0)}","dynamicHeaderText":"function (pageContext) { if (pageContext.maintenanceScheduleNNSPAction === 'add') { return '@lang.[\"amd\",\"Add Maintenance Date\"]'; } else if (pageContext.maintenanceScheduleNNSPAction === 'edit') { return '@lang.[\"emd\",\"Edit Maintenance Date\"]'; } }","isSaveDisabled":"function (pageContext) { if (pageContext.maintenanceScheduleNNSPAction === 'add') { return !(typeof pageContext.createWorkOrderDate !== 'undefined' && pageContext.createWorkOrderDate !== '' && typeof pageContext.requestedDate !== 'undefined' && pageContext.requestedDate !== '' && typeof pageContext.deadline !== 'undefined' && pageContext.deadline !== '' && !pageContext.error && pageContext.createWorkOrderDate <= pageContext.requestedDate) } return ((pageContext.maintenanceScheduleNNSPAction === 'edit' && pageContext.initialCreateWorkOrderDate === pageContext.createWorkOrderDate && ZNFS.webConfig.pageConfig.pageContext.initialRequestedDate === pageContext.requestedDate && pageContext.initialDeadline === pageContext.deadline) || pageContext.error || pageContext.createWorkOrderDate > pageContext.requestedDate || pageContext.createWorkOrderDate < pageContext.minDate ) }","isActionEdit":"function (pageContext) { return!(pageContext.maintenanceScheduleNNSPAction === 'edit')}"},"header":{"leftData":{"children":[{"name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.openMaintenanceSchedulePanel"],"type":"buttonIcon"}]},"children":[{"activeIcon":"@iconlib.ActionsBinPurple","hidden":"@jslib.isActionEdit","name":"@lang.['d1','Delete']","icon":"@iconlib.ActionsBinGrey","tooltip":"@lang.['d1','Delete']","actionOnClick":["@actions.deleteMaintenanceSchedule","@actions.openMaintenanceSchedulePanel"],"id":"delete","type":"buttonIcon"},{"buttonType":"primary","actionOnClick":["@actions.saveMaintenanceSchedule","@actions.openMaintenanceSchedulePanel"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"actionOnChange":[],"minDate":"@pageContext.currentDate","id":"createWorkOrderDate","title":"@lang.['cwo1','Create Work Order']","type":"date","value":"@pageContext.createWorkOrderDate"},{"actionOnChange":["@actions.isContractPresent"],"minDate":"@pageContext.createWorkOrderDate","id":"requestedOnDate","title":"@lang.['ro','Requested On']","type":"date","value":"@pageContext.requestedDate"},{"minDate":"@pageContext.requestedDate","hidden":"@jslib.isContractSelected","maxDate":"@pageContext.endDate","id":"deadlineDate","title":"@lang.['d4','Deadline']","type":"date","value":"@pageContext.deadline"},{"errorText":"@lang.['mdfateotcsandtp','Maintenance deadline falls after the expiration of the contract. Select a new date to proceed']","hidden":"@jslib.contractNotSelected","validator":"@jslib.isGreaterThanContract","readOnly":true,"id":"deadlineDate","title":"@lang.['d4','Deadline']","type":"date","value":"@pageContext.deadline"}],"label":"","id":"NNSPSection","type":"section"}]},"actions":[{"name":"setInitialData","type":"script","actionDef":"function (pageContext) { var today = new Date(); pageContext.currentDate = today.toISOString().replace('T', ' ').replace('Z', ); pageContext.minDate = new Date(today.setDate(today.getDate() - 1)); pageContext.timezoneOffset = new Date().getTimezoneOffset(); pageContext.error = false; if (pageContext.maintenanceScheduleNNSPAction === 'add') { pageContext.createWorkOrderDate = ''; pageContext.requestedDate = ''; if (Array.isArray(pageContext.contract) && pageContext.contract.length > 0) { pageContext.deadline = '-'; } else { pageContext.deadline = ''; } } else if (pageContext.maintenanceScheduleNNSPAction === 'edit') { if (typeof pageContext.deadline === 'undefined' || pageContext.deadline === '') { pageContext.deadline = '-'; } pageContext.initialCreateWorkOrderDate = pageContext.createWorkOrderDate; pageContext.initialRequestedDate = pageContext.requestedDate; pageContext.initialDeadline = pageContext.deadline; } }"},{"name":"deleteMaintenanceSchedule","type":"script","actionDef":"function (pageContext) { _.remove(pageContext.maintenanceScheduleData, function (element) { if (element.id === pageContext.id) { return true; } }); }"},{"falseStep":[],"trueStep":["@actions.fireProcessEvent","@actions.setDeadlineData"],"name":"isContractPresent","type":"decision","actionDef":"function(pageContext){return(Array.isArray(pageContext.contract) && pageContext.contract.length > 0)}"},{"endPoint":"process/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.outputData"},"type":"api","actionDef":{"data":[{"processId":"CWFEEU7WFX","contextVar":{"workOrderCalendarId":"@pageContext.calendarId","workOrderSlaId":"@pageContext.slaId","timezoneOffset":"@pageContext.timezoneOffset","workOrderRequestedDate":"@pageContext.requestedDate"}}]}},{"name":"setDeadlineData","type":"script","actionDef":"function (pageContext) { if (Array.isArray(pageContext.outputData) && pageContext.outputData.length > 0) { pageContext.priorityDeadlineData = pageContext.outputData[0].outputVar.priorityDeadlineData; if (Array.isArray(pageContext.priorityDeadlineData) && pageContext.priorityDeadlineData.length > 0) { pageContext.priorityDeadlineData.forEach((element) => { if (element.priority === pageContext.workOrderPriority) { pageContext.deadline = element.deadline; } }); } } }"},{"name":"saveMaintenanceSchedule","type":"script","actionDef":"function (pageContext) { if (pageContext.deadline === '-') { pageContext.deadline = ''; } if (pageContext.maintenanceScheduleNNSPAction === 'add') { pageContext.maintenanceScheduleData.push({ 'createWorkOrderDate': pageContext.createWorkOrderDate, 'requestedDate': pageContext.requestedDate, 'deadline': pageContext.deadline }); } else if (pageContext.maintenanceScheduleNNSPAction === 'edit') { pageContext.maintenanceScheduleData.forEach(element => { if (element.id === pageContext.id) { element.createWorkOrderDate = pageContext.createWorkOrderDate; element.requestedDate = pageContext.requestedDate; element.deadline = pageContext.deadline; } }); } }"},{"name":"closePanel","type":"closePanel"},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"parentPanelRefreshRequired":false,"name":"openMaintenanceSchedulePanel","type":"backPanel","requiredPageContextKeys":"[ \"maintenanceScheduleData\" ]"}]}