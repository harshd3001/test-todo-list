{"findNumberOfHolidaysBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechHolidaysPresent"}],"contextChangePermitted":true,"name":"findNumberOfHolidaysBatches","description":"findNumberOfHolidaysBatches","processRule":"contextVar.noOfHolidaysBatches = Math.ceil(contextVar.holidaysCount / contextVar.customBatchSize);contextVar.newHolidaysBatchNumber = contextVar.techHolidaysBatchNumber + 1;","nodeType":"PROCESS"},"workflowContext":{"noOfHolidaysBatches":0,"newHolidaysBatchNumber":0},"getCalendarHolidays":{"models":["workforce","calendar","calendarHoliday","holiday"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfHolidaysBatches"}],"columns":{"holidayEndDate":"CONCAT(DATE_ADD({$holiday.date}, INTERVAL CAST(1439 AS UNSIGNED) MINUTE), '.000')","workforceUserId":"workforce.userId","holidayDate":"holiday.date"},"description":"getCalendarHolidays","distinct":true,"orderBy":"holidayDate ASC","inputVarMap":{"customBatchSize":"batchSize","loopArray":"loopArray","holidayEndDateFilter":"holidayEndDateFilter","holidayStartDateFilter":"holidayStartDateFilter","holidaysFilter":"filter"},"nodeType":"QUERY","filter":"filter","name":"getCalendarHolidays","links":{"calendar":"calendarHoliday","workforce":"calendar","calendarHoliday":"holiday"},"outputVarMap":{"data":"appendTechnicianHolidayData","count":"holidaysCount","batchSize":"techHolidaysbatchSize","batchNumber":"techHolidaysBatchNumber"},"batchSize":"batchSize","getCount":true},"appendHolidays":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechHolidaysPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"if (Array.isArray(contextVar.appendTechnicianHolidays)) { contextVar.appendTechnicianHolidays.forEach(function(obj){contextVar.appendTechnicianHolidayData.push(obj);}); } contextVar.newHolidaysBatchNumber = contextVar.newHolidaysBatchNumber + 1;","id":"appendTasks","nodeType":"PROCESS"},"fetchMoreTechsHolidays":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreTechniciansHolidays"},{"exitPortType":"FalseStep","nodeId":"end"}],"data":"appendTechnicianHolidayData","name":"fetchMoreTechsHolidays","description":"fetchMoreTechsHolidays","inputVarMap":{},"processRule":"contextVar.noOfHolidaysBatches >= contextVar.newHolidaysBatchNumber","id":"fetchMoreTechsHolidays","outputVarMap":{},"nodeType":"WHILELOOP"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"isCalledFromCrew"}],"name":"start","description":"Start","nodeType":"START"},"isCalledFromCrew":{"connectors":[{"exitPortType":"TrueStep","nodeId":"end"},{"exitPortType":"FalseStep","nodeId":"getCalendarHolidays"}],"name":"isCalledFromCrew","description":"isCalledFromCrew","processRule":"typeof contextVar.workflowCall !== 'undefined' && (contextVar.workflowCall ==='crew' || contextVar.workflowCall ==='batchSchedulerTechnicians')","id":"isCalledFromCrew","nodeType":"DECISION"},"end":{"name":"end","description":"End","inputVarMap":{"appendTechnicianHolidayData":"appendTechnicianHolidayData"},"outputVarMap":{"appendTechnicianHolidayData":"appendTechnicianHolidayData"},"nodeType":"END"},"areMoreTechHolidaysPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreTechsHolidays"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areMoreTechHolidaysPresent","description":"areMoreTechHolidaysPresent","processRule":"contextVar.noOfHolidaysBatches >= 2","id":"areMoreTechHolidaysPresent","nodeType":"DECISION"},"workflowNodes":["start","isCalledFromCrew","getCalendarHolidays","findNumberOfHolidaysBatches","areMoreTechHolidaysPresent","fetchMoreTechsHolidays","getMoreTechniciansHolidays","appendHolidays","end"],"getMoreTechniciansHolidays":{"models":["workforce","calendar","calendarHoliday","holiday"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendHolidays"}],"columns":{"holidayEndDate":"CONCAT(DATE_ADD({$holiday.date}, INTERVAL CAST(1439 AS UNSIGNED) MINUTE), '.000')","workforceUserId":"workforce.userId","holidayDate":"holiday.date"},"orderBy":"holidayDate ASC","description":"getMoreTechniciansHolidays","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","loopArray":"loopArray","holidayEndDateFilter":"holidayEndDateFilter","holidayStartDateFilter":"holidayStartDateFilter","holidaysFilter":"filter","newHolidaysBatchNumber":"batchNumber"},"nodeType":"QUERY","filter":"filter","name":"getMoreTechniciansHolidays","links":{"calendar":"calendarHoliday","workforce":"calendar","calendarHoliday":"holiday"},"outputVarMap":{"data":"appendTechnicianHolidays"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"}}