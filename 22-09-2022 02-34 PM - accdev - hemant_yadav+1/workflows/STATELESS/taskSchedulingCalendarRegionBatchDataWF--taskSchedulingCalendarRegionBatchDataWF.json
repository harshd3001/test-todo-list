{"appendTechData":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"appendTechData","description":"appendTechData","processRule":"{ if (Array.isArray(contextVar.moreEligibleTechsData)) { contextVar.eligibleTechnicians = contextVar.eligibleTechnicians.concat(contextVar.moreEligibleTechsData); } contextVar.eligibileTechsBatchNumber++; }","nodeType":"PROCESS"},"findNumberOfContractorRegionBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreContractorRegionTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfContractorRegionBatches","description":"findNumberOfContractorRegionBatches","processRule":"{ contextVar.noOfContractorRegionBatches = Math.ceil(contextVar.contractorRegionCount / contextVar.customBatchSize);contextVar.contractorRegionBatchNumber++; }","nodeType":"PROCESS"},"areMoreContractorRegionTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreContractorRegionTechsData"},{"exitPortType":"FalseStep","nodeId":"processFinalTechArray"}],"name":"areMoreContractorRegionTechsPresent","description":"areMoreContractorRegionTechsPresent","processRule":"{ contextVar.noOfContractorRegionBatches >= 2 && contextVar.noOfContractorRegionBatches >= contextVar.contractorRegionBatchNumber }","id":"areMoreContractorRegionTechsPresent","nodeType":"DECISION"},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreBatchesPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{ contextVar.noOfEligibleBatches = Math.ceil(contextVar.eligibleTechsCount / contextVar.customBatchSize);contextVar.eligibileTechsBatchNumber++; }","nodeType":"PROCESS"},"processFilter":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchAllEligibleTechnicians"}],"contextChangePermitted":true,"name":"processFilter","description":"processFilter","processRule":"{ if (typeof contextVar.workGroupDataObject !== 'undefined' && typeof contextVar.workGroupDataObject.region !== 'undefined' && Array.isArray(contextVar.workGroupDataObject.region.workGroupIdList) && contextVar.workGroupDataObject.region.workGroupIdList.length > 0) { contextVar.regionWGIds = JSON.parse(JSON.stringify(contextVar.workGroupDataObject.region.workGroupIdList)); } if (typeof contextVar.workGroupDataObject !== 'undefined' && typeof contextVar.workGroupDataObject.region !== 'undefined' && Array.isArray(contextVar.workGroupDataObject.region.filterIdList) && contextVar.workGroupDataObject.region.filterIdList.length > 0) { contextVar.regionIdsList = JSON.parse(JSON.stringify(contextVar.workGroupDataObject.region.filterIdList)); } var filter = '({$workforce.workforceType} IS NULL OR {$workforce.workforceType} != \"webUser\") AND {$workforce.statusId} = {@workforceStatusFilter} AND {$User.status} != {@userStatusFilter}'; if (typeof contextVar.regionWGIds !== 'undefined' && contextVar.regionWGIds.length > 0) { /* Setting the filter when region ids are present*/ contextVar.regionFilter = '(' + filter + ' AND {$workforceUserId} NOT IN ({@fetchTechniciansToRemove})) OR (' + filter + 'AND ({$workforceWorkGroup.workGroupId} IN {@regionWGIds} OR {$workforceWorkGroup.workGroupId} =\"all\"))'; } else { contextVar.regionWGIds = JSON.parse(JSON.stringify(contextVar.emptyJunkData)); /* Setting the filter when region ids are empty or undefined i.e no work order type work group filter is applied*/ contextVar.regionFilter = '(' + filter + ' AND {$workforceUserId} NOT IN ({@fetchTechniciansToRemove})) OR (' + filter + ')'; } }","nodeType":"PROCESS"},"createContractorRegionFilter":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchContractorRegionData"}],"contextChangePermitted":true,"name":"createContractorRegionFilter","description":"createContractorRegionFilter","processRule":"{contextVar.contractorRegionfilter='({$workforce.workforceType} IS NULL OR {$workforce.workforceType} !={@workforceType}) AND {$workforce.statusId} = {@workforceStatusFilter} AND {$User.status}!= {@userStatusFilter}';if(typeof contextVar.eligibleTechnicians!=='undefined'&&contextVar.eligibleTechnicians.length>0){for(var i=0;i<contextVar.eligibleTechnicians.length;i++){contextVar.eligibleTechsIds.push(contextVar.eligibleTechnicians[i].workforceUserId);}contextVar.contractorRegionfilter='{$contractorRegion.regionId} IN {@regionIdsList} AND {$workforceId} NOT IN {@eligibleTechsIds} AND'+contextVar.contractorRegionfilter;}}","nodeType":"PROCESS"},"fetchMoreContractorRegionTechsData":{"models":["contractorWorkforce","contractorRegion","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendContractorRegionTechs"}],"columns":{"workforceId":"contractorWorkforce.workforceId"},"outerJoinOnModel":"workforce","distinct":true,"description":"fetchContractorRegionData","inputVarMap":{"customBatchSize":"batchSize","contractorRegionBatchNumber":"batchNumber","regionIdsList":"regionIdsList","workforceStatusFilter":"workforceStatusFilter","workforceType":"workforceType","eligibleTechsIds":"eligibleTechsIds","userStatusFilter":"userStatusFilter","contractorRegionfilter":"filter"},"nodeType":"QUERY","filter":"filter","name":"fetchContractorRegionData","links":{"contractorRegion":"contractorWorkforce","contractorWorkforce":"workforce","workforce":"User"},"outputVarMap":{"data":"contractorRegionDataToAppend"},"batchSize":"batchSize","batchNumber":"batchNumber"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processFilter"}],"name":"Start","description":"Start","id":"start","nodeType":"START"},"processFinalTechArray":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processFinalTechArray","description":"processFinalTechArray","processRule":"{ if (typeof contextVar.workforceContractorRegionData !== 'undefined' && contextVar.workforceContractorRegionData.length > 0) { for (var i = 0; i < contextVar.workforceContractorRegionData.length; i++) { contextVar.eligibleTechsIds.push(contextVar.workforceContractorRegionData[i].workforceId); } } }","nodeType":"PROCESS"},"fetchAllEligibleTechnicians":{"models":["workforceWorkGroup","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"workforceUserId":"workforce.userId"},"inputs":{"fetchTechniciansToRemove":{"filter":"({$workforceWorkGroup.workGroupId} NOT IN {@regionWGIds} AND {$workGroup.filterMethod} = \"region\")","models":["workforceWorkGroup","workGroup","workforce"],"columns":{"workforceWorkGroupUserId":"workforceWorkGroup.workforceUserId"},"name":"fetchTechniciansToRemove","distinct":true,"description":"fetchTechniciansToRemove","links":{"workforceWorkGroup":"workforce","workGroup":"workforceWorkGroup"},"inputVarMap":{"regionWGIds":"regionWGIds"},"selectColumns":["workforceWorkGroupUserId"]}},"distinct":true,"description":"fetchAllEligibleTechnicians","outerJoinOnModel":"workforce","inputVarMap":{"customBatchSize":"batchSize","workforceStatusFilter":"workforceStatusFilter","regionWGIds":"regionWGIds","regionFilter":"filter","userStatusFilter":"userStatusFilter"},"nodeType":"QUERY","filter":"filter","name":"fetchAllEligibleTechnicians","links":{"workforceWorkGroup":"workforce","User":"workforce"},"outputVarMap":{"data":"eligibleTechnicians","count":"eligibleTechsCount","batchNumber":"eligibileTechsBatchNumber"},"batchSize":"batchSize","getCount":true},"workflowNodes":["start","processFilter","fetchAllEligibleTechnicians","findNumberOfBatches","areMoreBatchesPresent","fetchMoreEligibleTechnicians","appendTechData","createContractorRegionFilter","fetchContractorRegionData","findNumberOfContractorRegionBatches","areMoreContractorRegionTechsPresent","fetchMoreContractorRegionTechsData","appendContractorRegionTechs","processFinalTechArray","end"],"areMoreBatchesPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreEligibleTechnicians"},{"exitPortType":"FalseStep","nodeId":"createContractorRegionFilter"}],"name":"areMoreBatchesPresent","description":"areMoreBatchesPresent","processRule":"(contextVar.noOfEligibleBatches >= 2 && contextVar.noOfEligibleBatches >= contextVar.eligibileTechsBatchNumber)","nodeType":"DECISION"},"workflowContext":{"customBatchSize":1000,"filterMethod":"region","emptyJunkData":[" "],"noOfEligibleBatches":0,"workforceStatusFilter":"workforceActive","workforceType":"webUser","eligibleTechsIds":[],"userStatusFilter":"Deactivated"},"end":{"name":"End","description":"end","inputVarMap":{"filterMethod":"filterMethod","eligibleTechsIds":"eligibleTechsIds"},"outputVarMap":{"filterMethod":"filterMethod","eligibleTechsIds":"eligibleTechsIds"},"id":"end","nodeType":"END"},"appendContractorRegionTechs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreContractorRegionTechsPresent"}],"contextChangePermitted":true,"name":"appendContractorRegionTechs","description":"appendContractorRegionTechs","processRule":"{ if (Array.isArray(contextVar.contractorRegionDataToAppend)) { contextVar.workforceContractorRegionData = contextVar.workforceContractorRegionData.concat(contextVar.contractorRegionDataToAppend); } contextVar.contractorRegionBatchNumber = contextVar.contractorRegionBatchNumber + 1; }","id":"appendContractorRegionTechs","nodeType":"PROCESS"},"fetchContractorRegionData":{"models":["contractorWorkforce","contractorRegion","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfContractorRegionBatches"}],"columns":{"workforceId":"contractorWorkforce.workforceId"},"distinct":true,"description":"fetchContractorRegionData","inputVarMap":{"customBatchSize":"batchSize","regionIdsList":"regionIdsList","workforceStatusFilter":"workforceStatusFilter","workforceType":"workforceType","eligibleTechsIds":"eligibleTechsIds","userStatusFilter":"userStatusFilter","contractorRegionfilter":"filter"},"nodeType":"QUERY","filter":"filter","name":"fetchContractorRegionData","links":{"contractorRegion":"contractorWorkforce","contractorWorkforce":"workforce","workforce":"User"},"outputVarMap":{"data":"workforceContractorRegionData","count":"contractorRegionCount","batchNumber":"contractorRegionBatchNumber"},"batchSize":"batchSize","getCount":true},"fetchMoreEligibleTechnicians":{"models":["workforceWorkGroup","workGroup","workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTechData"}],"columns":{"workforceUserId":"workforce.userId"},"inputs":{"fetchTechniciansToRemove":{"filter":"({$workforceWorkGroup.workGroupId} NOT IN {@regionWGIds} AND {$workGroup.filterMethod} = \"region\")","models":["workforceWorkGroup","workGroup","workforce"],"columns":{"workforceWorkGroupUserId":"workforceWorkGroup.workforceUserId"},"name":"fetchTechniciansToRemove","distinct":true,"description":"fetchTechniciansToRemove","links":{"workforceWorkGroup":"workforce","workGroup":"workforceWorkGroup"},"inputVarMap":{"regionWGIds":"regionWGIds"},"selectColumns":["workforceWorkGroupUserId"]}},"distinct":true,"description":"fetchMoreEligibleTechnicians","inputVarMap":{"customBatchSize":"batchSize","workforceStatusFilter":"workforceStatusFilter","eligibileTechsBatchNumber":"batchNumber","regionWGIds":"regionWGIds","regionFilter":"filter","userStatusFilter":"userStatusFilter"},"nodeType":"QUERY","filter":"filter","name":"fetchMoreEligibleTechnicians","links":{"workforceWorkGroup":"workforce","User":"workforce","workGroup":"workforceWorkGroup"},"outputVarMap":{"data":"moreEligibleTechsData"},"batchSize":"batchSize","getCount":true}}