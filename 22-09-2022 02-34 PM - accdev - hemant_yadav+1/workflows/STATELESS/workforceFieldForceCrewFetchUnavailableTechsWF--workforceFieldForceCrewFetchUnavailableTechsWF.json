{"getMoreFilteredTechnicians":{"models":["workforceCrew","crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTechs"}],"columns":{"startTime":"crew.startDate","endTime":"crew.endDate","workforceUserId":"workforceCrew.workforceUserId"},"distinct":true,"inputVarMap":{"customBatchSize":"batchSize","endDate":"endDate","crewId":"crewId","unavailableTechsBatchNumber":"batchNumber","startDate":"startDate"},"nodeType":"QUERY","filter":"((({$crew.startDate} BETWEEN {@startDate} AND {@endDate}) OR ({$crew.endDate} BETWEEN {@startDate} AND {@endDate}) OR ({@startDate} BETWEEN {$crew.startDate} AND {$crew.endDate}) OR ({@endDate} BETWEEN {$crew.startDate} AND {$crew.endDate})) AND {$workforceCrew.statusId}=\"workforceCrewOnCrew\") OR ({$crew.id}={@crewId})","name":"getMoreFilteredTechnicians","links":{"workforceCrew":"crew"},"outputVarMap":{"data":"appendUnavailableTechniciansData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"appendTechs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTechs","description":"appendTechs","processRule":"if (Array.isArray(contextVar.appendUnavailableTechniciansData)) { contextVar.techniciansData = contextVar.techniciansData.concat(contextVar.appendUnavailableTechniciansData) } contextVar.unavailableTechsBatchNumber = contextVar.unavailableTechsBatchNumber + 1;","nodeType":"PROCESS"},"workflowContext":{"customBatchSize":1000,"noOfUnavailableTechsBatches":0,"unavailableTechs":[]},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{contextVar.noOfUnavailableTechsBatches = Math.ceil(contextVar.unavailableTechsCount / contextVar.customBatchSize);contextVar.unavailableTechsBatchNumber = contextVar.unavailableTechsBatchNumber + 1;}","id":"findNumberOfBatches","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreFilteredTechnicians"},{"exitPortType":"FalseStep","nodeId":"addFilteredTechsToArray"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"contextVar.noOfUnavailableTechsBatches >= 2 && contextVar.noOfUnavailableTechsBatches >= contextVar.unavailableTechsBatchNumber","nodeType":"DECISION"},"addFilteredTechsToArray":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"addFilteredTechsToArray","description":"addFilteredTechsToArray","processRule":"contextVar.unavailableTechs=[]; if(typeof contextVar.techniciansData!=='undefined' && contextVar.techniciansData.length>0){ contextVar.techniciansData.forEach(function(element){ contextVar.unavailableTechs.push(element.workforceUserId); });}","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"getFilteredTechnicians"}],"name":"start","description":"Start","nodeType":"START"},"end":{"name":"end","description":"End","inputVarMap":{"techniciansData":"unavailableTechsData","unavailableTechs":"unavailableTechs"},"outputVarMap":{"techniciansData":"unavailableTechsData","unavailableTechs":"unavailableTechs"},"nodeType":"END"},"getFilteredTechnicians":{"models":["workforceCrew","crew"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatches"}],"columns":{"startTime":"crew.startDate","endTime":"crew.endDate","workforceUserId":"workforceCrew.workforceUserId"},"distinct":true,"inputVarMap":{"customBatchSize":"batchSize","endDate":"endDate","crewId":"crewId","startDate":"startDate"},"nodeType":"QUERY","filter":"((({$crew.startDate} BETWEEN {@startDate} AND {@endDate}) OR ({$crew.endDate} BETWEEN {@startDate} AND {@endDate}) OR ({@startDate} BETWEEN {$crew.startDate} AND {$crew.endDate}) OR ({@endDate} BETWEEN {$crew.startDate} AND {$crew.endDate})) AND {$workforceCrew.statusId}=\"workforceCrewOnCrew\" AND {$crew.statusId}!=\"crewDeactivated\") OR ({$crew.id}={@crewId})","name":"getFilteredTechnicians","links":{"workforceCrew":"crew"},"id":"getFilteredTechnicians","outputVarMap":{"data":"techniciansData","count":"unavailableTechsCount","batchNumber":"unavailableTechsBatchNumber"},"batchSize":"batchSize","getCount":true},"workflowNodes":["start","getFilteredTechnicians","findNumberOfBatches","areMoreTechsPresent","getMoreFilteredTechnicians","appendTechs","addFilteredTechsToArray","end"]}