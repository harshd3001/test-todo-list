{"workflowContext":{"customBatchSize":1000,"customerSiteHistoryData":[],"workOrderTaskCompleted":"workOrderTaskCompleted","customerSiteTechnicianBatches":0},"appendTasks":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"appendTasks","description":"appendTasks","processRule":"{ if (Array.isArray(contextVar.customerSiteTaskDataToAppend)) { contextVar.customerSiteHistoryData = contextVar.customerSiteHistoryData.concat(contextVar.customerSiteTaskDataToAppend); } }","id":"appendTasks","nodeType":"PROCESS"},"areMoreTechsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"technicianProcessData"},{"exitPortType":"FalseStep","nodeId":"calculateCustomerSiteHistory"}],"name":"areMoreTechsPresent","description":"areMoreTechsPresent","processRule":"typeof contextVar.customerSiteTechnicianIds !== 'undefined' && contextVar.customerSiteTechnicianIds.length > 0","id":"areMoreTechsPresent","nodeType":"DECISION"},"technicianProcessData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTechsTaskData"}],"contextChangePermitted":true,"name":"technicianProcessData","description":"technicianProcessData","processRule":"{ contextVar.loopArray = []; contextVar.loopArray = contextVar.customerSiteTechnicianIds.splice(0, contextVar.customBatchSize); contextVar.customerSiteHistoryFilter = '{$status} = {@workOrderTaskCompleted} AND {$assignToUserId} IN {@loopArray}  AND {$workOrderTask.siteId} = {@workOrderTaskSiteId}'; }","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfBatchesOfTechnician"}],"name":"start","description":"Start","nodeType":"START"},"end":{"name":"End","description":"end","inputVarMap":{"customerSiteHistoryFinalData":"customerSiteHistoryFinalData"},"outputVarMap":{"customerSiteHistoryFinalData":"customerSiteHistoryFinalData"},"nodeType":"END"},"findNumberOfBatchesOfTechnician":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTechsPresent"}],"contextChangePermitted":true,"name":"findNumberOfBatchesOfTechnician","description":"findNumberOfBatchesOfTechnician","processRule":"{contextVar.customerSiteTechnicianBatches = Math.ceil(contextVar.techArray.length / contextVar.customBatchSize);contextVar.customerSiteTechnicianIds = JSON.parse(JSON.stringify(contextVar.techArray)); }","nodeType":"PROCESS"},"calculateCustomerSiteHistory":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"calculateCustomerSiteHistory","description":"calculateCustomerSiteHistory","processRule":"{ contextVar.customerSiteHistoryFinalData = {}; if (typeof contextVar.customerSiteHistoryData != 'undefined' && contextVar.customerSiteHistoryData != '' && contextVar.customerSiteHistoryData.length > 0) { var sortable = []; var high; contextVar.customerSiteHistoryData.forEach(function (element) { if (typeof element.assignToUserId !== 'undefined' && element.assignToUserId !== '' && typeof element.csh !== 'undefined' && element.csh !== '') { sortable.push([element.assignToUserId, element.csh]); } }); if (sortable.length > 0) { sortable.sort(function (a, b) { return b[1] - a[1]; }); high = sortable[0][1]; sortable.forEach(function (element) { if (element[1] === high) { contextVar.customerSiteHistoryFinalData[element[0]] = (element[1] === 0) ? 0 : 100; } else { contextVar.customerSiteHistoryFinalData[element[0]] = Math.ceil((element[1]) / high * 100); } }); } } }","id":"calculateCustomerSiteHistory","nodeType":"PROCESS"},"getTechsTaskData":{"models":["workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTasks"}],"columns":{"workOrderTaskSiteId":"workOrderTask.siteId","csh":"(count({$workOrderTask.id}))","assignToUserId":"workOrderTask.assignedToUserId","status":"workOrderTask.statusId"},"description":"Fetch Task Details","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","workOrderTaskSiteId":"workOrderTaskSiteId","workOrderTaskCompleted":"workOrderTaskCompleted","loopArray":"loopArray","customerSiteHistoryFilter":"filter"},"groupBy":"assignToUserId","nodeType":"QUERY","filter":"filter","name":"getTechsTaskData","id":"getTechsTaskData","outputVarMap":{"data":"customerSiteTaskDataToAppend"},"batchSize":"batchSize","getCount":true},"workflowNodes":["start","findNumberOfBatchesOfTechnician","areMoreTechsPresent","technicianProcessData","getTechsTaskData","appendTasks","calculateCustomerSiteHistory","end"]}