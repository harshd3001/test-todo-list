{"areMoreWorkforcePresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreWorkforceData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areMoreWorkforcePresent","description":"areMoreWorkforcePresent","processRule":"contextVar.noOfBatches >= 2 && contextVar.noOfBatches >= contextVar.workforceBatchNumber","nodeType":"DECISION"},"workflowContext":{"customBatchSize":1000,"userStatus":"Deactivated","mandatoryFilter":"{$User.status} != {@userStatus} AND {$workforce.statusId} = {@workforceStatusId} AND ({$workforce.workforceType} = 'technician' OR {$workforce.workforceType} IS NULL)","customBatchNumber":1,"workforceStatusId":"workforceActive","fetchMoreData":false},"findNumberOfBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreWorkforcePresent"}],"contextChangePermitted":true,"name":"findNumberOfBatches","description":"findNumberOfBatches","processRule":"{contextVar.noOfBatches = Math.ceil(contextVar.totalWorkforceCount / contextVar.customBatchSize);contextVar.workforceBatchNumber++;}","id":"findNumberOfBatches","nodeType":"PROCESS"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processInitialParameters"}],"name":"start","description":"Start","nodeType":"START"},"fetchMoreWorkforceData":{"models":["workforce","ZStatus","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendWorkforce"}],"columns":{"workforceCountry":"workforce.country","workforceCity":"workforce.city","userStatus":"User.status","workforceStatusTargetModel":"workforce.statusTargetModel","workforceAddress":"workforce.address","userPhoneNumber":"User.phoneNumber","workforceTimezoneOffset":"workforce.timezoneOffset","workforceStatusId":"workforce.statusId","workforceUserId":"workforce.userId","userName":"User.name","workforceLongitude":"workforce.longitude","workforcePostalCode":"workforce.postalCode","workforceState":"workforce.state","userId":"User.id","workforceStatusNameColor":"ZStatus.colorCode","workforceStatusName":"ZStatus.name","workforceLatLong":"workforce.latLong","userEmailId":"User.emailId","workforceLatitude":"workforce.latitude","workforceRole":"workforce.role","workforceWorkforceType":"workforce.workforceType","workforceCalendarId":"workforce.calendarId"},"description":"Fetch Workforce Details","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","searchText":"searchText","userStatus":"userStatus","workforceUserFilter":"filter","userIdToBeIgnored":"userIdToBeIgnored","workforceBatchNumber":"batchNumber","workforceStatusId":"workforceStatusId","batchSize":"batchSize","workforceUserIdList":"workforceUserIdList"},"nodeType":"QUERY","filter":"filter","name":"fetchMoreWorkforceData","links":{"workforce":"User","ZStatus":"workforce"},"outputVarMap":{"data":"appendWorkforceData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"end":{"name":"end","description":"end","inputVarMap":{"workforceData":"workforceData","totalWorkforceCount":"count"},"outputVarMap":{"workforceData":"workforceData","count":"count"},"nodeType":"END"},"fetchMoreData":{"connectors":[{"exitPortType":"TrueStep","nodeId":"findNumberOfBatches"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"fetchMoreData","description":"fetchMoreData","processRule":"contextVar.fetchMoreData === true","nodeType":"DECISION"},"appendWorkforce":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreWorkforcePresent"}],"contextChangePermitted":true,"name":"appendWorkforce","description":"appendWorkforce","processRule":"if (Array.isArray(contextVar.appendWorkforceData)) { contextVar.workforceData = contextVar.workforceData.concat(contextVar.appendWorkforceData) } contextVar.workforceBatchNumber++;","nodeType":"PROCESS"},"workflowNodes":["start","processInitialParameters","fetchWorkforceData","fetchMoreData","findNumberOfBatches","areMoreWorkforcePresent","fetchMoreWorkforceData","appendWorkforce","end"],"processInitialParameters":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkforceData"}],"contextChangePermitted":true,"name":"processInitialParameters","description":"processInitialParameters","processRule":"{ if (typeof contextVar.workforceUserFilter !== 'undefined' && contextVar.workforceUserFilter !== '') contextVar.workforceUserFilter += ' AND ' + contextVar.mandatoryFilter; else contextVar.workforceUserFilter = contextVar.mandatoryFilter; if (typeof contextVar.batchSize === 'undefined' || contextVar.batchSize === '') { contextVar.batchSize = contextVar.customBatchSize; contextVar.batchNumber = contextVar.customBatchNumber; contextVar.fetchMoreData = true; } if (typeof contextVar.workforceUserIdList !== 'undefined' && contextVar.workforceUserIdList.length > 0) { contextVar.workforceUserFilter += ' AND {$workforceUserId} IN {@workforceUserIdList}'; } if (typeof contextVar.filter !== 'undefined' && contextVar.filter !== '') { contextVar.workforceUserFilter = contextVar.workforceUserFilter + ' AND ' + contextVar.filter; } }","nodeType":"PROCESS","jsEngine":"es6"},"fetchWorkforceData":{"models":["workforce","ZStatus","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"fetchMoreData"}],"columns":{"workforceCountry":"workforce.country","workforceCity":"workforce.city","userStatus":"User.status","workforceStatusTargetModel":"workforce.statusTargetModel","workforceAddress":"workforce.address","userPhoneNumber":"User.phoneNumber","workforceTimezoneOffset":"workforce.timezoneOffset","workforceStatusId":"workforce.statusId","workforceUserId":"workforce.userId","userName":"User.name","workforceLongitude":"workforce.longitude","workforcePostalCode":"workforce.postalCode","workforceState":"workforce.state","userId":"User.id","workforceStatusNameColor":"ZStatus.colorCode","workforceStatusName":"ZStatus.name","workforceLatLong":"workforce.latLong","userEmailId":"User.emailId","workforceLatitude":"workforce.latitude","workforceRole":"workforce.role","workforceWorkforceType":"workforce.workforceType","workforceCalendarId":"workforce.calendarId"},"description":"Fetch workforce Details","distinct":true,"inputVarMap":{"searchText":"searchText","userStatus":"userStatus","workforceUserFilter":"filter","userIdToBeIgnored":"userIdToBeIgnored","workforceStatusId":"workforceStatusId","batchSize":"batchSize","workforceUserIdList":"workforceUserIdList","batchNumber":"batchNumber"},"nodeType":"QUERY","filter":"filter","name":"fetchWorkforceData","links":{"workforce":"User","ZStatus":"workforce"},"outputVarMap":{"data":"workforceData","count":"totalWorkforceCount","batchNumber":"workforceBatchNumber"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"}}