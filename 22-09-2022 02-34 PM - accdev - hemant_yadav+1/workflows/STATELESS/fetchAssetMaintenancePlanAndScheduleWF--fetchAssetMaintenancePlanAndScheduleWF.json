{"processFinalResultSet":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"processFinalResultSet","description":"processFinalResultSet","processRule":"{ contextVar.assetMaintenancePlanData.forEach(plan => { contextVar.contractData.forEach(contract =>{ if (contract.assetMaintenancePlanId === plan.assetMaintenancePlanId) { plan.contractId=contract.contractId; plan.contractNumber=contract.contractNumber; plan.contractEndDate=contract.contractEndDate;plan.calendarName=contract.calendarName;  } }); plan.assetMaintenancePlanSiteData = contextVar.assetMaintenancePlanSiteData.reduce((result, siteData) => { if (siteData.assetMaintenancePlanId === plan.assetMaintenancePlanId) { result.push(siteData) } return result }, []); plan.assetMaintenancePlanInstalledBaseData = contextVar.assetMaintenancePlanInstalledBaseData.reduce((result, assetData) => { if (assetData.assetMaintenancePlanId === plan.assetMaintenancePlanId) { result.push(assetData) } return result }, []); if (typeof plan.assetMaintenancePlanSiteData !== 'undefined' && plan.assetMaintenancePlanSiteData !== '' && Array.isArray(plan.assetMaintenancePlanSiteData) && plan.assetMaintenancePlanSiteData.length > 0) { plan.assetMaintenancePlanSiteName = plan.assetMaintenancePlanSiteData.map(site => site.siteName).join(','); } plan.assetMaintenanceScheduleData = contextVar.assetMaintenanceScheduleData.reduce((result, scheduleData) => { if (scheduleData.assetMaintenancePlanId === plan.assetMaintenancePlanId) { result.push(scheduleData) } return result }, []); }) }","nodeType":"PROCESS","jsEngine":"es6"},"getContractData":{"filter":"{$assetMaintenancePlanId} IN {@assetMaintenancePlanIds}","models":["assetMaintenancePlan","contract","calendar"],"connectors":[{"exitPortType":"NextStep","nodeId":"getAssetMaintenancePlanSites"}],"columns":{"calendarName":"calendar.name","assetMaintenancePlanId":"assetMaintenancePlan.id","contractId":"assetMaintenancePlan.contractId","contractEndDate":"contract.endDate","contractNumber":"contract.contractNumber"},"name":"getContractData","description":"getContractData","outerJoinOnModel":"assetMaintenancePlan","inputVarMap":{"assetMaintenancePlanIds":"assetMaintenancePlanIds"},"links":{"calendar":"contract","contract":"assetMaintenancePlan"},"outputVarMap":{"data":"contractData"},"nodeType":"QUERY","getCount":true},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processInputData"}],"name":"start","description":"start","id":"start","nodeType":"START"},"areThePlanPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processAssetMaintenancePlanData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"areThePlanPresent","description":"areThePlanPresent","processRule":"(typeof contextVar.assetMaintenancePlanData !== 'undefined' && contextVar.assetMaintenancePlanData !== '' && Array.isArray(contextVar.assetMaintenancePlanData) && contextVar.assetMaintenancePlanData.length > 0)","nodeType":"DECISION"},"getAssetMaintenancePlanSites":{"filter":"filter","models":["assetMaintenancePlanSite","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"getAssetMaintenancePlanAssets"}],"columns":{"assetMaintenancePlanId":"assetMaintenancePlanSite.assetMaintenancePlanId","siteId":"assetMaintenancePlanSite.siteId","siteName":"site.name"},"name":"getAssetMaintenancePlanSites","description":"getAssetMaintenancePlanSites","inputVarMap":{"assetMaintenancePlanIds":"assetMaintenancePlanIds","siteFilter":"filter"},"links":{"assetMaintenancePlanSite":"site"},"outputVarMap":{"data":"assetMaintenancePlanSiteData"},"nodeType":"QUERY"},"getAssetMaintenanceSchedules":{"filter":"{$assetMaintenancePlanId} IN {@assetMaintenancePlanIds}","models":["assetMaintenanceSchedule"],"connectors":[{"exitPortType":"NextStep","nodeId":"processFinalResultSet"}],"columns":{"createWorkOrderDate":"assetMaintenanceSchedule.createWorkOrderDate","assetMaintenancePlanId":"assetMaintenanceSchedule.assetMaintenancePlanId","id":"assetMaintenanceSchedule.id","requestedDate":"assetMaintenanceSchedule.requestedDate","workOrderId":"assetMaintenanceSchedule.workOrderId","deadline":"assetMaintenanceSchedule.deadline"},"name":"getAssetMaintenanceSchedules","description":"getAssetMaintenanceSchedules","orderBy":"createWorkOrderDate","inputVarMap":{"assetMaintenancePlanIds":"assetMaintenancePlanIds"},"outputVarMap":{"data":"assetMaintenanceScheduleData"},"nodeType":"QUERY"},"workflowNodes":["start","processInputData","fetchAssetMaintenancePlan","areThePlanPresent","processAssetMaintenancePlanData","getContractData","getAssetMaintenancePlanAssets","getAssetMaintenancePlanSites","getAssetMaintenanceSchedules","processFinalResultSet","end"],"processInputData":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchAssetMaintenancePlan"}],"contextChangePermitted":true,"name":"processInputData","description":"processInputData","processRule":"{ if (typeof contextVar === 'undefined' || typeof contextVar.batchNumber === 'undefined' || contextVar.batchNumber === '') { contextVar.batchNumber = 1; } else { contextVar.batchNumber = contextVar.batchNumber; } if (typeof contextVar === 'undefined' || typeof contextVar.batchSize === 'undefined' || contextVar.batchSize === '') { contextVar.batchSize = 50; } else { contextVar.batchSize = contextVar.batchSize; } if (typeof contextVar === 'undefined' || typeof contextVar.orderBy === 'undefined' || contextVar.orderBy === '') { contextVar.orderBy = 'modifiedDate DESC'; } else { contextVar.orderBy = contextVar.orderBy; } contextVar.searchKey = ''; if (typeof contextVar === 'undefined' || typeof contextVar.filter === 'undefined' || contextVar.filter === '') { contextVar.filter = ''; } else { contextVar.searchKey = contextVar.filter.split('%')[1]; if (contextVar.filter.indexOf('{$assetMaintenancePlanFrequencyValueUnit}') >= 0) { contextVar.filter = contextVar.filter.replace('{$assetMaintenancePlanFrequencyValueUnit}', \"CONCAT({$assetMaintenancePlan.frequencyValue},' ',{$assetMaintenancePlan.frequencyUnit})\"); } if (contextVar.filter.indexOf('{$siteName}') >= 0) { contextVar.filter = contextVar.filter.replace('{$siteName}', '{$site.name}'); } }  if (typeof contextVar.contractId !== 'undefined' && contextVar.contractId !== '') { contextVar.filter = contextVar.filter + ' and ({$assetMaintenancePlan.contractId} = {@contractId})'; } }","nodeType":"PROCESS"},"workflowContext":{},"getAssetMaintenancePlanAssets":{"filter":"{$assetMaintenancePlanId} IN {@assetMaintenancePlanIds}","models":["assetMaintenancePlanInstalledBase","installedBase","catalog"],"connectors":[{"exitPortType":"NextStep","nodeId":"getAssetMaintenanceSchedules"}],"columns":{"catalogName":"catalog.name","assetMaintenancePlanId":"assetMaintenancePlanInstalledBase.assetMaintenancePlanId","installedBaseId":"assetMaintenancePlanInstalledBase.installedBaseId"},"name":"getAssetMaintenancePlanAssets","description":"getAssetMaintenancePlanAssets","inputVarMap":{"assetMaintenancePlanIds":"assetMaintenancePlanIds"},"links":{"installedBase":"catalog","assetMaintenancePlanInstalledBase":"installedBase"},"outputVarMap":{"data":"assetMaintenancePlanInstalledBaseData"},"nodeType":"QUERY"},"end":{"name":"end","description":"end","inputVarMap":{"assetMaintenancePlanData":"assetMaintenancePlanData","count":"count"},"outputVarMap":{"assetMaintenancePlanData":"assetMaintenancePlanData","count":"count"},"id":"end","nodeType":"END"},"fetchAssetMaintenancePlan":{"models":["assetMaintenancePlan","assetMaintenancePlanSite","customer","taskType","ZStatus","workOrderTemplateV2","site"],"connectors":[{"exitPortType":"NextStep","nodeId":"areThePlanPresent"}],"columns":{"workOrderTemplateId":"assetMaintenancePlan.workOrderTemplateId","lastMaintenanceDate":"assetMaintenancePlan.lastMaintenanceDate","frequencyUnit":"assetMaintenancePlan.frequencyUnit","assetMaintenancePlanModifiedDate":"assetMaintenancePlan.modifiedDate","statusTargetModel":"assetMaintenancePlan.statusTargetModel","slaId":"assetMaintenancePlan.slaId","endDate":"assetMaintenancePlan.endDate","firstMaintenanceDate":"assetMaintenancePlan.firstMaintenanceDate","companyName":"customer.companyName","description":"assetMaintenancePlan.description","frequencyValue":"assetMaintenancePlan.frequencyValue","taskTypeName":"taskType.name","statusNameColor":"ZStatus.colorCode","taskTypeId":"assetMaintenancePlan.taskTypeId","statusId":"assetMaintenancePlan.statusId","assetMaintenancePlanId":"assetMaintenancePlan.id","workOrderTemplateV2Name":"workOrderTemplateV2.name","calendarId":"assetMaintenancePlan.calendarId","statusName":"ZStatus.name","customerId":"assetMaintenancePlan.customerId","daysInAdvance":"assetMaintenancePlan.daysInAdvance","frequencyValueUnit":"CONCAT({$assetMaintenancePlan.frequencyValue},' ',{$assetMaintenancePlan.frequencyUnit})","assetMaintenancePlanName":"assetMaintenancePlan.name"},"description":"Fetch Task Details","distinct":true,"orderBy":"assetMaintenancePlanModifiedDate desc","inputVarMap":{"filter":"filter","contractId":"contractId","siteIds":"siteIds","batchSize":"batchSize","batchNumber":"batchNumber"},"nodeType":"QUERY","filter":"filter","name":"fetchAssetMaintenancePlan","links":{"workOrderTemplateV2":"assetMaintenancePlan","taskType":"assetMaintenancePlan","assetMaintenancePlanSite":"site","customer":"assetMaintenancePlan","ZStatus":"assetMaintenancePlan","assetMaintenancePlan":"assetMaintenancePlanSite"},"id":"fetchAssetMaintenancePlan","outputVarMap":{"data":"assetMaintenancePlanData","count":"count"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"},"processAssetMaintenancePlanData":{"connectors":[{"exitPortType":"NextStep","nodeId":"getContractData"}],"contextChangePermitted":true,"name":"processAssetMaintenancePlanData","description":"processAssetMaintenancePlanData","processRule":"{contextVar.assetMaintenancePlanIds= contextVar.assetMaintenancePlanData.map(plan => plan.assetMaintenancePlanId);}","nodeType":"PROCESS","jsEngine":"es6"}}