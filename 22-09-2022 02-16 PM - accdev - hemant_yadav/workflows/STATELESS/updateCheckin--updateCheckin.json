{"querySiteRequestId":{"filter":"{$name}='Site Change Request'","models":["taskType"],"connectors":[{"exitPortType":"NextStep","nodeId":"queryTaskDetails"}],"columns":{"name":"name","id":"id"},"name":"querySiteRequestId","description":"Provide some description for your query","id":"querySiteRequestId","outputVarMap":{"data":"siteChangeIdData"},"nodeType":"QUERY"},"updateTaskStatus":{"modelName":"workOrderTask","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"name":"updateTaskStatus","description":"Update Task status","inputVarMap":{"actualStartTime":"actualStartTime","inProgress":"statusId","workOrderTaskId":"id","eventType":"eventType","endTravelDate":"endTravelDate"},"id":"updateTaskStatus","outputVarMap":{"data":"statusUpdated"},"nodeType":"MODEL","operation":2},"logger":{"connectors":[{"exitPortType":"NextStep","nodeId":"parentPageContextToContextVarConversion"}],"name":"logger","description":"Provide some description for your logger node","inputVarMap":{"logLevel":"logLevel","message":"message"},"id":"logger","nodeType":"LOGGER"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"parentPageContextToContextVarConversion"}],"name":"start","description":"start","id":"start","nodeType":"START"},"isCrewMember":{"connectors":[{"exitPortType":"TrueStep","nodeId":"end"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isCrewMember","description":"isCrewMember","processRule":"(typeof contextVar.crewMobileAccess !='undefined' && contextVar.crewMobileAccess != '' && contextVar.crewMobileAccess=='partialAccess') && (typeof contextVar.leadUserId !='undefined' && contextVar.leadUserId != '' && contextVar.leadUserId!=contextVar.assignedToUserId)","id":"isCrewMember","nodeType":"DECISION"},"callCrewCheckOutWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"isSiteChangeNeeded"}],"processId":"mdtNewPostProcessingWF","name":"callCrewCheckOutWF","description":"call the crew checkout wf to update the crew attedance","inputVarMap":{},"id":"callCrewCheckOutWF","outputVarMap":{},"nodeType":"WORKFLOW"},"workflowNodes":["start","processData1","logger","parentPageContextToContextVarConversion","nullCheck","querySiteRequestId","queryTaskDetails","processData","callCrewCheckOutWF","isSiteChangeNeeded","createSiteChangeTask","insertToSiteLog","isCrewMember","updateTaskStatus","end"],"createSiteChangeTask":{"modelName":"workOrderTask","connectors":[{"exitPortType":"NextStep","nodeId":"insertToSiteLog"}],"name":"createSiteChangeTask","description":"Site change task","inputVarMap":{"siteChangeStatus":"statusId","assignedToUserId":"assignedToUserId","statusTargetModel":"statusTargetModel","checkInTime":"actualStartTime","siteId":"siteId","siteChangeRequest":"taskTypeId","workOrderId":"workOrderId","estimatedDuration":"estimatedDuration"},"id":"createSiteChangeTask","outputVarMap":{"data":"siteChangeTask","id":"siteChangeId"},"nodeType":"MODEL","operation":1},"processData1":{"connectors":[{"exitPortType":"NextStep","nodeId":"logger"}],"contextChangePermitted":true,"name":"processData1","description":"Processing site data and task details","processRule":"contextVar.logLevel = 'INFO'; contextVar.message='contextVar for UpdatecheckIn = '+ JSON.stringify(contextVar);","id":"processData1","nodeType":"PROCESS"},"queryTaskDetails":{"filter":"{$id} = {@workOrderTaskId}","models":["workOrderTask"],"connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"columns":{"actualStartTime":"actualStartTime","id":"id"},"name":"queryTaskDetails","description":"Provide some description for your query","inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"id":"queryTaskDetails","outputVarMap":{"data":"dataOfTask"},"nodeType":"QUERY"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"callCrewCheckOutWF"}],"contextChangePermitted":true,"name":"processData","description":"Processing site data and task details","processRule":"{ contextVar.workOrderTaskStatusId = contextVar.workOrderTaskStatusId ? contextVar.workOrderTaskStatusId : 'workOrderTaskInProgress'; if (contextVar.newSiteAddress) { contextVar.newSiteLat = contextVar.newSiteAddress.latitude; contextVar.newSiteLng = contextVar.newSiteAddress.longitude; contextVar.newSiteAddressText = contextVar.newSiteAddress.address; } contextVar.checkInTime = contextVar.checkInTime ? contextVar.checkInTime : contextVar.endTravelDate; if (contextVar.dataOfTask && Array.isArray(contextVar.dataOfTask) && contextVar.dataOfTask.length > 0 && typeof contextVar.dataOfTask[0].actualStartTime !== 'undefined' && contextVar.dataOfTask[0].actualStartTime !== '') { contextVar.actualStartTime = contextVar.dataOfTask[0].actualStartTime; } else { contextVar.actualStartTime = contextVar.checkInTime ? contextVar.checkInTime : contextVar.endTravelDate ? contextVar.endTravelDate : new Date().toISOString().replace('T', ' ').replace('Z', ''); } contextVar.submitType =  'checkIn';}","id":"processData","nodeType":"PROCESS"},"workflowContext":{"siteChangeStatus":"workOrderTaskSiteChangeRequest","pendingReviewStatus":"workOrderTaskPendingReview","inProgress":"workOrderTaskInProgress","statusTargetModel":"workOrderTask","submitType":"checkIn","siteChangeRequest":"siteChangeRequest","eventType":"workOrderTaskInProgress","keyList":["reasonOfwrongSite","newLocationPhoto","endTravelDate","checkInTime","incorrectSiteComments","endTravelLocationCoordinates","crewAttendanceDetailsDataGrid"],"estimatedDuration":"-"},"parentPageContextToContextVarConversion":{"connectors":[{"exitPortType":"NextStep","nodeId":"nullCheck"}],"processId":"parentPageContextToContextVarConversion","name":"parentPageContextToContextVarConversion","description":"","inputVarMap":{},"id":"parentPageContextToContextVarConversion","outputVarMap":{},"nodeType":"WORKFLOW"},"end":{"name":"End","description":"end","inputVarMap":{},"outputVarMap":{},"id":"end","nodeType":"END"},"isSiteChangeNeeded":{"connectors":[{"exitPortType":"TrueStep","nodeId":"createSiteChangeTask"},{"exitPortType":"FalseStep","nodeId":"isCrewMember"}],"name":"isSiteChangeNeeded","description":"Is site change needed","processRule":"(typeof contextVar.incorrectAddress!=='undefined' && contextVar.incorrectAddress=='true')","id":"isSiteChangeNeeded","nodeType":"DECISION"},"nullCheck":{"connectors":[{"exitPortType":"TrueStep","nodeId":"querySiteRequestId"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"nullCheck","description":"Is site change needed","processRule":"(typeof contextVar.workOrderTaskId!='undefined' && contextVar.workOrderTaskId!='')","id":"nullCheck","nodeType":"DECISION"},"insertToSiteLog":{"modelName":"siteChangeLog","connectors":[{"exitPortType":"NextStep","nodeId":"isCrewMember"}],"name":"insertToSiteLog","description":"Insert data to site log","inputVarMap":{"newSiteLng":"longitude","newSiteLat":"latitude","workOrderTaskId":"originalTaskId","incorrectSiteComments":"notes","newLocationPhoto":"photoUrl","reasonOfwrongSite":"reason","newSiteAddressText":"address","siteChangeId":"workOrderTaskId"},"id":"insertToSiteLog","outputVarMap":{"data":"siteChangeLogData"},"multiRecord":false,"nodeType":"MODEL","operation":1}}