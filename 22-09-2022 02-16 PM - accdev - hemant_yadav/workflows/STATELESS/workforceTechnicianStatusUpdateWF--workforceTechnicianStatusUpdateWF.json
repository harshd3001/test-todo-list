{"callAutoCheckOutCrewMembersWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfTechsToBeCheckedOut"}],"processId":"autoCheckOutCrewMembersWF","name":"callAutoCheckOutCrewMembersWF","description":"callAutoCheckOutCrewMembersWF","inputVarMap":{"checkOutTime":"checkOutTime","userId":"userId"},"outputVarMap":{},"nodeType":"WORKFLOW"},"checkIfAnyTechnicianToBeUpdated":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processUserData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkIfAnyTechnicianToBeUpdated","description":"Checked if the queryWorkforceData has user","processRule":"(contextVar.queryWorkforceData.length > 0)","nodeType":"DECISION"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"queryWorkforceModel"}],"name":"start","description":"Start","nodeType":"START"},"processUserData":{"connectors":[{"exitPortType":"NextStep","nodeId":"publishEventForWorkforce"}],"contextChangePermitted":true,"name":"processUserData","description":"process query User Data","processRule":"{ for (var index in contextVar.queryWorkforceData) { contextVar.workforceObj.push({ 'statusId': 'workforceDeactivated', 'userId': contextVar.queryWorkforceData[index].userId }); contextVar.checkOutCrewMemberObj.push({ 'checkOutTime': contextVar.queryWorkforceData[index].userModifiedDate, 'userId': contextVar.queryWorkforceData[index].userId }); contextVar.deactivatedUserIds.push(contextVar.queryWorkforceData[index].userId); } contextVar.checkOutCrewMemberObjLength = contextVar.checkOutCrewMemberObj.length; }","nodeType":"PROCESS"},"checkIfAnyCrewToBeUpdated":{"connectors":[{"exitPortType":"TrueStep","nodeId":"updateCrewModel"},{"exitPortType":"FalseStep","nodeId":"updateWorkforceCrewModel"}],"name":"checkIfAnyCrewToBeUpdated","description":"Checked if the crewData has any record","processRule":"(contextVar.jsonCrewObj.length > 0)","nodeType":"DECISION"},"setMemberToAutoCheckout":{"connectors":[{"exitPortType":"NextStep","nodeId":"callAutoCheckOutCrewMembersWF"}],"contextChangePermitted":true,"name":"setMemberToAutoCheckout","description":"process query crew Data","processRule":"{ if(typeof contextVar.checkOutCrewMemberObj!=='undefined' && contextVar.checkOutCrewMemberObj.length>0){ contextVar.checkOutTime=contextVar.checkOutCrewMemberObj[contextVar.currentCheckOutCrewMemberObj].checkOutTime; contextVar.userId=contextVar.checkOutCrewMemberObj[contextVar.currentCheckOutCrewMemberObj].userId; } contextVar.currentCheckOutCrewMemberObj++; }","nodeType":"PROCESS"},"queryWorkforceModel":{"filter":"{$User.status} = 'Deactivated' AND {$statusId} = 'workforceActive'","models":["workforce","User"],"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfAnyTechnicianToBeUpdated"}],"columns":{"statusId":"workforce.statusId","userId":"User.id","userModifiedDate":"User.modifiedDate"},"name":"queryWorkforceModel","distinct":true,"description":"queryWorkforceModel","inputVarMap":{},"outputVarMap":{"data":"queryWorkforceData"},"nodeType":"QUERY"},"workflowNodes":["start","queryWorkforceModel","checkIfAnyTechnicianToBeUpdated","processUserData","publishEventForWorkforce","queryCrewData","checkIfCrewDataIsPresent","processCrewsData","checkIfAnyCrewToBeUpdated","updateCrewModel","updateWorkforceCrewModel","setMemberToAutoCheckout","callAutoCheckOutCrewMembersWF","checkIfTechsToBeCheckedOut","end"],"updateCrewModel":{"modelName":"crew","connectors":[{"exitPortType":"NextStep","nodeId":"updateWorkforceCrewModel"}],"multirecord":true,"name":"updateCrewModel","description":"updateCrewModel","inputVarMap":{"jsonCrewObj":"data"},"nodeType":"MODEL","operation":2},"workflowContext":{"checkOutCrewMemberObjLength":0,"currentCheckOutCrewMemberObj":0,"jsonCrewObj":[],"jsonWorkforceCrewObj":[],"workforceSubAction":"deactivateTechnician","deactivatedUserIds":[],"checkOutCrewMemberObj":[],"workforceObj":[]},"checkIfCrewDataIsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"processCrewsData"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkIfCrewDataIsPresent","description":"Checked if the crewData has any record","processRule":"(contextVar.crewData.length > 0)","nodeType":"DECISION"},"checkIfTechsToBeCheckedOut":{"connectors":[{"exitPortType":"TrueStep","nodeId":"setMemberToAutoCheckout"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"checkIfTechsToBeCheckedOut","description":"Checked if the crewData has any record","processRule":"(contextVar.currentCheckOutCrewMemberObj < contextVar.checkOutCrewMemberObjLength)","nodeType":"DECISION"},"publishEventForWorkforce":{"eventId":"workforceTechnicianProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"queryCrewData"}],"contextChangePermitted":true,"name":"publishEventForWorkforce","description":"publishEventForWorkforce","inputVarMap":{"workforceSubAction":"subAction","workforceObj":"workforce"},"outputVarMap":{},"nodeType":"PUBLISH","captureOutput":true},"queryCrewData":{"filter":"({$workforceUserId} IN {@deactivatedUserIds}) AND {$statusId}!='crewDeactivated'","models":["crew","workforceCrew"],"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfCrewDataIsPresent"}],"columns":{"isLead":"IF({$crew.leadUserId} = {$workforceCrew.workforceUserId},'true','false')","statusId":"crew.statusId","name":"crew.name","crewId":"crew.id","workforceUserId":"workforceCrew.workforceUserId"},"name":"queryCrewData","distinct":true,"description":"queryCrewData","links":{"workforceCrew":"crew"},"inputVarMap":{"deactivatedUserIds":"deactivatedUserIds"},"outputVarMap":{"data":"crewData"},"nodeType":"QUERY","getCount":true},"end":{"name":"end","description":"end","nodeType":"END"},"processCrewsData":{"connectors":[{"exitPortType":"NextStep","nodeId":"checkIfAnyCrewToBeUpdated"}],"contextChangePermitted":true,"name":"processCrewsData","description":"process query crew Data","processRule":"{ var crewObj, crewMemberObject; if (typeof contextVar.crewData !== 'undefined' && contextVar.crewData.length > 0) { contextVar.crewData.forEach(function (element) { if (element.isLead === 'true') { crewObj = {}; crewObj['statusId'] = 'crewDraft'; crewObj['leadUserId'] = ''; crewObj['id'] = element.crewId; contextVar.jsonCrewObj.push(crewObj); } crewMemberObject = {}; crewMemberObject['statusId'] = 'workforceCrewDeactivated'; crewMemberObject['workforceUserId'] = element.workforceUserId; crewMemberObject['crewId'] = element.crewId; contextVar.jsonWorkforceCrewObj.push(crewMemberObject); }); } }","nodeType":"PROCESS"},"updateWorkforceCrewModel":{"modelName":"workforceCrew","connectors":[{"exitPortType":"NextStep","nodeId":"checkIfTechsToBeCheckedOut"}],"multirecord":true,"name":"updateWorkforceCrewModel","description":"updateWorkforceCrewModel","inputVarMap":{"jsonWorkforceCrewObj":"data"},"nodeType":"MODEL","operation":2}}