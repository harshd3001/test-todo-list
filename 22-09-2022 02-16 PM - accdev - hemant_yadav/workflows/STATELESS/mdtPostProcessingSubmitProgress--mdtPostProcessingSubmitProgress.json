{"processInstanceId":{"connectors":[{"exitPortType":"NextStep","nodeId":"updateDecision"}],"contextChangePermitted":true,"name":"processInstanceId","description":"processInstanceId","processRule":"{ if (typeof contextVar.zProcessInstanceData1 !== 'undefined' && contextVar.zProcessInstanceData1 !== '') { contextVar.zProcessInstanceId = contextVar.zProcessInstanceData1[0].zProcessInstanceId; } contextVar.updateLeadOrSingleTech = 'NA'; if(typeof contextVar.crewMobileAccess !== 'undefined' && contextVar.crewMobileAccess !== ''){ if(contextVar.crewMobileAccess == 'noAccess'){ contextVar.updateLeadOrSingleTech  = true; } if(contextVar.crewMobileAccess == 'partialAccess'){ if(Array.isArray(contextVar.leadDetails)){ contextVar.lead = contextVar.leadDetails[0].leadUserId; }else{ contextVar.lead = contextVar.leadUserId; } if(contextVar.lead == contextVar['assignedToUserId']){ contextVar.updateLeadOrSingleTech  = true; }else{ contextVar.updateLeadOrSingleTech  = false; } } }else{ contextVar.updateLeadOrSingleTech  = true; } }","nodeType":"PROCESS"},"createInstance":{"connectors":[{"exitPortType":"NextStep","nodeId":"getInstanceId"}],"name":"createInstance","description":"createInstance","inputVarMap":{"submitProgressComments":"submitProgressComments","userData":"userData","workforceCrewStatusId":"workforceCrewStatusId","crewAttendanceDetailsList":"crewAttendanceDetailsList","endDate":"endDate","taskDescription":"taskDescription","crewMobileAccess":"crewMobileAccess","workOrderTaskAssignedToCrewId":"workOrderTaskAssignedToCrewId","leadUserId":"leadUserId","webTask":"webTask","correctiveTaskRequestReasons":"correctiveTaskRequestReasons","scheduleBreakDown":"scheduleBreakDown","taskLogData":"taskLogData","workOrderTaskOpen":"workOrderTaskOpen","workOrderCompleted":"workOrderCompleted","workOrderInProgress":"workOrderInProgress","workOrderTaskDraft":"workOrderTaskDraft","recordInitialEvidenceLocationCoordinates":"recordInitialEvidenceLocationCoordinates","cancellationNotes":"cancellationNotes","assignUserId":"assignUserId","mobileProcessId":"processId","leadDetails":"leadDetails","customerName":"customerName","crewTask":"crewTask","servicesDataGrid":"servicesDataGrid","statusId":"statusId","workOrderOpen":"workOrderOpen","assetsList":"assetsList","assignee":"assignee","taskProgress":"taskProgress","workOrderTaskTaskTypeId":"workOrderTaskTaskTypeId","submitType":"submitType","breakDownData":"breakDownData","latitude":"latitude","taskData":"taskData","siteName":"siteName","additionalMaterialsDataGrid":"additionalMaterialsDataGrid","checkInIncidentReasonsListOptions":"checkInIncidentReasonsListOptions","notCheckedInTravelStatus":"{%notCheckedIn}","taskDetail":"taskDetail","submitServicesLocationCoordinates":"submitServicesLocationCoordinates","workOrderTaskDispatched":"workOrderTaskDispatched","workOrderTaskEstimatedDuration":"workOrderTaskEstimatedDuration","userEmail":"userEmail","fetchActivityIncidentListOptions":"fetchActivityIncidentListOptions","workOrderTaskReOpenCount":"workOrderTaskReOpenCount","assignedToUserId":"assignedToUserId","address":"address","incorrectAddress":"incorrectAddress","cancellationReason":"cancellationReason","taskPriority":"taskPriority","services":"services","userId":"assignedToUserId","fetchReportIssue":"fetchReportIssue","workOrderScheduled":"workOrderScheduled","initialEvidenceDataGrid":"initialEvidenceDataGrid","workOrderTaskSiteChangeRequest":"workOrderTaskSiteChangeRequest","workOrderTaskInTransit":"workOrderTaskInTransit","travelStatus":"travelStatus","recordSubmitServicesTime":"recordSubmitServicesTime","workOrderTaskIncident":"workOrderTaskIncident","workOrderTaskScheduledDate":"{@plannedStartTime}","contactPhone":"contactPhone","dueDate":"dueDate","incidentType":"incidentType","userPhoneNumber":"userPhoneNumber","workOrderData":"workOrderData","custData":"custData","pendingReviewStatus":"workOrderTaskPendingReview","workOrderTaskPendingReview":"workOrderTaskPendingReview","fullTaskScheduleGridData":"fullTaskScheduleGridData","partialAccess":"partialAccess","workOrderTaskId":"workOrderTaskId","checkOutCheckBoxForSubmitCapturedTime":"checkOutCheckBoxForSubmitCapturedTime","checkOutCheckBoxForSubmit":"checkOutCheckBoxForSubmit","currentUserDetail":"currentUserDetail","userStatusFilter":"userStatusFilter","longitude":"longitude","recordInitialEvidenceTime":"recordInitialEvidenceTime","workOrder":"workOrder","workOrderTaskApproved":"workOrderTaskApproved","initialComments":"initialComments","catalogList":"catalogList","workOrderTaskPendingApproval":"workOrderTaskPendingApproval","workOrderTaskDiscontinued":"workOrderTaskDiscontinued","modesOfTransport":"modesOfTransport","workOrderTaskRejected":"workOrderTaskRejected","isCrewTask":"isCrewTask","enableServices":"enableServices","workOrderTaskDelayed":"workOrderTaskDelayed","name":"name","newLocationPhoto":"newLocationPhoto","workOrderId":"workOrderId","workOrderTaskScheduled":"workOrderTaskScheduled","submitProgressEvidenceDataGrid":"submitProgressEvidenceDataGrid","viewTravelStatus":"viewTravelStatus","workOrderTaskInProgress":"workOrderTaskInProgress","submitTypeListOptions":"submitTypeListOptions","fetchTransportModes":"fetchTransportModes","crewMemberSubmitTypeListOptions":"crewMemberSubmitTypeListOptions","siteChangeReq":"siteChangeReq","workOrderTaskCompleted":"workOrderTaskCompleted","timezone":"timezone","dateArray":"dateArray","travelIncidentReasonsListOptions":"travelIncidentReasonsListOptions","scheduledDate":"scheduledDate","taskTypeName":"taskTypeName","taskType":"taskType","reasonOfwrongSite":"reasonOfwrongSite","workOrderTaskCancelled":"workOrderTaskCancelled","checkOutCheckBoxForSubmitLocationCoordinates":"checkOutCheckBoxForSubmitLocationCoordinates","workOrderDraft":"workOrderDraft","workOrderTaskAssignedToUserId":"workOrderTaskAssignedToUserId","estimatedTaskDuration":"estimatedTaskDuration","taskTypeData":"taskTypeData","userName":"userName","autoCheckoutReqd":"autoCheckoutReqd","workOrderPendingReview":"workOrderPendingReview","serviceList":"serviceList","siteId":"siteId","incorrectSiteComments":"incorrectSiteComments","fetchSuggestedMaterials":"fetchSuggestedMaterials","crewAttendanceDetailsDataGrid":"crewAttendanceDetailsDataGrid","taskDetailBackwardCompatibility":"taskDetailBackwardCompatibility","timeTakenForTask":"{@estimatedDurationInHours}","taskId":"taskId","workOrderTaskData":"workOrderTaskData"},"outputVarMap":{"zProcessInstanceId":"zProcessInstanceId"},"execType":"fork","nodeType":"WORKFLOW"},"getInstanceId":{"filter":"{$ZProcessInstance.mainTitle} = {@workOrderTaskId} AND {$ZProcessInstance.assignedToUserId} = {@userId}","models":["ZProcessInstance"],"connectors":[{"exitPortType":"NextStep","nodeId":"processInstanceId"}],"columns":{"createdDate":"ZProcessInstance.createdDate","zProcessInstanceId":"ZProcessInstance.id"},"name":"getInstanceId","description":"getInstanceId","orderBy":"createdDate DESC","inputVarMap":{"assignedToUserId":"userId","workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"zProcessInstanceData1"},"batchSize":"1","nodeType":"QUERY"},"updateTaskInstance":{"eventId":"zprocessInstanceWorkOrderTaskProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"mdtEndOfPostProcessingEvent"}],"name":"updateTaskInstance","description":"updateTaskInstance","inputVarMap":{},"id":"updateTaskInstance","outputVarMap":{},"nodeType":"PUBLISH","captureOutput":false},"setResumeKey":{"connectors":[{"exitPortType":"NextStep","nodeId":"deleteProcessInstanceDecision"}],"contextChangePermitted":true,"name":"setResumeKey","description":"setResumeKey","processRule":"{if(typeof contextVar.zProcessInstanceData !== 'undefined' && contextVar.zProcessInstanceData !== ''){contextVar.resumeKey=contextVar.zProcessInstanceData[0].resumeKey;contextVar.instanceId=contextVar.zProcessInstanceData[0].id;}}","nodeType":"PROCESS"},"deleteProcessInstanceDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"deleteInstance"},{"exitPortType":"FalseStep","nodeId":"createInstance"}],"name":"deleteProcessInstanceDecision","description":"deleteProcessInstanceDecision","processRule":"(typeof contextVar.resumeKey !== 'undefined' && contextVar.resumeKey !== '' && typeof contextVar.instanceId !== 'undefined' && contextVar.instanceId !== '')","nodeType":"DECISION"},"statusUpdateForSubmitPage":{"connectors":[{"exitPortType":"NextStep","nodeId":"isSubmitProgress"}],"processId":"mdtStatusUpdateForSubmitPage","name":"statusUpdateForSubmitPage","description":"submitAndEndTask","inputVarMap":{},"id":"statusUpdateForSubmitPage","outputVarMap":{},"nodeType":"WORKFLOW"},"mdtEndOfPostProcessingEvent":{"eventId":"mdtEndOfPostProcessingEvent","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"name":"mdtEndOfPostProcessingEvent","description":"mdtEndOfPostProcessingEvent","inputVarMap":{"assignedToUserId":"assignedToUserId","submitTaskTime":"submitTaskTime","submitType":"submitType","crewMobileAccess":"crewMobileAccess","mobileProcessId":"mobileProcessId","leadDetails":"leadDetails","userId":"userId","leadUserId":"leadUserId","workOrderTaskId":"workOrderTaskId","workOrderTaskScheduledDate":"workOrderTaskScheduledDate","workOrderTaskEstimatedDuration":"workOrderTaskEstimatedDuration","checkOutCheckBoxForSubmitCapturedTime":"checkOutCheckBoxForSubmitCapturedTime","timeTakenForTask":"timeTakenForTask","__sys__loggedIn_UserId":"__sys__loggedIn_UserId"},"id":"mdtEndOfPostProcessingEvent","outputVarMap":{},"nodeType":"PUBLISH","captureOutput":false},"logger":{"connectors":[{"exitPortType":"NextStep","nodeId":"statusUpdateForSubmitPage"}],"name":"logger","description":"Provide some description for your logger node","inputVarMap":{"logLevel":"logLevel","message":"message"},"id":"logger","nodeType":"LOGGER"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"processData"}],"name":"start","description":" Start","id":"start","nodeType":"START"},"workflowNodes":["start","processData","processData1","logger","statusUpdateForSubmitPage","isSubmitProgress","fetchCrewAttendanceDetails","processcrewAttendanceDetailsDataGrid","getResumeKey","setResumeKey","deleteProcessInstanceDecision","deleteInstance","createInstance","getInstanceId","processInstanceId","updateDecision","updateTaskInstance","updatePartialTechInstance","mdtEndOfPostProcessingEvent","end"],"isSubmitProgress":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchCrewAttendanceDetails"},{"exitPortType":"FalseStep","nodeId":"mdtEndOfPostProcessingEvent"}],"name":"isSubmitProgress","description":"isSubmitProgress","processRule":"(typeof contextVar.submitType !='undefined' && contextVar.submitType != '' && (contextVar.submitType=='submitTaskProgress' || contextVar.submitType=='checkOut'))","nodeType":"DECISION"},"mdtEndOfPostProcessingEvent1":{"eventId":"mdtEndOfPostProcessingEvent","connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"mdtEndOfPostProcessingEvent1","description":"mdtEndOfPostProcessingEvent1","inputVarMap":{},"outputVarMap":{},"nodeType":"PUBLISH","captureOutput":true},"updateDecision":{"connectors":[{"exitPortType":"TrueStep","nodeId":"updateTaskInstance"},{"exitPortType":"FalseStep","nodeId":"updatePartialTechInstance"}],"name":"updateDecision","description":"updateDecision","processRule":"(contextVar.updateLeadOrSingleTech)","nodeType":"DECISION"},"fetchCrewAttendanceDetails":{"filter":"{$workOrderTaskId}={@workOrderTaskId} && {$userId}!={$crewLeadUserId}  AND {$crewMemberStatus} = 'workforceCrewOnCrew' ","models":["workOrderTask","crewAttendance","User","workforce","crew","workforceCrew"],"connectors":[{"exitPortType":"NextStep","nodeId":"processcrewAttendanceDetailsDataGrid"}],"columns":{"crewLeadUserId":"crew.leadUserId","crewAttendance":"crewAttendance.attendance","latitude":"User.latitude","crewMemberName":"User.name","crewMemberPhoneNumber":"User.phoneNumber","crewName":"crew.name","assignedToCrewId":"workOrderTask.assignedToCrewId","userId":"User.id","workforceCrewWorkforceUserId":"crewAttendance.workforceUserId","crewMemberEmailId":"User.emailId","workOrderTaskId":"workOrderTask.id","crewId":"crew.id","crewMemberStatus":"workforceCrew.statusId","longitude":"User.longitude"},"name":"fetchCrewAttendanceDetails","description":"fetchCrewAttendanceDetails","distinct":true,"links":{"User":"workforce","crewAttendance":"workOrderTask","workforce":"crewAttendance","crew":"workOrderTask","workforceCrew":"crew"},"inputVarMap":{"workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"crewAttendanceDetailsDataGrid"},"nodeType":"QUERY"},"updatePartialTechInstance":{"connectors":[{"exitPortType":"NextStep","nodeId":"mdtEndOfPostProcessingEvent"}],"processId":"mdtUpdateCrewAttendanceRecord","name":"updatePartialTechInstance","description":"updatePartialTechInstance","inputVarMap":{},"id":"updatePartialTechInstance","outputVarMap":{},"nodeType":"WORKFLOW"},"processData":{"connectors":[{"exitPortType":"NextStep","nodeId":"processData1"}],"contextChangePermitted":true,"name":"processData","description":"Processing site data and task details","processRule":"if (contextVar.submitType == 'submitTaskProgress' || contextVar.submitType == 'checkOut') { if (contextVar.checkOutCheckBoxForSubmit == 'true') { contextVar.checkOutCheckBoxForSubmitCapturedTime = contextVar.checkOutCheckBoxForSubmitCapturedTime; } else { contextVar.checkOutCheckBoxForSubmitCapturedTime = contextVar.checkOutCheckBoxForSubmitCapturedTime ? contextVar.checkOutCheckBoxForSubmitCapturedTime : new Date().toISOString().replace('T', ' ').replace('Z', ''); } } contextVar.backedUpData = {'checkOutCheckBoxForSubmitCapturedTime': contextVar.checkOutCheckBoxForSubmitCapturedTime, 'checkOutCheckBoxForSubmit': contextVar.checkOutCheckBoxForSubmit, 'checkOutCheckBoxForSubmitLocationCoordinates': contextVar.checkOutCheckBoxForSubmitLocationCoordinates};","id":"processData","nodeType":"PROCESS"},"processData1":{"connectors":[{"exitPortType":"NextStep","nodeId":"logger"}],"contextChangePermitted":true,"name":"processData1","description":"Processing site data and task details","processRule":"contextVar.logLevel = 'INFO'; contextVar.message='contextVar PP WF = '+ JSON.stringify(contextVar);","id":"processData1","nodeType":"PROCESS"},"workflowContext":{"travelStatus":"{%checkedOut}","statusId":"workOrderTaskInProgress"},"deleteInstance":{"connectors":[{"exitPortType":"NextStep","nodeId":"createInstance"}],"name":"deleteInstance","description":"deleteInstance","action":"cancel","inputVarMap":{"resumeKey":"resumeKey","instanceId":"instanceId"},"outputVarMap":{},"nodeType":"WORKFLOW"},"processcrewAttendanceDetailsDataGrid":{"connectors":[{"exitPortType":"NextStep","nodeId":"createInstance"}],"contextChangePermitted":true,"name":"processcrewAttendanceDetailsDataGrid","description":"processcrewAttendanceDetailsDataGrid","processRule":"if (typeof contextVar.crewAttendanceDetailsDataGrid !== 'undefined' && Array.isArray(contextVar.crewAttendanceDetailsDataGrid)) { for (var i = 0; i < contextVar.crewAttendanceDetailsDataGrid.length; i++) { if(typeof contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance !== 'undefined' && Array.isArray(contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance) && contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance.length > 0){ var cAtt = contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance; if(contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance.crewId!=contextVar.crewAttendanceDetailsDataGrid[i].crewId){i++;contextVar.crewAttendanceDetailsDataGrid[i]['attendanceCheckIn'] = contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance[cAtt.length - 1].checkInTime; contextVar.crewAttendanceDetailsDataGrid[i]['attendanceCheckOut'] = contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance[cAtt.length - 1].checkOutTime;}else{contextVar.crewAttendanceDetailsDataGrid[i]['attendanceCheckIn'] = contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance[cAtt.length - 1].checkInTime; contextVar.crewAttendanceDetailsDataGrid[i]['attendanceCheckOut'] = contextVar.crewAttendanceDetailsDataGrid[i].crewAttendance[cAtt.length - 1].checkOutTime;}  } } } contextVar.viewTravelStatus = contextVar.viewTravelStatus || true;","id":"processcrewAttendanceDetailsDataGrid","nodeType":"PROCESS"},"end":{"name":"end","description":"end","inputVarMap":{},"outputVarMap":{},"nodeType":"END"},"getResumeKey":{"filter":"{$ZProcessInstance.mainTitle} = {@taskId} AND {$ZProcessInstance.assignedToUserId} = {@userId}","models":["ZProcessInstance"],"connectors":[{"exitPortType":"NextStep","nodeId":"setResumeKey"}],"columns":{"resumeKey":"ZProcessInstance.resumeKey","id":"ZProcessInstance.id"},"name":"getResumeKey","description":"getResumeKey","inputVarMap":{"assignedToUserId":"userId","workOrderTaskId":"taskId"},"outputVarMap":{"data":"zProcessInstanceData"},"nodeType":"QUERY"}}