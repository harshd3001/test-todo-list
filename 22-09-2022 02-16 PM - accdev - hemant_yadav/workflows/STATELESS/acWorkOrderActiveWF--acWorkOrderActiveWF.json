{"addSubActionForWorkOrderTask":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertWorkOrderTask"}],"contextChangePermitted":true,"name":"addSubActionForWorkOrderTask","description":"addSubActionForWorkOrderTask","processRule":"if (contextVar.subAction === 'cancelWorkOrder') { contextVar.workOrderTaskSubAction = 'cancelWorkOrderTask'; contextVar.workOrderTaskCancellationReason = contextVar.workOrder[0].cancellationReason; contextVar.workOrderTaskCancellationNotes = contextVar.workOrder[0].cancellationNotes; } else if (contextVar.subAction === 'deleteWorkOrder') { contextVar.workOrderTaskSubAction = ''; } else if (contextVar.subAction === 'duplicateWorkOrder') { contextVar.workOrderTaskSubAction = 'duplicateWorkOrder'; } else if (contextVar.subAction === 'upsertWorkOrder' && typeof contextVar.workOrderTemplateId !== 'undefined' && contextVar.workOrderTemplateId !== '') { contextVar.workOrderTaskSubAction = 'upsertWorkOrder'; }","nodeType":"PROCESS"},"fetchWorkOrderDetails":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertWorkOrder"}],"processId":"acProcessWorkOrderForDuplicationWF","name":"fetchWorkOrderDetails","description":"fetch work Order Details of given Work Order","inputVarMap":{},"outputVarMap":{},"nodeType":"WORKFLOW"},"upsertWorkOrderTask":{"connectors":[{"exitPortType":"NextStep","nodeId":"fetchWorkOrderTemplateInventoryData"}],"processId":"QIFGIU7FDJ","name":"upsertWorkOrderTask","description":"upsert workOrder Task","inputVarMap":{"workOrderTaskSubAction":"subAction"},"outputVarMap":{"data":"upsertWorkOrderTaskResponseData"},"nodeType":"WORKFLOW"},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"decisionNode"}],"name":"start","description":"Start","nodeType":"START"},"fetchCancellationReason":{"filter":"{$listOptionAnswer.id}= {@id} ","models":["listOptionAnswer"],"connectors":[{"exitPortType":"NextStep","nodeId":"processWorkOrderData"}],"columns":{"listOptionAnswerOptionText":"listOptionAnswer.answerOptionText"},"name":"fetchCancellationReason","description":"fetchCancellationReason","inputVarMap":{"workOrderReason":"id"},"outputVarMap":{"data":"cancellationData"},"nodeType":"QUERY"},"createDatasetForWorkOrderInventoryInsertion":{"connectors":[{"exitPortType":"NextStep","nodeId":"insertWorkOrderInventoryData"}],"contextChangePermitted":true,"name":"createDatasetForWorkOrderInventoryInsertion","description":"createDatasetForWorkOrderInventoryInsertion","processRule":"{contextVar.workOrderInventory = []; var currentIndex = 0; var currentTaskId, previousTemplateTaskId, currentTemplateTaskId = ''; contextVar.workOrderTemplateInventoryData.forEach(function (element) { previousTemplateTaskId = (typeof currentTemplateTaskId != 'undefined') ? currentTemplateTaskId : ''; currentTemplateTaskId = (typeof element.workOrderTemplateInventoryWorkOrderTemplateTaskId != 'undefined') ? element.workOrderTemplateInventoryWorkOrderTemplateTaskId : ''; if (typeof element.workOrderTemplateInventoryWorkOrderTemplateTaskId != 'undefined' && element.workOrderTemplateInventoryWorkOrderTemplateTaskId != '') { if (currentIndex == 0) { contextVar.workOrderInventory.push({ 'id': '', 'workOrderId': contextVar.workOrderId, 'catalogId': element.catalogId, 'estimatedQty': element.workOrderTemplateInventoryEstimatedQty, 'unitPrice': element.catalogUnitPrice, 'customerPrice': element.catalogCustomerPrice, 'workOrderTaskId': (typeof contextVar.upsertWorkOrderTaskResponseData[currentIndex] != 'undefined') ? contextVar.upsertWorkOrderTaskResponseData[currentIndex].id : '' }); currentTaskId = (typeof contextVar.upsertWorkOrderTaskResponseData[currentIndex] != 'undefined') ? contextVar.upsertWorkOrderTaskResponseData[currentIndex].id : ''; currentIndex++; } else { if (previousTemplateTaskId === element.workOrderTemplateInventoryWorkOrderTemplateTaskId) { contextVar.workOrderInventory.push({ 'id': '', 'workOrderId': contextVar.workOrderId, 'catalogId': element.catalogId, 'estimatedQty': element.workOrderTemplateInventoryEstimatedQty, 'unitPrice': element.catalogUnitPrice, 'customerPrice': element.catalogCustomerPrice, 'workOrderTaskId': currentTaskId }); } else { contextVar.workOrderInventory.push({ 'id': '', 'workOrderId': contextVar.workOrderId, 'catalogId': element.catalogId, 'estimatedQty': element.workOrderTemplateInventoryEstimatedQty, 'unitPrice': element.catalogUnitPrice, 'customerPrice': element.catalogCustomerPrice, 'workOrderTaskId': (typeof contextVar.upsertWorkOrderTaskResponseData[currentIndex] != 'undefined') ? contextVar.upsertWorkOrderTaskResponseData[currentIndex].id : '' }); currentTaskId = (typeof contextVar.upsertWorkOrderTaskResponseData[currentIndex] != 'undefined') ? contextVar.upsertWorkOrderTaskResponseData[currentIndex].id : ''; currentIndex++; } } } else { contextVar.workOrderInventory.push({ 'id': '', 'workOrderId': contextVar.workOrderId, 'catalogId': element.catalogId, 'estimatedQty': element.workOrderTemplateInventoryEstimatedQty, 'unitPrice': element.catalogUnitPrice, 'customerPrice': element.catalogCustomerPrice, 'workOrderTaskId': '' }); currentTaskId = (typeof contextVar.upsertWorkOrderTaskResponseData[currentIndex] != 'undefined') ? contextVar.upsertWorkOrderTaskResponseData[currentIndex].id : ''; currentIndex++; } });}","nodeType":"PROCESS","jsEngine":"es6"},"workflowNodes":["start","decisionNode","fetchWorkOrderDetails","fetchCancellationReason","processWorkOrderData","upsertWorkOrder","addSubActionForWorkOrderTask","upsertWorkOrderTask","fetchWorkOrderTemplateInventoryData","isWorkOrderTemplateInventoryDataPresent","createDatasetForWorkOrderInventoryInsertion","insertWorkOrderInventoryData","end"],"fetchWorkOrderTemplateInventoryData":{"filter":"{$workOrderTemplateInventory.workOrderTemplateId}={@workOrderTemplateId}","models":["workOrderTemplateInventory","catalog"],"connectors":[{"exitPortType":"NextStep","nodeId":"isWorkOrderTemplateInventoryDataPresent"}],"columns":{"catalogId":"catalog.id","catalogCustomerPrice":"catalog.customerPrice","workOrderTemplateInventoryEstimatedQty":"workOrderTemplateInventory.estimatedQty","catalogUnitPrice":"catalog.unitPrice","workOrderTemplateInventoryWorkOrderTemplateTaskId":"workOrderTemplateInventory.workOrderTemplateTaskId"},"name":"fetchWorkOrderTemplateInventoryData","description":"fetchWorkOrderTemplateInventoryData","orderBy":"workOrderTemplateInventoryWorkOrderTemplateTaskId DESC","links":{"workOrderTemplateInventory":"catalog"},"inputVarMap":{"workOrderTemplateId":"workOrderTemplateId"},"outputVarMap":{"data":"workOrderTemplateInventoryData"},"nodeType":"QUERY"},"isWorkOrderTemplateInventoryDataPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"createDatasetForWorkOrderInventoryInsertion"},{"exitPortType":"FalseStep","nodeId":"end"}],"name":"isWorkOrderTemplateInventoryDataPresent","description":"isWorkOrderTemplateInventoryDataPresent","processRule":"( Array.isArray(contextVar.workOrderTemplateInventoryData) && contextVar.workOrderTemplateInventoryData.length >0)","nodeType":"DECISION"},"processWorkOrderData":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertWorkOrder"}],"contextChangePermitted":true,"name":"processWorkOrderData","description":"processWorkOrderData","processRule":"if (Array.isArray(contextVar.workOrder) && contextVar.workOrder.length > 0) { contextVar.workOrder[0].cancellationReason = contextVar.cancellationData[0].listOptionAnswerOptionText; }","nodeType":"PROCESS","jsEngine":"es6"},"decisionNode":{"connectors":[{"condition":"contextVar.subAction==='duplicateWorkOrder'","exitPortType":"NextStep","nodeId":"fetchWorkOrderDetails"},{"condition":"contextVar.subAction ==='cancelWorkOrder' && (contextVar.workOrderReason != '' || typeof contextVar.workOrderReason !== 'undefined') ","exitPortType":"NextStep","nodeId":"fetchCancellationReason"},{"condition":"contextVar.subAction!=='duplicateWorkOrder'","exitPortType":"NextStep","nodeId":"upsertWorkOrder"},{"DefaultStep":true,"condition":"contextVar.subAction===''","exitPortType":"NextStep","nodeId":"end"}],"name":"decisionNode","description":"decisionNode","nodeType":"MULTIDECISION"},"end":{"name":"End","description":"end","inputVarMap":{"priorityDeadlineData":"priorityDeadlineData","workOrderId":"workOrderId","workOrderRequestedDate":"workOrderRequestedDate"},"outputVarMap":{"priorityDeadlineData":"priorityDeadlineData","workOrderId":"workOrderId","workOrderRequestedDate":"workOrderRequestedDate"},"nodeType":"END"},"upsertWorkOrder":{"connectors":[{"exitPortType":"NextStep","nodeId":"addSubActionForWorkOrderTask"}],"processId":"FVLMOO7ADC","name":"upsertWorkOrder","description":"Upsert workOrder Model","inputVarMap":{},"outputVarMap":{"workOrderId":"workOrderId"},"nodeType":"WORKFLOW"},"insertWorkOrderInventoryData":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"workOrderInventoryWF","name":"insertWorkOrderInventoryData","description":"insertWorkOrderInventoryData","inputVarMap":{"subAction":"subAction","workOrderInventory":"workOrderInventory"},"outputVarMap":{},"nodeType":"WORKFLOW"}}