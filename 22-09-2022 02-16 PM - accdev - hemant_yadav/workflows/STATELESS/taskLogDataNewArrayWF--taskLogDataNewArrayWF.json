{"findNumberOfTaskLogBatches":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTaskLogsPresent"}],"contextChangePermitted":true,"name":"findNumberOfTaskLogBatches","description":"findNumberOfTaskLogBatches","processRule":"contextVar.noOfTaskLogBatches = Math.ceil(contextVar.TaskLogCount / contextVar.customBatchSize);contextVar.newTaskLogBatchNumber = contextVar.techTaskLogBatchNumber + 1;","nodeType":"PROCESS"},"appendEventType":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"contextChangePermitted":true,"name":"appendEventType","description":"appendEventType","processRule":"if (typeof contextVar.appendTaskLogData != 'undefined' && contextVar.appendTaskLogData != '' && contextVar.appendTaskLogData.length > 0) { contextVar.formattedData = []; contextVar.appendTaskLogData.forEach(function (element) { element.log[0]['eventType'] = element.eventType; contextVar.formattedData.push(element.log[0]); }) }","id":"appendEventType","nodeType":"PROCESS"},"appendTaskLogs":{"connectors":[{"exitPortType":"NextStep","nodeId":"areMoreTaskLogsPresent"}],"contextChangePermitted":true,"name":"appendTaskLogs","description":"appendTaskLogs","processRule":"if (Array.isArray(contextVar.taskLogData)) { contextVar.taskLogData.forEach(function(obj){contextVar.appendTaskLogData.push(obj);}); } contextVar.newTaskLogBatchNumber = contextVar.newTaskLogBatchNumber + 1;","id":"appendTaskLogs","nodeType":"PROCESS"},"workflowContext":{"customBatchSize":1000,"newTaskLogBatchNumber":0},"getTaskLogData":{"filter":"filter","models":["taskLog"],"connectors":[{"exitPortType":"NextStep","nodeId":"findNumberOfTaskLogBatches"}],"columns":{"log":"taskLog.log","workOrderTaskId":"taskLog.taskId","eventType":"taskLog.eventType"},"name":"getTaskLogData","description":"getTaskLogData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","filter":"filter","loopArray":"loopArray","workOrderTaskId":"workOrderTaskId"},"outputVarMap":{"data":"appendTaskLogData","count":"TaskLogCount","batchSize":"techTaskLogbatchSize","batchNumber":"techTaskLogBatchNumber"},"nodeType":"QUERY","batchSize":"batchSize","getCount":true},"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"createFilterForWorkOrderTaskId"}],"name":"Start","description":"Start","nodeType":"START"},"createFilterForWorkOrderTaskId":{"connectors":[{"exitPortType":"NextStep","nodeId":"getTaskLogData"}],"contextChangePermitted":true,"name":"createFilterForWorkOrderTaskId","description":"createFilterForCancellation","processRule":"{ if( typeof contextVar.workOrderTaskId === 'undefined' || contextVar.workOrderTaskId === ''){ contextVar.filter =''; }else{ contextVar.filter ='{$workOrderTaskId} = {@workOrderTaskId}'; } }","nodeType":"PROCESS"},"end":{"name":"end","description":"End","inputVarMap":{"formattedData":"formattedData"},"outputVarMap":{"formattedData":"formattedData"},"nodeType":"END"},"areMoreTaskLogsPresent":{"connectors":[{"exitPortType":"TrueStep","nodeId":"fetchMoreTechsTaskLog"},{"exitPortType":"FalseStep","nodeId":"appendEventType"}],"name":"areMoreTaskLogsPresent","description":"areMoreTaskLogsPresent","processRule":"contextVar.noOfTaskLogBatches >= 2","id":"areMoreTaskLogsPresent","nodeType":"DECISION"},"fetchMoreTechsTaskLog":{"connectors":[{"exitPortType":"TrueStep","nodeId":"getMoreTaskLogData"},{"exitPortType":"FalseStep","nodeId":"appendEventType"}],"data":"appendTaskLogData","name":"fetchMoreTechsTaskLog","description":"fetchMoreTechsTaskLog","inputVarMap":{},"processRule":"contextVar.noOfTaskLogBatches >= contextVar.newTaskLogBatchNumber","id":"fetchMoreTechsTaskLog","outputVarMap":{},"nodeType":"WHILELOOP"},"workflowNodes":["start","createFilterForWorkOrderTaskId","getTaskLogData","findNumberOfTaskLogBatches","areMoreTaskLogsPresent","fetchMoreTechsTaskLog","getMoreTaskLogData","appendTaskLogs","appendEventType","end"],"getMoreTaskLogData":{"models":["taskLog"],"connectors":[{"exitPortType":"NextStep","nodeId":"appendTaskLogs"}],"columns":{"log":"taskLog.log","id":"taskLog.taskId","eventType":"taskLog.eventType"},"description":"getMoreTaskLogData","distinct":true,"inputVarMap":{"customBatchSize":"batchSize","newTaskLogBatchNumber":"batchNumber","workOrderTaskFilter":"filter","loopArray":"loopArray","workOrderTaskId":"taskId"},"nodeType":"QUERY","filter":"filter","name":"getMoreTaskLogData","outputVarMap":{"data":"taskLogData"},"batchSize":"batchSize","getCount":true,"batchNumber":"batchNumber"}}