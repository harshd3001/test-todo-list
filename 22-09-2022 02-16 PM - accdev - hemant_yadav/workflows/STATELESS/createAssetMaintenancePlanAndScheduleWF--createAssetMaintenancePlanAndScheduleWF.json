{"start":{"connectors":[{"exitPortType":"NextStep","nodeId":"wfExecutionFlowCheck"}],"name":"start","description":"start","nodeType":"START"},"callAssetMaintenancePlanInstalledBaseProcessEvent":{"eventId":"assetMaintenancePlanInstalledBaseProcessEvent","connectors":[{"exitPortType":"NextStep","nodeId":"upsertMaintenanceScheduleWFCall"}],"multirecord":true,"name":"callAssetMaintenancePlanInstalledBaseProcessEvent","description":"callAssetMaintenancePlanInstalledBaseProcessEvent","inputVarMap":{"assetSubAction":"subAction","assetMaintenancePlanInstalledBase":"assetMaintenancePlanInstalledBase"},"outputVarMap":{"data":"assetId"},"nodeType":"PUBLISH"},"processMaintenanceScheduleData":{"connectors":[{"exitPortType":"NextStep","nodeId":"deadlineCalculationCheck"}],"contextChangePermitted":true,"name":"processMaintenanceScheduleData","description":"calculate maintenance plan","processRule":"@XMD9TQPNUP","nodeType":"PROCESS","jsEngine":"es6"},"upsertMaintenancePlanWFCall":{"connectors":[{"exitPortType":"NextStep","nodeId":"processUpsertdata"}],"processId":"assetMaintenancePlanWF","name":"upsertMaintenancePlanWFCall","description":"upsertMaintenancePlanWFCall","inputVarMap":{"maintenancePlanData":"assetMaintenancePlan","subAction":"subActionForPlan"},"outputVarMap":{"assetMaintenancePlanData":"assetMaintenancePlanData"},"nodeType":"WORKFLOW"},"workflowNodes":["start","wfExecutionFlowCheck","createScheduleDate","deadlineCalculationCheck","callCalculateDeadlineWF","processMaintenanceScheduleData","processMaintenancePlanData","upsertMaintenancePlanWFCall","processUpsertdata","upsertCustomerSitesWFCall","callAssetMaintenancePlanInstalledBaseProcessEvent","formatMaintenanceScheduleData","upsertMaintenanceScheduleWFCall","end"],"upsertCustomerSitesWFCall":{"connectors":[{"exitPortType":"NextStep","nodeId":"callAssetMaintenancePlanInstalledBaseProcessEvent"}],"processId":"assetMaintenancePlanSiteWF","multirecord":true,"name":"upsertCustomerSitesWFCall","description":"upsertCustomerSitesWFCall","inputVarMap":{"assetMaintenancePlanSite":"assetMaintenancePlanSite","customerSiteSubAction":"subAction"},"outputVarMap":{"data":"siteId"},"nodeType":"WORKFLOW"},"wfExecutionFlowCheck":{"connectors":[{"condition":"contextVar.subAction === 'createMaintenanceSchedule' ","exitPortType":"NextStep","nodeId":"createScheduleDate"},{"condition":"contextVar.subAction === 'upsertAssetMaintenancePlan' ","exitPortType":"NextStep","nodeId":"processMaintenancePlanData"},{"DefaultStep":true,"condition":"contextVar.subAction==='' ","exitPortType":"NextStep","nodeId":"end"}],"name":"wfExecutionFlowCheck","description":"wfExecutionFlowCheck","nodeType":"MULTIDECISION"},"processMaintenancePlanData":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertMaintenancePlanWFCall"}],"contextChangePermitted":true,"name":"processMaintenancePlanData","description":"processMaintenancePlanData","processRule":"{contextVar.maintenancePlanData.push(contextVar.assetMaintenancePlan);}","nodeType":"PROCESS","jsEngine":"es6"},"upsertMaintenanceScheduleWFCall":{"connectors":[{"exitPortType":"NextStep","nodeId":"end"}],"processId":"assetMaintenanceScheduleWF","multirecord":true,"name":"upsertMaintenanceScheduleWFCall","description":"upsertMaintenanceScheduleWFCall","inputVarMap":{"maintenanceScheduleSubAction":"subAction","assetMaintenanceSchedule":"assetMaintenanceSchedule"},"outputVarMap":{"assetMaintenanceScheduleData":"assetMaintenanceScheduleData"},"nodeType":"WORKFLOW"},"workflowContext":{"maintenanceScheduleSubAction":"upsertAssetMaintenanceSchedule","assetSubAction":"upsertAssetMaintenancePlanInstalledBase","maintenancePlanData":[],"customerSiteSubAction":"upsertAssetMaintenancePlanSite"},"callCalculateDeadlineWF":{"connectors":[{"exitPortType":"NextStep","nodeId":"processMaintenanceScheduleData"}],"processId":"CWFEEU7WFX","name":"callCalculateDeadlineWF","description":"callCalculateDeadlineWF","inputVarMap":{"calendarId":"workOrderCalendarId","slaId":"workOrderSlaId","timezoneOffset":"timezoneOffset","scheduledOnDate":"workOrderRequestedDate"},"outputVarMap":{"priorityDeadlineData":"workOrderDeadlineData"},"nodeType":"WORKFLOW"},"createScheduleDate":{"connectors":[{"exitPortType":"NextStep","nodeId":"deadlineCalculationCheck"}],"contextChangePermitted":true,"name":"createScheduleDate","description":"createScheduleDate","processRule":"for (var key in contextVar.assetMaintenancePlan) { contextVar[key] = contextVar.assetMaintenancePlan[key]; }; contextVar.scheduledOnDate = new Date(contextVar.firstMaintenanceDate).toISOString().replace('T', ' ').replace('Z', ''); contextVar.maintenanceScheduleData = []","nodeType":"PROCESS","jsEngine":"es6"},"formatMaintenanceScheduleData":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertMaintenanceScheduleWFCall"}],"contextChangePermitted":true,"name":"formatMaintenanceScheduleData","description":"formatMaintenanceScheduleData","processRule":"contextVar.assetMaintenanceSchedule = { 'selectedSchedules': contextVar.maintenanceScheduleData };","nodeType":"PROCESS"},"processUpsertdata":{"connectors":[{"exitPortType":"NextStep","nodeId":"upsertCustomerSitesWFCall"}],"contextChangePermitted":true,"name":"processUpsertdata","description":"processUpsertdata","processRule":"if (Array.isArray(contextVar.assetMaintenancePlanData) && contextVar.assetMaintenancePlanData.length > 0) { contextVar.planId = contextVar.assetMaintenancePlanData[0].id; }; contextVar.assetMaintenancePlanSite = { 'assetMaintenancePlanId': contextVar.planId, 'selectedSites': contextVar.selectedSites }; contextVar.assetMaintenancePlanInstalledBase = { 'assetMaintenancePlanId': contextVar.planId, 'selectedAssets': contextVar.selectedAssets }; if (Array.isArray(contextVar.maintenanceScheduleData) && contextVar.maintenanceScheduleData.length > 0) { contextVar.maintenanceScheduleData.forEach(element => { element.assetMaintenancePlanId = contextVar.planId; }) } contextVar.assetMaintenanceSchedule = { 'selectedSchedules': contextVar.maintenanceScheduleData };","nodeType":"PROCESS","jsEngine":"es6"},"end":{"name":"end","description":"end","inputVarMap":{"assetMaintenanceScheduleData":"assetMaintenanceScheduleData"},"outputVarMap":{"assetMaintenanceScheduleData":"assetMaintenanceScheduleData"},"nodeType":"END"},"deadlineCalculationCheck":{"connectors":[{"condition":"contextVar.scheduledOnDate <= contextVar.lastMaintenanceDate && contextVar.slaId !== '-' ","exitPortType":"NextStep","nodeId":"callCalculateDeadlineWF"},{"condition":"contextVar.scheduledOnDate <= contextVar.lastMaintenanceDate && (contextVar.slaId === '-' || typeof contextVar.slaId === 'undefined' || contextVar.slaId === '')","exitPortType":"NextStep","nodeId":"processMaintenanceScheduleData"},{"DefaultStep":true,"condition":"contextVar.scheduledOnDate > contextVar.lastMaintenanceDate","exitPortType":"NextStep","nodeId":"formatMaintenanceScheduleData"}],"name":"deadlineCalculationCheck","description":"deadlineCalculationCheck","nodeType":"MULTIDECISION"}}