{"pageContext":{},"actionOnLoad":["@actions.fetchInProgressWOCount","@actions.fetchTsNts","@actions.initialData","@actions.initialDataForAddress"],"localPageContext":true,"jslib":{"isDeactivated":"function(pageContext){return (pageContext.customerAction=='view');}","canDeactivate":"function(pageContext){return (pageContext.customerAction !== 'edit' || (pageContext.customerAction === 'edit' && (typeof pageContext.inProgressWOCount === 'undefined' || pageContext.inProgressWOCount === '' || pageContext.inProgressWOCount===0)));}","notView":"function(pageContext){return(pageContext.customerAction !== 'view');}","isAdd":"function(pageContext){return(pageContext.customerAction === 'add');}","dynamicHeaderText":"function(pageContext){ if(pageContext.customerAction === 'add'){return '@lang.[\"anc2\",\"Add New Customer\"]'}else if(pageContext.customerAction === 'edit' || pageContext.customerAction === 'view'){return '@lang.[\"ec3\",\"Edit Customer\"]'}}","cannotDeactivate":"function(pageContext){return (pageContext.customerAction !== 'edit' || (pageContext.customerAction === 'edit' && (typeof pageContext.inProgressWOCount === 'undefined' || pageContext.inProgressWOCount === '' ||pageContext.inProgressWOCount>0)));}","isSaveDisabled":"function (pageContext) { if (pageContext.customerAction === 'add') { return !(typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.city !== '' && pageContext.customerPostalCode !== '' && pageContext.addressObj.country !== '' && pageContext.addressObj.zipCode !== '' && typeof pageContext.customerCompanyName !== 'undefined' && pageContext.customerCompanyName !== '' &&  typeof pageContext.customerBillingAddress !== 'undefined' && pageContext.customerBillingAddress !== '' && typeof pageContext.customerContactPhone !== 'undefined' && pageContext.customerContactPhone !== '' && typeof pageContext.customerContactPerson !== 'undefined' && pageContext.customerContactPerson !== '' && pageContext.customerContactEmail !== '' && typeof pageContext.customerContactEmail !== 'undefined' && typeof pageContext.contactPhoneIsValid !== 'undefined' && pageContext.contactPhoneIsValid === true) } else if (pageContext.customerAction === 'edit') { return (((pageContext.customerCompanyName === pageContext.initialCompanyName) && (pageContext.customerAnowClientId === pageContext.initialAnowClientId) && (pageContext.customerTsNtsValue === pageContext.initialTsNtsValue) &&(pageContext.customerBillingAddress === pageContext.initialBillingAddress) && (pageContext.initialAddressTwo === pageContext.customerAddressTwo) && (pageContext.customerContactPhone === pageContext.initialContactPhone) && (pageContext.initialDescription === pageContext.customerDescription) && (pageContext.initialContactTitle === pageContext.customerContactTitle) && (pageContext.initialContactEmail === pageContext.customerContactEmail) && (pageContext.initialContactPerson === pageContext.customerContactPerson) || !(typeof pageContext.addressObj !== 'undefined' && pageContext.addressObj.city !== '' && pageContext.customerPostalCode !== '' && pageContext.addressObj.country !== '' && pageContext.addressObj.zipCode !== '' && typeof pageContext.customerCompanyName !== 'undefined' && pageContext.customerCompanyName !== '' &&  typeof pageContext.customerBillingAddress !== 'undefined' && pageContext.customerBillingAddress !== '' && typeof pageContext.customerContactPhone !== 'undefined' && pageContext.customerContactPhone !== '' && typeof pageContext.customerContactPerson !== 'undefined' && pageContext.customerContactPerson !== '' && pageContext.customerContactEmail !== '' && typeof pageContext.customerContactEmail !== 'undefined'))); } else if (pageContext.customerAction === 'view') { return true; } }"},"header":{"children":[{"hidden":"@jslib.isAdd","statusColor":"@pageContext.statusNameColor","id":"status","type":"status","value":"@pageContext.statusName"},{"buttonType":"secondary","hidden":"@jslib.canDeactivate","actionOnClick":["@actions.openCannotDeactivateModal"],"id":"cannotDeactivate","type":"button","title":"@lang.['d10','Deactivate']"},{"buttonType":"secondary","hidden":"@jslib.cannotDeactivate","actionOnClick":["@actions.openCanDeactivateModal"],"id":"canDeactivate","type":"button","title":"@lang.['d10','Deactivate']"},{"buttonType":"secondary","hidden":"@jslib.notView","actionOnClick":["@actions.openReactivateModal"],"id":"reactivate","type":"button","title":"@lang.['r6','Reactivate']"},{"buttonType":"primary","actionOnClick":["@actions.setSubActionUpsertCustomer","@actions.fireProcessEvent","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"disabled":"@jslib.isSaveDisabled","id":"submit","type":"button","title":"@lang.['s12','Save']"},{"icon":"@iconlib.NavigationCloseGrey","actionOnClick":["@actions.closePanel","@actions.clearPageContext"],"id":"Close","type":"buttonIcon"}],"title":"@jslib.dynamicHeaderText"},"body":{"children":[{"children":[{"children":[{"children":[{"isRequired":true,"inputType":"text","disabled":"@jslib.isDeactivated","id":"companyName","label":"@lang.['c16','Customer']","placeholder":"@lang.['en1','Enter name']","type":"input","value":"@pageContext.customerCompanyName"},{"disabled":"@jslib.isDeactivated","id":"description","label":"@lang.['d7','Description (Optional)']","type":"textarea","value":"@pageContext.customerDescription","placeHolder":"@lang.['ed1','Enter description']"},{"inputType":"text","disabled":"@jslib.isDeactivated","id":"anowClientId","label":"@lang.['acio1','Anow Client Id (Optional)']","placeholder":"@lang.['enterAnowClientId','Enter Anow Client Id']","type":"input","value":"@pageContext.customerAnowClientId"},{"isRequired":true,"options":"@pageContext.tsNtsValues","optTitleKey":"listOptionAnswerOptionText","optValueKey":"listOptionAnswerOptionText","id":"tsNtsList","title":"@lang.['tsNtso','TS / NTS (Optional)']","type":"select","value":"@pageContext.customerTsNtsValue","placeHolder":"@lang.['stsNts','Select TS / NTS ']"}],"label":"@lang.['gi','General Information']","id":"customerInfo","type":"section"},{"children":[{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"billingAddress","label":"@lang.['address','Address']","placeholder":"@lang.['ea','Enter address']","type":"address","value":"@pageContext.customerBillingAddress"},{"isRequired":true,"inputType":"text","disabled":"@jslib.isDeactivated","id":"addressTwo","label":"@lang.['at01','Address Two (Optional)']","placeholder":"@lang.['eat01','Enter Address Two']","type":"input","value":"@pageContext.customerAddressTwo"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"city","label":"@lang.['c','City']","placeholder":"@lang.['cibosa','City is based on selected address']","type":"input","value":"@pageContext.addressObj.city"},{"disabled":"@jslib.isDeactivated","id":"state","label":"@lang.['s30','State (Optional)']","placeholder":"@lang.['sibosa','State is based on selected address']","type":"input","value":"@pageContext.addressObj.state"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"postalCode","label":"@lang.['pc','Postal Code']","placeholder":"@lang.['pcibosa','Postal code is based on selected address']","type":"input","value":"@pageContext.addressObj.zipCode"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"country","label":"@lang.['c1','Country']","placeholder":"@lang.['cibosa1','Country is based on selected address']","type":"input","value":"@pageContext.addressObj.country"},{"address":"@pageContext.customerBillingAddress","hidden":true,"type":"latitude","value":"@pageContext.latitude"},{"address":"@pageContext.customerBillingAddress","hidden":true,"type":"longitude","value":"@pageContext.longitude"}],"label":"@lang.['li','Location Information']","id":"locationInfo","type":"section"},{"children":[{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"text","id":"contactPerson","label":"@lang.['cpn','Contact Person Name']","placeholder":"@lang.['ecpn','Enter contact person name']","type":"input","value":"@pageContext.customerContactPerson"},{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"text","id":"contactTitle","label":"@lang.['cpt','Contact Person Title']","placeholder":"@lang.['ejt','Enter job title']","type":"input","value":"@pageContext.customerContactTitle"},{"isRequired":true,"disabled":"@jslib.isDeactivated","id":"contactPhone","label":"@lang.['cp','Contact Phone']","type":"phoneNumber","value":"@pageContext.customerContactPhone"},{"isRequired":true,"disabled":"@jslib.isDeactivated","inputType":"email","id":"contactEmail","label":"@lang.['ce','Contact Email']","placeholder":"@lang.['ee','Enter email']","type":"input","value":"@pageContext.customerContactEmail"}],"label":"@lang.['ci4','Contact Information']","id":"contactInfo","type":"section"}],"label":"@lang.['ci','Customer Information']","type":"tab"},{"hidden":"@jslib.isAdd","children":[{"children":[{"label":"","id":"customerSitesGrid","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{}},"isScrollAble":true,"tableWidth":"50rem","searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['s','Status']","options":{"flex":1.3,"sortOrder":"ASC","colorCode":"statusNameColor","sortable":true,"showLabel":true},"key":"statusName"},{"name":"@lang.['sn1','Site Name']","options":{"flex":1.5,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"siteName"},{"name":"@lang.['c16','Customer']","options":{"flex":1.1,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"customerCompanyName"},{"name":"@lang.['c','City']","options":{"flex":0.9,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"siteCity"},{"name":"@lang.['m12','Market']","options":{"flex":0.9,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"regionName"},{"name":"@lang.['c1','Country']","options":{"flex":0.9,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"siteCountry"}],"dataToBeSent":{"filter":"{$siteSiteType} = 'customerSite' and {$siteCustomerId} = {@customerId}","models":["customer","site","region","subRegion","ZStatus"],"columns":{"siteRegionId":"site.regionId","siteRecver":"site.recver","siteCity":"site.city","customerCompanyName":"customer.companyName","regionName":"region.name","siteState":"site.state","siteAddress":"site.address","siteDescription":"site.description","siteName":"site.name","siteCountry":"site.country","siteCustomerId":"site.customerId","statusNameColor":"ZStatus.colorCode","siteSiteType":"site.siteType","siteSubRegionId":"site.subRegionId","sitePostalCode":"site.postalCode","statusName":"ZStatus.name","siteId":"site.id","subRegionName":"subRegion.name"},"inputs":{"siteSiteType":"@pageContext.siteSiteType","customerId":"@pageContext.customerId"},"name":"loadCustomerSites","outerJoinOnModel":"site","orderBy":"siteName ASC","distinct":true,"description":"loadCustomerSites"},"dataSourceId":"query/read","header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['cs01','Customer Sites']"},"isSelectable":false,"updateAllowed":true,"actions":[],"searchKeys":["subRegionName","regionName","siteCity","siteCountry","siteName","statusName","customerCompanyName"]}}],"localPageContext":true,"label":"","id":"customerSiteDataGrid","type":"section","transparent":true}],"label":"@lang.['cs01','Customer Sites']","type":"tab"},{"hidden":"@jslib.isAdd","children":[{"children":[{"label":"","id":"ApprovedAnalysts","type":"dataGrid","jsonDef":{"pageContextConfig":{"enable":true,"isPaginationReqd":false,"tableData":{}},"isScrollAble":true,"deleteAllowed":true,"tableWidth":"50rem","searchAllowed":true,"searchEmptyScreen":{"image":"@iconlib.ActionsSearchError","contentValue":"@lang.['sysrcue','SORRY! YOUR SEARCH RESULTS CAME UP EMPTY ']","type":"noData"},"rowActions":{"children":[{"activeIcon":"@iconlib.TrashOrange","name":"delete","icon":"@iconlib.TrashGray","tooltip":"Delete","actionOnClick":["@actions.deleteModal","@actions.refreshDataGrid1"],"type":"button"}]},"emptyScreen":{"image":"@iconlib.ActionsSearchEmpty","contentValue":"@lang.['ylieatm','YOUR LIST IS EMPTY AT THE MOMENT']","type":"noData"},"isSync":true,"tableHeader":[{"name":"@lang.['ap01','Appraiser']","options":{"flex":1.3,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"appraiser"},{"name":"@lang.['an01','Analyst']","options":{"flex":1.3,"sortOrder":"ASC","sortable":true,"showLabel":true},"key":"analystName"},{"name":"@lang.['id','id']","options":{"hidden":true,"showLabel":false},"key":"id"}],"dataToBeSent":{"apiResponseParams":["count"],"inputVar":{},"processId":"acClientApprovedAnalysts","apiResponseFormat":true,"contextVar":{"customerId":"@pageContext.customerId","userId":"{@userId}"},"apiResponseObject":"approvedAnalysts"},"dataSourceId":"process/start","sourceType":"api","rowTextLength":30,"header":{"subHeaderText":"@lang.['r','Records']","headerText":"@lang.['aa02','Approved Analysts']","leftData":{"children":[{"hidden":"@jslib.isBackHidden","name":"back","icon":"@iconlib.NavigationArrowBackGrey","actionOnClick":["@actions.goToPreviousPanel"],"type":"buttonIcon"}]},"children":[{"buttonType":"primary","hidden":"","actionOnClick":["@actions.setActionAdd","@actions.openApprovedAnalystNSP"],"id":"addNew","type":"button","title":"@lang.['an02','Add New']"}]},"isSelectable":false,"updateAllowed":true,"actions":[{"name":"setActionAdd","type":"script","actionDef":"function(pageContext){pageContext.ApprovedAnalystsTaskAction='add';}"},{"name":"openApprovedAnalystNSP","type":"openPanel","pageId":"acCustomerNSP"},{"name":"goToPreviousPanel","type":"backPanel"},{"endPoint":"model/delete","name":"apiDelete2","type":"api","actionDef":{"data":[{"modelName":"acClientApprovedWorkforce","clientId":"@pageContext.customerId","recver":"@pageContext.recver","id":"@pageContext.id","analystId":"@pageContext.analystId","acClientApprovedWorkforceId":"@pageContext.id","appraiserId":"@pageContext.appraiserValue"}]}},{"subTitle":"Deleting  an Approved Analyst will not modify existing Tasks. Are you sure you want to delete? Click OK to Delete and Cancel otherwise","name":"deleteModal","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.apiDelete2","@actions.closeModal1","@actions.refreshDataGrid1"],"type":"button","title":"OK"},{"buttonType":"secondary","name":"Cancel","actionOnClick":["@actions.closeModal1"],"type":"button","title":"Cancel"}],"type":"openModal","title":"Confirm delete"},{"name":"closeModal1","type":"closeModal"},{"name":"clearPageContext","type":"clearPageContext"},{"name":"refreshDataGrid1","type":"refreshDataGrid"}],"searchKeys":["analystName"]}}],"localPageContext":true,"label":"","id":"ApprovedAnalysts","type":"section","transparent":true}],"label":"@lang.['aa02','Approved Analysts']","type":"tab"}],"id":"customerSitesTab","type":"tab"}]},"actions":[{"name":"fetchTsNts","outputVarMap":{"data":"@pageContext.tsNtsValues"},"type":"query","actionDef":{"filter":"{$listOptionId} = {@idFilter} AND ( {$listOptionAnswerOptionText} like {@filter} || {$listOptionAnswerRank} like {@filter} )","models":["listOption","listOptionAnswer"],"inputs":{"filter":"%%","idFilter":"927COV12P5"},"columns":{"listOptionAnswerRank":"listOptionAnswer.rank","listOptionAnswerOptionText":"listOptionAnswer.answerOptionText","listOptionAnswerRecver":"listOptionAnswer.recver","listOptionAnswerOptionId":"listOptionAnswer.id","listOptionId":"listOption.id"},"orderBy":"listOptionAnswerOptionText ASC","batchSize":50,"getCount":true,"batchNumber":1}},{"name":"initialData","type":"script","actionDef":"function(pageContext) { if (pageContext.customerAction == 'add') { pageContext.customerStatusId = 'customerActive'; pageContext.customerBillingAddress = ''; pageContext.customerDescription = ''; pageContext.customerCompanyName = ''; pageContext.customerTsNtsValue = ''; pageContext.customerAnowClientId = ''; pageContext.addressObj = {}; pageContext.addressObj.zipCode = ''; pageContext.customerContactPhone = ''; pageContext.customerContactPerson = ''; pageContext.addressObj.country = ''; pageContext.addressObj.state = ''; pageContext.addressObj.city = ''; } else if (pageContext.customerAction == 'edit') { pageContext.initialBillingAddress = pageContext.customerBillingAddress; pageContext.initialAddressTwo = pageContext.customerAddressTwo; pageContext.initialDescription = pageContext.customerDescription; pageContext.initialCompanyName = pageContext.customerCompanyName; pageContext.initialContactEmail = pageContext.customerContactEmail; pageContext.initialContactPhone = pageContext.customerContactPhone; pageContext.initialContactTitle = pageContext.customerContactTitle; pageContext.initialContactPerson = pageContext.customerContactPerson; pageContext.initialTsNtsValue = pageContext.customerTsNtsValue; pageContext.initialAnowClientId = pageContext.customerAnowClientId; } } "},{"name":"initialDataForAddress","type":"script","actionDef":"function(pageContext) { if (pageContext.customerAction == 'edit' || pageContext.customerAction === 'view') { pageContext.addressObj = {}; pageContext.addressObj.zipCode = pageContext.customerPostalCode; pageContext.addressObj.country = pageContext.customerCountry; pageContext.addressObj.state = pageContext.customerState; pageContext.addressObj.city = pageContext.customerCity } }"},{"name":"close","type":"script","actionDef":"function(pageContext){pageContext.test='test';}"},{"name":"setSubActionUpsertCustomer","type":"script","actionDef":"function(pageContext){pageContext.subAction='upsertCustomer';}"},{"name":"setSubActionDeactivateCustomer","type":"script","actionDef":"function(pageContext){pageContext.subAction='deactivateCustomer';pageContext.customerStatusId='customerDeactivated';}"},{"name":"setSubActionReactivateCustomer","type":"script","actionDef":"function(pageContext){pageContext.subAction='reactivateCustomer';pageContext.customerStatusId='customerActive';}"},{"name":"fetchInProgressWOCount","outputVarMap":{"data":"@pageContext.inProgressWO","count":"@pageContext.inProgressWOCount"},"type":"query","continueOnError":true,"actionDef":{"filter":"{$workOrderCustomerId}={@customerId} and ({$workOrderTaskStatusId} = 'workOrderTaskAutoScheduling' or {$workOrderStatusId} = 'workOrderInProgress' )","models":["workOrder","customer","workOrderTask"],"inputs":{"customerId":"@pageContext.customerId"},"columns":{"workOrderTaskStatusId":"workOrderTask.statusId","workOrderTaskId":"workOrderTask.id","workOrderId":"workOrder.id","workOrderCustomerId":"workOrder.customerId","workOrderStatusId":"workOrder.statusId"},"links":{"workOrder":"customer","workOrderTask":"workOrder"},"getCount":true}},{"subTitle":"@lang.['aysywtdtctawdtcsctcaaewoat','Are you sure you want to deactivate this customer? This action will deactivate the customer\u2019s sites, cancel the contract and any existing work orders and tasks.']","name":"openCanDeactivateModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionDeactivateCustomer","@actions.fireProcessEvent","@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"type":"button","title":"@lang.['d10','Deactivate']"}],"type":"openModal","title":"@lang.['dc2','Deactivate Customer']"},{"subTitle":"@lang.['tccbdaoomwoawtcaco','This customer cannot be deactivated, as one or more work orders associated with the customer are currently ongoing.']","name":"openCannotDeactivateModal","options":[{"buttonType":"primary","name":"yes","actionOnClick":["@actions.closeModal"],"type":"button","title":"@lang.['o2','OK']"}],"type":"openModal","title":"@lang.['dc2','Deactivate Customer']"},{"subTitle":"@lang.['aysywtrtcyntrtcssacanc','Are you sure you want to reactivate this customer? You\u2019ll need to reactivate this customer\u2019s sites separately and create a new contract.']","name":"openReactivateModal","options":[{"buttonType":"secondary","name":"no","actionOnClick":"@actions.closeModal","type":"button","title":"@lang.['c2','Cancel']"},{"buttonType":"primary","name":"yes","actionOnClick":["@actions.setSubActionReactivateCustomer","@actions.fireProcessEvent","@actions.closeModal","@actions.closePanel","@actions.clearPageContext","@actions.refreshDataGrid"],"type":"button","title":"@lang.['r6','Reactivate']"}],"type":"openModal","title":"@lang.['rc','Reactivate Customer']"},{"endPoint":"event/start","name":"fireProcessEvent","outputVarMap":{"data":"@pageContext.responseData"},"type":"api","actionDef":{"data":[{"eventId":"customerProcessEvent","contextVar":{"cancellationSubAction":"cancelWorkOrderTask","customerSubAction":"@pageContext.subAction","customerId":"@pageContext.customerId","customer":{"country":"@pageContext.addressObj.country","acClientId":"@pageContext.customerAnowClientId","statusTargetModel":"customer","contactEmail":"@pageContext.customerContactEmail","city":"@pageContext.addressObj.city","postalCode":"@pageContext.addressObj.zipCode","companyName":"@pageContext.customerCompanyName","latitude":"@pageContext.latitude","contactPerson":"@pageContext.customerContactPerson","description":"@pageContext.customerDescription","acTsNts":"@pageContext.customerTsNtsValue","contactTitle":"@pageContext.customerContactTitle","isDeactivated":"@pageContext.customerIsDeactivated","statusId":"@pageContext.customerStatusId","billingAddress":"@pageContext.customerBillingAddress","id":"@pageContext.customerId","state":"@pageContext.addressObj.state","acAddressTwo":"@pageContext.customerAddressTwo","contactPhone":"@pageContext.customerContactPhone","longitude":"@pageContext.longitude"}}}]}},{"name":"refreshDataGrid","type":"refreshDataGrid"},{"name":"clearPageContext","type":"clearPageContext"},{"endPoint":"model/delete","name":"apiDelete2","type":"api","actionDef":{"data":[{"modelName":"acClientApprovedWorkforce","clientId":"@pageContext.customerId","recver":"@pageContext.recver","id":"@pageContext.id","analystId":"@pageContext.analystId","acClientApprovedWorkforceId":"@pageContext.id","appraiserId":"@pageContext.appraiserValue"}]}},{"name":"closePanel","type":"closePanel"},{"name":"refreshDataGrid1","type":"refreshDataGrid"},{"name":"closeModal1","type":"closeModal"},{"name":"closeModal","type":"closeModal"}]}